const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-By29LvfG.js","assets/radix-ui-C6G5B-jo.js","assets/react-vendor-Dt2nJDur.js","assets/ui-vendor-BVP4ZoRz.js","assets/Register-D-_rYn1e.js","assets/ForgetPassword-ChyRMPM7.js","assets/VerifyEmail-B1ehFFIg.js"])))=>i.map(i=>d[i]);
import{j as l,_ as qf,a as ba,S as Xu,R as zf,O as cl,b as ul,C as dl,c as hl,T as $u,D as Ku,d as Qu,P as fl,e as Yf,f as Xf,I as $f,V as Kf,g as Qf,h as Zf,i as Jf,k as e0,l as t0,m as r0,n as n0,o as s0,p as i0,q as a0,r as o0,s as l0,t as Zu,u as Ju,W as c0,v as u0,w as d0,x as Us,y as Wn,z as wi,A as h0,L as f0,B as g0,E as m0,F as x0}from"./radix-ui-C6G5B-jo.js";import{e as p0,r as D,u as w0,L as Yi,R as rr,f as va,g as Xi,h as y0,i as ed,B as b0,j as v0,k as pr,N as Or}from"./react-vendor-Dt2nJDur.js";import{L as td,c as rd,M as C0,C as Ms,a as _0,b as E0,t as xe,G as Io,U as nd,S as gl,A as A0,D as sd,F as N0,Q as Gs,d as id,e as yi,f as bc,X as ml,g as S0,h as ad,i as xl,j as I0,k as od,l as ld,m as bi,P as T0,n as Xs,o as vc,p as To,q as us,E as cd,r as Ca,T as Oi,s as Ka,u as vi,v as pl,w as ud,x as Oo,y as Ro,z as wl,B as O0,H as Cc,I as dd,J as R0,K as _c,N as j0,O as k0,R as D0,V as P0,W as M0,Y as L0,Z as B0}from"./ui-vendor-BVP4ZoRz.js";function F0(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const u in i)if(u!=="default"&&!(u in t)){const d=Object.getOwnPropertyDescriptor(i,u);d&&Object.defineProperty(t,u,d.get?d:{enumerable:!0,get:()=>i[u]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function n(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(u){if(u.ep)return;u.ep=!0;const d=n(u);fetch(u.href,d)}})();var $i={},Ec;function U0(){if(Ec)return $i;Ec=1;var t=p0();return $i.createRoot=t.createRoot,$i.hydrateRoot=t.hydrateRoot,$i}var W0=U0(),$s=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},V0={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},H0=class{#e=V0;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},ns=new H0;function G0(t){setTimeout(t,0)}var is=typeof window>"u"||"Deno"in globalThis;function br(){}function q0(t,e){return typeof t=="function"?t(e):t}function jo(t){return typeof t=="number"&&t>=0&&t!==1/0}function hd(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Mn(t,e){return typeof t=="function"?t(e):t}function Yr(t,e){return typeof t=="function"?t(e):t}function Ac(t,e){const{type:n="all",exact:i,fetchStatus:u,predicate:d,queryKey:g,stale:w}=t;if(g){if(i){if(e.queryHash!==yl(g,e.options))return!1}else if(!Ci(e.queryKey,g))return!1}if(n!=="all"){const p=e.isActive();if(n==="active"&&!p||n==="inactive"&&p)return!1}return!(typeof w=="boolean"&&e.isStale()!==w||u&&u!==e.state.fetchStatus||d&&!d(e))}function Nc(t,e){const{exact:n,status:i,predicate:u,mutationKey:d}=t;if(d){if(!e.options.mutationKey)return!1;if(n){if(as(e.options.mutationKey)!==as(d))return!1}else if(!Ci(e.options.mutationKey,d))return!1}return!(i&&e.state.status!==i||u&&!u(e))}function yl(t,e){return(e?.queryKeyHashFn||as)(t)}function as(t){return JSON.stringify(t,(e,n)=>ko(n)?Object.keys(n).sort().reduce((i,u)=>(i[u]=n[u],i),{}):n)}function Ci(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Ci(t[n],e[n])):!1}var z0=Object.prototype.hasOwnProperty;function fd(t,e){if(t===e)return t;const n=Sc(t)&&Sc(e);if(!n&&!(ko(t)&&ko(e)))return e;const u=(n?t:Object.keys(t)).length,d=n?e:Object.keys(e),g=d.length,w=n?new Array(g):{};let p=0;for(let m=0;m<g;m++){const b=n?m:d[m],C=t[b],_=e[b];if(C===_){w[b]=C,(n?m<u:z0.call(t,b))&&p++;continue}if(C===null||_===null||typeof C!="object"||typeof _!="object"){w[b]=_;continue}const N=fd(C,_);w[b]=N,N===C&&p++}return u===g&&p===u?t:w}function ia(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Sc(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ko(t){if(!Ic(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Ic(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Ic(t){return Object.prototype.toString.call(t)==="[object Object]"}function Y0(t){return new Promise(e=>{ns.setTimeout(e,t)})}function Do(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?fd(t,e):e}function X0(t,e,n=0){const i=[...t,e];return n&&i.length>n?i.slice(1):i}function $0(t,e,n=0){const i=[e,...t];return n&&i.length>n?i.slice(0,-1):i}var bl=Symbol();function gd(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===bl?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function vl(t,e){return typeof t=="function"?t(...e):!!t}function K0(t,e,n){let i=!1,u;return Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(u??=e(),i||(i=!0,u.aborted?n():u.addEventListener("abort",n,{once:!0})),u)}),t}var Q0=class extends $s{#e;#t;#r;constructor(){super(),this.#r=t=>{if(!is&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#r=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Cl=new Q0;function Po(){let t,e;const n=new Promise((u,d)=>{t=u,e=d});n.status="pending",n.catch(()=>{});function i(u){Object.assign(n,u),delete n.resolve,delete n.reject}return n.resolve=u=>{i({status:"fulfilled",value:u}),t(u)},n.reject=u=>{i({status:"rejected",reason:u}),e(u)},n}var Z0=G0;function J0(){let t=[],e=0,n=w=>{w()},i=w=>{w()},u=Z0;const d=w=>{e?t.push(w):u(()=>{n(w)})},g=()=>{const w=t;t=[],w.length&&u(()=>{i(()=>{w.forEach(p=>{n(p)})})})};return{batch:w=>{let p;e++;try{p=w()}finally{e--,e||g()}return p},batchCalls:w=>(...p)=>{d(()=>{w(...p)})},schedule:d,setNotifyFunction:w=>{n=w},setBatchNotifyFunction:w=>{i=w},setScheduler:w=>{u=w}}}var nr=J0(),e1=class extends $s{#e=!0;#t;#r;constructor(){super(),this.#r=t=>{if(!is&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#r=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},aa=new e1;function t1(t){return Math.min(1e3*2**t,3e4)}function md(t){return(t??"online")==="online"?aa.isOnline():!0}var Mo=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function xd(t){let e=!1,n=0,i;const u=Po(),d=()=>u.status!=="pending",g=T=>{if(!d()){const k=new Mo(T);_(k),t.onCancel?.(k)}},w=()=>{e=!0},p=()=>{e=!1},m=()=>Cl.isFocused()&&(t.networkMode==="always"||aa.isOnline())&&t.canRun(),b=()=>md(t.networkMode)&&t.canRun(),C=T=>{d()||(i?.(),u.resolve(T))},_=T=>{d()||(i?.(),u.reject(T))},N=()=>new Promise(T=>{i=k=>{(d()||m())&&T(k)},t.onPause?.()}).then(()=>{i=void 0,d()||t.onContinue?.()}),I=()=>{if(d())return;let T;const k=n===0?t.initialPromise:void 0;try{T=k??t.fn()}catch(M){T=Promise.reject(M)}Promise.resolve(T).then(C).catch(M=>{if(d())return;const H=t.retry??(is?0:3),B=t.retryDelay??t1,z=typeof B=="function"?B(n,M):B,ae=H===!0||typeof H=="number"&&n<H||typeof H=="function"&&H(n,M);if(e||!ae){_(M);return}n++,t.onFail?.(n,M),Y0(z).then(()=>m()?void 0:N()).then(()=>{e?_(M):I()})})};return{promise:u,status:()=>u.status,cancel:g,continue:()=>(i?.(),u),cancelRetry:w,continueRetry:p,canStart:b,start:()=>(b()?I():N().then(I),u)}}var pd=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),jo(this.gcTime)&&(this.#e=ns.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(is?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ns.clearTimeout(this.#e),this.#e=void 0)}},r1=class extends pd{#e;#t;#r;#s;#n;#a;#o;constructor(t){super(),this.#o=!1,this.#a=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#s=t.client,this.#r=this.#s.getQueryCache(),this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#e=Oc(this.options),this.state=t.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(t){if(this.options={...this.#a,...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=Oc(this.options);e.data!==void 0&&(this.setState(Tc(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(t,e){const n=Do(this.state.data,t,this.options);return this.#i({data:n,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),n}setState(t,e){this.#i({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#n?.promise;return this.#n?.cancel(t),e?e.then(br).catch(br):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(t=>Yr(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===bl||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Mn(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!hd(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(this.#n&&(this.#o?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(t&&this.setOptions(t),!this.options.queryFn){const w=this.observers.find(p=>p.options.queryFn);w&&this.setOptions(w.options)}const n=new AbortController,i=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(this.#o=!0,n.signal)})},u=()=>{const w=gd(this.options,e),m=(()=>{const b={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(b),b})();return this.#o=!1,this.options.persister?this.options.persister(w,m,this):w(m)},g=(()=>{const w={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:u};return i(w),w})();this.options.behavior?.onFetch(g,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==g.fetchOptions?.meta)&&this.#i({type:"fetch",meta:g.fetchOptions?.meta}),this.#n=xd({initialPromise:e?.initialPromise,fn:g.fetchFn,onCancel:w=>{w instanceof Mo&&w.revert&&this.setState({...this.#t,fetchStatus:"idle"}),n.abort()},onFail:(w,p)=>{this.#i({type:"failed",failureCount:w,error:p})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:g.options.retry,retryDelay:g.options.retryDelay,networkMode:g.options.networkMode,canRun:()=>!0});try{const w=await this.#n.start();if(w===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(w),this.#r.config.onSuccess?.(w,this),this.#r.config.onSettled?.(w,this.state.error,this),w}catch(w){if(w instanceof Mo){if(w.silent)return this.#n.promise;if(w.revert){if(this.state.data===void 0)throw w;return this.state.data}}throw this.#i({type:"error",error:w}),this.#r.config.onError?.(w,this),this.#r.config.onSettled?.(this.state.data,w,this),w}finally{this.scheduleGc()}}#i(t){const e=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...wd(n.data,this.options),fetchMeta:t.meta??null};case"success":const i={...n,...Tc(t.data,t.dataUpdatedAt),dataUpdateCount:n.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=t.manual?i:void 0,i;case"error":const u=t.error;return{...n,error:u,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=e(this.state),nr.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:t})})}};function wd(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:md(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Tc(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Oc(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var n1=class extends $s{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=Po(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#r=void 0;#s=void 0;#n;#a;#o;#i;#m;#h;#f;#c;#u;#l;#g=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Rc(this.#t,this.options)?this.#d():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Lo(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Lo(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#v(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Yr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#C(),this.#t.setOptions(this.options),e._defaulted&&!ia(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&jc(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),i&&(this.#t!==n||Yr(this.options.enabled,this.#t)!==Yr(e.enabled,this.#t)||Mn(this.options.staleTime,this.#t)!==Mn(e.staleTime,this.#t))&&this.#x();const u=this.#p();i&&(this.#t!==n||Yr(this.options.enabled,this.#t)!==Yr(e.enabled,this.#t)||u!==this.#l)&&this.#w(u)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return i1(this,n)&&(this.#s=n,this.#a=this.options,this.#n=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,i)=>(this.trackProp(i),e?.(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,i))})}trackProp(t){this.#g.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#C();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(br)),e}#x(){this.#b();const t=Mn(this.options.staleTime,this.#t);if(is||this.#s.isStale||!jo(t))return;const n=hd(this.#s.dataUpdatedAt,t)+1;this.#c=ns.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#p(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#w(t){this.#v(),this.#l=t,!(is||Yr(this.options.enabled,this.#t)===!1||!jo(this.#l)||this.#l===0)&&(this.#u=ns.setInterval(()=>{(this.options.refetchIntervalInBackground||Cl.isFocused())&&this.#d()},this.#l))}#y(){this.#x(),this.#w(this.#p())}#b(){this.#c&&(ns.clearTimeout(this.#c),this.#c=void 0)}#v(){this.#u&&(ns.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,i=this.options,u=this.#s,d=this.#n,g=this.#a,p=t!==n?t.state:this.#r,{state:m}=t;let b={...m},C=!1,_;if(e._optimisticResults){const P=this.hasListeners(),O=!P&&Rc(t,e),ne=P&&jc(t,n,e,i);(O||ne)&&(b={...b,...wd(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(b.fetchStatus="idle")}let{error:N,errorUpdatedAt:I,status:T}=b;_=b.data;let k=!1;if(e.placeholderData!==void 0&&_===void 0&&T==="pending"){let P;u?.isPlaceholderData&&e.placeholderData===g?.placeholderData?(P=u.data,k=!0):P=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,P!==void 0&&(T="success",_=Do(u?.data,P,e),C=!0)}if(e.select&&_!==void 0&&!k)if(u&&_===d?.data&&e.select===this.#m)_=this.#h;else try{this.#m=e.select,_=e.select(_),_=Do(u?.data,_,e),this.#h=_,this.#i=null}catch(P){this.#i=P}this.#i&&(N=this.#i,_=this.#h,I=Date.now(),T="error");const M=b.fetchStatus==="fetching",H=T==="pending",B=T==="error",z=H&&M,ae=_!==void 0,G={status:T,fetchStatus:b.fetchStatus,isPending:H,isSuccess:T==="success",isError:B,isInitialLoading:z,isLoading:z,data:_,dataUpdatedAt:b.dataUpdatedAt,error:N,errorUpdatedAt:I,failureCount:b.fetchFailureCount,failureReason:b.fetchFailureReason,errorUpdateCount:b.errorUpdateCount,isFetched:b.dataUpdateCount>0||b.errorUpdateCount>0,isFetchedAfterMount:b.dataUpdateCount>p.dataUpdateCount||b.errorUpdateCount>p.errorUpdateCount,isFetching:M,isRefetching:M&&!H,isLoadingError:B&&!ae,isPaused:b.fetchStatus==="paused",isPlaceholderData:C,isRefetchError:B&&ae,isStale:_l(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Yr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const P=oe=>{G.status==="error"?oe.reject(G.error):G.data!==void 0&&oe.resolve(G.data)},O=()=>{const oe=this.#o=G.promise=Po();P(oe)},ne=this.#o;switch(ne.status){case"pending":t.queryHash===n.queryHash&&P(ne);break;case"fulfilled":(G.status==="error"||G.data!==ne.value)&&O();break;case"rejected":(G.status!=="error"||G.error!==ne.reason)&&O();break}}return G}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#a=this.options,this.#n.data!==void 0&&(this.#f=this.#t),ia(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,u=typeof i=="function"?i():i;if(u==="all"||!u&&!this.#g.size)return!0;const d=new Set(u??this.#g);return this.options.throwOnError&&d.add("error"),Object.keys(this.#s).some(g=>{const w=g;return this.#s[w]!==t[w]&&d.has(w)})};this.#_({listeners:n()})}#C(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#r=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#_(t){nr.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function s1(t,e){return Yr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Rc(t,e){return s1(t,e)||t.state.data!==void 0&&Lo(t,e,e.refetchOnMount)}function Lo(t,e,n){if(Yr(e.enabled,t)!==!1&&Mn(e.staleTime,t)!=="static"){const i=typeof n=="function"?n(t):n;return i==="always"||i!==!1&&_l(t,e)}return!1}function jc(t,e,n,i){return(t!==e||Yr(i.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&_l(t,n)}function _l(t,e){return Yr(e.enabled,t)!==!1&&t.isStaleByTime(Mn(e.staleTime,t))}function i1(t,e){return!ia(t.getCurrentResult(),e)}function kc(t){return{onFetch:(e,n)=>{const i=e.options,u=e.fetchOptions?.meta?.fetchMore?.direction,d=e.state.data?.pages||[],g=e.state.data?.pageParams||[];let w={pages:[],pageParams:[]},p=0;const m=async()=>{let b=!1;const C=I=>{K0(I,()=>e.signal,()=>b=!0)},_=gd(e.options,e.fetchOptions),N=async(I,T,k)=>{if(b)return Promise.reject();if(T==null&&I.pages.length)return Promise.resolve(I);const H=(()=>{const V={client:e.client,queryKey:e.queryKey,pageParam:T,direction:k?"backward":"forward",meta:e.options.meta};return C(V),V})(),B=await _(H),{maxPages:z}=e.options,ae=k?$0:X0;return{pages:ae(I.pages,B,z),pageParams:ae(I.pageParams,T,z)}};if(u&&d.length){const I=u==="backward",T=I?a1:Dc,k={pages:d,pageParams:g},M=T(i,k);w=await N(k,M,I)}else{const I=t??d.length;do{const T=p===0?g[0]??i.initialPageParam:Dc(i,w);if(p>0&&T==null)break;w=await N(w,T),p++}while(p<I)}return w};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function Dc(t,{pages:e,pageParams:n}){const i=e.length-1;return e.length>0?t.getNextPageParam(e[i],e,n[i],n):void 0}function a1(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var o1=class extends pd{#e;#t;#r;#s;constructor(t){super(),this.#e=t.client,this.mutationId=t.mutationId,this.#r=t.mutationCache,this.#t=[],this.state=t.state||yd(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(e=>e!==t),this.scheduleGc(),this.#r.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#r.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(t){const e=()=>{this.#n({type:"continue"})},n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=xd({fn:()=>this.options.mutationFn?this.options.mutationFn(t,n):Promise.reject(new Error("No mutationFn found")),onFail:(d,g)=>{this.#n({type:"failed",failureCount:d,error:g})},onPause:()=>{this.#n({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#r.canRun(this)});const i=this.state.status==="pending",u=!this.#s.canStart();try{if(i)e();else{this.#n({type:"pending",variables:t,isPaused:u}),await this.#r.config.onMutate?.(t,this,n);const g=await this.options.onMutate?.(t,n);g!==this.state.context&&this.#n({type:"pending",context:g,variables:t,isPaused:u})}const d=await this.#s.start();return await this.#r.config.onSuccess?.(d,t,this.state.context,this,n),await this.options.onSuccess?.(d,t,this.state.context,n),await this.#r.config.onSettled?.(d,null,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(d,null,t,this.state.context,n),this.#n({type:"success",data:d}),d}catch(d){try{await this.#r.config.onError?.(d,t,this.state.context,this,n)}catch(g){Promise.reject(g)}try{await this.options.onError?.(d,t,this.state.context,n)}catch(g){Promise.reject(g)}try{await this.#r.config.onSettled?.(void 0,d,this.state.variables,this.state.context,this,n)}catch(g){Promise.reject(g)}try{await this.options.onSettled?.(void 0,d,t,this.state.context,n)}catch(g){Promise.reject(g)}throw this.#n({type:"error",error:d}),d}finally{this.#r.runNext(this)}}#n(t){const e=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=e(this.state),nr.batch(()=>{this.#t.forEach(n=>{n.onMutationUpdate(t)}),this.#r.notify({mutation:this,type:"updated",action:t})})}};function yd(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var l1=class extends $s{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(t,e,n){const i=new o1({client:t,mutationCache:this,mutationId:++this.#r,options:t.defaultMutationOptions(e),state:n});return this.add(i),i}add(t){this.#e.add(t);const e=Ki(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Ki(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Ki(t);if(typeof e=="string"){const i=this.#t.get(e)?.find(u=>u.state.status==="pending");return!i||i===t}else return!0}runNext(t){const e=Ki(t);return typeof e=="string"?this.#t.get(e)?.find(i=>i!==t&&i.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){nr.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Nc(e,n))}findAll(t={}){return this.getAll().filter(e=>Nc(t,e))}notify(t){nr.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return nr.batch(()=>Promise.all(t.map(e=>e.continue().catch(br))))}};function Ki(t){return t.options.scope?.id}var c1=class extends $s{#e;#t=void 0;#r;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),ia(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),n?.mutationKey&&this.options.mutationKey&&as(n.mutationKey)!==as(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#a()}mutate(e,n){return this.#s=n,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(e)}#n(){const e=this.#r?.state??yd();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){nr.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,i=this.#t.context,u={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#s.onSuccess?.(e.data,n,i,u)}catch(d){Promise.reject(d)}try{this.#s.onSettled?.(e.data,null,n,i,u)}catch(d){Promise.reject(d)}}else if(e?.type==="error"){try{this.#s.onError?.(e.error,n,i,u)}catch(d){Promise.reject(d)}try{this.#s.onSettled?.(void 0,e.error,n,i,u)}catch(d){Promise.reject(d)}}}this.listeners.forEach(n=>{n(this.#t)})})}},u1=class extends $s{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const i=e.queryKey,u=e.queryHash??yl(i,e);let d=this.get(u);return d||(d=new r1({client:t,queryKey:i,queryHash:u,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(i)}),this.add(d)),d}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){nr.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Ac(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Ac(t,n)):e}notify(t){nr.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){nr.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){nr.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},d1=class{#e;#t;#r;#s;#n;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new u1,this.#t=t.mutationCache||new l1,this.#r=t.defaultOptions||{},this.#s=new Map,this.#n=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Cl.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=aa.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),i=n.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Mn(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(i))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const i=n.data;return[e,i]})}setQueryData(t,e,n){const i=this.defaultQueryOptions({queryKey:t}),d=this.#e.get(i.queryHash)?.state.data,g=q0(e,d);if(g!==void 0)return this.#e.build(this,i).setData(g,{...n,manual:!0})}setQueriesData(t,e,n){return nr.batch(()=>this.#e.findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;nr.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return nr.batch(()=>(n.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},i=nr.batch(()=>this.#e.findAll(t).map(u=>u.cancel(n)));return Promise.all(i).then(br).catch(br)}invalidateQueries(t,e={}){return nr.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},i=nr.batch(()=>this.#e.findAll(t).filter(u=>!u.isDisabled()&&!u.isStatic()).map(u=>{let d=u.fetch(void 0,n);return n.throwOnError||(d=d.catch(br)),u.state.fetchStatus==="paused"?Promise.resolve():d}));return Promise.all(i).then(br)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(Mn(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(br).catch(br)}fetchInfiniteQuery(t){return t.behavior=kc(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(br).catch(br)}ensureInfiniteQueryData(t){return t.behavior=kc(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return aa.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(t){this.#r=t}setQueryDefaults(t,e){this.#s.set(as(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(i=>{Ci(t,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(t,e){this.#n.set(as(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#n.values()],n={};return e.forEach(i=>{Ci(t,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#r.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=yl(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===bl&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#r.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},bd=D.createContext(void 0),Vn=t=>{const e=D.useContext(bd);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},h1=({client:t,children:e})=>(D.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),l.jsx(bd.Provider,{value:t,children:e})),vd=D.createContext(!1),f1=()=>D.useContext(vd);vd.Provider;function g1(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var m1=D.createContext(g1()),x1=()=>D.useContext(m1),p1=(t,e,n)=>{const i=n?.state.error&&typeof t.throwOnError=="function"?vl(t.throwOnError,[n.state.error,n]):t.throwOnError;(t.suspense||t.experimental_prefetchInRender||i)&&(e.isReset()||(t.retryOnMount=!1))},w1=t=>{D.useEffect(()=>{t.clearReset()},[t])},y1=({result:t,errorResetBoundary:e,throwOnError:n,query:i,suspense:u})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(u&&t.data===void 0||vl(n,[t.error,i])),b1=t=>{if(t.suspense){const n=u=>u==="static"?u:Math.max(u??1e3,1e3),i=t.staleTime;t.staleTime=typeof i=="function"?(...u)=>n(i(...u)):n(i),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},v1=(t,e)=>t.isLoading&&t.isFetching&&!e,C1=(t,e)=>t?.suspense&&e.isPending,Pc=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function _1(t,e,n){const i=f1(),u=x1(),d=Vn(),g=d.defaultQueryOptions(t);d.getDefaultOptions().queries?._experimental_beforeQuery?.(g);const w=d.getQueryCache().get(g.queryHash);g._optimisticResults=i?"isRestoring":"optimistic",b1(g),p1(g,u,w),w1(u);const p=!d.getQueryCache().get(g.queryHash),[m]=D.useState(()=>new e(d,g)),b=m.getOptimisticResult(g),C=!i&&t.subscribed!==!1;if(D.useSyncExternalStore(D.useCallback(_=>{const N=C?m.subscribe(nr.batchCalls(_)):br;return m.updateResult(),N},[m,C]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),D.useEffect(()=>{m.setOptions(g)},[g,m]),C1(g,b))throw Pc(g,m,u);if(y1({result:b,errorResetBoundary:u,throwOnError:g.throwOnError,query:w,suspense:g.suspense}))throw b.error;return d.getDefaultOptions().queries?._experimental_afterQuery?.(g,b),g.experimental_prefetchInRender&&!is&&v1(b,i)&&(p?Pc(g,m,u):w?.promise)?.catch(br).finally(()=>{m.updateResult()}),g.notifyOnChangeProps?b:m.trackResult(b)}function os(t,e){return _1(t,n1)}function jr(t,e){const n=Vn(),[i]=D.useState(()=>new c1(n,t));D.useEffect(()=>{i.setOptions(t)},[i,t]);const u=D.useSyncExternalStore(D.useCallback(g=>i.subscribe(nr.batchCalls(g)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),d=D.useCallback((g,w)=>{i.mutate(g,w).catch(br)},[i]);if(u.error&&vl(i.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:d,mutateAsync:u.mutate}}const E1="modulepreload",A1=function(t){return"/schools/"+t},Mc={},_a=function(e,n,i){let u=Promise.resolve();if(n&&n.length>0){let g=function(m){return Promise.all(m.map(b=>Promise.resolve(b).then(C=>({status:"fulfilled",value:C}),C=>({status:"rejected",reason:C}))))};document.getElementsByTagName("link");const w=document.querySelector("meta[property=csp-nonce]"),p=w?.nonce||w?.getAttribute("nonce");u=g(n.map(m=>{if(m=A1(m),m in Mc)return;Mc[m]=!0;const b=m.endsWith(".css"),C=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${C}`))return;const _=document.createElement("link");if(_.rel=b?"stylesheet":E1,b||(_.as="script"),_.crossOrigin="",_.href=m,p&&_.setAttribute("nonce",p),document.head.appendChild(_),b)return new Promise((N,I)=>{_.addEventListener("load",N),_.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${m}`)))})}))}function d(g){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=g,window.dispatchEvent(w),!w.defaultPrevented)throw g}return u.then(g=>{for(const w of g||[])w.status==="rejected"&&d(w.reason);return e().catch(d)})};function N1(){return l.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:l.jsxs("div",{className:"text-center",children:[l.jsx(td,{className:"h-12 w-12 animate-spin text-orange-500 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"جاري التحميل..."})]})})}const S1=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class El extends Error{constructor(e,n="FunctionsError",i){super(e),this.name=n,this.context=i}}class I1 extends El{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Lc extends El{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Bc extends El{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Bo;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Bo||(Bo={}));class T1{constructor(e,{headers:n={},customFetch:i,region:u=Bo.Any}={}){this.url=e,this.headers=n,this.region=u,this.fetch=S1(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return qf(this,arguments,void 0,function*(n,i={}){var u;let d,g;try{const{headers:w,method:p,body:m,signal:b,timeout:C}=i;let _={},{region:N}=i;N||(N=this.region);const I=new URL(`${this.url}/${n}`);N&&N!=="any"&&(_["x-region"]=N,I.searchParams.set("forceFunctionRegion",N));let T;m&&(w&&!Object.prototype.hasOwnProperty.call(w,"Content-Type")||!w)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(_["Content-Type"]="application/octet-stream",T=m):typeof m=="string"?(_["Content-Type"]="text/plain",T=m):typeof FormData<"u"&&m instanceof FormData?T=m:(_["Content-Type"]="application/json",T=JSON.stringify(m)):m&&typeof m!="string"&&!(typeof Blob<"u"&&m instanceof Blob)&&!(m instanceof ArrayBuffer)&&!(typeof FormData<"u"&&m instanceof FormData)?T=JSON.stringify(m):T=m;let k=b;C&&(g=new AbortController,d=setTimeout(()=>g.abort(),C),b?(k=g.signal,b.addEventListener("abort",()=>g.abort())):k=g.signal);const M=yield this.fetch(I.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},_),this.headers),w),body:T,signal:k}).catch(ae=>{throw new I1(ae)}),H=M.headers.get("x-relay-error");if(H&&H==="true")throw new Lc(M);if(!M.ok)throw new Bc(M);let B=((u=M.headers.get("Content-Type"))!==null&&u!==void 0?u:"text/plain").split(";")[0].trim(),z;return B==="application/json"?z=yield M.json():B==="application/octet-stream"||B==="application/pdf"?z=yield M.blob():B==="text/event-stream"?z=M:B==="multipart/form-data"?z=yield M.formData():z=yield M.text(),{data:z,error:null,response:M}}catch(w){return{data:null,error:w,response:w instanceof Bc||w instanceof Lc?w.context:void 0}}finally{d&&clearTimeout(d)}})}}var O1=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},R1=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let u=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{let g=null,w=null,p=null,m=d.status,b=d.statusText;if(d.ok){var C,_;if(n.method!=="HEAD"){var N;const M=await d.text();M===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((N=n.headers.get("Accept"))===null||N===void 0)&&N.includes("application/vnd.pgrst.plan+text"))?w=M:w=JSON.parse(M))}const T=(C=n.headers.get("Prefer"))===null||C===void 0?void 0:C.match(/count=(exact|planned|estimated)/),k=(_=d.headers.get("content-range"))===null||_===void 0?void 0:_.split("/");T&&k&&k.length>1&&(p=parseInt(k[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(w)&&(w.length>1?(g={code:"PGRST116",details:`Results contain ${w.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},w=null,p=null,m=406,b="Not Acceptable"):w.length===1?w=w[0]:w=null)}else{var I;const T=await d.text();try{g=JSON.parse(T),Array.isArray(g)&&d.status===404&&(w=[],g=null,m=200,b="OK")}catch{d.status===404&&T===""?(m=204,b="No Content"):g={message:T}}if(g&&n.isMaybeSingle&&(!(g==null||(I=g.details)===null||I===void 0)&&I.includes("0 rows"))&&(g=null,m=200,b="OK"),g&&n.shouldThrowOnError)throw new O1(g)}return{error:g,data:w,count:p,status:m,statusText:b}});return this.shouldThrowOnError||(u=u.catch(d=>{var g;let w="";const p=d?.cause;if(p){var m,b,C,_;const I=(m=p?.message)!==null&&m!==void 0?m:"",T=(b=p?.code)!==null&&b!==void 0?b:"";w=`${(C=d?.name)!==null&&C!==void 0?C:"FetchError"}: ${d?.message}`,w+=`

Caused by: ${(_=p?.name)!==null&&_!==void 0?_:"Error"}: ${I}`,T&&(w+=` (${T})`),p?.stack&&(w+=`
${p.stack}`)}else{var N;w=(N=d?.stack)!==null&&N!==void 0?N:""}return{error:{message:`${(g=d?.name)!==null&&g!==void 0?g:"FetchError"}: ${d?.message}`,details:w,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),u.then(t,e)}returns(){return this}overrideTypes(){return this}},j1=class extends R1{select(t){let e=!1;const n=(t??"*").split("").map(i=>/\s/.test(i)&&!e?"":(i==='"'&&(e=!e),i)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:i,referencedTable:u=i}={}){const d=u?`${u}.order`:"order",g=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${g?`${g},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:i=n}={}){const u=typeof i>"u"?"offset":`${i}.offset`,d=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(u,`${t}`),this.url.searchParams.set(d,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:i=!1,wal:u=!1,format:d="text"}={}){var g;const w=[t?"analyze":null,e?"verbose":null,n?"settings":null,i?"buffers":null,u?"wal":null].filter(Boolean).join("|"),p=(g=this.headers.get("Accept"))!==null&&g!==void 0?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${d}; for="${p}"; options=${w};`),d==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Fc=new RegExp("[,()]");var Rs=class extends j1{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(i=>typeof i=="string"&&Fc.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(i=>typeof i=="string"&&Fc.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:i}={}){let u="";i==="plain"?u="pl":i==="phrase"?u="ph":i==="websearch"&&(u="w");const d=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${u}fts${d}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const i=n?`${n}.or`:"or";return this.url.searchParams.append(i,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},k1=class{constructor(t,{headers:e={},schema:n,fetch:i}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:n=!1,count:i}=e??{},u=n?"HEAD":"GET";let d=!1;const g=(t??"*").split("").map(m=>/\s/.test(m)&&!d?"":(m==='"'&&(d=!d),m)).join(""),{url:w,headers:p}=this.cloneRequestState();return w.searchParams.set("select",g),i&&p.append("Prefer",`count=${i}`),new Rs({method:u,url:w,headers:p,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var i;const u="POST",{url:d,headers:g}=this.cloneRequestState();if(e&&g.append("Prefer",`count=${e}`),n||g.append("Prefer","missing=default"),Array.isArray(t)){const w=t.reduce((p,m)=>p.concat(Object.keys(m)),[]);if(w.length>0){const p=[...new Set(w)].map(m=>`"${m}"`);d.searchParams.set("columns",p.join(","))}}return new Rs({method:u,url:d,headers:g,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:i,defaultToNull:u=!0}={}){var d;const g="POST",{url:w,headers:p}=this.cloneRequestState();if(p.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&w.searchParams.set("on_conflict",e),i&&p.append("Prefer",`count=${i}`),u||p.append("Prefer","missing=default"),Array.isArray(t)){const m=t.reduce((b,C)=>b.concat(Object.keys(C)),[]);if(m.length>0){const b=[...new Set(m)].map(C=>`"${C}"`);w.searchParams.set("columns",b.join(","))}}return new Rs({method:g,url:w,headers:p,schema:this.schema,body:t,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}update(t,{count:e}={}){var n;const i="PATCH",{url:u,headers:d}=this.cloneRequestState();return e&&d.append("Prefer",`count=${e}`),new Rs({method:i,url:u,headers:d,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE",{url:i,headers:u}=this.cloneRequestState();return t&&u.append("Prefer",`count=${t}`),new Rs({method:n,url:i,headers:u,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},D1=class Cd{constructor(e,{headers:n={},schema:i,fetch:u}={}){this.url=e,this.headers=new Headers(n),this.schemaName=i,this.fetch=u}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new k1(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Cd(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:i=!1,get:u=!1,count:d}={}){var g;let w;const p=new URL(`${this.url}/rpc/${e}`);let m;const b=N=>N!==null&&typeof N=="object"&&(!Array.isArray(N)||N.some(b)),C=i&&Object.values(n).some(b);C?(w="POST",m=n):i||u?(w=i?"HEAD":"GET",Object.entries(n).filter(([N,I])=>I!==void 0).map(([N,I])=>[N,Array.isArray(I)?`{${I.join(",")}}`:`${I}`]).forEach(([N,I])=>{p.searchParams.append(N,I)})):(w="POST",m=n);const _=new Headers(this.headers);return C?_.set("Prefer",d?`count=${d},return=minimal`:"return=minimal"):d&&_.set("Prefer",`count=${d}`),new Rs({method:w,url:p,headers:_,schema:this.schemaName,body:m,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}};class P1{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const n=globalThis.process;if(n){const i=n.versions;if(i&&i.node){const u=i.node,d=parseInt(u.replace(/^v/,"").split(".")[0]);return d>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${d} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${d} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const i=this.getWebSocketConstructor();return new i(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const M1="2.90.1",L1=`realtime-js/${M1}`,_d="1.0.0",B1="2.0.0",Uc=_d,Fo=1e4,F1=1e3,U1=100;var Dn;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Dn||(Dn={}));var tr;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(tr||(tr={}));var Jr;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Jr||(Jr={}));var Uo;(function(t){t.websocket="websocket"})(Uo||(Uo={}));var ts;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(ts||(ts={}));class W1{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(i))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,i;const u=(i=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&i!==void 0?i:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,u)}_encodeJsonUserBroadcastPush(e){var n,i;const u=(i=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&i!==void 0?i:{},g=new TextEncoder().encode(JSON.stringify(u)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,g)}_encodeUserBroadcastPush(e,n,i){var u,d;const g=e.topic,w=(u=e.ref)!==null&&u!==void 0?u:"",p=(d=e.join_ref)!==null&&d!==void 0?d:"",m=e.payload.event,b=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},C=Object.keys(b).length===0?"":JSON.stringify(b);if(p.length>255)throw new Error(`joinRef length ${p.length} exceeds maximum of 255`);if(w.length>255)throw new Error(`ref length ${w.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`topic length ${g.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(C.length>255)throw new Error(`metadata length ${C.length} exceeds maximum of 255`);const _=this.USER_BROADCAST_PUSH_META_LENGTH+p.length+w.length+g.length+m.length+C.length,N=new ArrayBuffer(this.HEADER_LENGTH+_);let I=new DataView(N),T=0;I.setUint8(T++,this.KINDS.userBroadcastPush),I.setUint8(T++,p.length),I.setUint8(T++,w.length),I.setUint8(T++,g.length),I.setUint8(T++,m.length),I.setUint8(T++,C.length),I.setUint8(T++,n),Array.from(p,M=>I.setUint8(T++,M.charCodeAt(0))),Array.from(w,M=>I.setUint8(T++,M.charCodeAt(0))),Array.from(g,M=>I.setUint8(T++,M.charCodeAt(0))),Array.from(m,M=>I.setUint8(T++,M.charCodeAt(0))),Array.from(C,M=>I.setUint8(T++,M.charCodeAt(0)));var k=new Uint8Array(N.byteLength+i.byteLength);return k.set(new Uint8Array(N),0),k.set(new Uint8Array(i),N.byteLength),k.buffer}decode(e,n){if(this._isArrayBuffer(e)){let i=this._binaryDecode(e);return n(i)}if(typeof e=="string"){const i=JSON.parse(e),[u,d,g,w,p]=i;return n({join_ref:u,ref:d,topic:g,event:w,payload:p})}return n({})}_binaryDecode(e){const n=new DataView(e),i=n.getUint8(0),u=new TextDecoder;switch(i){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,u)}}_decodeUserBroadcast(e,n,i){const u=n.getUint8(1),d=n.getUint8(2),g=n.getUint8(3),w=n.getUint8(4);let p=this.HEADER_LENGTH+4;const m=i.decode(e.slice(p,p+u));p=p+u;const b=i.decode(e.slice(p,p+d));p=p+d;const C=i.decode(e.slice(p,p+g));p=p+g;const _=e.slice(p,e.byteLength),N=w===this.JSON_ENCODING?JSON.parse(i.decode(_)):_,I={type:this.BROADCAST_EVENT,event:b,payload:N};return g>0&&(I.meta=JSON.parse(C)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:I}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e?.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([i])=>n.includes(i)))}}class Ed{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var yt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(yt||(yt={}));const Wc=(t,e,n={})=>{var i;const u=(i=n.skipTypes)!==null&&i!==void 0?i:[];return e?Object.keys(e).reduce((d,g)=>(d[g]=V1(g,t,e,u),d),{}):{}},V1=(t,e,n,i)=>{const u=e.find(w=>w.name===t),d=u?.type,g=n[t];return d&&!i.includes(d)?Ad(d,g):Wo(g)},Ad=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return z1(e,n)}switch(t){case yt.bool:return H1(e);case yt.float4:case yt.float8:case yt.int2:case yt.int4:case yt.int8:case yt.numeric:case yt.oid:return G1(e);case yt.json:case yt.jsonb:return q1(e);case yt.timestamp:return Y1(e);case yt.abstime:case yt.date:case yt.daterange:case yt.int4range:case yt.int8range:case yt.money:case yt.reltime:case yt.text:case yt.time:case yt.timestamptz:case yt.timetz:case yt.tsrange:case yt.tstzrange:return Wo(e);default:return Wo(e)}},Wo=t=>t,H1=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},G1=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},q1=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},z1=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,i=t[n];if(t[0]==="{"&&i==="}"){let d;const g=t.slice(1,n);try{d=JSON.parse("["+g+"]")}catch{d=g?g.split(","):[]}return d.map(w=>Ad(e,w))}return t},Y1=t=>typeof t=="string"?t.replace(" ","T"):t,Nd=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Qa{constructor(e,n,i={},u=Fo){this.channel=e,this.event=n,this.payload=i,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var i;return this._hasReceived(e)&&n((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Vc;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Vc||(Vc={}));class xi{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},u=>{const{onJoin:d,onLeave:g,onSync:w}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xi.syncState(this.state,u,d,g),this.pendingDiffs.forEach(p=>{this.state=xi.syncDiff(this.state,p,d,g)}),this.pendingDiffs=[],w()}),this.channel._on(i.diff,{},u=>{const{onJoin:d,onLeave:g,onSync:w}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(u):(this.state=xi.syncDiff(this.state,u,d,g),w())}),this.onJoin((u,d,g)=>{this.channel._trigger("presence",{event:"join",key:u,currentPresences:d,newPresences:g})}),this.onLeave((u,d,g)=>{this.channel._trigger("presence",{event:"leave",key:u,currentPresences:d,leftPresences:g})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,i,u){const d=this.cloneDeep(e),g=this.transformState(n),w={},p={};return this.map(d,(m,b)=>{g[m]||(p[m]=b)}),this.map(g,(m,b)=>{const C=d[m];if(C){const _=b.map(k=>k.presence_ref),N=C.map(k=>k.presence_ref),I=b.filter(k=>N.indexOf(k.presence_ref)<0),T=C.filter(k=>_.indexOf(k.presence_ref)<0);I.length>0&&(w[m]=I),T.length>0&&(p[m]=T)}else w[m]=b}),this.syncDiff(d,{joins:w,leaves:p},i,u)}static syncDiff(e,n,i,u){const{joins:d,leaves:g}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return i||(i=()=>{}),u||(u=()=>{}),this.map(d,(w,p)=>{var m;const b=(m=e[w])!==null&&m!==void 0?m:[];if(e[w]=this.cloneDeep(p),b.length>0){const C=e[w].map(N=>N.presence_ref),_=b.filter(N=>C.indexOf(N.presence_ref)<0);e[w].unshift(..._)}i(w,b,p)}),this.map(g,(w,p)=>{let m=e[w];if(!m)return;const b=p.map(C=>C.presence_ref);m=m.filter(C=>b.indexOf(C.presence_ref)<0),e[w]=m,u(w,m,p),m.length===0&&delete e[w]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(i=>n(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,i)=>{const u=e[i];return"metas"in u?n[i]=u.metas.map(d=>(d.presence_ref=d.phx_ref,delete d.phx_ref,delete d.phx_ref_prev,d)):n[i]=u,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Hc;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Hc||(Hc={}));var pi;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(pi||(pi={}));var bn;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(bn||(bn={}));class Ls{constructor(e,n={config:{}},i){var u,d;if(this.topic=e,this.params=n,this.socket=i,this.bindings={},this.state=tr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Qa(this,Jr.join,this.params,this.timeout),this.rejoinTimer=new Ed(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=tr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(g=>g.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=tr.closed,this.socket._remove(this)}),this._onError(g=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,g),this.state=tr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=tr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",g=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,g),this.state=tr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Jr.reply,{},(g,w)=>{this._trigger(this._replyEventName(w),g)}),this.presence=new xi(this),this.broadcastEndpointURL=Nd(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((d=(u=this.params.config)===null||u===void 0?void 0:u.broadcast)===null||d===void 0)&&d.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var i,u,d;if(this.socket.isConnected()||this.socket.connect(),this.state==tr.closed){const{config:{broadcast:g,presence:w,private:p}}=this.params,m=(u=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(N=>N.filter))!==null&&u!==void 0?u:[],b=!!this.bindings[pi.PRESENCE]&&this.bindings[pi.PRESENCE].length>0||((d=this.params.config.presence)===null||d===void 0?void 0:d.enabled)===!0,C={},_={broadcast:g,presence:Object.assign(Object.assign({},w),{enabled:b}),postgres_changes:m,private:p};this.socket.accessTokenValue&&(C.access_token=this.socket.accessTokenValue),this._onError(N=>e?.(bn.CHANNEL_ERROR,N)),this._onClose(()=>e?.(bn.CLOSED)),this.updateJoinPayload(Object.assign({config:_},C)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:N})=>{var I;if(this.socket._isManualToken()||this.socket.setAuth(),N===void 0){e?.(bn.SUBSCRIBED);return}else{const T=this.bindings.postgres_changes,k=(I=T?.length)!==null&&I!==void 0?I:0,M=[];for(let H=0;H<k;H++){const B=T[H],{filter:{event:z,schema:ae,table:V,filter:G}}=B,P=N&&N[H];if(P&&P.event===z&&Ls.isFilterValueEqual(P.schema,ae)&&Ls.isFilterValueEqual(P.table,V)&&Ls.isFilterValueEqual(P.filter,G))M.push(Object.assign(Object.assign({},B),{id:P.id}));else{this.unsubscribe(),this.state=tr.errored,e?.(bn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=M,e&&e(bn.SUBSCRIBED);return}}).receive("error",N=>{this.state=tr.errored,e?.(bn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(N).join(", ")||"error")))}).receive("timeout",()=>{e?.(bn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,i){return this.state===tr.joined&&e===pi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,i)}async httpSend(e,n,i={}){var u;if(n==null)return Promise.reject("Payload is required for httpSend()");const d={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(d.Authorization=`Bearer ${this.socket.accessTokenValue}`);const g={method:"POST",headers:d,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},w=await this._fetchWithTimeout(this.broadcastEndpointURL,g,(u=i.timeout)!==null&&u!==void 0?u:this.timeout);if(w.status===202)return{success:!0};let p=w.statusText;try{const m=await w.json();p=m.error||m.message||p}catch{}return Promise.reject(new Error(p))}async send(e,n={}){var i,u;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:d,payload:g}=e,w={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(w.Authorization=`Bearer ${this.socket.accessTokenValue}`);const p={method:"POST",headers:w,body:JSON.stringify({messages:[{topic:this.subTopic,event:d,payload:g,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(i=n.timeout)!==null&&i!==void 0?i:this.timeout);return await((u=m.body)===null||u===void 0?void 0:u.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(d=>{var g,w,p;const m=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(w=(g=this.params)===null||g===void 0?void 0:g.config)===null||w===void 0?void 0:w.broadcast)===null||p===void 0)&&p.ack)&&d("ok"),m.receive("ok",()=>d("ok")),m.receive("error",()=>d("error")),m.receive("timeout",()=>d("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=tr.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Jr.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(u=>{i=new Qa(this,Jr.leave,{},e),i.receive("ok",()=>{n(),u("ok")}).receive("timeout",()=>{n(),u("timed out")}).receive("error",()=>{u("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=tr.closed,this.bindings={}}async _fetchWithTimeout(e,n,i){const u=new AbortController,d=setTimeout(()=>u.abort(),i),g=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:u.signal}));return clearTimeout(d),g}_push(e,n,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new Qa(this,e,n,i);return this._canPush()?u.send():this._addToPushBuffer(u),u}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>U1){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,i){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,i){var u,d;const g=e.toLocaleLowerCase(),{close:w,error:p,leave:m,join:b}=Jr;if(i&&[w,p,m,b].indexOf(g)>=0&&i!==this._joinRef())return;let _=this._onMessage(g,n,i);if(n&&!_)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(g)?(u=this.bindings.postgres_changes)===null||u===void 0||u.filter(N=>{var I,T,k;return((I=N.filter)===null||I===void 0?void 0:I.event)==="*"||((k=(T=N.filter)===null||T===void 0?void 0:T.event)===null||k===void 0?void 0:k.toLocaleLowerCase())===g}).map(N=>N.callback(_,i)):(d=this.bindings[g])===null||d===void 0||d.filter(N=>{var I,T,k,M,H,B,z,ae;if(["broadcast","presence","postgres_changes"].includes(g))if("id"in N){const V=N.id,G=(I=N.filter)===null||I===void 0?void 0:I.event;return V&&((T=n.ids)===null||T===void 0?void 0:T.includes(V))&&(G==="*"||G?.toLocaleLowerCase()===((k=n.data)===null||k===void 0?void 0:k.type.toLocaleLowerCase()))&&(!(!((M=N.filter)===null||M===void 0)&&M.table)||N.filter.table===((H=n.data)===null||H===void 0?void 0:H.table))}else{const V=(z=(B=N?.filter)===null||B===void 0?void 0:B.event)===null||z===void 0?void 0:z.toLocaleLowerCase();return V==="*"||V===((ae=n?.event)===null||ae===void 0?void 0:ae.toLocaleLowerCase())}else return N.type.toLocaleLowerCase()===g}).map(N=>{if(typeof _=="object"&&"ids"in _){const I=_.data,{schema:T,table:k,commit_timestamp:M,type:H,errors:B}=I;_=Object.assign(Object.assign({},{schema:T,table:k,commit_timestamp:M,eventType:H,new:{},old:{},errors:B}),this._getPayloadRecords(I))}N.callback(_,i)})}_isClosed(){return this.state===tr.closed}_isJoined(){return this.state===tr.joined}_isJoining(){return this.state===tr.joining}_isLeaving(){return this.state===tr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,i){const u=e.toLocaleLowerCase(),d={type:u,filter:n,callback:i};return this.bindings[u]?this.bindings[u].push(d):this.bindings[u]=[d],this}_off(e,n){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(u=>{var d;return!(((d=u.type)===null||d===void 0?void 0:d.toLocaleLowerCase())===i&&Ls.isEqual(u.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const i in e)if(e[i]!==n[i])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Jr.close,{},e)}_onError(e){this._on(Jr.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=tr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Wc(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Wc(e.columns,e.old_record)),n}}const Za=()=>{},Qi={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},X1=[1e3,2e3,5e3,1e4],$1=1e4,K1=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Q1{constructor(e,n){var i;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Fo,this.transport=null,this.heartbeatIntervalMs=Qi.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Za,this.ref=0,this.reconnectTimer=null,this.vsn=Uc,this.logger=Za,this.conn=null,this.sendBuffer=[],this.serializer=new W1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=u=>u?(...d)=>u(...d):(...d)=>fetch(...d),!(!((i=n?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Uo.websocket}`,this.httpEndpoint=Nd(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=P1.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,i){this.logger(e,n,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Dn.connecting:return ts.Connecting;case Dn.open:return ts.Open;case Dn.closing:return ts.Closing;default:return ts.Closed}}isConnected(){return this.connectionState()===ts.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const i=`realtime:${e}`,u=this.getChannels().find(d=>d.topic===i);if(u)return u;{const d=new Ls(`realtime:${e}`,n,this);return this.channels.push(d),d}}push(e){const{topic:n,event:i,payload:u,ref:d}=e,g=()=>{this.encode(e,w=>{var p;(p=this.conn)===null||p===void 0||p.send(w)})};this.log("push",`${n} ${i} (${d})`,u),this.isConnected()?g():this.sendBuffer.push(g)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(F1,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Qi.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply"&&n.ref&&n.ref===this.pendingHeartbeatRef){const m=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error",m)}catch(b){this.log("error","error in heartbeat callback",b)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:i,event:u,payload:d,ref:g}=n,w=g?`(${g})`:"",p=d.status||"";this.log("receive",`${p} ${i} ${u} ${w}`.trim(),d),this.channels.filter(m=>m._isMember(i)).forEach(m=>m._trigger(u,d,g)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Dn.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Dn.open||this.conn.readyState===Dn.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Jr.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const i=e.match(/\?/)?"&":"?",u=new URLSearchParams(n);return`${e}${i}${u}`}_workerObjectUrl(e){let n;if(e)n=e;else{const i=new Blob([K1],{type:"application/javascript"});n=URL.createObjectURL(i)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,i=!1;if(e)n=e,i=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(u){this.log("error","Error fetching access token from callback",u),n=this.accessTokenValue}else n=this.accessTokenValue;i?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(u=>{const d={access_token:n,version:L1};n&&u.updateJoinPayload(d),u.joinedOnce&&u._isJoined()&&u._push(Jr.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(n)}catch(u){this.log("error",`error in ${e} callback`,u)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new Ed(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Qi.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,i,u,d,g,w,p,m,b,C,_,N;switch(this.transport=(n=e?.transport)!==null&&n!==void 0?n:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:Fo,this.heartbeatIntervalMs=(u=e?.heartbeatIntervalMs)!==null&&u!==void 0?u:Qi.HEARTBEAT_INTERVAL,this.worker=(d=e?.worker)!==null&&d!==void 0?d:!1,this.accessToken=(g=e?.accessToken)!==null&&g!==void 0?g:null,this.heartbeatCallback=(w=e?.heartbeatCallback)!==null&&w!==void 0?w:Za,this.vsn=(p=e?.vsn)!==null&&p!==void 0?p:Uc,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=e?.reconnectAfterMs)!==null&&m!==void 0?m:(I=>X1[I-1]||$1),this.vsn){case _d:this.encode=(b=e?.encode)!==null&&b!==void 0?b:((I,T)=>T(JSON.stringify(I))),this.decode=(C=e?.decode)!==null&&C!==void 0?C:((I,T)=>T(JSON.parse(I)));break;case B1:this.encode=(_=e?.encode)!==null&&_!==void 0?_:this.serializer.encode.bind(this.serializer),this.decode=(N=e?.decode)!==null&&N!==void 0?N:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var _i=class extends Error{constructor(t,e){super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Z1(t,e,n){const i=new URL(e,t);if(n)for(const[u,d]of Object.entries(n))d!==void 0&&i.searchParams.set(u,d);return i.toString()}async function J1(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function eg(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:i,query:u,body:d,headers:g}){const w=Z1(t.baseUrl,i,u),p=await J1(t.auth),m=await e(w,{method:n,headers:{...d?{"Content-Type":"application/json"}:{},...p,...g},body:d?JSON.stringify(d):void 0}),b=await m.text(),C=(m.headers.get("content-type")||"").includes("application/json"),_=C&&b?JSON.parse(b):b;if(!m.ok){const N=C?_:void 0,I=N?.error;throw new _i(I?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:I?.type,icebergCode:I?.code,details:N})}return{status:m.status,headers:m.headers,data:_}}}}function Zi(t){return t.join("")}var tg=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Zi(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(i=>({namespace:i}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Zi(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Zi(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Zi(t.namespace)}`}),!0}catch(e){if(e instanceof _i&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof _i&&n.status===409)return;throw n}}};function _s(t){return t.join("")}var rg=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${_s(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${_s(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${_s(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${_s(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${_s(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${_s(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof _i&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof _i&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},ng=class{constructor(t){let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=eg({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=t.accessDelegation?.join(","),this.namespaceOps=new tg(this.client,e),this.tableOps=new rg(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},Ea=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function Rt(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var sg=class extends Ea{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Vo=class extends Ea{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const Al=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),ig=()=>Response,Ho=t=>{if(Array.isArray(t))return t.map(n=>Ho(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,i])=>{const u=n.replace(/([-_][a-z])/gi,d=>d.toUpperCase().replace(/[-_]/g,""));e[u]=Ho(i)}),e},ag=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},og=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function Ei(t){"@babel/helpers - typeof";return Ei=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ei(t)}function lg(t,e){if(Ei(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(Ei(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function cg(t){var e=lg(t,"string");return Ei(e)=="symbol"?e:e+""}function ug(t,e,n){return(e=cg(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Gc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,i)}return n}function De(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Gc(Object(n),!0).forEach(function(i){ug(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Gc(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Ja=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},dg=async(t,e,n)=>{t instanceof await ig()&&!n?.noResolveJson?t.json().then(i=>{const u=t.status||500,d=i?.statusCode||u+"";e(new sg(Ja(i),u,d))}).catch(i=>{e(new Vo(Ja(i),i))}):e(new Vo(Ja(t),t))},hg=(t,e,n,i)=>{const u={method:t,headers:e?.headers||{}};return t==="GET"||!i?u:(ag(i)?(u.headers=De({"Content-Type":"application/json"},e?.headers),u.body=JSON.stringify(i)):u.body=i,e?.duplex&&(u.duplex=e.duplex),De(De({},u),n))};async function Ri(t,e,n,i,u,d){return new Promise((g,w)=>{t(n,hg(e,i,u,d)).then(p=>{if(!p.ok)throw p;return i?.noResolveJson?p:p.json()}).then(p=>g(p)).catch(p=>dg(p,w,i))})}async function Ai(t,e,n,i){return Ri(t,"GET",e,n,i)}async function Zr(t,e,n,i,u){return Ri(t,"POST",e,i,u,n)}async function Go(t,e,n,i,u){return Ri(t,"PUT",e,i,u,n)}async function fg(t,e,n,i){return Ri(t,"HEAD",e,De(De({},n),{},{noResolveJson:!0}),i)}async function Nl(t,e,n,i,u){return Ri(t,"DELETE",e,i,u,n)}var gg=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Rt(e))return{data:null,error:e};throw e}}};let Sd;Sd=Symbol.toStringTag;var mg=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Sd]="BlobDownloadBuilder",this.promise=null}asStream(){return new gg(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Rt(e))return{data:null,error:e};throw e}}};const xg={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},qc={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var pg=class{constructor(t,e={},n,i){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=Al(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,i){var u=this;try{let d;const g=De(De({},qc),i);let w=De(De({},u.headers),t==="POST"&&{"x-upsert":String(g.upsert)});const p=g.metadata;typeof Blob<"u"&&n instanceof Blob?(d=new FormData,d.append("cacheControl",g.cacheControl),p&&d.append("metadata",u.encodeMetadata(p)),d.append("",n)):typeof FormData<"u"&&n instanceof FormData?(d=n,d.has("cacheControl")||d.append("cacheControl",g.cacheControl),p&&!d.has("metadata")&&d.append("metadata",u.encodeMetadata(p))):(d=n,w["cache-control"]=`max-age=${g.cacheControl}`,w["content-type"]=g.contentType,p&&(w["x-metadata"]=u.toBase64(u.encodeMetadata(p))),(typeof ReadableStream<"u"&&d instanceof ReadableStream||d&&typeof d=="object"&&"pipe"in d&&typeof d.pipe=="function")&&!g.duplex&&(g.duplex="half")),i?.headers&&(w=De(De({},w),i.headers));const m=u._removeEmptyFolders(e),b=u._getFinalPath(m),C=await(t=="PUT"?Go:Zr)(u.fetch,`${u.url}/object/${b}`,d,De({headers:w},g?.duplex?{duplex:g.duplex}:{}));return{data:{path:m,id:C.Id,fullPath:C.Key},error:null}}catch(d){if(u.shouldThrowOnError)throw d;if(Rt(d))return{data:null,error:d};throw d}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,i){var u=this;const d=u._removeEmptyFolders(t),g=u._getFinalPath(d),w=new URL(u.url+`/object/upload/sign/${g}`);w.searchParams.set("token",e);try{let p;const m=De({upsert:qc.upsert},i),b=De(De({},u.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&n instanceof Blob?(p=new FormData,p.append("cacheControl",m.cacheControl),p.append("",n)):typeof FormData<"u"&&n instanceof FormData?(p=n,p.append("cacheControl",m.cacheControl)):(p=n,b["cache-control"]=`max-age=${m.cacheControl}`,b["content-type"]=m.contentType),{data:{path:d,fullPath:(await Go(u.fetch,w.toString(),p,{headers:b})).Key},error:null}}catch(p){if(u.shouldThrowOnError)throw p;if(Rt(p))return{data:null,error:p};throw p}}async createSignedUploadUrl(t,e){var n=this;try{let i=n._getFinalPath(t);const u=De({},n.headers);e?.upsert&&(u["x-upsert"]="true");const d=await Zr(n.fetch,`${n.url}/object/upload/sign/${i}`,{},{headers:u}),g=new URL(n.url+d.url),w=g.searchParams.get("token");if(!w)throw new Ea("No token returned by API");return{data:{signedUrl:g.toString(),path:t,token:w},error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Rt(i))return{data:null,error:i};throw i}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var i=this;try{return{data:await Zr(i.fetch,`${i.url}/object/move`,{bucketId:i.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:i.headers}),error:null}}catch(u){if(i.shouldThrowOnError)throw u;if(Rt(u))return{data:null,error:u};throw u}}async copy(t,e,n){var i=this;try{return{data:{path:(await Zr(i.fetch,`${i.url}/object/copy`,{bucketId:i.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:i.headers})).Key},error:null}}catch(u){if(i.shouldThrowOnError)throw u;if(Rt(u))return{data:null,error:u};throw u}}async createSignedUrl(t,e,n){var i=this;try{let u=i._getFinalPath(t),d=await Zr(i.fetch,`${i.url}/object/sign/${u}`,De({expiresIn:e},n?.transform?{transform:n.transform}:{}),{headers:i.headers});const g=n?.download?`&download=${n.download===!0?"":n.download}`:"";return d={signedUrl:encodeURI(`${i.url}${d.signedURL}${g}`)},{data:d,error:null}}catch(u){if(i.shouldThrowOnError)throw u;if(Rt(u))return{data:null,error:u};throw u}}async createSignedUrls(t,e,n){var i=this;try{const u=await Zr(i.fetch,`${i.url}/object/sign/${i.bucketId}`,{expiresIn:e,paths:t},{headers:i.headers}),d=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:u.map(g=>De(De({},g),{},{signedUrl:g.signedURL?encodeURI(`${i.url}${g.signedURL}${d}`):null})),error:null}}catch(u){if(i.shouldThrowOnError)throw u;if(Rt(u))return{data:null,error:u};throw u}}download(t,e){const n=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),u=i?`?${i}`:"",d=this._getFinalPath(t),g=()=>Ai(this.fetch,`${this.url}/${n}/${d}${u}`,{headers:this.headers,noResolveJson:!0});return new mg(g,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:Ho(await Ai(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(Rt(i))return{data:null,error:i};throw i}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await fg(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(Rt(i)&&i instanceof Vo){const u=i.originalError;if([400,404].includes(u?.status))return{data:!1,error:i}}throw i}}getPublicUrl(t,e){const n=this._getFinalPath(t),i=[],u=e?.download?`download=${e.download===!0?"":e.download}`:"";u!==""&&i.push(u);const d=typeof e?.transform<"u"?"render/image":"object",g=this.transformOptsToQueryString(e?.transform||{});g!==""&&i.push(g);let w=i.join("&");return w!==""&&(w=`?${w}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${n}${w}`)}}}async remove(t){var e=this;try{return{data:await Nl(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}async list(t,e,n){var i=this;try{const u=De(De(De({},xg),e),{},{prefix:t||""});return{data:await Zr(i.fetch,`${i.url}/object/list/${i.bucketId}`,u,{headers:i.headers},n),error:null}}catch(u){if(i.shouldThrowOnError)throw u;if(Rt(u))return{data:null,error:u};throw u}}async listV2(t,e){var n=this;try{const i=De({},t);return{data:await Zr(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,i,{headers:n.headers},e),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Rt(i))return{data:null,error:i};throw i}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const Id="2.90.1",Td={"X-Client-Info":`storage-js/${Id}`};var wg=class{constructor(t,e={},n,i){this.shouldThrowOnError=!1;const u=new URL(t);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(u.hostname)&&!u.hostname.includes("storage.supabase.")&&(u.hostname=u.hostname.replace("supabase.","storage.supabase.")),this.url=u.href.replace(/\/$/,""),this.headers=De(De({},Td),e),this.fetch=Al(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await Ai(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await Ai(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await Zr(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Rt(i))return{data:null,error:i};throw i}}async updateBucket(t,e){var n=this;try{return{data:await Go(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Rt(i))return{data:null,error:i};throw i}}async emptyBucket(t){var e=this;try{return{data:await Zr(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Nl(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},yg=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=De(De({},Td),e),this.fetch=Al(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Zr(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;t?.limit!==void 0&&n.set("limit",t.limit.toString()),t?.offset!==void 0&&n.set("offset",t.offset.toString()),t?.sortColumn&&n.set("sortColumn",t.sortColumn),t?.sortOrder&&n.set("sortOrder",t.sortOrder),t?.search&&n.set("search",t.search);const i=n.toString(),u=i?`${e.url}/bucket?${i}`:`${e.url}/bucket`;return{data:await Ai(e.fetch,u,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Nl(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Rt(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!og(t))throw new Ea("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new ng({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(n,{get(u,d){const g=u[d];return typeof g!="function"?g:async(...w)=>{try{return{data:await g.apply(u,w),error:null}}catch(p){if(i)throw p;return{data:null,error:p}}}}})}};const Sl={"X-Client-Info":`storage-js/${Id}`,"Content-Type":"application/json"};var Od=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Lr(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var eo=class extends Od{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},bg=class extends Od{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const Il=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),vg=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},zc=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Cg=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!n?.noResolveJson){const i=t.status||500,u=t;if(typeof u.json=="function")u.json().then(d=>{const g=d?.statusCode||d?.code||i+"";e(new eo(zc(d),i,g))}).catch(()=>{const d=i+"";e(new eo(u.statusText||`HTTP ${i} error`,i,d))});else{const d=i+"";e(new eo(u.statusText||`HTTP ${i} error`,i,d))}}else e(new bg(zc(t),t))},_g=(t,e,n,i)=>{const u={method:t,headers:e?.headers||{}};return i?(vg(i)?(u.headers=De({"Content-Type":"application/json"},e?.headers),u.body=JSON.stringify(i)):u.body=i,De(De({},u),n)):u};async function Eg(t,e,n,i,u,d){return new Promise((g,w)=>{t(n,_g(e,i,u,d)).then(p=>{if(!p.ok)throw p;if(i?.noResolveJson)return p;const m=p.headers.get("content-type");return!m||!m.includes("application/json")?{}:p.json()}).then(p=>g(p)).catch(p=>Cg(p,w,i))})}async function Br(t,e,n,i,u){return Eg(t,"POST",e,i,u,n)}var Ag=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=De(De({},Sl),e),this.fetch=Il(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await Br(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await Br(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Lr(i))return{data:null,error:i};throw i}}async listIndexes(t){var e=this;try{return{data:await Br(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await Br(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Lr(i))return{data:null,error:i};throw i}}},Ng=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=De(De({},Sl),e),this.fetch=Il(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Br(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await Br(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await Br(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await Br(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Br(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}},Sg=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=De(De({},Sl),e),this.fetch=Il(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Br(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await Br(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await Br(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Br(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Lr(n))return{data:null,error:n};throw n}}},Ig=class extends Sg{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new Tg(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},Tg=class extends Ag{constructor(t,e,n,i){super(t,e,i),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,De(De({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,De(De({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new Og(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},Og=class extends Ng{constructor(t,e,n,i,u){super(t,e,u),this.vectorBucketName=n,this.indexName=i}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,De(De({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,De(De({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,De(De({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,De(De({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,De(De({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},Rg=class extends wg{constructor(t,e={},n,i){super(t,e,n,i)}from(t){return new pg(this.url,this.headers,t,this.fetch)}get vectors(){return new Ig(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new yg(this.url+"/iceberg",this.headers,this.fetch)}};const Rd="2.90.1",js=30*1e3,qo=3,to=qo*js,jg="http://localhost:9999",kg="supabase.auth.token",Dg={"X-Client-Info":`gotrue-js/${Rd}`},zo="X-Supabase-Api-Version",jd={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Pg=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Mg=600*1e3;class Ni extends Error{constructor(e,n,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=i}}function Ee(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Lg extends Ni{constructor(e,n,i){super(e,n,i),this.name="AuthApiError",this.status=n,this.code=i}}function Bg(t){return Ee(t)&&t.name==="AuthApiError"}class rs extends Ni{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class _n extends Ni{constructor(e,n,i,u){super(e,i,u),this.name=n,this.status=i}}class Pr extends _n{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Fg(t){return Ee(t)&&t.name==="AuthSessionMissingError"}class Es extends _n{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ji extends _n{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ea extends _n{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ug(t){return Ee(t)&&t.name==="AuthImplicitGrantRedirectError"}class Yc extends _n{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Wg extends _n{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Yo extends _n{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function ro(t){return Ee(t)&&t.name==="AuthRetryableFetchError"}class Xc extends _n{constructor(e,n,i){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=i}}class Xo extends _n{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const oa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),$c=` 	
\r=`.split(""),Vg=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<$c.length;e+=1)t[$c[e].charCodeAt(0)]=-2;for(let e=0;e<oa.length;e+=1)t[oa[e].charCodeAt(0)]=e;return t})();function Kc(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;n(oa[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;n(oa[i]),e.queuedBits-=6}}function kd(t,e,n){const i=Vg[t];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Qc(t){const e=[],n=g=>{e.push(String.fromCodePoint(g))},i={utf8seq:0,codepoint:0},u={queue:0,queuedBits:0},d=g=>{qg(g,i,n)};for(let g=0;g<t.length;g+=1)kd(t.charCodeAt(g),u,d);return e.join("")}function Hg(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Gg(t,e){for(let n=0;n<t.length;n+=1){let i=t.charCodeAt(n);if(i>55295&&i<=56319){const u=(i-55296)*1024&65535;i=(t.charCodeAt(n+1)-56320&65535|u)+65536,n+=1}Hg(i,e)}}function qg(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let i=1;i<6;i+=1)if((t>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Ws(t){const e=[],n={queue:0,queuedBits:0},i=u=>{e.push(u)};for(let u=0;u<t.length;u+=1)kd(t.charCodeAt(u),n,i);return new Uint8Array(e)}function zg(t){const e=[];return Gg(t,n=>e.push(n)),new Uint8Array(e)}function ss(t){const e=[],n={queue:0,queuedBits:0},i=u=>{e.push(u)};return t.forEach(u=>Kc(u,n,i)),Kc(null,n,i),e.join("")}function Yg(t){return Math.round(Date.now()/1e3)+t}function Xg(){return Symbol("auth-callback")}const hr=()=>typeof window<"u"&&typeof document<"u",$n={tested:!1,writable:!1},Dd=()=>{if(!hr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if($n.tested)return $n.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),$n.tested=!0,$n.writable=!0}catch{$n.tested=!0,$n.writable=!1}return $n.writable};function $g(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((u,d)=>{e[d]=u})}catch{}return n.searchParams.forEach((i,u)=>{e[u]=i}),e}const Pd=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Kg=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",ks=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Kn=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},dr=async(t,e)=>{await t.removeItem(e)};class Aa{constructor(){this.promise=new Aa.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Aa.promiseConstructor=Promise;function no(t){const e=t.split(".");if(e.length!==3)throw new Xo("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!Pg.test(e[i]))throw new Xo("JWT not in base64url format");return{header:JSON.parse(Qc(e[0])),payload:JSON.parse(Qc(e[1])),signature:Ws(e[2]),raw:{header:e[0],payload:e[1]}}}async function Qg(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Zg(t,e){return new Promise((i,u)=>{(async()=>{for(let d=0;d<1/0;d++)try{const g=await t(d);if(!e(d,null,g)){i(g);return}}catch(g){if(!e(d,g)){u(g);return}}})()})}function Jg(t){return("0"+t.toString(16)).substr(-2)}function em(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=n.length;let u="";for(let d=0;d<56;d++)u+=n.charAt(Math.floor(Math.random()*i));return u}return crypto.getRandomValues(e),Array.from(e,Jg).join("")}async function tm(t){const n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n),u=new Uint8Array(i);return Array.from(u).map(d=>String.fromCharCode(d)).join("")}async function rm(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await tm(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function As(t,e,n=!1){const i=em();let u=i;n&&(u+="/PASSWORD_RECOVERY"),await ks(t,`${e}-code-verifier`,u);const d=await rm(i);return[d,i===d?"plain":"s256"]}const nm=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function sm(t){const e=t.headers.get(zo);if(!e||!e.match(nm))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function im(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function am(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const om=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ns(t){if(!om.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function so(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function lm(t,e){return new Proxy(t,{get:(n,i,u)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const d=i.toString();if(d==="Symbol(Symbol.toPrimitive)"||d==="Symbol(Symbol.toStringTag)"||d==="Symbol(util.inspect.custom)"||d==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,i,u)}return!e.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,i,u)}})}function Zc(t){return JSON.parse(JSON.stringify(t))}const Zn=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),cm=[502,503,504];async function Jc(t){var e;if(!Kg(t))throw new Yo(Zn(t),0);if(cm.includes(t.status))throw new Yo(Zn(t),t.status);let n;try{n=await t.json()}catch(d){throw new rs(Zn(d),d)}let i;const u=sm(t);if(u&&u.getTime()>=jd["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?i=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(i=n.error_code),i){if(i==="weak_password")throw new Xc(Zn(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new Pr}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((d,g)=>d&&typeof g=="string",!0))throw new Xc(Zn(n),t.status,n.weak_password.reasons);throw new Lg(Zn(n),t.status||500,i)}const um=(t,e,n,i)=>{const u={method:t,headers:e?.headers||{}};return t==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),u.body=JSON.stringify(i),Object.assign(Object.assign({},u),n))};async function ke(t,e,n,i){var u;const d=Object.assign({},i?.headers);d[zo]||(d[zo]=jd["2024-01-01"].name),i?.jwt&&(d.Authorization=`Bearer ${i.jwt}`);const g=(u=i?.query)!==null&&u!==void 0?u:{};i?.redirectTo&&(g.redirect_to=i.redirectTo);const w=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",p=await dm(t,e,n+w,{headers:d,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(p):{data:Object.assign({},p),error:null}}async function dm(t,e,n,i,u,d){const g=um(e,i,u,d);let w;try{w=await t(n,Object.assign({},g))}catch(p){throw console.error(p),new Yo(Zn(p),0)}if(w.ok||await Jc(w),i?.noResolveJson)return w;try{return await w.json()}catch(p){await Jc(p)}}function Qr(t){var e;let n=null;gm(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Yg(t.expires_in)));const i=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:i},error:null}}function eu(t){const e=Qr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,i)=>n&&typeof i=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Pn(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function hm(t){return{data:t,error:null}}function fm(t){const{action_link:e,email_otp:n,hashed_token:i,redirect_to:u,verification_type:d}=t,g=ba(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),w={action_link:e,email_otp:n,hashed_token:i,redirect_to:u,verification_type:d},p=Object.assign({},g);return{data:{properties:w,user:p},error:null}}function tu(t){return t}function gm(t){return t.access_token&&t.refresh_token&&t.expires_in}const io=["global","local","others"];class mm{constructor({url:e="",headers:n={},fetch:i}){this.url=e,this.headers=n,this.fetch=Pd(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=io[0]){if(io.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${io.join(", ")}`);try{return await ke(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(Ee(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,n={}){try{return await ke(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Pn})}catch(i){if(Ee(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:n}=e,i=ba(e,["options"]),u=Object.assign(Object.assign({},i),n);return"newEmail"in i&&(u.new_email=i?.newEmail,delete u.newEmail),await ke(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:u,headers:this.headers,xform:fm,redirectTo:n?.redirectTo})}catch(n){if(Ee(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await ke(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Pn})}catch(n){if(Ee(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,i,u,d,g,w,p;try{const m={nextPage:null,lastPage:0,total:0},b=await ke(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:"",per_page:(d=(u=e?.perPage)===null||u===void 0?void 0:u.toString())!==null&&d!==void 0?d:""},xform:tu});if(b.error)throw b.error;const C=await b.json(),_=(g=b.headers.get("x-total-count"))!==null&&g!==void 0?g:0,N=(p=(w=b.headers.get("link"))===null||w===void 0?void 0:w.split(","))!==null&&p!==void 0?p:[];return N.length>0&&(N.forEach(I=>{const T=parseInt(I.split(";")[0].split("=")[1].substring(0,1)),k=JSON.parse(I.split(";")[1].split("=")[1]);m[`${k}Page`]=T}),m.total=parseInt(_)),{data:Object.assign(Object.assign({},C),m),error:null}}catch(m){if(Ee(m))return{data:{users:[]},error:m};throw m}}async getUserById(e){Ns(e);try{return await ke(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Pn})}catch(n){if(Ee(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Ns(e);try{return await ke(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Pn})}catch(i){if(Ee(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,n=!1){Ns(e);try{return await ke(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Pn})}catch(i){if(Ee(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){Ns(e.userId);try{const{data:n,error:i}=await ke(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:u=>({data:{factors:u},error:null})});return{data:n,error:i}}catch(n){if(Ee(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Ns(e.userId),Ns(e.id);try{return{data:await ke(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Ee(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,i,u,d,g,w,p;try{const m={nextPage:null,lastPage:0,total:0},b=await ke(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:"",per_page:(d=(u=e?.perPage)===null||u===void 0?void 0:u.toString())!==null&&d!==void 0?d:""},xform:tu});if(b.error)throw b.error;const C=await b.json(),_=(g=b.headers.get("x-total-count"))!==null&&g!==void 0?g:0,N=(p=(w=b.headers.get("link"))===null||w===void 0?void 0:w.split(","))!==null&&p!==void 0?p:[];return N.length>0&&(N.forEach(I=>{const T=parseInt(I.split(";")[0].split("=")[1].substring(0,1)),k=JSON.parse(I.split(";")[1].split("=")[1]);m[`${k}Page`]=T}),m.total=parseInt(_)),{data:Object.assign(Object.assign({},C),m),error:null}}catch(m){if(Ee(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(e){try{return await ke(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ee(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await ke(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ee(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await ke(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Ee(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(e){try{return await ke(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ee(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await ke(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ee(n))return{data:null,error:n};throw n}}}function ru(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const Ss={debug:!!(globalThis&&Dd()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Md extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class xm extends Md{}async function pm(t,e,n){Ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),Ss.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async u=>{if(u){Ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,u.name);try{return await n()}finally{Ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,u.name)}}else{if(e===0)throw Ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new xm(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Ss.debug)try{const d=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(d,null,"  "))}catch(d){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",d)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function wm(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Ld(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function ym(t){return parseInt(t,16)}function bm(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}function vm(t){var e;const{chainId:n,domain:i,expirationTime:u,issuedAt:d=new Date,nonce:g,notBefore:w,requestId:p,resources:m,scheme:b,uri:C,version:_}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(g&&g.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${g}`);if(!C)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(_!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${_}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const N=Ld(t.address),I=b?`${b}://${i}`:i,T=t.statement?`${t.statement}
`:"",k=`${I} wants you to sign in with your Ethereum account:
${N}

${T}`;let M=`URI: ${C}
Version: ${_}
Chain ID: ${n}${g?`
Nonce: ${g}`:""}
Issued At: ${d.toISOString()}`;if(u&&(M+=`
Expiration Time: ${u.toISOString()}`),w&&(M+=`
Not Before: ${w.toISOString()}`),p&&(M+=`
Request ID: ${p}`),m){let H=`
Resources:`;for(const B of m){if(!B||typeof B!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${B}`);H+=`
- ${B}`}M+=H}return`${k}
${M}`}class Kt extends Error{constructor({message:e,code:n,cause:i,name:u}){var d;super(e,{cause:i}),this.__isWebAuthnError=!0,this.name=(d=u??(i instanceof Error?i.name:void 0))!==null&&d!==void 0?d:"Unknown Error",this.code=n}}class la extends Kt{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function Cm({error:t,options:e}){var n,i,u;const{publicKey:d}=e;if(!d)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Kt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=d.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new Kt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((i=d.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Kt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((u=d.authenticatorSelection)===null||u===void 0?void 0:u.userVerification)==="required")return new Kt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Kt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Kt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return d.pubKeyCredParams.filter(w=>w.type==="public-key").length===0?new Kt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Kt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const g=window.location.hostname;if(Bd(g)){if(d.rp.id!==g)return new Kt({message:`The RP ID "${d.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Kt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(d.user.id.byteLength<1||d.user.id.byteLength>64)return new Kt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Kt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Kt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function _m({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Kt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Kt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const i=window.location.hostname;if(Bd(i)){if(n.rpId!==i)return new Kt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Kt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Kt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Kt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class Em{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Am=new Em;function Nm(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:i}=t,u=ba(t,["challenge","user","excludeCredentials"]),d=Ws(e).buffer,g=Object.assign(Object.assign({},n),{id:Ws(n.id).buffer}),w=Object.assign(Object.assign({},u),{challenge:d,user:g});if(i&&i.length>0){w.excludeCredentials=new Array(i.length);for(let p=0;p<i.length;p++){const m=i[p];w.excludeCredentials[p]=Object.assign(Object.assign({},m),{id:Ws(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return w}function Sm(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,i=ba(t,["challenge","allowCredentials"]),u=Ws(e).buffer,d=Object.assign(Object.assign({},i),{challenge:u});if(n&&n.length>0){d.allowCredentials=new Array(n.length);for(let g=0;g<n.length;g++){const w=n[g];d.allowCredentials[g]=Object.assign(Object.assign({},w),{id:Ws(w.id).buffer,type:w.type||"public-key",transports:w.transports})}}return d}function Im(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:ss(new Uint8Array(t.response.attestationObject)),clientDataJSON:ss(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Tm(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,i=t.getClientExtensionResults(),u=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:ss(new Uint8Array(u.authenticatorData)),clientDataJSON:ss(new Uint8Array(u.clientDataJSON)),signature:ss(new Uint8Array(u.signature)),userHandle:u.userHandle?ss(new Uint8Array(u.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Bd(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function nu(){var t,e;return!!(hr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Om(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new la("Browser returned unexpected credential type",e)}:{data:null,error:new la("Empty credential response",e)}}catch(e){return{data:null,error:Cm({error:e,options:t})}}}async function Rm(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new la("Browser returned unexpected credential type",e)}:{data:null,error:new la("Empty credential response",e)}}catch(e){return{data:null,error:_m({error:e,options:t})}}}const jm={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},km={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ca(...t){const e=u=>u!==null&&typeof u=="object"&&!Array.isArray(u),n=u=>u instanceof ArrayBuffer||ArrayBuffer.isView(u),i={};for(const u of t)if(u)for(const d in u){const g=u[d];if(g!==void 0)if(Array.isArray(g))i[d]=g;else if(n(g))i[d]=g;else if(e(g)){const w=i[d];e(w)?i[d]=ca(w,g):i[d]=ca(g)}else i[d]=g}return i}function Dm(t,e){return ca(jm,t,e||{})}function Pm(t,e){return ca(km,t,e||{})}class Mm{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:i,signal:u},d){try{const{data:g,error:w}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!g)return{data:null,error:w};const p=u??Am.createNewAbortSignal();if(g.webauthn.type==="create"){const{user:m}=g.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${i}`),m.displayName||(m.displayName=m.name)}switch(g.webauthn.type){case"create":{const m=Dm(g.webauthn.credential_options.publicKey,d?.create),{data:b,error:C}=await Om({publicKey:m,signal:p});return b?{data:{factorId:e,challengeId:g.id,webauthn:{type:g.webauthn.type,credential_response:b}},error:null}:{data:null,error:C}}case"request":{const m=Pm(g.webauthn.credential_options.publicKey,d?.request),{data:b,error:C}=await Rm(Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:m,signal:p}));return b?{data:{factorId:e,challengeId:g.id,webauthn:{type:g.webauthn.type,credential_response:b}},error:null}:{data:null,error:C}}}}catch(g){return Ee(g)?{data:null,error:g}:{data:null,error:new rs("Unexpected error in challenge",g)}}}async _verify({challengeId:e,factorId:n,webauthn:i}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:i})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:u}={}},d){if(!n)return{data:null,error:new Ni("rpId is required for WebAuthn authentication")};try{if(!nu())return{data:null,error:new rs("Browser does not support WebAuthn",null)};const{data:g,error:w}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:i},signal:u},{request:d});if(!g)return{data:null,error:w};const{webauthn:p}=g;return this._verify({factorId:e,challengeId:g.challengeId,webauthn:{type:p.type,rpId:n,rpOrigins:i,credential_response:p.credential_response}})}catch(g){return Ee(g)?{data:null,error:g}:{data:null,error:new rs("Unexpected error in authenticate",g)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:u}={}},d){if(!n)return{data:null,error:new Ni("rpId is required for WebAuthn registration")};try{if(!nu())return{data:null,error:new rs("Browser does not support WebAuthn",null)};const{data:g,error:w}=await this._enroll({friendlyName:e});if(!g)return await this.client.mfa.listFactors().then(b=>{var C;return(C=b.data)===null||C===void 0?void 0:C.all.find(_=>_.factor_type==="webauthn"&&_.friendly_name===e&&_.status!=="unverified")}).then(b=>b?this.client.mfa.unenroll({factorId:b?.id}):void 0),{data:null,error:w};const{data:p,error:m}=await this._challenge({factorId:g.id,friendlyName:g.friendly_name,webauthn:{rpId:n,rpOrigins:i},signal:u},{create:d});return p?this._verify({factorId:g.id,challengeId:p.challengeId,webauthn:{rpId:n,rpOrigins:i,type:p.webauthn.type,credential_response:p.webauthn.credential_response}}):{data:null,error:m}}catch(g){return Ee(g)?{data:null,error:g}:{data:null,error:new rs("Unexpected error in register",g)}}}}wm();const Lm={url:jg,storageKey:kg,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Dg,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function su(t,e,n){return await n()}const Is={};class Si{get jwks(){var e,n;return(n=(e=Is[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Is[this.storageKey]=Object.assign(Object.assign({},Is[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Is[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Is[this.storageKey]=Object.assign(Object.assign({},Is[this.storageKey]),{cachedAt:e})}constructor(e){var n,i,u;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const d=Object.assign(Object.assign({},Lm),e);if(this.storageKey=d.storageKey,this.instanceID=(n=Si.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,Si.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!d.debug,typeof d.debug=="function"&&(this.logger=d.debug),this.instanceID>0&&hr()){const g=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(g),this.logDebugMessages&&console.trace(g)}if(this.persistSession=d.persistSession,this.autoRefreshToken=d.autoRefreshToken,this.admin=new mm({url:d.url,headers:d.headers,fetch:d.fetch}),this.url=d.url,this.headers=d.headers,this.fetch=Pd(d.fetch),this.lock=d.lock||su,this.detectSessionInUrl=d.detectSessionInUrl,this.flowType=d.flowType,this.hasCustomAuthorizationHeader=d.hasCustomAuthorizationHeader,this.throwOnError=d.throwOnError,this.lockAcquireTimeout=d.lockAcquireTimeout,d.lock?this.lock=d.lock:this.persistSession&&hr()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=pm:this.lock=su,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Mm(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(d.storage?this.storage=d.storage:Dd()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ru(this.memoryStorage)),d.userStorage&&(this.userStorage=d.userStorage)):(this.memoryStorage={},this.storage=ru(this.memoryStorage)),hr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(g){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",g)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async g=>{this._debug("received broadcast notification from other tab or client",g),await this._notifyAllSubscribers(g.data.event,g.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Rd}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},i="none";if(hr()&&(n=$g(window.location.href),this._isImplicitGrantCallback(n)?i="implicit":await this._isPKCECallback(n)&&(i="pkce")),hr()&&this.detectSessionInUrl&&i!=="none"){const{data:u,error:d}=await this._getSessionFromURL(n,i);if(d){if(this._debug("#_initialize()","error detecting session from URL",d),Ug(d)){const p=(e=d.details)===null||e===void 0?void 0:e.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:d}}return{error:d}}const{session:g,redirectType:w}=u;return this._debug("#_initialize()","detected session in URL",g,"redirect type",w),await this._saveSession(g),setTimeout(async()=>{w==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",g):await this._notifyAllSubscribers("SIGNED_IN",g)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Ee(n)?this._returnResult({error:n}):this._returnResult({error:new rs("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,i,u;try{const d=await ke(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(u=e?.options)===null||u===void 0?void 0:u.captchaToken}},xform:Qr}),{data:g,error:w}=d;if(w||!g)return this._returnResult({data:{user:null,session:null},error:w});const p=g.session,m=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(d){if(Ee(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signUp(e){var n,i,u;try{let d;if("email"in e){const{email:b,password:C,options:_}=e;let N=null,I=null;this.flowType==="pkce"&&([N,I]=await As(this.storage,this.storageKey)),d=await ke(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:_?.emailRedirectTo,body:{email:b,password:C,data:(n=_?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:_?.captchaToken},code_challenge:N,code_challenge_method:I},xform:Qr})}else if("phone"in e){const{phone:b,password:C,options:_}=e;d=await ke(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:b,password:C,data:(i=_?.data)!==null&&i!==void 0?i:{},channel:(u=_?.channel)!==null&&u!==void 0?u:"sms",gotrue_meta_security:{captcha_token:_?.captchaToken}},xform:Qr})}else throw new Ji("You must provide either an email or phone number and a password");const{data:g,error:w}=d;if(w||!g)return await dr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:w});const p=g.session,m=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(d){if(await dr(this.storage,`${this.storageKey}-code-verifier`),Ee(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signInWithPassword(e){try{let n;if("email"in e){const{email:d,password:g,options:w}=e;n=await ke(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:d,password:g,gotrue_meta_security:{captcha_token:w?.captchaToken}},xform:eu})}else if("phone"in e){const{phone:d,password:g,options:w}=e;n=await ke(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:d,password:g,gotrue_meta_security:{captcha_token:w?.captchaToken}},xform:eu})}else throw new Ji("You must provide either an email or phone number and a password");const{data:i,error:u}=n;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!i||!i.session||!i.user){const d=new Es;return this._returnResult({data:{user:null,session:null},error:d})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:u})}catch(n){if(Ee(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,i,u,d;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:(d=e.options)===null||d===void 0?void 0:d.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,i,u,d,g,w,p,m,b,C,_;let N,I;if("message"in e)N=e.message,I=e.signature;else{const{chain:T,wallet:k,statement:M,options:H}=e;let B;if(hr())if(typeof k=="object")B=k;else{const O=window;if("ethereum"in O&&typeof O.ethereum=="object"&&"request"in O.ethereum&&typeof O.ethereum.request=="function")B=O.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof k!="object"||!H?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");B=k}const z=new URL((n=H?.url)!==null&&n!==void 0?n:window.location.href),ae=await B.request({method:"eth_requestAccounts"}).then(O=>O).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!ae||ae.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const V=Ld(ae[0]);let G=(i=H?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!G){const O=await B.request({method:"eth_chainId"});G=ym(O)}const P={domain:z.host,address:V,statement:M,uri:z.href,version:"1",chainId:G,nonce:(u=H?.signInWithEthereum)===null||u===void 0?void 0:u.nonce,issuedAt:(g=(d=H?.signInWithEthereum)===null||d===void 0?void 0:d.issuedAt)!==null&&g!==void 0?g:new Date,expirationTime:(w=H?.signInWithEthereum)===null||w===void 0?void 0:w.expirationTime,notBefore:(p=H?.signInWithEthereum)===null||p===void 0?void 0:p.notBefore,requestId:(m=H?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(b=H?.signInWithEthereum)===null||b===void 0?void 0:b.resources};N=vm(P),I=await B.request({method:"personal_sign",params:[bm(N),V]})}try{const{data:T,error:k}=await ke(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:N,signature:I},!((C=e.options)===null||C===void 0)&&C.captchaToken?{gotrue_meta_security:{captcha_token:(_=e.options)===null||_===void 0?void 0:_.captchaToken}}:null),xform:Qr});if(k)throw k;if(!T||!T.session||!T.user){const M=new Es;return this._returnResult({data:{user:null,session:null},error:M})}return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),this._returnResult({data:Object.assign({},T),error:k})}catch(T){if(Ee(T))return this._returnResult({data:{user:null,session:null},error:T});throw T}}async signInWithSolana(e){var n,i,u,d,g,w,p,m,b,C,_,N;let I,T;if("message"in e)I=e.message,T=e.signature;else{const{chain:k,wallet:M,statement:H,options:B}=e;let z;if(hr())if(typeof M=="object")z=M;else{const V=window;if("solana"in V&&typeof V.solana=="object"&&("signIn"in V.solana&&typeof V.solana.signIn=="function"||"signMessage"in V.solana&&typeof V.solana.signMessage=="function"))z=V.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof M!="object"||!B?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=M}const ae=new URL((n=B?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in z&&z.signIn){const V=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},B?.signInWithSolana),{version:"1",domain:ae.host,uri:ae.href}),H?{statement:H}:null));let G;if(Array.isArray(V)&&V[0]&&typeof V[0]=="object")G=V[0];else if(V&&typeof V=="object"&&"signedMessage"in V&&"signature"in V)G=V;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in G&&"signature"in G&&(typeof G.signedMessage=="string"||G.signedMessage instanceof Uint8Array)&&G.signature instanceof Uint8Array)I=typeof G.signedMessage=="string"?G.signedMessage:new TextDecoder().decode(G.signedMessage),T=G.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");I=[`${ae.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...H?["",H,""]:[""],"Version: 1",`URI: ${ae.href}`,`Issued At: ${(u=(i=B?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&u!==void 0?u:new Date().toISOString()}`,...!((d=B?.signInWithSolana)===null||d===void 0)&&d.notBefore?[`Not Before: ${B.signInWithSolana.notBefore}`]:[],...!((g=B?.signInWithSolana)===null||g===void 0)&&g.expirationTime?[`Expiration Time: ${B.signInWithSolana.expirationTime}`]:[],...!((w=B?.signInWithSolana)===null||w===void 0)&&w.chainId?[`Chain ID: ${B.signInWithSolana.chainId}`]:[],...!((p=B?.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${B.signInWithSolana.nonce}`]:[],...!((m=B?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${B.signInWithSolana.requestId}`]:[],...!((C=(b=B?.signInWithSolana)===null||b===void 0?void 0:b.resources)===null||C===void 0)&&C.length?["Resources",...B.signInWithSolana.resources.map(G=>`- ${G}`)]:[]].join(`
`);const V=await z.signMessage(new TextEncoder().encode(I),"utf8");if(!V||!(V instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");T=V}}try{const{data:k,error:M}=await ke(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:I,signature:ss(T)},!((_=e.options)===null||_===void 0)&&_.captchaToken?{gotrue_meta_security:{captcha_token:(N=e.options)===null||N===void 0?void 0:N.captchaToken}}:null),xform:Qr});if(M)throw M;if(!k||!k.session||!k.user){const H=new Es;return this._returnResult({data:{user:null,session:null},error:H})}return k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("SIGNED_IN",k.session)),this._returnResult({data:Object.assign({},k),error:M})}catch(k){if(Ee(k))return this._returnResult({data:{user:null,session:null},error:k});throw k}}async _exchangeCodeForSession(e){const n=await Kn(this.storage,`${this.storageKey}-code-verifier`),[i,u]=(n??"").split("/");try{if(!i&&this.flowType==="pkce")throw new Wg;const{data:d,error:g}=await ke(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:Qr});if(await dr(this.storage,`${this.storageKey}-code-verifier`),g)throw g;if(!d||!d.session||!d.user){const w=new Es;return this._returnResult({data:{user:null,session:null,redirectType:null},error:w})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:Object.assign(Object.assign({},d),{redirectType:u??null}),error:g})}catch(d){if(await dr(this.storage,`${this.storageKey}-code-verifier`),Ee(d))return this._returnResult({data:{user:null,session:null,redirectType:null},error:d});throw d}}async signInWithIdToken(e){try{const{options:n,provider:i,token:u,access_token:d,nonce:g}=e,w=await ke(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:u,access_token:d,nonce:g,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:Qr}),{data:p,error:m}=w;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!p||!p.session||!p.user){const b=new Es;return this._returnResult({data:{user:null,session:null},error:b})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:p,error:m})}catch(n){if(Ee(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,i,u,d,g;try{if("email"in e){const{email:w,options:p}=e;let m=null,b=null;this.flowType==="pkce"&&([m,b]=await As(this.storage,this.storageKey));const{error:C}=await ke(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:w,data:(n=p?.data)!==null&&n!==void 0?n:{},create_user:(i=p?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:m,code_challenge_method:b},redirectTo:p?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:C})}if("phone"in e){const{phone:w,options:p}=e,{data:m,error:b}=await ke(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:w,data:(u=p?.data)!==null&&u!==void 0?u:{},create_user:(d=p?.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(g=p?.channel)!==null&&g!==void 0?g:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:b})}throw new Ji("You must provide either an email or phone number.")}catch(w){if(await dr(this.storage,`${this.storageKey}-code-verifier`),Ee(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async verifyOtp(e){var n,i;try{let u,d;"options"in e&&(u=(n=e.options)===null||n===void 0?void 0:n.redirectTo,d=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:g,error:w}=await ke(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:d}}),redirectTo:u,xform:Qr});if(w)throw w;if(!g)throw new Error("An error occurred on token verification.");const p=g.session,m=g.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(u){if(Ee(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithSSO(e){var n,i,u,d,g;try{let w=null,p=null;this.flowType==="pkce"&&([w,p]=await As(this.storage,this.storageKey));const m=await ke(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&i!==void 0?i:void 0}),!((u=e?.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:w,code_challenge_method:p}),headers:this.headers,xform:hm});return!((d=m.data)===null||d===void 0)&&d.url&&hr()&&!(!((g=e.options)===null||g===void 0)&&g.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(w){if(await dr(this.storage,`${this.storageKey}-code-verifier`),Ee(w))return this._returnResult({data:null,error:w});throw w}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:i}=e;if(i)throw i;if(!n)throw new Pr;const{error:u}=await ke(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:u})})}catch(e){if(Ee(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:i,type:u,options:d}=e,{error:g}=await ke(this.fetch,"POST",n,{headers:this.headers,body:{email:i,type:u,gotrue_meta_security:{captcha_token:d?.captchaToken}},redirectTo:d?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}else if("phone"in e){const{phone:i,type:u,options:d}=e,{data:g,error:w}=await ke(this.fetch,"POST",n,{headers:this.headers,body:{phone:i,type:u,gotrue_meta_security:{captcha_token:d?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:g?.message_id},error:w})}throw new Ji("You must provide either an email or phone number and a type")}catch(n){if(Ee(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),u=(async()=>(await i,await n()))();return this.pendingInLock.push((async()=>{try{await u}catch{}})()),u}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=n();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const u=[...this.pendingInLock];await Promise.all(u),this.pendingInLock.splice(0,u.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await Kn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<to:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const g=await Kn(this.userStorage,this.storageKey+"-user");g?.user?e.user=g.user:e.user=so()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const g={value:this.suppressGetSessionWarning};e.user=lm(e.user,g),g.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:u,error:d}=await this._callRefreshToken(e.refresh_token);return d?this._returnResult({data:{session:null},error:d}):this._returnResult({data:{session:u},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await ke(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Pn}):await this._useSession(async n=>{var i,u,d;const{data:g,error:w}=n;if(w)throw w;return!(!((i=g.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pr}:await ke(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(d=(u=g.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0,xform:Pn})})}catch(n){if(Ee(n))return Fg(n)&&(await this._removeSession(),await dr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async i=>{const{data:u,error:d}=i;if(d)throw d;if(!u.session)throw new Pr;const g=u.session;let w=null,p=null;this.flowType==="pkce"&&e.email!=null&&([w,p]=await As(this.storage,this.storageKey));const{data:m,error:b}=await ke(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:w,code_challenge_method:p}),jwt:g.access_token,xform:Pn});if(b)throw b;return g.user=m.user,await this._saveSession(g),await this._notifyAllSubscribers("USER_UPDATED",g),this._returnResult({data:{user:g.user},error:null})})}catch(i){if(await dr(this.storage,`${this.storageKey}-code-verifier`),Ee(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Pr;const n=Date.now()/1e3;let i=n,u=!0,d=null;const{payload:g}=no(e.access_token);if(g.exp&&(i=g.exp,u=i<=n),u){const{data:w,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!w)return{data:{user:null,session:null},error:null};d=w}else{const{data:w,error:p}=await this._getUser(e.access_token);if(p)throw p;d={access_token:e.access_token,refresh_token:e.refresh_token,user:w.user,token_type:"bearer",expires_in:i-n,expires_at:i},await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)}return this._returnResult({data:{user:d.user,session:d},error:null})}catch(n){if(Ee(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var i;if(!e){const{data:g,error:w}=n;if(w)throw w;e=(i=g.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new Pr;const{data:u,error:d}=await this._callRefreshToken(e.refresh_token);return d?this._returnResult({data:{user:null,session:null},error:d}):u?this._returnResult({data:{user:u.user,session:u},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Ee(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!hr())throw new ea("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ea(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Yc("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ea("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Yc("No code detected.");const{data:H,error:B}=await this._exchangeCodeForSession(e.code);if(B)throw B;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:H.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:u,access_token:d,refresh_token:g,expires_in:w,expires_at:p,token_type:m}=e;if(!d||!w||!g||!m)throw new ea("No session defined in URL");const b=Math.round(Date.now()/1e3),C=parseInt(w);let _=b+C;p&&(_=parseInt(p));const N=_-b;N*1e3<=js&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${N}s, should have been closer to ${C}s`);const I=_-C;b-I>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",I,_,b):b-I<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",I,_,b);const{data:T,error:k}=await this._getUser(d);if(k)throw k;const M={provider_token:i,provider_refresh_token:u,access_token:d,expires_in:C,expires_at:_,refresh_token:g,token_type:m,user:T.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:M,redirectType:e.type},error:null})}catch(i){if(Ee(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await Kn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var i;const{data:u,error:d}=n;if(d)return this._returnResult({error:d});const g=(i=u.session)===null||i===void 0?void 0:i.access_token;if(g){const{error:w}=await this.admin.signOut(g,e);if(w&&!(Bg(w)&&(w.status===404||w.status===401||w.status===403)))return this._returnResult({error:w})}return e!=="others"&&(await this._removeSession(),await dr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=Xg(),i={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,i),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async n=>{var i,u;try{const{data:{session:d},error:g}=n;if(g)throw g;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",e,"session",d)}catch(d){await((u=this.stateChangeEmitters.get(e))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",d),console.error(d)}})}async resetPasswordForEmail(e,n={}){let i=null,u=null;this.flowType==="pkce"&&([i,u]=await As(this.storage,this.storageKey,!0));try{return await ke(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:u,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(d){if(await dr(this.storage,`${this.storageKey}-code-verifier`),Ee(d))return this._returnResult({data:null,error:d});throw d}}async getUserIdentities(){var e;try{const{data:n,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:i,error:u}=await this._useSession(async d=>{var g,w,p,m,b;const{data:C,error:_}=d;if(_)throw _;const N=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(g=e.options)===null||g===void 0?void 0:g.redirectTo,scopes:(w=e.options)===null||w===void 0?void 0:w.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await ke(this.fetch,"GET",N,{headers:this.headers,jwt:(b=(m=C.session)===null||m===void 0?void 0:m.access_token)!==null&&b!==void 0?b:void 0})});if(u)throw u;return hr()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:e.provider,url:i?.url},error:null})}catch(i){if(Ee(i))return this._returnResult({data:{provider:e.provider,url:null},error:i});throw i}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var i;try{const{error:u,data:{session:d}}=n;if(u)throw u;const{options:g,provider:w,token:p,access_token:m,nonce:b}=e,C=await ke(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=d?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:w,id_token:p,access_token:m,nonce:b,link_identity:!0,gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:Qr}),{data:_,error:N}=C;return N?this._returnResult({data:{user:null,session:null},error:N}):!_||!_.session||!_.user?this._returnResult({data:{user:null,session:null},error:new Es}):(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("USER_UPDATED",_.session)),this._returnResult({data:_,error:N}))}catch(u){if(await dr(this.storage,`${this.storageKey}-code-verifier`),Ee(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var i,u;const{data:d,error:g}=n;if(g)throw g;return await ke(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(u=(i=d.session)===null||i===void 0?void 0:i.access_token)!==null&&u!==void 0?u:void 0})})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const i=Date.now();return await Zg(async u=>(u>0&&await Qg(200*Math.pow(2,u-1)),this._debug(n,"refreshing attempt",u),await ke(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Qr})),(u,d)=>{const g=200*Math.pow(2,u);return d&&ro(d)&&Date.now()+g-i<js})}catch(i){if(this._debug(n,"error",i),Ee(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",i),hr()&&!n.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,n;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const u=await Kn(this.storage,this.storageKey);if(u&&this.userStorage){let g=await Kn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!g&&(g={user:u.user},await ks(this.userStorage,this.storageKey+"-user",g)),u.user=(e=g?.user)!==null&&e!==void 0?e:so()}else if(u&&!u.user&&!u.user){const g=await Kn(this.storage,this.storageKey+"-user");g&&g?.user?(u.user=g.user,await dr(this.storage,this.storageKey+"-user"),await ks(this.storage,this.storageKey,u)):u.user=so()}if(this._debug(i,"session from storage",u),!this._isValidSession(u)){this._debug(i,"session is not valid"),u!==null&&await this._removeSession();return}const d=((n=u.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<to;if(this._debug(i,`session has${d?"":" not"} expired with margin of ${to}s`),d){if(this.autoRefreshToken&&u.refresh_token){const{error:g}=await this._callRefreshToken(u.refresh_token);g&&(console.error(g),ro(g)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",g),await this._removeSession()))}}else if(u.user&&u.user.__isUserNotAvailableProxy===!0)try{const{data:g,error:w}=await this._getUser(u.access_token);!w&&g?.user?(u.user=g.user,await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(g){console.error("Error getting user data:",g),this._debug(i,"error getting user data, skipping SIGNED_IN notification",g)}else await this._notifyAllSubscribers("SIGNED_IN",u)}catch(u){this._debug(i,"error",u),console.error(u);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var n,i;if(!e)throw new Pr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const u=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(u,"begin");try{this.refreshingDeferred=new Aa;const{data:d,error:g}=await this._refreshAccessToken(e);if(g)throw g;if(!d.session)throw new Pr;await this._saveSession(d.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",d.session);const w={data:d.session,error:null};return this.refreshingDeferred.resolve(w),w}catch(d){if(this._debug(u,"error",d),Ee(d)){const g={data:null,error:d};return ro(d)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(g),g}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(d),d}finally{this.refreshingDeferred=null,this._debug(u,"end")}}async _notifyAllSubscribers(e,n,i=!0){const u=`#_notifyAllSubscribers(${e})`;this._debug(u,"begin",n,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:n});const d=[],g=Array.from(this.stateChangeEmitters.values()).map(async w=>{try{await w.callback(e,n)}catch(p){d.push(p)}});if(await Promise.all(g),d.length>0){for(let w=0;w<d.length;w+=1)console.error(d[w]);throw d[0]}}finally{this._debug(u,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await dr(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),i=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&n.user&&await ks(this.userStorage,this.storageKey+"-user",{user:n.user});const u=Object.assign({},n);delete u.user;const d=Zc(u);await ks(this.storage,this.storageKey,d)}else{const u=Zc(n);await ks(this.storage,this.storageKey,u)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await dr(this.storage,this.storageKey),await dr(this.storage,this.storageKey+"-code-verifier"),await dr(this.storage,this.storageKey+"-user"),this.userStorage&&await dr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&hr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),js);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const n=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const n=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,n&&clearTimeout(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:i}}=n;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const u=Math.floor((i.expires_at*1e3-e)/js);this._debug("#_autoRefreshTokenTick()",`access token expires in ${u} ticks, a tick lasts ${js}ms, refresh threshold is ${qo} ticks`),u<=qo&&await this._callRefreshToken(i.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Md)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!hr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,i){const u=[`provider=${encodeURIComponent(n)}`];if(i?.redirectTo&&u.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&u.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[d,g]=await As(this.storage,this.storageKey),w=new URLSearchParams({code_challenge:`${encodeURIComponent(d)}`,code_challenge_method:`${encodeURIComponent(g)}`});u.push(w.toString())}if(i?.queryParams){const d=new URLSearchParams(i.queryParams);u.push(d.toString())}return i?.skipBrowserRedirect&&u.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${u.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var i;const{data:u,error:d}=n;return d?this._returnResult({data:null,error:d}):await ke(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=u?.session)===null||i===void 0?void 0:i.access_token})})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var i,u;const{data:d,error:g}=n;if(g)return this._returnResult({data:null,error:g});const w=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:p,error:m}=await ke(this.fetch,"POST",`${this.url}/factors`,{body:w,headers:this.headers,jwt:(i=d?.session)===null||i===void 0?void 0:i.access_token});return m?this._returnResult({data:null,error:m}):(e.factorType==="totp"&&p.type==="totp"&&(!((u=p?.totp)===null||u===void 0)&&u.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),this._returnResult({data:p,error:null}))})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var i;const{data:u,error:d}=n;if(d)return this._returnResult({data:null,error:d});const g=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Im(e.webauthn.credential_response):Tm(e.webauthn.credential_response)})}:{code:e.code}),{data:w,error:p}=await ke(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:g,headers:this.headers,jwt:(i=u?.session)===null||i===void 0?void 0:i.access_token});return p?this._returnResult({data:null,error:p}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+w.expires_in},w)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",w),this._returnResult({data:w,error:p}))})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var i;const{data:u,error:d}=n;if(d)return this._returnResult({data:null,error:d});const g=await ke(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(i=u?.session)===null||i===void 0?void 0:i.access_token});if(g.error)return g;const{data:w}=g;if(w.type!=="webauthn")return{data:w,error:null};switch(w.webauthn.type){case"create":return{data:Object.assign(Object.assign({},w),{webauthn:Object.assign(Object.assign({},w.webauthn),{credential_options:Object.assign(Object.assign({},w.webauthn.credential_options),{publicKey:Nm(w.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},w),{webauthn:Object.assign(Object.assign({},w.webauthn),{credential_options:Object.assign(Object.assign({},w.webauthn.credential_options),{publicKey:Sm(w.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:i}=await this._challenge({factorId:e.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:i}=await this.getUser();if(i)return{data:null,error:i};const u={all:[],phone:[],totp:[],webauthn:[]};for(const d of(e=n?.factors)!==null&&e!==void 0?e:[])u.all.push(d),d.status==="verified"&&u[d.factor_type].push(d);return{data:u,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:i},error:u}=await this.getSession();if(u)return this._returnResult({data:null,error:u});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=no(i.access_token);let g=null;d.aal&&(g=d.aal);let w=g;((n=(e=i.user.factors)===null||e===void 0?void 0:e.filter(b=>b.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(w="aal2");const m=d.amr||[];return{data:{currentLevel:g,nextLevel:w,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:i},error:u}=n;return u?this._returnResult({data:null,error:u}):i?await ke(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:i.access_token,xform:d=>({data:d,error:null})}):this._returnResult({data:null,error:new Pr})})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async i=>{const{data:{session:u},error:d}=i;if(d)return this._returnResult({data:null,error:d});if(!u)return this._returnResult({data:null,error:new Pr});const g=await ke(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"approve"},xform:w=>({data:w,error:null})});return g.data&&g.data.redirect_url&&hr()&&!n?.skipBrowserRedirect&&window.location.assign(g.data.redirect_url),g})}catch(i){if(Ee(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(e,n){try{return await this._useSession(async i=>{const{data:{session:u},error:d}=i;if(d)return this._returnResult({data:null,error:d});if(!u)return this._returnResult({data:null,error:new Pr});const g=await ke(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"deny"},xform:w=>({data:w,error:null})});return g.data&&g.data.redirect_url&&hr()&&!n?.skipBrowserRedirect&&window.location.assign(g.data.redirect_url),g})}catch(i){if(Ee(i))return this._returnResult({data:null,error:i});throw i}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:i}=e;return i?this._returnResult({data:null,error:i}):n?await ke(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Pr})})}catch(e){if(Ee(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:i},error:u}=n;return u?this._returnResult({data:null,error:u}):i?(await ke(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Pr})})}catch(n){if(Ee(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let i=n.keys.find(w=>w.kid===e);if(i)return i;const u=Date.now();if(i=this.jwks.keys.find(w=>w.kid===e),i&&this.jwks_cached_at+Mg>u)return i;const{data:d,error:g}=await ke(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(g)throw g;return!d.keys||d.keys.length===0||(this.jwks=d,this.jwks_cached_at=u,i=d.keys.find(w=>w.kid===e),!i)?null:i}async getClaims(e,n={}){try{let i=e;if(!i){const{data:N,error:I}=await this.getSession();if(I||!N.session)return this._returnResult({data:null,error:I});i=N.session.access_token}const{header:u,payload:d,signature:g,raw:{header:w,payload:p}}=no(i);n?.allowExpired||im(d.exp);const m=!u.alg||u.alg.startsWith("HS")||!u.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(u.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!m){const{error:N}=await this.getUser(i);if(N)throw N;return{data:{claims:d,header:u,signature:g},error:null}}const b=am(u.alg),C=await crypto.subtle.importKey("jwk",m,b,!0,["verify"]);if(!await crypto.subtle.verify(b,C,g,zg(`${w}.${p}`)))throw new Xo("Invalid JWT signature");return{data:{claims:d,header:u,signature:g},error:null}}catch(i){if(Ee(i))return this._returnResult({data:null,error:i});throw i}}}Si.nextInstanceID={};const Bm=Si,Fm="2.90.1";let gi="";typeof Deno<"u"?gi="deno":typeof document<"u"?gi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?gi="react-native":gi="node";const Um={"X-Client-Info":`supabase-js-${gi}/${Fm}`},Wm={headers:Um},Vm={schema:"public"},Hm={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Gm={};function Ii(t){"@babel/helpers - typeof";return Ii=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ii(t)}function qm(t,e){if(Ii(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(Ii(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function zm(t){var e=qm(t,"string");return Ii(e)=="symbol"?e:e+""}function Ym(t,e,n){return(e=zm(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function iu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,i)}return n}function Bt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iu(Object(n),!0).forEach(function(i){Ym(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iu(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Xm=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),$m=()=>Headers,Km=(t,e,n)=>{const i=Xm(n),u=$m();return async(d,g)=>{var w;const p=(w=await e())!==null&&w!==void 0?w:t;let m=new u(g?.headers);return m.has("apikey")||m.set("apikey",t),m.has("Authorization")||m.set("Authorization",`Bearer ${p}`),i(d,Bt(Bt({},g),{},{headers:m}))}};function Qm(t){return t.endsWith("/")?t:t+"/"}function Zm(t,e){var n,i;const{db:u,auth:d,realtime:g,global:w}=t,{db:p,auth:m,realtime:b,global:C}=e,_={db:Bt(Bt({},p),u),auth:Bt(Bt({},m),d),realtime:Bt(Bt({},b),g),storage:{},global:Bt(Bt(Bt({},C),w),{},{headers:Bt(Bt({},(n=C?.headers)!==null&&n!==void 0?n:{}),(i=w?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return t.accessToken?_.accessToken=t.accessToken:delete _.accessToken,_}function Jm(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Qm(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var ex=class extends Bm{constructor(t){super(t)}},tx=class{constructor(t,e,n){var i,u;this.supabaseUrl=t,this.supabaseKey=e;const d=Jm(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",d),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",d),this.storageUrl=new URL("storage/v1",d),this.functionsUrl=new URL("functions/v1",d);const g=`sb-${d.hostname.split(".")[0]}-auth-token`,w={db:Vm,realtime:Gm,auth:Bt(Bt({},Hm),{},{storageKey:g}),global:Wm},p=Zm(n??{},w);if(this.storageKey=(i=p.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(u=p.global.headers)!==null&&u!==void 0?u:{},p.accessToken)this.accessToken=p.accessToken,this.auth=new Proxy({},{get:(b,C)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(C)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=p.auth)!==null&&m!==void 0?m:{},this.headers,p.global.fetch)}this.fetch=Km(e,this._getAccessToken.bind(this),p.global.fetch),this.realtime=this._initRealtimeClient(Bt({headers:this.headers,accessToken:this._getAccessToken.bind(this)},p.realtime)),this.accessToken&&this.accessToken().then(b=>this.realtime.setAuth(b)).catch(b=>console.warn("Failed to set initial Realtime auth token:",b)),this.rest=new D1(new URL("rest/v1",d).href,{headers:this.headers,schema:p.db.schema,fetch:this.fetch}),this.storage=new Rg(this.storageUrl.href,this.headers,this.fetch,n?.storage),p.accessToken||this._listenForAuthEvents()}get functions(){return new T1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:i}=await t.auth.getSession();return(e=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:i,userStorage:u,storageKey:d,flowType:g,lock:w,debug:p,throwOnError:m},b,C){const _={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ex({url:this.authUrl.href,headers:Bt(Bt({},_),b),storageKey:d,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:i,userStorage:u,flowType:g,lock:w,debug:p,throwOnError:m,fetch:C,hasCustomAuthorizationHeader:Object.keys(this.headers).some(N=>N.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Q1(this.realtimeUrl.href,Bt(Bt({},t),{},{params:Bt(Bt({},{apikey:this.supabaseKey}),t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e?.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const rx=(t,e,n)=>new tx(t,e,n);function nx(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const n=e.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}nx()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const sx="https://xrbywqremyibbnsdqvvv.supabase.co",ix="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhyYnl3cXJlbXlpYmJuc2RxdnZ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjk0MDIsImV4cCI6MjA4MzcwNTQwMn0.w3PnRWz0VWaNQrRIyFiCOUYGV9X-gTOG-LkymkpYQkQ",ze=rx(sx,ix),au=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,ou=rd,Fd=(t,e)=>n=>{var i;if(e?.variants==null)return ou(t,n?.class,n?.className);const{variants:u,defaultVariants:d}=e,g=Object.keys(u).map(m=>{const b=n?.[m],C=d?.[m];if(b===null)return null;const _=au(b)||au(C);return u[m][_]}),w=n&&Object.entries(n).reduce((m,b)=>{let[C,_]=b;return _===void 0||(m[C]=_),m},{}),p=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((m,b)=>{let{class:C,className:_,...N}=b;return Object.entries(N).every(I=>{let[T,k]=I;return Array.isArray(k)?k.includes({...d,...w}[T]):{...d,...w}[T]===k})?[...m,C,_]:m},[]);return ou(t,g,p,n?.class,n?.className)},ax=(t,e)=>{const n=new Array(t.length+e.length);for(let i=0;i<t.length;i++)n[i]=t[i];for(let i=0;i<e.length;i++)n[t.length+i]=e[i];return n},ox=(t,e)=>({classGroupId:t,validator:e}),Ud=(t=new Map,e=null,n)=>({nextPart:t,validators:e,classGroupId:n}),ua="-",lu=[],lx="arbitrary..",cx=t=>{const e=dx(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:g=>{if(g.startsWith("[")&&g.endsWith("]"))return ux(g);const w=g.split(ua),p=w[0]===""&&w.length>1?1:0;return Wd(w,p,e)},getConflictingClassGroupIds:(g,w)=>{if(w){const p=i[g],m=n[g];return p?m?ax(m,p):p:m||lu}return n[g]||lu}}},Wd=(t,e,n)=>{if(t.length-e===0)return n.classGroupId;const u=t[e],d=n.nextPart.get(u);if(d){const m=Wd(t,e+1,d);if(m)return m}const g=n.validators;if(g===null)return;const w=e===0?t.join(ua):t.slice(e).join(ua),p=g.length;for(let m=0;m<p;m++){const b=g[m];if(b.validator(w))return b.classGroupId}},ux=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=t.slice(1,-1),n=e.indexOf(":"),i=e.slice(0,n);return i?lx+i:void 0})(),dx=t=>{const{theme:e,classGroups:n}=t;return hx(n,e)},hx=(t,e)=>{const n=Ud();for(const i in t){const u=t[i];Tl(u,n,i,e)}return n},Tl=(t,e,n,i)=>{const u=t.length;for(let d=0;d<u;d++){const g=t[d];fx(g,e,n,i)}},fx=(t,e,n,i)=>{if(typeof t=="string"){gx(t,e,n);return}if(typeof t=="function"){mx(t,e,n,i);return}xx(t,e,n,i)},gx=(t,e,n)=>{const i=t===""?e:Vd(e,t);i.classGroupId=n},mx=(t,e,n,i)=>{if(px(t)){Tl(t(i),e,n,i);return}e.validators===null&&(e.validators=[]),e.validators.push(ox(n,t))},xx=(t,e,n,i)=>{const u=Object.entries(t),d=u.length;for(let g=0;g<d;g++){const[w,p]=u[g];Tl(p,Vd(e,w),n,i)}},Vd=(t,e)=>{let n=t;const i=e.split(ua),u=i.length;for(let d=0;d<u;d++){const g=i[d];let w=n.nextPart.get(g);w||(w=Ud(),n.nextPart.set(g,w)),n=w}return n},px=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,wx=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=Object.create(null),i=Object.create(null);const u=(d,g)=>{n[d]=g,e++,e>t&&(e=0,i=n,n=Object.create(null))};return{get(d){let g=n[d];if(g!==void 0)return g;if((g=i[d])!==void 0)return u(d,g),g},set(d,g){d in n?n[d]=g:u(d,g)}}},$o="!",cu=":",yx=[],uu=(t,e,n,i,u)=>({modifiers:t,hasImportantModifier:e,baseClassName:n,maybePostfixModifierPosition:i,isExternal:u}),bx=t=>{const{prefix:e,experimentalParseClassName:n}=t;let i=u=>{const d=[];let g=0,w=0,p=0,m;const b=u.length;for(let T=0;T<b;T++){const k=u[T];if(g===0&&w===0){if(k===cu){d.push(u.slice(p,T)),p=T+1;continue}if(k==="/"){m=T;continue}}k==="["?g++:k==="]"?g--:k==="("?w++:k===")"&&w--}const C=d.length===0?u:u.slice(p);let _=C,N=!1;C.endsWith($o)?(_=C.slice(0,-1),N=!0):C.startsWith($o)&&(_=C.slice(1),N=!0);const I=m&&m>p?m-p:void 0;return uu(d,N,_,I)};if(e){const u=e+cu,d=i;i=g=>g.startsWith(u)?d(g.slice(u.length)):uu(yx,!1,g,void 0,!0)}if(n){const u=i;i=d=>n({className:d,parseClassName:u})}return i},vx=t=>{const e=new Map;return t.orderSensitiveModifiers.forEach((n,i)=>{e.set(n,1e6+i)}),n=>{const i=[];let u=[];for(let d=0;d<n.length;d++){const g=n[d],w=g[0]==="[",p=e.has(g);w||p?(u.length>0&&(u.sort(),i.push(...u),u=[]),i.push(g)):u.push(g)}return u.length>0&&(u.sort(),i.push(...u)),i}},Cx=t=>({cache:wx(t.cacheSize),parseClassName:bx(t),sortModifiers:vx(t),...cx(t)}),_x=/\s+/,Ex=(t,e)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:u,sortModifiers:d}=e,g=[],w=t.trim().split(_x);let p="";for(let m=w.length-1;m>=0;m-=1){const b=w[m],{isExternal:C,modifiers:_,hasImportantModifier:N,baseClassName:I,maybePostfixModifierPosition:T}=n(b);if(C){p=b+(p.length>0?" "+p:p);continue}let k=!!T,M=i(k?I.substring(0,T):I);if(!M){if(!k){p=b+(p.length>0?" "+p:p);continue}if(M=i(I),!M){p=b+(p.length>0?" "+p:p);continue}k=!1}const H=_.length===0?"":_.length===1?_[0]:d(_).join(":"),B=N?H+$o:H,z=B+M;if(g.indexOf(z)>-1)continue;g.push(z);const ae=u(M,k);for(let V=0;V<ae.length;++V){const G=ae[V];g.push(B+G)}p=b+(p.length>0?" "+p:p)}return p},Ax=(...t)=>{let e=0,n,i,u="";for(;e<t.length;)(n=t[e++])&&(i=Hd(n))&&(u&&(u+=" "),u+=i);return u},Hd=t=>{if(typeof t=="string")return t;let e,n="";for(let i=0;i<t.length;i++)t[i]&&(e=Hd(t[i]))&&(n&&(n+=" "),n+=e);return n},Nx=(t,...e)=>{let n,i,u,d;const g=p=>{const m=e.reduce((b,C)=>C(b),t());return n=Cx(m),i=n.cache.get,u=n.cache.set,d=w,w(p)},w=p=>{const m=i(p);if(m)return m;const b=Ex(p,n);return u(p,b),b};return d=g,(...p)=>d(Ax(...p))},Sx=[],er=t=>{const e=n=>n[t]||Sx;return e.isThemeGetter=!0,e},Gd=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,qd=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Ix=/^\d+\/\d+$/,Tx=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ox=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Rx=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,jx=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kx=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ts=t=>Ix.test(t),Ke=t=>!!t&&!Number.isNaN(Number(t)),Rn=t=>!!t&&Number.isInteger(Number(t)),ao=t=>t.endsWith("%")&&Ke(t.slice(0,-1)),pn=t=>Tx.test(t),Dx=()=>!0,Px=t=>Ox.test(t)&&!Rx.test(t),zd=()=>!1,Mx=t=>jx.test(t),Lx=t=>kx.test(t),Bx=t=>!be(t)&&!ve(t),Fx=t=>Ks(t,$d,zd),be=t=>Gd.test(t),Qn=t=>Ks(t,Kd,Px),oo=t=>Ks(t,Gx,Ke),du=t=>Ks(t,Yd,zd),Ux=t=>Ks(t,Xd,Lx),ta=t=>Ks(t,Qd,Mx),ve=t=>qd.test(t),ci=t=>Qs(t,Kd),Wx=t=>Qs(t,qx),hu=t=>Qs(t,Yd),Vx=t=>Qs(t,$d),Hx=t=>Qs(t,Xd),ra=t=>Qs(t,Qd,!0),Ks=(t,e,n)=>{const i=Gd.exec(t);return i?i[1]?e(i[1]):n(i[2]):!1},Qs=(t,e,n=!1)=>{const i=qd.exec(t);return i?i[1]?e(i[1]):n:!1},Yd=t=>t==="position"||t==="percentage",Xd=t=>t==="image"||t==="url",$d=t=>t==="length"||t==="size"||t==="bg-size",Kd=t=>t==="length",Gx=t=>t==="number",qx=t=>t==="family-name",Qd=t=>t==="shadow",zx=()=>{const t=er("color"),e=er("font"),n=er("text"),i=er("font-weight"),u=er("tracking"),d=er("leading"),g=er("breakpoint"),w=er("container"),p=er("spacing"),m=er("radius"),b=er("shadow"),C=er("inset-shadow"),_=er("text-shadow"),N=er("drop-shadow"),I=er("blur"),T=er("perspective"),k=er("aspect"),M=er("ease"),H=er("animate"),B=()=>["auto","avoid","all","avoid-page","page","left","right","column"],z=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],ae=()=>[...z(),ve,be],V=()=>["auto","hidden","clip","visible","scroll"],G=()=>["auto","contain","none"],P=()=>[ve,be,p],O=()=>[Ts,"full","auto",...P()],ne=()=>[Rn,"none","subgrid",ve,be],oe=()=>["auto",{span:["full",Rn,ve,be]},Rn,ve,be],ue=()=>[Rn,"auto",ve,be],te=()=>["auto","min","max","fr",ve,be],ge=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],q=()=>["start","end","center","stretch","center-safe","end-safe"],Z=()=>["auto",...P()],Y=()=>[Ts,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...P()],Q=()=>[t,ve,be],Fe=()=>[...z(),hu,du,{position:[ve,be]}],qe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],lt=()=>["auto","cover","contain",Vx,Fx,{size:[ve,be]}],re=()=>[ao,ci,Qn],W=()=>["","none","full",m,ve,be],ce=()=>["",Ke,ci,Qn],$=()=>["solid","dashed","dotted","double"],F=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],he=()=>[Ke,ao,hu,du],Pe=()=>["","none",I,ve,be],Ze=()=>["none",Ke,ve,be],_t=()=>["none",Ke,ve,be],Nt=()=>[Ke,ve,be],wr=()=>[Ts,"full",...P()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[pn],breakpoint:[pn],color:[Dx],container:[pn],"drop-shadow":[pn],ease:["in","out","in-out"],font:[Bx],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[pn],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[pn],shadow:[pn],spacing:["px",Ke],text:[pn],"text-shadow":[pn],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Ts,be,ve,k]}],container:["container"],columns:[{columns:[Ke,be,ve,w]}],"break-after":[{"break-after":B()}],"break-before":[{"break-before":B()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:ae()}],overflow:[{overflow:V()}],"overflow-x":[{"overflow-x":V()}],"overflow-y":[{"overflow-y":V()}],overscroll:[{overscroll:G()}],"overscroll-x":[{"overscroll-x":G()}],"overscroll-y":[{"overscroll-y":G()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:O()}],"inset-x":[{"inset-x":O()}],"inset-y":[{"inset-y":O()}],start:[{start:O()}],end:[{end:O()}],top:[{top:O()}],right:[{right:O()}],bottom:[{bottom:O()}],left:[{left:O()}],visibility:["visible","invisible","collapse"],z:[{z:[Rn,"auto",ve,be]}],basis:[{basis:[Ts,"full","auto",w,...P()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Ke,Ts,"auto","initial","none",be]}],grow:[{grow:["",Ke,ve,be]}],shrink:[{shrink:["",Ke,ve,be]}],order:[{order:[Rn,"first","last","none",ve,be]}],"grid-cols":[{"grid-cols":ne()}],"col-start-end":[{col:oe()}],"col-start":[{"col-start":ue()}],"col-end":[{"col-end":ue()}],"grid-rows":[{"grid-rows":ne()}],"row-start-end":[{row:oe()}],"row-start":[{"row-start":ue()}],"row-end":[{"row-end":ue()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":te()}],"auto-rows":[{"auto-rows":te()}],gap:[{gap:P()}],"gap-x":[{"gap-x":P()}],"gap-y":[{"gap-y":P()}],"justify-content":[{justify:[...ge(),"normal"]}],"justify-items":[{"justify-items":[...q(),"normal"]}],"justify-self":[{"justify-self":["auto",...q()]}],"align-content":[{content:["normal",...ge()]}],"align-items":[{items:[...q(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...q(),{baseline:["","last"]}]}],"place-content":[{"place-content":ge()}],"place-items":[{"place-items":[...q(),"baseline"]}],"place-self":[{"place-self":["auto",...q()]}],p:[{p:P()}],px:[{px:P()}],py:[{py:P()}],ps:[{ps:P()}],pe:[{pe:P()}],pt:[{pt:P()}],pr:[{pr:P()}],pb:[{pb:P()}],pl:[{pl:P()}],m:[{m:Z()}],mx:[{mx:Z()}],my:[{my:Z()}],ms:[{ms:Z()}],me:[{me:Z()}],mt:[{mt:Z()}],mr:[{mr:Z()}],mb:[{mb:Z()}],ml:[{ml:Z()}],"space-x":[{"space-x":P()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":P()}],"space-y-reverse":["space-y-reverse"],size:[{size:Y()}],w:[{w:[w,"screen",...Y()]}],"min-w":[{"min-w":[w,"screen","none",...Y()]}],"max-w":[{"max-w":[w,"screen","none","prose",{screen:[g]},...Y()]}],h:[{h:["screen","lh",...Y()]}],"min-h":[{"min-h":["screen","lh","none",...Y()]}],"max-h":[{"max-h":["screen","lh",...Y()]}],"font-size":[{text:["base",n,ci,Qn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[i,ve,oo]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",ao,be]}],"font-family":[{font:[Wx,be,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[u,ve,be]}],"line-clamp":[{"line-clamp":[Ke,"none",ve,oo]}],leading:[{leading:[d,...P()]}],"list-image":[{"list-image":["none",ve,be]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ve,be]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Q()}],"text-color":[{text:Q()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...$(),"wavy"]}],"text-decoration-thickness":[{decoration:[Ke,"from-font","auto",ve,Qn]}],"text-decoration-color":[{decoration:Q()}],"underline-offset":[{"underline-offset":[Ke,"auto",ve,be]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:P()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ve,be]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ve,be]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Fe()}],"bg-repeat":[{bg:qe()}],"bg-size":[{bg:lt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Rn,ve,be],radial:["",ve,be],conic:[Rn,ve,be]},Hx,Ux]}],"bg-color":[{bg:Q()}],"gradient-from-pos":[{from:re()}],"gradient-via-pos":[{via:re()}],"gradient-to-pos":[{to:re()}],"gradient-from":[{from:Q()}],"gradient-via":[{via:Q()}],"gradient-to":[{to:Q()}],rounded:[{rounded:W()}],"rounded-s":[{"rounded-s":W()}],"rounded-e":[{"rounded-e":W()}],"rounded-t":[{"rounded-t":W()}],"rounded-r":[{"rounded-r":W()}],"rounded-b":[{"rounded-b":W()}],"rounded-l":[{"rounded-l":W()}],"rounded-ss":[{"rounded-ss":W()}],"rounded-se":[{"rounded-se":W()}],"rounded-ee":[{"rounded-ee":W()}],"rounded-es":[{"rounded-es":W()}],"rounded-tl":[{"rounded-tl":W()}],"rounded-tr":[{"rounded-tr":W()}],"rounded-br":[{"rounded-br":W()}],"rounded-bl":[{"rounded-bl":W()}],"border-w":[{border:ce()}],"border-w-x":[{"border-x":ce()}],"border-w-y":[{"border-y":ce()}],"border-w-s":[{"border-s":ce()}],"border-w-e":[{"border-e":ce()}],"border-w-t":[{"border-t":ce()}],"border-w-r":[{"border-r":ce()}],"border-w-b":[{"border-b":ce()}],"border-w-l":[{"border-l":ce()}],"divide-x":[{"divide-x":ce()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ce()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...$(),"hidden","none"]}],"divide-style":[{divide:[...$(),"hidden","none"]}],"border-color":[{border:Q()}],"border-color-x":[{"border-x":Q()}],"border-color-y":[{"border-y":Q()}],"border-color-s":[{"border-s":Q()}],"border-color-e":[{"border-e":Q()}],"border-color-t":[{"border-t":Q()}],"border-color-r":[{"border-r":Q()}],"border-color-b":[{"border-b":Q()}],"border-color-l":[{"border-l":Q()}],"divide-color":[{divide:Q()}],"outline-style":[{outline:[...$(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Ke,ve,be]}],"outline-w":[{outline:["",Ke,ci,Qn]}],"outline-color":[{outline:Q()}],shadow:[{shadow:["","none",b,ra,ta]}],"shadow-color":[{shadow:Q()}],"inset-shadow":[{"inset-shadow":["none",C,ra,ta]}],"inset-shadow-color":[{"inset-shadow":Q()}],"ring-w":[{ring:ce()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Q()}],"ring-offset-w":[{"ring-offset":[Ke,Qn]}],"ring-offset-color":[{"ring-offset":Q()}],"inset-ring-w":[{"inset-ring":ce()}],"inset-ring-color":[{"inset-ring":Q()}],"text-shadow":[{"text-shadow":["none",_,ra,ta]}],"text-shadow-color":[{"text-shadow":Q()}],opacity:[{opacity:[Ke,ve,be]}],"mix-blend":[{"mix-blend":[...F(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":F()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Ke]}],"mask-image-linear-from-pos":[{"mask-linear-from":he()}],"mask-image-linear-to-pos":[{"mask-linear-to":he()}],"mask-image-linear-from-color":[{"mask-linear-from":Q()}],"mask-image-linear-to-color":[{"mask-linear-to":Q()}],"mask-image-t-from-pos":[{"mask-t-from":he()}],"mask-image-t-to-pos":[{"mask-t-to":he()}],"mask-image-t-from-color":[{"mask-t-from":Q()}],"mask-image-t-to-color":[{"mask-t-to":Q()}],"mask-image-r-from-pos":[{"mask-r-from":he()}],"mask-image-r-to-pos":[{"mask-r-to":he()}],"mask-image-r-from-color":[{"mask-r-from":Q()}],"mask-image-r-to-color":[{"mask-r-to":Q()}],"mask-image-b-from-pos":[{"mask-b-from":he()}],"mask-image-b-to-pos":[{"mask-b-to":he()}],"mask-image-b-from-color":[{"mask-b-from":Q()}],"mask-image-b-to-color":[{"mask-b-to":Q()}],"mask-image-l-from-pos":[{"mask-l-from":he()}],"mask-image-l-to-pos":[{"mask-l-to":he()}],"mask-image-l-from-color":[{"mask-l-from":Q()}],"mask-image-l-to-color":[{"mask-l-to":Q()}],"mask-image-x-from-pos":[{"mask-x-from":he()}],"mask-image-x-to-pos":[{"mask-x-to":he()}],"mask-image-x-from-color":[{"mask-x-from":Q()}],"mask-image-x-to-color":[{"mask-x-to":Q()}],"mask-image-y-from-pos":[{"mask-y-from":he()}],"mask-image-y-to-pos":[{"mask-y-to":he()}],"mask-image-y-from-color":[{"mask-y-from":Q()}],"mask-image-y-to-color":[{"mask-y-to":Q()}],"mask-image-radial":[{"mask-radial":[ve,be]}],"mask-image-radial-from-pos":[{"mask-radial-from":he()}],"mask-image-radial-to-pos":[{"mask-radial-to":he()}],"mask-image-radial-from-color":[{"mask-radial-from":Q()}],"mask-image-radial-to-color":[{"mask-radial-to":Q()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":z()}],"mask-image-conic-pos":[{"mask-conic":[Ke]}],"mask-image-conic-from-pos":[{"mask-conic-from":he()}],"mask-image-conic-to-pos":[{"mask-conic-to":he()}],"mask-image-conic-from-color":[{"mask-conic-from":Q()}],"mask-image-conic-to-color":[{"mask-conic-to":Q()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Fe()}],"mask-repeat":[{mask:qe()}],"mask-size":[{mask:lt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",ve,be]}],filter:[{filter:["","none",ve,be]}],blur:[{blur:Pe()}],brightness:[{brightness:[Ke,ve,be]}],contrast:[{contrast:[Ke,ve,be]}],"drop-shadow":[{"drop-shadow":["","none",N,ra,ta]}],"drop-shadow-color":[{"drop-shadow":Q()}],grayscale:[{grayscale:["",Ke,ve,be]}],"hue-rotate":[{"hue-rotate":[Ke,ve,be]}],invert:[{invert:["",Ke,ve,be]}],saturate:[{saturate:[Ke,ve,be]}],sepia:[{sepia:["",Ke,ve,be]}],"backdrop-filter":[{"backdrop-filter":["","none",ve,be]}],"backdrop-blur":[{"backdrop-blur":Pe()}],"backdrop-brightness":[{"backdrop-brightness":[Ke,ve,be]}],"backdrop-contrast":[{"backdrop-contrast":[Ke,ve,be]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Ke,ve,be]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ke,ve,be]}],"backdrop-invert":[{"backdrop-invert":["",Ke,ve,be]}],"backdrop-opacity":[{"backdrop-opacity":[Ke,ve,be]}],"backdrop-saturate":[{"backdrop-saturate":[Ke,ve,be]}],"backdrop-sepia":[{"backdrop-sepia":["",Ke,ve,be]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":P()}],"border-spacing-x":[{"border-spacing-x":P()}],"border-spacing-y":[{"border-spacing-y":P()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ve,be]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Ke,"initial",ve,be]}],ease:[{ease:["linear","initial",M,ve,be]}],delay:[{delay:[Ke,ve,be]}],animate:[{animate:["none",H,ve,be]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[T,ve,be]}],"perspective-origin":[{"perspective-origin":ae()}],rotate:[{rotate:Ze()}],"rotate-x":[{"rotate-x":Ze()}],"rotate-y":[{"rotate-y":Ze()}],"rotate-z":[{"rotate-z":Ze()}],scale:[{scale:_t()}],"scale-x":[{"scale-x":_t()}],"scale-y":[{"scale-y":_t()}],"scale-z":[{"scale-z":_t()}],"scale-3d":["scale-3d"],skew:[{skew:Nt()}],"skew-x":[{"skew-x":Nt()}],"skew-y":[{"skew-y":Nt()}],transform:[{transform:[ve,be,"","none","gpu","cpu"]}],"transform-origin":[{origin:ae()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:wr()}],"translate-x":[{"translate-x":wr()}],"translate-y":[{"translate-y":wr()}],"translate-z":[{"translate-z":wr()}],"translate-none":["translate-none"],accent:[{accent:Q()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Q()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ve,be]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":P()}],"scroll-mx":[{"scroll-mx":P()}],"scroll-my":[{"scroll-my":P()}],"scroll-ms":[{"scroll-ms":P()}],"scroll-me":[{"scroll-me":P()}],"scroll-mt":[{"scroll-mt":P()}],"scroll-mr":[{"scroll-mr":P()}],"scroll-mb":[{"scroll-mb":P()}],"scroll-ml":[{"scroll-ml":P()}],"scroll-p":[{"scroll-p":P()}],"scroll-px":[{"scroll-px":P()}],"scroll-py":[{"scroll-py":P()}],"scroll-ps":[{"scroll-ps":P()}],"scroll-pe":[{"scroll-pe":P()}],"scroll-pt":[{"scroll-pt":P()}],"scroll-pr":[{"scroll-pr":P()}],"scroll-pb":[{"scroll-pb":P()}],"scroll-pl":[{"scroll-pl":P()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ve,be]}],fill:[{fill:["none",...Q()]}],"stroke-w":[{stroke:[Ke,ci,Qn,oo]}],stroke:[{stroke:["none",...Q()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Yx=Nx(zx);function Ce(...t){return Yx(rd(t))}const qs=Fd("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),me=D.forwardRef(({className:t,variant:e,size:n,asChild:i=!1,...u},d)=>{const g=i?Xu:"button";return l.jsx(g,{"data-slot":"button",className:Ce(qs({variant:e,size:n,className:t})),ref:d,...u})});me.displayName="Button";function Se({className:t,...e}){return l.jsx("div",{"data-slot":"card",className:Ce("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",t),...e})}function Ue({className:t,...e}){return l.jsx("div",{"data-slot":"card-header",className:Ce("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...e})}function We({className:t,...e}){return l.jsx("h4",{"data-slot":"card-title",className:Ce("leading-none",t),...e})}function nt({className:t,...e}){return l.jsx("p",{"data-slot":"card-description",className:Ce("text-muted-foreground",t),...e})}function ht({className:t,...e}){return l.jsx("div",{"data-slot":"card-content",className:Ce("px-6 [&:last-child]:pb-6",t),...e})}function WC({className:t,...e}){return l.jsx("div",{"data-slot":"card-footer",className:Ce("flex items-center px-6 pb-6 [.border-t]:pt-6",t),...e})}var Xx=Object.defineProperty,$x=Object.defineProperties,Kx=Object.getOwnPropertyDescriptors,da=Object.getOwnPropertySymbols,Zd=Object.prototype.hasOwnProperty,Jd=Object.prototype.propertyIsEnumerable,fu=(t,e,n)=>e in t?Xx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qx=(t,e)=>{for(var n in e||(e={}))Zd.call(e,n)&&fu(t,n,e[n]);if(da)for(var n of da(e))Jd.call(e,n)&&fu(t,n,e[n]);return t},Zx=(t,e)=>$x(t,Kx(e)),Jx=(t,e)=>{var n={};for(var i in t)Zd.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&da)for(var i of da(t))e.indexOf(i)<0&&Jd.call(t,i)&&(n[i]=t[i]);return n};function ep(t){let e=setTimeout(t,0),n=setTimeout(t,10),i=setTimeout(t,50);return[e,n,i]}function tp(t){let e=D.useRef();return D.useEffect(()=>{e.current=t}),e.current}var rp=18,eh=40,np=`${eh}px`,sp=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function ip({containerRef:t,inputRef:e,pushPasswordManagerStrategy:n,isFocused:i}){let[u,d]=D.useState(!1),[g,w]=D.useState(!1),[p,m]=D.useState(!1),b=D.useMemo(()=>n==="none"?!1:(n==="increase-width"||n==="experimental-no-flickering")&&u&&g,[u,g,n]),C=D.useCallback(()=>{let _=t.current,N=e.current;if(!_||!N||p||n==="none")return;let I=_,T=I.getBoundingClientRect().left+I.offsetWidth,k=I.getBoundingClientRect().top+I.offsetHeight/2,M=T-rp,H=k;document.querySelectorAll(sp).length===0&&document.elementFromPoint(M,H)===_||(d(!0),m(!0))},[t,e,p,n]);return D.useEffect(()=>{let _=t.current;if(!_||n==="none")return;function N(){let T=window.innerWidth-_.getBoundingClientRect().right;w(T>=eh)}N();let I=setInterval(N,1e3);return()=>{clearInterval(I)}},[t,n]),D.useEffect(()=>{let _=i||document.activeElement===e.current;if(n==="none"||!_)return;let N=setTimeout(C,0),I=setTimeout(C,2e3),T=setTimeout(C,5e3),k=setTimeout(()=>{m(!0)},6e3);return()=>{clearTimeout(N),clearTimeout(I),clearTimeout(T),clearTimeout(k)}},[e,i,n,C]),{hasPWMBadge:u,willPushPWMBadge:b,PWM_BADGE_SPACE_WIDTH:np}}var th=D.createContext({}),rh=D.forwardRef((t,e)=>{var n=t,{value:i,onChange:u,maxLength:d,textAlign:g="left",pattern:w,placeholder:p,inputMode:m="numeric",onComplete:b,pushPasswordManagerStrategy:C="increase-width",pasteTransformer:_,containerClassName:N,noScriptCSSFallback:I=ap,render:T,children:k}=n,M=Jx(n,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),H,B,z,ae,V;let[G,P]=D.useState(typeof M.defaultValue=="string"?M.defaultValue:""),O=i??G,ne=tp(O),oe=D.useCallback(Te=>{u?.(Te),P(Te)},[u]),ue=D.useMemo(()=>w?typeof w=="string"?new RegExp(w):w:null,[w]),te=D.useRef(null),ge=D.useRef(null),q=D.useRef({value:O,onChange:oe,isIOS:typeof window<"u"&&((B=(H=window?.CSS)==null?void 0:H.supports)==null?void 0:B.call(H,"-webkit-touch-callout","none"))}),Z=D.useRef({prev:[(z=te.current)==null?void 0:z.selectionStart,(ae=te.current)==null?void 0:ae.selectionEnd,(V=te.current)==null?void 0:V.selectionDirection]});D.useImperativeHandle(e,()=>te.current,[]),D.useEffect(()=>{let Te=te.current,je=ge.current;if(!Te||!je)return;q.current.value!==Te.value&&q.current.onChange(Te.value),Z.current.prev=[Te.selectionStart,Te.selectionEnd,Te.selectionDirection];function Ut(){if(document.activeElement!==Te){re(null),ce(null);return}let Ae=Te.selectionStart,sr=Te.selectionEnd,ye=Te.selectionDirection,gr=Te.maxLength,rn=Te.value,Qt=Z.current.prev,Vr=-1,$t=-1,nn;if(rn.length!==0&&Ae!==null&&sr!==null){let fs=Ae===sr,Oa=Ae===rn.length&&rn.length<gr;if(fs&&!Oa){let ft=Ae;if(ft===0)Vr=0,$t=1,nn="forward";else if(ft===gr)Vr=ft-1,$t=ft,nn="backward";else if(gr>1&&rn.length>1){let fe=0;if(Qt[0]!==null&&Qt[1]!==null){nn=ft<Qt[1]?"backward":"forward";let Wt=Qt[0]===Qt[1]&&Qt[0]<gr;nn==="backward"&&!Wt&&(fe=-1)}Vr=fe+ft,$t=fe+ft+1}}Vr!==-1&&$t!==-1&&Vr!==$t&&te.current.setSelectionRange(Vr,$t,nn)}let Xr=Vr!==-1?Vr:Ae,ir=$t!==-1?$t:sr,Li=nn??ye;re(Xr),ce(ir),Z.current.prev=[Xr,ir,Li]}if(document.addEventListener("selectionchange",Ut,{capture:!0}),Ut(),document.activeElement===Te&&qe(!0),!document.getElementById("input-otp-style")){let Ae=document.createElement("style");if(Ae.id="input-otp-style",document.head.appendChild(Ae),Ae.sheet){let sr="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";ui(Ae.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),ui(Ae.sheet,`[data-input-otp]:autofill { ${sr} }`),ui(Ae.sheet,`[data-input-otp]:-webkit-autofill { ${sr} }`),ui(Ae.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),ui(Ae.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let ct=()=>{je&&je.style.setProperty("--root-height",`${Te.clientHeight}px`)};ct();let Xe=new ResizeObserver(ct);return Xe.observe(Te),()=>{document.removeEventListener("selectionchange",Ut,{capture:!0}),Xe.disconnect()}},[]);let[Y,Q]=D.useState(!1),[Fe,qe]=D.useState(!1),[lt,re]=D.useState(null),[W,ce]=D.useState(null);D.useEffect(()=>{ep(()=>{var Te,je,Ut,ct;(Te=te.current)==null||Te.dispatchEvent(new Event("input"));let Xe=(je=te.current)==null?void 0:je.selectionStart,Ae=(Ut=te.current)==null?void 0:Ut.selectionEnd,sr=(ct=te.current)==null?void 0:ct.selectionDirection;Xe!==null&&Ae!==null&&(re(Xe),ce(Ae),Z.current.prev=[Xe,Ae,sr])})},[O,Fe]),D.useEffect(()=>{ne!==void 0&&O!==ne&&ne.length<d&&O.length===d&&b?.(O)},[d,b,ne,O]);let $=ip({containerRef:ge,inputRef:te,pushPasswordManagerStrategy:C,isFocused:Fe}),F=D.useCallback(Te=>{let je=Te.currentTarget.value.slice(0,d);if(je.length>0&&ue&&!ue.test(je)){Te.preventDefault();return}typeof ne=="string"&&je.length<ne.length&&document.dispatchEvent(new Event("selectionchange")),oe(je)},[d,oe,ne,ue]),he=D.useCallback(()=>{var Te;if(te.current){let je=Math.min(te.current.value.length,d-1),Ut=te.current.value.length;(Te=te.current)==null||Te.setSelectionRange(je,Ut),re(je),ce(Ut)}qe(!0)},[d]),Pe=D.useCallback(Te=>{var je,Ut;let ct=te.current;if(!_&&(!q.current.isIOS||!Te.clipboardData||!ct))return;let Xe=Te.clipboardData.getData("text/plain"),Ae=_?_(Xe):Xe;Te.preventDefault();let sr=(je=te.current)==null?void 0:je.selectionStart,ye=(Ut=te.current)==null?void 0:Ut.selectionEnd,gr=(sr!==ye?O.slice(0,sr)+Ae+O.slice(ye):O.slice(0,sr)+Ae+O.slice(sr)).slice(0,d);if(gr.length>0&&ue&&!ue.test(gr))return;ct.value=gr,oe(gr);let rn=Math.min(gr.length,d-1),Qt=gr.length;ct.setSelectionRange(rn,Qt),re(rn),ce(Qt)},[d,oe,ue,O]),Ze=D.useMemo(()=>({position:"relative",cursor:M.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[M.disabled]),_t=D.useMemo(()=>({position:"absolute",inset:0,width:$.willPushPWMBadge?`calc(100% + ${$.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:$.willPushPWMBadge?`inset(0 ${$.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:g,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[$.PWM_BADGE_SPACE_WIDTH,$.willPushPWMBadge,g]),Nt=D.useMemo(()=>D.createElement("input",Zx(Qx({autoComplete:M.autoComplete||"one-time-code"},M),{"data-input-otp":!0,"data-input-otp-placeholder-shown":O.length===0||void 0,"data-input-otp-mss":lt,"data-input-otp-mse":W,inputMode:m,pattern:ue?.source,"aria-placeholder":p,style:_t,maxLength:d,value:O,ref:te,onPaste:Te=>{var je;Pe(Te),(je=M.onPaste)==null||je.call(M,Te)},onChange:F,onMouseOver:Te=>{var je;Q(!0),(je=M.onMouseOver)==null||je.call(M,Te)},onMouseLeave:Te=>{var je;Q(!1),(je=M.onMouseLeave)==null||je.call(M,Te)},onFocus:Te=>{var je;he(),(je=M.onFocus)==null||je.call(M,Te)},onBlur:Te=>{var je;qe(!1),(je=M.onBlur)==null||je.call(M,Te)}})),[F,he,Pe,m,_t,d,W,lt,M,ue?.source,O]),wr=D.useMemo(()=>({slots:Array.from({length:d}).map((Te,je)=>{var Ut;let ct=Fe&&lt!==null&&W!==null&&(lt===W&&je===lt||je>=lt&&je<W),Xe=O[je]!==void 0?O[je]:null,Ae=O[0]!==void 0?null:(Ut=p?.[je])!=null?Ut:null;return{char:Xe,placeholderChar:Ae,isActive:ct,hasFakeCaret:ct&&Xe===null}}),isFocused:Fe,isHovering:!M.disabled&&Y}),[Fe,Y,d,W,lt,M.disabled,O]),tt=D.useMemo(()=>T?T(wr):D.createElement(th.Provider,{value:wr},k),[k,wr,T]);return D.createElement(D.Fragment,null,I!==null&&D.createElement("noscript",null,D.createElement("style",null,I)),D.createElement("div",{ref:ge,"data-input-otp-container":!0,style:Ze,className:N},tt,D.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Nt)))});rh.displayName="Input";function ui(t,e){try{t.insertRule(e)}catch{console.error("input-otp could not insert CSS rule:",e)}}var ap=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;function op({className:t,containerClassName:e,...n}){return l.jsx(rh,{"data-slot":"input-otp",containerClassName:Ce("flex items-center gap-2 has-disabled:opacity-50",e),className:Ce("disabled:cursor-not-allowed",t),...n})}function gu({className:t,...e}){return l.jsx("div",{"data-slot":"input-otp-group",className:Ce("flex items-center gap-1",t),...e})}function jn({index:t,className:e,...n}){const i=D.useContext(th),{char:u,hasFakeCaret:d,isActive:g}=i?.slots[t]??{};return l.jsxs("div",{"data-slot":"input-otp-slot","data-active":g,className:Ce("data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm bg-input-background transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",e),...n,children:[u,d&&l.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:l.jsx("div",{className:"animate-caret-blink bg-foreground h-4 w-px duration-1000"})})]})}function lp({...t}){return l.jsx("div",{"data-slot":"input-otp-separator",role:"separator",...t,children:l.jsx(C0,{})})}function cp({email:t,onVerify:e}){const[n,i]=D.useState(!1),[u,d]=D.useState(""),g=async()=>{try{const{error:m}=await ze.auth.resend({type:"signup",email:t});if(m)throw m;xe.success("تم إعادة إرسال رمز التحقق بنجاح")}catch(m){xe.error(m.message||"فشل إرسال الرمز")}},w=()=>{const m=encodeURIComponent(`مرحباً، أحتاج مساعدة في تفعيل حسابي: ${t}`);window.open(`https://wa.me/966501234567?text=${m}`,"_blank")},p=async()=>{if(u.length<6){xe.error("الرجاء إدخال رمز التحقق كاملاً");return}i(!0);try{const{data:m,error:b}=await ze.auth.verifyOtp({email:t,token:u,type:"signup"});if(b)throw b;e(),xe.success("تم تفعيل حسابك بنجاح!")}catch(m){console.error("OTP Error:",m),xe.error("رمز التحقق غير صحيح أو منتهي الصلاحية")}finally{i(!1)}};return l.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-center justify-center p-4",children:l.jsxs(Se,{className:"w-full max-w-md border-orange-500/20 shadow-2xl",children:[l.jsxs(Ue,{className:"space-y-1",children:[l.jsx("div",{className:"flex justify-center mb-4",children:l.jsx("div",{className:"bg-orange-500/10 p-4 rounded-full",children:l.jsx(Ms,{className:"h-12 w-12 text-orange-500"})})}),l.jsx(We,{className:"text-2xl text-center text-black",children:"يرجى تفعيل حسابك"}),l.jsxs(nt,{className:"text-center",children:["أدخل رمز التحقق المرسل إلى ",t]})]}),l.jsxs(ht,{className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col items-center gap-4 py-4",dir:"ltr",children:[l.jsx("span",{className:"text-sm text-gray-500 mb-2 font-medium",children:"الرمز المكون من 8 أرقام"}),l.jsxs(op,{maxLength:8,value:u,onChange:m=>d(m),children:[l.jsxs(gu,{children:[l.jsx(jn,{index:0,className:"w-10 h-10 text-lg border border-black rounded-md mr-1"}),l.jsx(jn,{index:1,className:"w-10 h-10 text-lg border border-black rounded-md mr-1"}),l.jsx(jn,{index:2,className:"w-10 h-10 text-lg border border-black rounded-md mr-1"}),l.jsx(jn,{index:3,className:"w-10 h-10 text-lg border border-black rounded-md"})]}),l.jsx(lp,{}),l.jsxs(gu,{children:[l.jsx(jn,{index:4,className:"w-10 h-10 text-lg border border-black rounded-md mr-1"}),l.jsx(jn,{index:5,className:"w-10 h-10 text-lg border border-black rounded-md mr-1"}),l.jsx(jn,{index:6,className:"w-10 h-10 text-lg border border-black rounded-md mr-1"}),l.jsx(jn,{index:7,className:"w-10 h-10 text-lg border border-black rounded-md"})]})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs(me,{onClick:p,className:"w-full bg-orange-500 hover:bg-orange-600 text-black",disabled:n||u.length<6,children:[n?l.jsx(td,{className:"mr-2 h-4 w-4 animate-spin"}):null,"تفعيل الحساب"]}),l.jsxs(me,{onClick:g,variant:"outline",className:"w-full border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-black",children:[l.jsx(_0,{className:"ml-2 h-4 w-4"}),"إعادة إرسال رمز التفعيل"]}),l.jsxs(me,{onClick:w,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[l.jsx(E0,{className:"ml-2 h-4 w-4"}),"تواصل عبر واتساب للمساعدة"]}),l.jsx(me,{onClick:()=>window.location.reload(),variant:"ghost",className:"w-full text-gray-500 hover:text-gray-700",children:"تحديث الصفحة"})]}),l.jsxs("div",{className:"text-center text-sm text-gray-600",children:[l.jsx("p",{className:"mb-1",children:"لم تستلم الرمز؟"}),l.jsx("p",{children:"تحقق من مجلد الرسائل غير المرغوب فيها (Spam)"})]})]})]})})}const lo={async getSettings(){const{data:{user:t}}=await ze.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:e,error:n}=await ze.from("school_settings").select("*").eq("user_id",t.id).maybeSingle();if(n&&n.code!=="PGRST116"){if(n.code==="42P01")return console.warn("Table school_settings does not exist. Using defaults."),this.getDefaultSettings();throw n}if(e)return e;try{const i=this.getDefaultSettings(t.id),{data:u,error:d}=await ze.from("school_settings").insert([i]).select().single();return d?(console.warn("Could not insert default settings, falling back to local defaults.",d),i):u}catch(i){return console.warn("Error in getSettings creation flow, falling back to local defaults.",i),this.getDefaultSettings()}},async updateSettings(t){const{data:{user:e}}=await ze.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:n,error:i}=await ze.from("school_settings").update({...t,updated_at:new Date().toISOString()}).eq("user_id",e.id).select().single();if(i)throw i;return n},getDefaultSettings(t){const e=new Date;return e.setFullYear(e.getFullYear()+1),{user_id:t,school_name:"منصة التعليم",subscription_type:"بريميوم",available_stages:["الابتدائية","المتوسطة","الثانوية"],auto_renew:!0,cancel_requested:!1,expiry_date:e.toISOString(),work_start_time:"08:00",work_end_time:"14:00"}}};function Na(){const t=Vn(),{data:e,isLoading:n,error:i}=os({queryKey:["school-settings"],queryFn:()=>lo.getSettings(),staleTime:1/0}),u=jr({mutationFn:d=>lo.updateSettings(d),onSuccess:d=>{t.setQueryData(["school-settings"],d),xe.success("تم حفظ الإعدادات بنجاح")},onError:d=>{console.error("Error updating settings:",d),xe.error("فشل حفظ الإعدادات")}});return{settings:e||lo.getDefaultSettings(),isLoading:n,error:i,updateSettings:u.mutate,isUpdating:u.isPending}}const up=Fd("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function vt({className:t,variant:e,asChild:n=!1,...i}){const u=n?Xu:"span";return l.jsx(u,{"data-slot":"badge",className:Ce(up({variant:e}),t),...i})}function dn({children:t,onLogout:e,isVerified:n,userEmail:i,onVerify:u}){const d=w0(),[g,w]=D.useState(!1),p=[{name:"جميع الطلاب",icon:nd,path:"/dashboard/students"},{name:"الفصول",icon:gl,path:"/dashboard/classes"},{name:"المراحل الدراسية",icon:A0,path:"/dashboard/grades"},{name:"المدفوعات",icon:sd,path:"/dashboard/payments"},{name:"تقارير الحضور",icon:N0,path:"/dashboard/reports"},{name:"مسح QR",icon:Gs,path:"/dashboard/qr-scanner"},{name:"إعدادات المدرسة",icon:id,path:"/dashboard/settings"}],{settings:m}=Na();return l.jsxs("div",{className:"min-h-screen bg-gray-50",children:[l.jsx("aside",{className:"hidden lg:fixed lg:inset-y-0 lg:right-0 lg:flex lg:w-64 lg:flex-col bg-black border-l border-orange-500/20",children:l.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[l.jsx("div",{className:"flex items-center h-16 flex-shrink-0 px-4 bg-black border-b border-orange-500/20",children:l.jsxs(Yi,{to:"/",className:"flex items-center gap-2",children:[l.jsx("div",{className:"bg-orange-500 p-2 rounded-lg shrink-0",children:l.jsx(Io,{className:"h-6 w-6 text-black"})}),l.jsxs("div",{className:"flex flex-col min-w-0",children:[l.jsx("span",{className:"text-white font-bold text-sm leading-tight",children:"منصة التعليم"}),l.jsx("span",{className:"text-orange-400 text-[10px] truncate leading-tight",children:m.school_name})]})]})}),l.jsx("nav",{className:"flex-1 px-2 py-4 space-y-1 overflow-y-auto",children:p.map(b=>{const C=b.icon,_=d.pathname===b.path||b.path==="/dashboard/students"&&d.pathname==="/dashboard";return l.jsxs(Yi,{to:b.path,className:`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${_?"bg-orange-500 text-black":"text-gray-300 hover:bg-gray-900 hover:text-white"}`,children:[l.jsx(C,{className:"h-5 w-5"}),l.jsx("span",{children:b.name})]},b.path)})}),l.jsxs("div",{className:"flex-shrink-0 border-t border-orange-500/20 p-4",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3 px-2",children:[l.jsx("div",{className:"bg-orange-500 p-2 rounded-full",children:l.jsx(yi,{className:"h-5 w-5 text-black"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm text-white truncate",children:i||"المستخدم"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:`text-[10px] ${n?"text-green-400":"text-orange-400"}`,children:n?"حساب مفعل":"في انتظار التفعيل"}),n&&l.jsx(vt,{variant:"outline",className:"text-[9px] py-0 h-4 border-orange-500/50 text-orange-400 bg-transparent",children:m.subscription_type})]})]})]}),l.jsxs(me,{onClick:e,variant:"outline",className:"w-full border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-black",children:[l.jsx(bc,{className:"ml-2 h-4 w-4"}),"تسجيل الخروج"]})]})]})}),g&&l.jsxs("div",{className:"lg:hidden",children:[l.jsx("div",{className:"fixed inset-0 z-40 bg-black/50",onClick:()=>w(!1)}),l.jsxs("aside",{className:"fixed inset-y-0 right-0 z-50 w-64 bg-black border-l border-orange-500/20 flex flex-col",children:[l.jsxs("div",{className:"flex items-center justify-between h-16 px-4 border-b border-orange-500/20",children:[l.jsxs(Yi,{to:"/",className:"flex items-center gap-2",children:[l.jsx("div",{className:"bg-orange-500 p-2 rounded-lg shrink-0",children:l.jsx(Io,{className:"h-6 w-6 text-black"})}),l.jsxs("div",{className:"flex flex-col min-w-0 text-right",children:[l.jsx("span",{className:"text-white font-bold text-sm leading-tight",children:"منصة التعليم"}),l.jsx("span",{className:"text-orange-400 text-[10px] truncate leading-tight",children:m.school_name})]})]}),l.jsx("button",{onClick:()=>w(!1),className:"text-white",children:l.jsx(ml,{className:"h-6 w-6"})})]}),l.jsx("nav",{className:"flex-1 px-2 py-4 space-y-1 overflow-y-auto",children:p.map(b=>{const C=b.icon,_=d.pathname===b.path||b.path==="/dashboard/students"&&d.pathname==="/dashboard";return l.jsxs(Yi,{to:b.path,onClick:()=>w(!1),className:`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${_?"bg-orange-500 text-black":"text-gray-300 hover:bg-gray-900 hover:text-white"}`,children:[l.jsx(C,{className:"h-5 w-5"}),l.jsx("span",{children:b.name})]},b.path)})}),l.jsxs("div",{className:"flex-shrink-0 border-t border-orange-500/20 p-4",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3 px-2",children:[l.jsx("div",{className:"bg-orange-500 p-2 rounded-full",children:l.jsx(yi,{className:"h-5 w-5 text-black"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm text-white truncate",children:i||"المستخدم"}),l.jsx("p",{className:`text-xs ${n?"text-green-400":"text-orange-400"}`,children:n?"حساب مفعل":"في انتظار التفعيل"})]})]}),l.jsxs(me,{onClick:e,variant:"outline",className:"w-full border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-black",children:[l.jsx(bc,{className:"ml-2 h-4 w-4"}),"تسجيل الخروج"]})]})]})]}),l.jsxs("div",{className:"lg:pr-64",children:[l.jsxs("header",{className:"sticky top-0 z-30 bg-white border-b border-gray-200 h-16 flex items-center px-4 lg:px-8",children:[l.jsx("button",{onClick:()=>w(!0),className:"lg:hidden ml-4 text-gray-600 hover:text-black",children:l.jsx(S0,{className:"h-6 w-6"})}),l.jsx("div",{className:"flex-1",children:l.jsx("h1",{className:"text-xl text-black",children:p.find(b=>d.pathname===b.path||b.path==="/dashboard/students"&&d.pathname==="/dashboard")?.name||"لوحة التحكم"})}),l.jsx("div",{className:"flex items-center gap-2",children:!n&&l.jsx("span",{className:"hidden sm:inline-block text-sm text-orange-600 bg-orange-50 px-3 py-1 rounded-full",children:"يرجى تفعيل حسابك"})})]}),l.jsx("main",{className:"p-4 lg:p-8",children:l.jsx("div",{className:"max-w-7xl mx-auto",children:t})})]}),!n&&l.jsx(cp,{email:i,onVerify:u})]})}function Be({className:t,type:e,...n}){return l.jsx("input",{type:e,"data-slot":"input",className:Ce("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}function _e({className:t,...e}){return l.jsx(zf,{"data-slot":"label",className:Ce("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...e})}function Ln({className:t,...e}){return l.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:l.jsx("table",{"data-slot":"table",className:Ce("w-full caption-bottom text-sm",t),...e})})}function Bn({className:t,...e}){return l.jsx("thead",{"data-slot":"table-header",className:Ce("[&_tr]:border-b",t),...e})}function Fn({className:t,...e}){return l.jsx("tbody",{"data-slot":"table-body",className:Ce("[&_tr:last-child]:border-0",t),...e})}function Tt({className:t,...e}){return l.jsx("tr",{"data-slot":"table-row",className:Ce("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...e})}function Ve({className:t,...e}){return l.jsx("th",{"data-slot":"table-head",className:Ce("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...e})}function Oe({className:t,...e}){return l.jsx("td",{"data-slot":"table-cell",className:Ce("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...e})}function vr({...t}){return l.jsx(ul,{"data-slot":"dialog",...t})}function ha({...t}){return l.jsx(Qu,{"data-slot":"dialog-trigger",...t})}function dp({...t}){return l.jsx(fl,{"data-slot":"dialog-portal",...t})}const nh=D.forwardRef(({className:t,...e},n)=>l.jsx(cl,{ref:n,"data-slot":"dialog-overlay",className:Ce("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...e}));nh.displayName="DialogOverlay";function Cr({className:t,children:e,...n}){return l.jsxs(dp,{"data-slot":"dialog-portal",children:[l.jsx(nh,{}),l.jsxs(dl,{"data-slot":"dialog-content",className:Ce("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...n,children:[e,l.jsxs(hl,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[l.jsx(ml,{}),l.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function _r({className:t,...e}){return l.jsx("div",{"data-slot":"dialog-header",className:Ce("flex flex-col gap-2 text-center sm:text-left",t),...e})}function Fr({className:t,...e}){return l.jsx("div",{"data-slot":"dialog-footer",className:Ce("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...e})}function Er({className:t,...e}){return l.jsx($u,{"data-slot":"dialog-title",className:Ce("text-lg leading-none font-semibold",t),...e})}function Ur({className:t,...e}){return l.jsx(Ku,{"data-slot":"dialog-description",className:Ce("text-muted-foreground text-sm",t),...e})}function Ht({...t}){return l.jsx(Yf,{"data-slot":"select",...t})}function Gt({...t}){return l.jsx(Kf,{"data-slot":"select-value",...t})}function qt({className:t,size:e="default",children:n,...i}){return l.jsxs(Xf,{"data-slot":"select-trigger","data-size":e,className:Ce("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i,children:[n,l.jsx($f,{asChild:!0,children:l.jsx(ad,{className:"size-4 opacity-50"})})]})}function zt({className:t,children:e,position:n="popper",...i}){return l.jsx(Qf,{children:l.jsxs(Zf,{"data-slot":"select-content",className:Ce("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[l.jsx(hp,{}),l.jsx(Jf,{className:Ce("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:e}),l.jsx(fp,{})]})})}function et({className:t,children:e,...n}){return l.jsxs(e0,{"data-slot":"select-item",className:Ce("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...n,children:[l.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:l.jsx(t0,{children:l.jsx(xl,{className:"size-4"})})}),l.jsx(r0,{children:e})]})}function hp({className:t,...e}){return l.jsx(n0,{"data-slot":"select-scroll-up-button",className:Ce("flex cursor-default items-center justify-center py-1",t),...e,children:l.jsx(I0,{className:"size-4"})})}function fp({className:t,...e}){return l.jsx(s0,{"data-slot":"select-scroll-down-button",className:Ce("flex cursor-default items-center justify-center py-1",t),...e,children:l.jsx(ad,{className:"size-4"})})}function Ol({className:t,...e}){return l.jsx("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:Ce("mx-auto flex w-full justify-center",t),...e})}function Rl({className:t,...e}){return l.jsx("ul",{"data-slot":"pagination-content",className:Ce("flex flex-row items-center gap-1",t),...e})}function vn({...t}){return l.jsx("li",{"data-slot":"pagination-item",...t})}function ji({className:t,isActive:e,size:n="icon",...i}){return l.jsx("a",{"aria-current":e?"page":void 0,"data-slot":"pagination-link","data-active":e,className:Ce(qs({variant:e?"outline":"ghost",size:n}),t),...i})}function jl({className:t,...e}){return l.jsxs(ji,{"aria-label":"Go to previous page",size:"default",className:Ce("gap-1 px-2.5 sm:pl-2.5",t),...e,children:[l.jsx(od,{}),l.jsx("span",{className:"hidden sm:block",children:"Previous"})]})}function kl({className:t,...e}){return l.jsxs(ji,{"aria-label":"Go to next page",size:"default",className:Ce("gap-1 px-2.5 sm:pr-2.5",t),...e,children:[l.jsx("span",{className:"hidden sm:block",children:"Next"}),l.jsx(ld,{})]})}var gp=Object.defineProperty,fa=Object.getOwnPropertySymbols,sh=Object.prototype.hasOwnProperty,ih=Object.prototype.propertyIsEnumerable,mu=(t,e,n)=>e in t?gp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ko=(t,e)=>{for(var n in e||(e={}))sh.call(e,n)&&mu(t,n,e[n]);if(fa)for(var n of fa(e))ih.call(e,n)&&mu(t,n,e[n]);return t},Qo=(t,e)=>{var n={};for(var i in t)sh.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&fa)for(var i of fa(t))e.indexOf(i)<0&&ih.call(t,i)&&(n[i]=t[i]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var ls;(t=>{const e=class Qe{constructor(p,m,b,C){if(this.version=p,this.errorCorrectionLevel=m,this.modules=[],this.isFunction=[],p<Qe.MIN_VERSION||p>Qe.MAX_VERSION)throw new RangeError("Version value out of range");if(C<-1||C>7)throw new RangeError("Mask value out of range");this.size=p*4+17;let _=[];for(let I=0;I<this.size;I++)_.push(!1);for(let I=0;I<this.size;I++)this.modules.push(_.slice()),this.isFunction.push(_.slice());this.drawFunctionPatterns();const N=this.addEccAndInterleave(b);if(this.drawCodewords(N),C==-1){let I=1e9;for(let T=0;T<8;T++){this.applyMask(T),this.drawFormatBits(T);const k=this.getPenaltyScore();k<I&&(C=T,I=k),this.applyMask(T)}}u(0<=C&&C<=7),this.mask=C,this.applyMask(C),this.drawFormatBits(C),this.isFunction=[]}static encodeText(p,m){const b=t.QrSegment.makeSegments(p);return Qe.encodeSegments(b,m)}static encodeBinary(p,m){const b=t.QrSegment.makeBytes(p);return Qe.encodeSegments([b],m)}static encodeSegments(p,m,b=1,C=40,_=-1,N=!0){if(!(Qe.MIN_VERSION<=b&&b<=C&&C<=Qe.MAX_VERSION)||_<-1||_>7)throw new RangeError("Invalid value");let I,T;for(I=b;;I++){const B=Qe.getNumDataCodewords(I,m)*8,z=g.getTotalBits(p,I);if(z<=B){T=z;break}if(I>=C)throw new RangeError("Data too long")}for(const B of[Qe.Ecc.MEDIUM,Qe.Ecc.QUARTILE,Qe.Ecc.HIGH])N&&T<=Qe.getNumDataCodewords(I,B)*8&&(m=B);let k=[];for(const B of p){n(B.mode.modeBits,4,k),n(B.numChars,B.mode.numCharCountBits(I),k);for(const z of B.getData())k.push(z)}u(k.length==T);const M=Qe.getNumDataCodewords(I,m)*8;u(k.length<=M),n(0,Math.min(4,M-k.length),k),n(0,(8-k.length%8)%8,k),u(k.length%8==0);for(let B=236;k.length<M;B^=253)n(B,8,k);let H=[];for(;H.length*8<k.length;)H.push(0);return k.forEach((B,z)=>H[z>>>3]|=B<<7-(z&7)),new Qe(I,m,H,_)}getModule(p,m){return 0<=p&&p<this.size&&0<=m&&m<this.size&&this.modules[m][p]}getModules(){return this.modules}drawFunctionPatterns(){for(let b=0;b<this.size;b++)this.setFunctionModule(6,b,b%2==0),this.setFunctionModule(b,6,b%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const p=this.getAlignmentPatternPositions(),m=p.length;for(let b=0;b<m;b++)for(let C=0;C<m;C++)b==0&&C==0||b==0&&C==m-1||b==m-1&&C==0||this.drawAlignmentPattern(p[b],p[C]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(p){const m=this.errorCorrectionLevel.formatBits<<3|p;let b=m;for(let _=0;_<10;_++)b=b<<1^(b>>>9)*1335;const C=(m<<10|b)^21522;u(C>>>15==0);for(let _=0;_<=5;_++)this.setFunctionModule(8,_,i(C,_));this.setFunctionModule(8,7,i(C,6)),this.setFunctionModule(8,8,i(C,7)),this.setFunctionModule(7,8,i(C,8));for(let _=9;_<15;_++)this.setFunctionModule(14-_,8,i(C,_));for(let _=0;_<8;_++)this.setFunctionModule(this.size-1-_,8,i(C,_));for(let _=8;_<15;_++)this.setFunctionModule(8,this.size-15+_,i(C,_));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let p=this.version;for(let b=0;b<12;b++)p=p<<1^(p>>>11)*7973;const m=this.version<<12|p;u(m>>>18==0);for(let b=0;b<18;b++){const C=i(m,b),_=this.size-11+b%3,N=Math.floor(b/3);this.setFunctionModule(_,N,C),this.setFunctionModule(N,_,C)}}drawFinderPattern(p,m){for(let b=-4;b<=4;b++)for(let C=-4;C<=4;C++){const _=Math.max(Math.abs(C),Math.abs(b)),N=p+C,I=m+b;0<=N&&N<this.size&&0<=I&&I<this.size&&this.setFunctionModule(N,I,_!=2&&_!=4)}}drawAlignmentPattern(p,m){for(let b=-2;b<=2;b++)for(let C=-2;C<=2;C++)this.setFunctionModule(p+C,m+b,Math.max(Math.abs(C),Math.abs(b))!=1)}setFunctionModule(p,m,b){this.modules[m][p]=b,this.isFunction[m][p]=!0}addEccAndInterleave(p){const m=this.version,b=this.errorCorrectionLevel;if(p.length!=Qe.getNumDataCodewords(m,b))throw new RangeError("Invalid argument");const C=Qe.NUM_ERROR_CORRECTION_BLOCKS[b.ordinal][m],_=Qe.ECC_CODEWORDS_PER_BLOCK[b.ordinal][m],N=Math.floor(Qe.getNumRawDataModules(m)/8),I=C-N%C,T=Math.floor(N/C);let k=[];const M=Qe.reedSolomonComputeDivisor(_);for(let B=0,z=0;B<C;B++){let ae=p.slice(z,z+T-_+(B<I?0:1));z+=ae.length;const V=Qe.reedSolomonComputeRemainder(ae,M);B<I&&ae.push(0),k.push(ae.concat(V))}let H=[];for(let B=0;B<k[0].length;B++)k.forEach((z,ae)=>{(B!=T-_||ae>=I)&&H.push(z[B])});return u(H.length==N),H}drawCodewords(p){if(p.length!=Math.floor(Qe.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let m=0;for(let b=this.size-1;b>=1;b-=2){b==6&&(b=5);for(let C=0;C<this.size;C++)for(let _=0;_<2;_++){const N=b-_,T=(b+1&2)==0?this.size-1-C:C;!this.isFunction[T][N]&&m<p.length*8&&(this.modules[T][N]=i(p[m>>>3],7-(m&7)),m++)}}u(m==p.length*8)}applyMask(p){if(p<0||p>7)throw new RangeError("Mask value out of range");for(let m=0;m<this.size;m++)for(let b=0;b<this.size;b++){let C;switch(p){case 0:C=(b+m)%2==0;break;case 1:C=m%2==0;break;case 2:C=b%3==0;break;case 3:C=(b+m)%3==0;break;case 4:C=(Math.floor(b/3)+Math.floor(m/2))%2==0;break;case 5:C=b*m%2+b*m%3==0;break;case 6:C=(b*m%2+b*m%3)%2==0;break;case 7:C=((b+m)%2+b*m%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[m][b]&&C&&(this.modules[m][b]=!this.modules[m][b])}}getPenaltyScore(){let p=0;for(let _=0;_<this.size;_++){let N=!1,I=0,T=[0,0,0,0,0,0,0];for(let k=0;k<this.size;k++)this.modules[_][k]==N?(I++,I==5?p+=Qe.PENALTY_N1:I>5&&p++):(this.finderPenaltyAddHistory(I,T),N||(p+=this.finderPenaltyCountPatterns(T)*Qe.PENALTY_N3),N=this.modules[_][k],I=1);p+=this.finderPenaltyTerminateAndCount(N,I,T)*Qe.PENALTY_N3}for(let _=0;_<this.size;_++){let N=!1,I=0,T=[0,0,0,0,0,0,0];for(let k=0;k<this.size;k++)this.modules[k][_]==N?(I++,I==5?p+=Qe.PENALTY_N1:I>5&&p++):(this.finderPenaltyAddHistory(I,T),N||(p+=this.finderPenaltyCountPatterns(T)*Qe.PENALTY_N3),N=this.modules[k][_],I=1);p+=this.finderPenaltyTerminateAndCount(N,I,T)*Qe.PENALTY_N3}for(let _=0;_<this.size-1;_++)for(let N=0;N<this.size-1;N++){const I=this.modules[_][N];I==this.modules[_][N+1]&&I==this.modules[_+1][N]&&I==this.modules[_+1][N+1]&&(p+=Qe.PENALTY_N2)}let m=0;for(const _ of this.modules)m=_.reduce((N,I)=>N+(I?1:0),m);const b=this.size*this.size,C=Math.ceil(Math.abs(m*20-b*10)/b)-1;return u(0<=C&&C<=9),p+=C*Qe.PENALTY_N4,u(0<=p&&p<=2568888),p}getAlignmentPatternPositions(){if(this.version==1)return[];{const p=Math.floor(this.version/7)+2,m=this.version==32?26:Math.ceil((this.version*4+4)/(p*2-2))*2;let b=[6];for(let C=this.size-7;b.length<p;C-=m)b.splice(1,0,C);return b}}static getNumRawDataModules(p){if(p<Qe.MIN_VERSION||p>Qe.MAX_VERSION)throw new RangeError("Version number out of range");let m=(16*p+128)*p+64;if(p>=2){const b=Math.floor(p/7)+2;m-=(25*b-10)*b-55,p>=7&&(m-=36)}return u(208<=m&&m<=29648),m}static getNumDataCodewords(p,m){return Math.floor(Qe.getNumRawDataModules(p)/8)-Qe.ECC_CODEWORDS_PER_BLOCK[m.ordinal][p]*Qe.NUM_ERROR_CORRECTION_BLOCKS[m.ordinal][p]}static reedSolomonComputeDivisor(p){if(p<1||p>255)throw new RangeError("Degree out of range");let m=[];for(let C=0;C<p-1;C++)m.push(0);m.push(1);let b=1;for(let C=0;C<p;C++){for(let _=0;_<m.length;_++)m[_]=Qe.reedSolomonMultiply(m[_],b),_+1<m.length&&(m[_]^=m[_+1]);b=Qe.reedSolomonMultiply(b,2)}return m}static reedSolomonComputeRemainder(p,m){let b=m.map(C=>0);for(const C of p){const _=C^b.shift();b.push(0),m.forEach((N,I)=>b[I]^=Qe.reedSolomonMultiply(N,_))}return b}static reedSolomonMultiply(p,m){if(p>>>8||m>>>8)throw new RangeError("Byte out of range");let b=0;for(let C=7;C>=0;C--)b=b<<1^(b>>>7)*285,b^=(m>>>C&1)*p;return u(b>>>8==0),b}finderPenaltyCountPatterns(p){const m=p[1];u(m<=this.size*3);const b=m>0&&p[2]==m&&p[3]==m*3&&p[4]==m&&p[5]==m;return(b&&p[0]>=m*4&&p[6]>=m?1:0)+(b&&p[6]>=m*4&&p[0]>=m?1:0)}finderPenaltyTerminateAndCount(p,m,b){return p&&(this.finderPenaltyAddHistory(m,b),m=0),m+=this.size,this.finderPenaltyAddHistory(m,b),this.finderPenaltyCountPatterns(b)}finderPenaltyAddHistory(p,m){m[0]==0&&(p+=this.size),m.pop(),m.unshift(p)}};e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=e;function n(w,p,m){if(p<0||p>31||w>>>p)throw new RangeError("Value out of range");for(let b=p-1;b>=0;b--)m.push(w>>>b&1)}function i(w,p){return(w>>>p&1)!=0}function u(w){if(!w)throw new Error("Assertion error")}const d=class Mt{constructor(p,m,b){if(this.mode=p,this.numChars=m,this.bitData=b,m<0)throw new RangeError("Invalid argument");this.bitData=b.slice()}static makeBytes(p){let m=[];for(const b of p)n(b,8,m);return new Mt(Mt.Mode.BYTE,p.length,m)}static makeNumeric(p){if(!Mt.isNumeric(p))throw new RangeError("String contains non-numeric characters");let m=[];for(let b=0;b<p.length;){const C=Math.min(p.length-b,3);n(parseInt(p.substring(b,b+C),10),C*3+1,m),b+=C}return new Mt(Mt.Mode.NUMERIC,p.length,m)}static makeAlphanumeric(p){if(!Mt.isAlphanumeric(p))throw new RangeError("String contains unencodable characters in alphanumeric mode");let m=[],b;for(b=0;b+2<=p.length;b+=2){let C=Mt.ALPHANUMERIC_CHARSET.indexOf(p.charAt(b))*45;C+=Mt.ALPHANUMERIC_CHARSET.indexOf(p.charAt(b+1)),n(C,11,m)}return b<p.length&&n(Mt.ALPHANUMERIC_CHARSET.indexOf(p.charAt(b)),6,m),new Mt(Mt.Mode.ALPHANUMERIC,p.length,m)}static makeSegments(p){return p==""?[]:Mt.isNumeric(p)?[Mt.makeNumeric(p)]:Mt.isAlphanumeric(p)?[Mt.makeAlphanumeric(p)]:[Mt.makeBytes(Mt.toUtf8ByteArray(p))]}static makeEci(p){let m=[];if(p<0)throw new RangeError("ECI assignment value out of range");if(p<128)n(p,8,m);else if(p<16384)n(2,2,m),n(p,14,m);else if(p<1e6)n(6,3,m),n(p,21,m);else throw new RangeError("ECI assignment value out of range");return new Mt(Mt.Mode.ECI,0,m)}static isNumeric(p){return Mt.NUMERIC_REGEX.test(p)}static isAlphanumeric(p){return Mt.ALPHANUMERIC_REGEX.test(p)}getData(){return this.bitData.slice()}static getTotalBits(p,m){let b=0;for(const C of p){const _=C.mode.numCharCountBits(m);if(C.numChars>=1<<_)return 1/0;b+=4+_+C.bitData.length}return b}static toUtf8ByteArray(p){p=encodeURI(p);let m=[];for(let b=0;b<p.length;b++)p.charAt(b)!="%"?m.push(p.charCodeAt(b)):(m.push(parseInt(p.substring(b+1,b+3),16)),b+=2);return m}};d.NUMERIC_REGEX=/^[0-9]*$/,d.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,d.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let g=d;t.QrSegment=d})(ls||(ls={}));(t=>{(e=>{const n=class{constructor(u,d){this.ordinal=u,this.formatBits=d}};n.LOW=new n(0,1),n.MEDIUM=new n(1,0),n.QUARTILE=new n(2,3),n.HIGH=new n(3,2),e.Ecc=n})(t.QrCode||(t.QrCode={}))})(ls||(ls={}));(t=>{(e=>{const n=class{constructor(u,d){this.modeBits=u,this.numBitsCharCount=d}numCharCountBits(u){return this.numBitsCharCount[Math.floor((u+7)/17)]}};n.NUMERIC=new n(1,[10,12,14]),n.ALPHANUMERIC=new n(2,[9,11,13]),n.BYTE=new n(4,[8,16,16]),n.KANJI=new n(8,[8,10,12]),n.ECI=new n(7,[0,0,0]),e.Mode=n})(t.QrSegment||(t.QrSegment={}))})(ls||(ls={}));var Bs=ls;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var mp={L:Bs.QrCode.Ecc.LOW,M:Bs.QrCode.Ecc.MEDIUM,Q:Bs.QrCode.Ecc.QUARTILE,H:Bs.QrCode.Ecc.HIGH},ah=128,oh="L",lh="#FFFFFF",ch="#000000",uh=!1,dh=1,xp=4,pp=0,wp=.1;function hh(t,e=0){const n=[];return t.forEach(function(i,u){let d=null;i.forEach(function(g,w){if(!g&&d!==null){n.push(`M${d+e} ${u+e}h${w-d}v1H${d+e}z`),d=null;return}if(w===i.length-1){if(!g)return;d===null?n.push(`M${w+e},${u+e} h1v1H${w+e}z`):n.push(`M${d+e},${u+e} h${w+1-d}v1H${d+e}z`);return}g&&d===null&&(d=w)})}),n.join("")}function fh(t,e){return t.slice().map((n,i)=>i<e.y||i>=e.y+e.h?n:n.map((u,d)=>d<e.x||d>=e.x+e.w?u:!1))}function yp(t,e,n,i){if(i==null)return null;const u=t.length+n*2,d=Math.floor(e*wp),g=u/e,w=(i.width||d)*g,p=(i.height||d)*g,m=i.x==null?t.length/2-w/2:i.x*g,b=i.y==null?t.length/2-p/2:i.y*g,C=i.opacity==null?1:i.opacity;let _=null;if(i.excavate){let I=Math.floor(m),T=Math.floor(b),k=Math.ceil(w+m-I),M=Math.ceil(p+b-T);_={x:I,y:T,w:k,h:M}}const N=i.crossOrigin;return{x:m,y:b,h:p,w,excavation:_,opacity:C,crossOrigin:N}}function bp(t,e){return e!=null?Math.max(Math.floor(e),0):t?xp:pp}function gh({value:t,level:e,minVersion:n,includeMargin:i,marginSize:u,imageSettings:d,size:g,boostLevel:w}){let p=rr.useMemo(()=>{const I=(Array.isArray(t)?t:[t]).reduce((T,k)=>(T.push(...Bs.QrSegment.makeSegments(k)),T),[]);return Bs.QrCode.encodeSegments(I,mp[e],n,void 0,void 0,w)},[t,e,n,w]);const{cells:m,margin:b,numCells:C,calculatedImageSettings:_}=rr.useMemo(()=>{let N=p.getModules();const I=bp(i,u),T=N.length+I*2,k=yp(N,g,I,d);return{cells:N,margin:I,numCells:T,calculatedImageSettings:k}},[p,g,d,i,u]);return{qrcode:p,margin:b,cells:m,numCells:C,calculatedImageSettings:_}}var vp=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),Cp=rr.forwardRef(function(e,n){const i=e,{value:u,size:d=ah,level:g=oh,bgColor:w=lh,fgColor:p=ch,includeMargin:m=uh,minVersion:b=dh,boostLevel:C,marginSize:_,imageSettings:N}=i,T=Qo(i,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:k}=T,M=Qo(T,["style"]),H=N?.src,B=rr.useRef(null),z=rr.useRef(null),ae=rr.useCallback(ge=>{B.current=ge,typeof n=="function"?n(ge):n&&(n.current=ge)},[n]),[V,G]=rr.useState(!1),{margin:P,cells:O,numCells:ne,calculatedImageSettings:oe}=gh({value:u,level:g,minVersion:b,boostLevel:C,includeMargin:m,marginSize:_,imageSettings:N,size:d});rr.useEffect(()=>{if(B.current!=null){const ge=B.current,q=ge.getContext("2d");if(!q)return;let Z=O;const Y=z.current,Q=oe!=null&&Y!==null&&Y.complete&&Y.naturalHeight!==0&&Y.naturalWidth!==0;Q&&oe.excavation!=null&&(Z=fh(O,oe.excavation));const Fe=window.devicePixelRatio||1;ge.height=ge.width=d*Fe;const qe=d/ne*Fe;q.scale(qe,qe),q.fillStyle=w,q.fillRect(0,0,ne,ne),q.fillStyle=p,vp?q.fill(new Path2D(hh(Z,P))):O.forEach(function(lt,re){lt.forEach(function(W,ce){W&&q.fillRect(ce+P,re+P,1,1)})}),oe&&(q.globalAlpha=oe.opacity),Q&&q.drawImage(Y,oe.x+P,oe.y+P,oe.w,oe.h)}}),rr.useEffect(()=>{G(!1)},[H]);const ue=Ko({height:d,width:d},k);let te=null;return H!=null&&(te=rr.createElement("img",{src:H,key:H,style:{display:"none"},onLoad:()=>{G(!0)},ref:z,crossOrigin:oe?.crossOrigin})),rr.createElement(rr.Fragment,null,rr.createElement("canvas",Ko({style:ue,height:d,width:d,ref:ae,role:"img"},M)),te)});Cp.displayName="QRCodeCanvas";var mh=rr.forwardRef(function(e,n){const i=e,{value:u,size:d=ah,level:g=oh,bgColor:w=lh,fgColor:p=ch,includeMargin:m=uh,minVersion:b=dh,boostLevel:C,title:_,marginSize:N,imageSettings:I}=i,T=Qo(i,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:k,cells:M,numCells:H,calculatedImageSettings:B}=gh({value:u,level:g,minVersion:b,boostLevel:C,includeMargin:m,marginSize:N,imageSettings:I,size:d});let z=M,ae=null;I!=null&&B!=null&&(B.excavation!=null&&(z=fh(M,B.excavation)),ae=rr.createElement("image",{href:I.src,height:B.h,width:B.w,x:B.x+k,y:B.y+k,preserveAspectRatio:"none",opacity:B.opacity,crossOrigin:B.crossOrigin}));const V=hh(z,k);return rr.createElement("svg",Ko({height:d,width:d,viewBox:`0 0 ${H} ${H}`,ref:n,role:"img"},T),!!_&&rr.createElement("title",null,_),rr.createElement("path",{fill:w,d:`M0,0 h${H}v${H}H0z`,shapeRendering:"crispEdges"}),rr.createElement("path",{fill:p,d:V,shapeRendering:"crispEdges"}),ae)});mh.displayName="QRCodeSVG";function xh({student:t,open:e,onOpenChange:n}){const i=D.useRef(null),u=JSON.stringify({studentId:t.id,name:t.name,className:t.classes?.name||"",timestamp:Date.now()}),d=()=>{const p=i.current?.querySelector("svg");if(!p)return;const m=document.createElement("canvas"),b=m.getContext("2d"),C=new XMLSerializer().serializeToString(p),_=new Image;_.onload=()=>{if(m.width=800,m.height=1e3,b){b.fillStyle="#FFFFFF",b.fillRect(0,0,m.width,m.height),b.drawImage(_,200,200,400,400),b.fillStyle="#000000",b.font="bold 32px Arial",b.textAlign="center",b.fillText(t.name,400,100),b.font="24px Arial",b.fillText(`الفصل: ${t.classes?.name||"غير معين"}`,400,140);const N=t.id.slice(0,8).toUpperCase();b.fillText(`رقم الطالب: ${N}`,400,170),b.font="20px Arial",b.fillStyle="#666666",b.fillText("امسح هذا الرمز لتسجيل الحضور",400,650),m.toBlob(I=>{if(I){const T=URL.createObjectURL(I),k=document.createElement("a");k.href=T,k.download=`QR_${t.name}_${N}.png`,k.click(),URL.revokeObjectURL(T),xe.success("تم تحميل رمز QR بنجاح")}})}},_.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(C)))},g=()=>{const p=window.open("","_blank");if(!p)return;const m=i.current?.querySelector("svg");if(!m)return;const b=new XMLSerializer().serializeToString(m),C=t.id.slice(0,8).toUpperCase();p.document.write(`
      <!DOCTYPE html>
      <html dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>بطاقة QR - ${t.name}</title>
          <style>
            body {
              font-family: Arial, sans-serif;
              display: flex;
              justify-content: center;
              align-items: center;
              min-height: 100vh;
              margin: 0;
              padding: 20px;
            }
            .card {
              border: 3px solid #f97316;
              border-radius: 20px;
              padding: 40px;
              text-align: center;
              background: white;
              box-shadow: 0 4px 6px rgba(0,0,0,0.1);
              max-width: 400px;
            }
            h1 {
              color: #000;
              margin: 0 0 10px 0;
              font-size: 28px;
            }
            .info {
              color: #666;
              margin: 5px 0;
              font-size: 18px;
            }
            .qr-container {
              margin: 30px 0;
              padding: 20px;
              background: #f9f9f9;
              border-radius: 10px;
            }
            .footer {
              color: #999;
              font-size: 14px;
              margin-top: 20px;
            }
            @media print {
              body {
                background: white;
              }
            }
          </style>
        </head>
        <body>
          <div class="card">
            <h1>${t.name}</h1>
            <p class="info">الفصل: ${t.classes?.name||"غير معين"}</p>
            <p class="info">رقم الطالب: ${C}</p>
            <div class="qr-container">
              ${b}
            </div>
            <p class="footer">امسح هذا الرمز لتسجيل الحضور</p>
          </div>
          <script>
            window.onload = () => {
              window.print();
            };
          <\/script>
        </body>
      </html>
    `),p.document.close(),xe.success("جاري الطباعة...")},w=t.id.slice(0,8).toUpperCase();return l.jsx(vr,{open:e,onOpenChange:n,children:l.jsxs(Cr,{className:"sm:max-w-md",onInteractOutside:p=>p.preventDefault(),children:[l.jsxs(_r,{children:[l.jsxs(Er,{className:"flex items-center gap-2",children:[l.jsx(Gs,{className:"h-5 w-5 text-orange-500"}),"رمز QR للطالب"]}),l.jsx(Ur,{children:"استخدم هذا الرمز لتسجيل حضور الطالب"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[l.jsx("h3",{className:"text-black mb-1",children:t.name}),l.jsxs("p",{className:"text-sm text-gray-600",children:["الفصل: ",t.classes?.name||"غير معين"]}),l.jsxs("p",{className:"text-sm text-gray-600",children:["رقم الطالب: ",w]})]}),l.jsx("div",{ref:i,className:"flex justify-center p-6 bg-white border-2 border-orange-200 rounded-lg",children:l.jsx(mh,{value:u,size:256,level:"H",includeMargin:!0,fgColor:"#000000",bgColor:"#FFFFFF"})}),l.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:l.jsx("p",{className:"text-sm text-gray-700 text-center",children:"قم بطباعة أو تحميل هذا الرمز وتسليمه للطالب"})}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs(me,{onClick:d,variant:"outline",className:"border-orange-500 text-orange-500 hover:bg-orange-50",children:[l.jsx(bi,{className:"ml-2 h-4 w-4"}),"تحميل"]}),l.jsxs(me,{onClick:g,className:"bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(T0,{className:"ml-2 h-4 w-4"}),"طباعة"]})]})]})]})})}const ds=()=>{const t=Vn(),e=os({queryKey:["students"],queryFn:async()=>{const{data:d,error:g}=await ze.from("students").select(`
          *,
          classes (
            id,
            name,
            grade_level
          )
        `).order("created_at",{ascending:!1});if(g)throw g;return d},staleTime:1e3*60*5}),n=jr({mutationFn:async d=>{const{data:g,error:w}=await ze.from("students").insert([d]).select(`
          *,
          classes (
            id,
            name,
            grade_level
          )
        `).single();if(w)throw w;return g},onMutate:async d=>{await t.cancelQueries({queryKey:["students"]});const g=t.getQueryData(["students"]);return t.setQueryData(["students"],w=>{const p=Math.random().toString(),m={...d,id:p,created_at:new Date().toISOString(),classes:{id:d.class_id,name:"...",grade_level:"..."}};return w?[m,...w]:[m]}),{previousStudents:g}},onError:(d,g,w)=>{xe.error("فشل إضافة الطالب"),w?.previousStudents&&t.setQueryData(["students"],w.previousStudents)},onSuccess:()=>{xe.success("تم أضافة الطالب بنجاح")},onSettled:()=>{t.invalidateQueries({queryKey:["students"]}),t.invalidateQueries({queryKey:["classes"]}),t.invalidateQueries({queryKey:["grades"]})}}),i=jr({mutationFn:async({id:d,data:g})=>{const{error:w}=await ze.from("students").update(g).eq("id",d);if(w)throw w},onSuccess:()=>{xe.success("تم تعديل بيانات الطالب بنجاح"),t.invalidateQueries({queryKey:["students"]}),t.invalidateQueries({queryKey:["classes"]}),t.invalidateQueries({queryKey:["grades"]})},onError:()=>{xe.error("فشل تعديل بيانات الطالب")}}),u=jr({mutationFn:async d=>{const{error:g}=await ze.from("students").delete().eq("id",d);if(g)throw g},onSuccess:()=>{xe.success("تم حذف الطالب بنجاح"),t.invalidateQueries({queryKey:["students"]}),t.invalidateQueries({queryKey:["classes"]}),t.invalidateQueries({queryKey:["grades"]})},onError:()=>{xe.error("فشل حذف الطالب")}});return{students:e.data||[],isLoading:e.isLoading,isError:e.isError,addStudent:n.mutateAsync,updateStudent:i.mutateAsync,deleteStudent:u.mutateAsync}},di={async getAll(){const{data:t,error:e}=await ze.from("classes").select("*").order("created_at",{ascending:!1});if(e)throw e;return t},async getById(t){const{data:e,error:n}=await ze.from("classes").select("*").eq("id",t).single();if(n)throw n;return e},async create(t){const{data:e,error:n}=await ze.from("classes").insert([t]).select().single();if(n)throw n;return e},async update(t,e){const{data:n,error:i}=await ze.from("classes").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return n},async delete(t){const{error:e}=await ze.from("classes").delete().eq("id",t);if(e)throw e},async getStudentCount(t){const{count:e,error:n}=await ze.from("students").select("*",{count:"exact",head:!0}).eq("class_id",t);if(n)throw n;return e||0}},Zs=()=>{const t=Vn(),e=os({queryKey:["classes"],queryFn:async()=>{const d=await di.getAll();return await Promise.all(d.map(async w=>{const p=await di.getStudentCount(w.id||"");return{...w,currentStudents:p}}))},staleTime:1e3*60*5}),n=jr({mutationFn:di.create,onMutate:async d=>{await t.cancelQueries({queryKey:["classes"]});const g=t.getQueryData(["classes"]);return t.setQueryData(["classes"],w=>{const p=Math.random().toString(),m={...d,id:p,currentStudents:0,created_at:new Date().toISOString()};return w?[m,...w]:[m]}),{previousClasses:g}},onError:(d,g,w)=>{xe.error("فشل إضافة الفصل"),w?.previousClasses&&t.setQueryData(["classes"],w.previousClasses)},onSuccess:()=>{xe.success("تم إضافة الفصل بنجاح")},onSettled:()=>{t.invalidateQueries({queryKey:["classes"]}),t.invalidateQueries({queryKey:["grades"]})}}),i=jr({mutationFn:({id:d,data:g})=>di.update(d,g),onSuccess:()=>{xe.success("تم تعديل بيانات الفصل بنجاح"),t.invalidateQueries({queryKey:["classes"]})},onError:()=>{xe.error("فشل تعديل بيانات الفصل")}}),u=jr({mutationFn:di.delete,onSuccess:()=>{xe.success("تم حذف الفصل بنجاح"),t.invalidateQueries({queryKey:["classes"]}),t.invalidateQueries({queryKey:["grades"]})},onError:d=>{d?.code==="23503"?xe.error("لا يمكن حذف هذا الفصل لأنه يحتوي على طلاب مسجلين"):xe.error("فشل حذف الفصل")}});return{classes:e.data||[],isLoading:e.isLoading,isError:e.isError,addClass:n.mutateAsync,updateClass:i.mutateAsync,deleteClass:u.mutateAsync}};function xu(){const{students:t,isLoading:e,addStudent:n,updateStudent:i,deleteStudent:u}=ds(),d=t,{classes:g}=Zs(),w=va(),[p,m]=D.useState([]),[b,C]=D.useState(""),[_,N]=D.useState(!1),[I,T]=D.useState(!1),[k,M]=D.useState(!1),[H,B]=D.useState(!1),[z,ae]=D.useState(!1),[V,G]=D.useState(1),P=5,[O,ne]=D.useState({name:"",phone:"",email:"",class_id:"",guardian_name:"",guardian_phone:"",payment_status:"regular"}),[oe,ue]=D.useState(null),te=d.filter(W=>W.name.toLowerCase().includes(b.toLowerCase())||(W.email?.toLowerCase()||"").includes(b.toLowerCase())||W.phone.includes(b)||(W.guardian_name||"").toLowerCase().includes(b.toLowerCase())),ge=Math.ceil(te.length/P),q=te.slice((V-1)*P,V*P),Z=async()=>{if(!O.name||!O.phone||!O.guardian_name||!O.guardian_phone||!O.class_id){xe.error("الرجاء ملء جميع الحقول المطلوبة واختيار الفصل");return}try{await n({...O,email:O.email||void 0,class_id:O.class_id||void 0}),N(!1),qe()}catch(W){console.error(W)}},Y=async()=>{if(!(!oe||!oe.id))try{await i({id:oe.id,data:{...O,email:O.email||void 0,class_id:O.class_id||void 0}}),T(!1)}catch(W){console.error(W)}},Q=async W=>{if(window.confirm("هل أنت متأكد من حذف هذا الطالب؟"))try{await u(W)}catch(ce){console.error(ce)}},Fe=async()=>{if(!(!oe||!oe.id||!O.class_id))try{await i({id:oe.id,data:{class_id:O.class_id}}),xe.success("تم تعيين الفصل بنجاح"),M(!1)}catch(W){console.error(W),xe.error("فشل تعيين الفصل")}},qe=()=>{ne({name:"",phone:"",email:"",class_id:"",guardian_name:"",guardian_phone:"",payment_status:"regular"})},lt=W=>{ue(W),ne({name:W.name,phone:W.phone,email:W.email||"",class_id:W.class_id||"",guardian_name:W.guardian_name,guardian_phone:W.guardian_phone,payment_status:W.payment_status}),T(!0)},re=W=>{ue(W),ne(ce=>({...ce,class_id:W.class_id||""})),M(!0)};return e?l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"جاري تحميل البيانات..."})]})}):l.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[l.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"جميع الطلاب"}),l.jsx("p",{className:"text-gray-500",children:"عرض وإدارة جميع الطلاب المسجلين في النظام"})]}),l.jsxs(me,{onClick:()=>{qe(),N(!0)},className:"bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(Xs,{className:"ml-2 h-4 w-4"}),"إضافة طالب جديد"]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[l.jsxs(Se,{children:[l.jsxs(Ue,{className:"flex flex-row items-center justify-between pb-2",children:[l.jsx(We,{className:"text-sm font-medium text-gray-600",children:"إجمالي الطلاب"}),l.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:l.jsx(vc,{className:"h-4 w-4 text-blue-600"})})]}),l.jsxs(ht,{children:[l.jsx("div",{className:"text-2xl font-bold",children:d.length}),l.jsx("p",{className:"text-xs text-gray-500",children:"طالب مسجل في النظام"})]})]}),l.jsxs(Se,{children:[l.jsxs(Ue,{className:"flex flex-row items-center justify-between pb-2",children:[l.jsx(We,{className:"text-sm font-medium text-gray-600",children:"الطلاب المنتظمين"}),l.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:l.jsx(xl,{className:"h-4 w-4 text-green-600"})})]}),l.jsxs(ht,{children:[l.jsx("div",{className:"text-2xl font-bold",children:d.filter(W=>W.payment_status==="regular").length}),l.jsx("p",{className:"text-xs text-gray-500",children:"طالب دفع الرسوم"})]})]}),l.jsxs(Se,{children:[l.jsxs(Ue,{className:"flex flex-row items-center justify-between pb-2",children:[l.jsx(We,{className:"text-sm font-medium text-gray-600",children:"طلاب موقوفين/مفصولين"}),l.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:l.jsx(To,{className:"h-4 w-4 text-red-600"})})]}),l.jsxs(ht,{children:[l.jsx("div",{className:"text-2xl font-bold",children:d.filter(W=>W.status&&W.status!=="active").length}),l.jsx("p",{className:"text-xs text-gray-500",children:"طالب غير نشط حالياً"})]})]})]}),l.jsx("div",{className:"flex items-center gap-4 bg-white p-4 rounded-lg border shadow-sm",children:l.jsxs("div",{className:"relative flex-1",children:[l.jsx(us,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),l.jsx(Be,{placeholder:"بحث عن طالب...",value:b,onChange:W=>C(W.target.value),className:"pr-10"})]})}),l.jsxs("div",{className:"bg-white rounded-lg border shadow-sm",children:[l.jsxs(Ln,{children:[l.jsx(Bn,{children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right",children:"اسم الطالب"}),l.jsx(Ve,{className:"text-right",children:"الفصل"}),l.jsx(Ve,{className:"text-right",children:"ولي الأمر"}),l.jsx(Ve,{className:"text-right",children:"رقم الهاتف"}),l.jsx(Ve,{className:"text-right",children:"حالة الرسوم"}),l.jsx(Ve,{className:"text-right",children:"الحالة"}),l.jsx(Ve,{className:"text-right",children:"الإجراءات"})]})}),l.jsx(Fn,{children:q.length>0?q.map(W=>l.jsxs(Tt,{children:[l.jsx(Oe,{className:"font-medium",children:W.name}),l.jsx(Oe,{children:W.classes?l.jsxs("div",{className:"flex flex-col",children:[l.jsx("span",{className:"font-medium",children:W.classes.name}),l.jsx("span",{className:"text-xs text-gray-500",children:W.classes.grade_level})]}):l.jsx("span",{className:"text-gray-400",children:"غير معين"})}),l.jsx(Oe,{children:W.guardian_name}),l.jsx(Oe,{dir:"ltr",className:"text-right",children:W.phone}),l.jsx(Oe,{children:l.jsx(vt,{variant:W.payment_status==="regular"?"default":"secondary",children:W.payment_status==="regular"?"منتظم":"معفى"})}),l.jsx(Oe,{children:l.jsx(vt,{className:W.status==="suspended"?"bg-yellow-500 hover:bg-yellow-600":W.status==="expelled"?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600",children:W.status==="suspended"?"موقوف":W.status==="expelled"?"مفصول":"نشط"})}),l.jsx(Oe,{children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>w(`/dashboard/students/${W.id}`),children:l.jsx(cd,{className:"h-4 w-4 text-orange-500"})}),l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>lt(W),children:l.jsx(Ca,{className:"h-4 w-4 text-blue-500"})}),l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>re(W),children:l.jsx(vc,{className:"h-4 w-4 text-green-500"})}),l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>{ue(W),ae(!0)},children:l.jsx(Gs,{className:"h-4 w-4 text-purple-500"})}),l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>Q(W.id||""),children:l.jsx(Oi,{className:"h-4 w-4 text-red-500"})})]})})]},W.id)):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:6,className:"text-center py-8 text-gray-500",children:"لا توجد نتائج"})})})]}),ge>1&&l.jsx("div",{className:"p-4 border-t",children:l.jsx(Ol,{children:l.jsxs(Rl,{children:[l.jsx(vn,{children:l.jsx(jl,{onClick:()=>G(W=>Math.max(1,W-1)),className:V===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:ge},(W,ce)=>ce+1).map(W=>l.jsx(vn,{children:l.jsx(ji,{isActive:V===W,onClick:()=>G(W),className:"cursor-pointer",children:W})},W)),l.jsx(vn,{children:l.jsx(kl,{onClick:()=>G(W=>Math.min(ge,W+1)),className:V===ge?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]}),l.jsx(vr,{open:_,onOpenChange:N,children:l.jsxs(Cr,{className:"sm:max-w-[500px]",onInteractOutside:W=>W.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"إضافة طالب جديد"}),l.jsx(Ur,{children:"أدخل بيانات الطالب الجديد أدناه. جميع الحقول المميزة بـ * مطلوبة."})]}),l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"name",children:"اسم الطالب *"}),l.jsx(Be,{id:"name",value:O.name,onChange:W=>ne({...O,name:W.target.value}),placeholder:"الاسم الثلاثي"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"phone",children:"رقم الهاتف *"}),l.jsx(Be,{id:"phone",value:O.phone,onChange:W=>ne({...O,phone:W.target.value}),placeholder:"05xxxxxxxx",dir:"ltr"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"email",children:"البريد الإلكتروني"}),l.jsx(Be,{id:"email",type:"email",value:O.email,onChange:W=>ne({...O,email:W.target.value}),placeholder:"example@email.com",dir:"ltr"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"guardianName",children:"اسم ولي الأمر *"}),l.jsx(Be,{id:"guardianName",value:O.guardian_name,onChange:W=>ne({...O,guardian_name:W.target.value}),placeholder:"اسم ولي الأمر"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"guardianPhone",children:"هاتف ولي الأمر *"}),l.jsx(Be,{id:"guardianPhone",value:O.guardian_phone,onChange:W=>ne({...O,guardian_phone:W.target.value}),placeholder:"05xxxxxxxx",dir:"ltr"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"paymentStatus",children:"حالة الرسوم"}),l.jsxs(Ht,{value:O.payment_status,onValueChange:W=>ne({...O,payment_status:W}),children:[l.jsx(qt,{id:"paymentStatus",children:l.jsx(Gt,{})}),l.jsxs(zt,{children:[l.jsx(et,{value:"regular",children:"منتظم"}),l.jsx(et,{value:"exempt",children:"معفى"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"class",children:"الفصل"}),l.jsxs(Ht,{value:O.class_id,onValueChange:W=>ne({...O,class_id:W}),children:[l.jsx(qt,{id:"class",children:l.jsx(Gt,{placeholder:"اختر الفصل"})}),l.jsx(zt,{children:g.map(W=>l.jsxs(et,{value:W.id||"",children:[W.name," (",W.grade_level,")"]},W.id))})]})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>N(!1),children:"إلغاء"}),l.jsx(me,{onClick:Z,className:"bg-orange-500 hover:bg-orange-600 text-black",children:"حفظ الطالب"})]})]})}),l.jsx(vr,{open:I,onOpenChange:T,children:l.jsxs(Cr,{className:"sm:max-w-[500px]",onInteractOutside:W=>W.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"تعديل بيانات الطالب"}),l.jsx(Ur,{children:"قم بتعديل بيانات الطالب"})]}),l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-name",children:"اسم الطالب *"}),l.jsx(Be,{id:"edit-name",value:O.name,onChange:W=>ne({...O,name:W.target.value})})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-phone",children:"رقم الهاتف *"}),l.jsx(Be,{id:"edit-phone",value:O.phone,onChange:W=>ne({...O,phone:W.target.value}),dir:"ltr"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-email",children:"البريد الإلكتروني"}),l.jsx(Be,{id:"edit-email",type:"email",value:O.email,onChange:W=>ne({...O,email:W.target.value}),dir:"ltr"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-guardianName",children:"اسم ولي الأمر *"}),l.jsx(Be,{id:"edit-guardianName",value:O.guardian_name,onChange:W=>ne({...O,guardian_name:W.target.value})})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-guardianPhone",children:"هاتف ولي الأمر *"}),l.jsx(Be,{id:"edit-guardianPhone",value:O.guardian_phone,onChange:W=>ne({...O,guardian_phone:W.target.value}),dir:"ltr"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-paymentStatus",children:"حالة الرسوم"}),l.jsxs(Ht,{value:O.payment_status,onValueChange:W=>ne({...O,payment_status:W}),children:[l.jsx(qt,{id:"edit-paymentStatus",children:l.jsx(Gt,{})}),l.jsxs(zt,{children:[l.jsx(et,{value:"regular",children:"منتظم"}),l.jsx(et,{value:"exempt",children:"معفى"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-class",children:"الفصل"}),l.jsxs(Ht,{value:O.class_id,onValueChange:W=>ne({...O,class_id:W}),children:[l.jsx(qt,{id:"edit-class",children:l.jsx(Gt,{placeholder:"اختر الفصل"})}),l.jsx(zt,{children:g.map(W=>l.jsxs(et,{value:W.id||"",children:[W.name," (",W.grade_level,")"]},W.id))})]})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>T(!1),children:"إلغاء"}),l.jsx(me,{onClick:Y,className:"bg-orange-500 hover:bg-orange-600 text-black",children:"حفظ التغييرات"})]})]})}),l.jsx(vr,{open:k,onOpenChange:M,children:l.jsxs(Cr,{className:"sm:max-w-[425px]",onInteractOutside:W=>W.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"تعيين فصل للطالب"}),l.jsxs(Ur,{children:["اختر الفصل المناسب للطالب ",oe?.name]})]}),l.jsx("div",{className:"grid gap-4 py-4",children:l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"assign-class",children:"الفصل"}),l.jsxs(Ht,{value:O.class_id,onValueChange:W=>ne({...O,class_id:W}),children:[l.jsx(qt,{id:"assign-class",children:l.jsx(Gt,{placeholder:"اختر الفصل"})}),l.jsx(zt,{children:g.map(W=>l.jsxs(et,{value:W.id||"",children:[W.name," (",W.grade_level,")"]},W.id))})]})]})}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>M(!1),children:"إلغاء"}),l.jsx(me,{onClick:Fe,className:"bg-orange-500 hover:bg-orange-600 text-black",children:"حفظ"})]})]})}),oe&&l.jsx(xh,{open:z,onOpenChange:ae,student:{id:oe.id||"",name:oe.name,classes:oe.classes,phone:oe.phone}})]})}const na={async getAll(){const{data:t,error:e}=await ze.from("grades").select("*, classes:classes(id)").order("created_at",{ascending:!1});if(e)throw e;const{data:n,error:i}=await ze.from("students").select("class_id");if(i)throw i;const{data:u,error:d}=await ze.from("classes").select("id, grade_id");if(d)throw d;const g=new Map;u.forEach(p=>g.set(p.id,p.grade_id));const w=new Map;return n.forEach(p=>{if(p.class_id){const m=g.get(p.class_id);m&&w.set(m,(w.get(m)||0)+1)}}),t.map(p=>({...p,classCount:p.classes?.length||0,studentCount:w.get(p.id)||0}))},async getById(t){const{data:e,error:n}=await ze.from("grades").select("*").eq("id",t).single();if(n)throw n;return e},async create(t){const{data:e,error:n}=await ze.from("grades").insert([t]).select().single();if(n)throw n;return e},async update(t,e){const{data:n,error:i}=await ze.from("grades").update(e).eq("id",t).select().single();if(i)throw i;return n},async delete(t){const{error:e}=await ze.from("grades").delete().eq("id",t);if(e)throw e;return!0}},Dl=()=>{const t=Vn(),e=os({queryKey:["grades"],queryFn:na.getAll,staleTime:1e3*60*5}),n=jr({mutationFn:na.create,onMutate:async d=>{await t.cancelQueries({queryKey:["grades"]});const g=t.getQueryData(["grades"]);return t.setQueryData(["grades"],w=>{const p=Math.random().toString(),m={...d,id:p,created_at:new Date().toISOString(),classCount:0};return w?[m,...w]:[m]}),{previousGrades:g}},onError:(d,g,w)=>{xe.error("فشل إضافة المرحلة الدراسية"),w?.previousGrades&&t.setQueryData(["grades"],w.previousGrades)},onSuccess:()=>{xe.success("تم إضافة المرحلة الدراسية بنجاح")},onSettled:()=>{t.invalidateQueries({queryKey:["grades"]})}}),i=jr({mutationFn:({id:d,data:g})=>na.update(d,g),onSuccess:()=>{xe.success("تم تعديل المرحلة الدراسية بنجاح"),t.invalidateQueries({queryKey:["grades"]})},onError:()=>{xe.error("فشل تعديل المرحلة الدراسية")}}),u=jr({mutationFn:na.delete,onSuccess:()=>{xe.success("تم حذف المرحلة الدراسية بنجاح"),t.invalidateQueries({queryKey:["grades"]})},onError:()=>{xe.error("فشل حذف المرحلة الدراسية")}});return{grades:e.data||[],isLoading:e.isLoading,isError:e.isError,addGrade:n.mutateAsync,updateGrade:i.mutateAsync,deleteGrade:u.mutateAsync}};function _p(){const t=va(),{classes:e,isLoading:n,addClass:i,updateClass:u,deleteClass:d}=Zs(),{students:g}=ds(),{grades:w}=Dl(),[p,m]=D.useState(""),[b,C]=D.useState(!1),[_,N]=D.useState(!1),[I,T]=D.useState({name:"",grade_level:"",stage:"",grade_id:"",capacity:30,teacher_name:""}),[k,M]=D.useState(null),H=e.map(P=>({...P,studentCount:g.filter(O=>O.class_id===P.id).length})).filter(P=>P.name.toLowerCase().includes(p.toLowerCase())||P.grade_level.toLowerCase().includes(p.toLowerCase())||P.stage.toLowerCase().includes(p.toLowerCase())||(P.teacher_name||"").toLowerCase().includes(p.toLowerCase())),B=async()=>{if(!I.name||!I.grade_level||!I.stage){xe.error("الرجاء ملء الحقول الأساسية");return}try{await i({name:I.name,grade_level:I.grade_level,stage:I.stage,capacity:Number(I.capacity),teacher_name:I.teacher_name,grade_id:I.grade_id}),C(!1),V()}catch(P){console.error(P)}},z=async()=>{if(!(!k||!k.id))try{await u({id:k.id,data:{name:I.name,grade_level:I.grade_level,stage:I.stage,capacity:Number(I.capacity),teacher_name:I.teacher_name,grade_id:I.grade_id}}),N(!1)}catch(P){console.error(P)}},ae=async P=>{if(window.confirm("هل أنت متأكد من حذف هذا الفصل؟"))try{await d(P)}catch(O){console.error(O)}},V=()=>{T({name:"",grade_level:"",stage:"",grade_id:"",capacity:30,teacher_name:""})},G=P=>{M(P),T({name:P.name,grade_level:P.grade_level,stage:P.stage,grade_id:P.grade_id||"",capacity:P.capacity||30,teacher_name:P.teacher_name||""}),N(!0)};return n?l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"جاري تحميل الفصول..."})]})}):l.jsxs("div",{className:"space-y-6",dir:"rtl",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl text-black mb-1",children:"إدارة الفصول"}),l.jsx("p",{className:"text-gray-600",children:"عرض وإدارة الفصول الدراسية"})]}),l.jsxs(vr,{open:b,onOpenChange:C,children:[l.jsx(ha,{asChild:!0,children:l.jsxs(me,{onClick:V,className:"bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(Xs,{className:"ml-2 h-4 w-4"}),"إضافة فصل جديد"]})}),l.jsxs(Cr,{onInteractOutside:P=>P.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"إضافة فصل جديد"}),l.jsx(Ur,{children:"أدخل بيانات الفصل الجديد"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"add-name",children:"اسم الفصل"}),l.jsx(Be,{id:"add-name",value:I.name,onChange:P=>T({...I,name:P.target.value}),placeholder:"مثال: فصل 1-أ"})]}),l.jsx("div",{className:"grid grid-cols-1 gap-4",children:l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"add-grade",children:"المرحلة الدراسية / الصف"}),l.jsxs(Ht,{value:I.grade_id,onValueChange:P=>{const O=w.find(ne=>ne.id===P);O&&T({...I,grade_id:P,grade_level:O.name,stage:O.stage})},children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"اختر المرحلة الدراسية"})}),l.jsx(zt,{children:w.map(P=>l.jsxs(et,{value:P.id||"",children:[P.name," - ",P.stage]},P.id))})]})]})}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"add-capacity",children:"السعة الاستيعابية"}),l.jsx(Be,{id:"add-capacity",type:"number",value:I.capacity,onChange:P=>T({...I,capacity:Number(P.target.value)}),placeholder:"30"})]}),l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"add-teacher",children:"المعلم المسؤول"}),l.jsx(Be,{id:"add-teacher",value:I.teacher_name,onChange:P=>T({...I,teacher_name:P.target.value}),placeholder:"اسم المعلم"})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>C(!1),children:"إلغاء"}),l.jsx(me,{className:"bg-orange-500 hover:bg-orange-600 text-black",onClick:B,children:"إضافة الفصل"})]})]})]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"إجمالي الفصول"}),l.jsx(We,{className:"text-3xl text-black",children:e.length})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"إجمالي الطلاب"}),l.jsx(We,{className:"text-3xl text-black",children:g.length})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"السعة الإجمالية"}),l.jsx(We,{className:"text-3xl text-black",children:e.reduce((P,O)=>P+(O.capacity||0),0)})]})})]}),l.jsx(Se,{children:l.jsx(ht,{className:"pt-6",children:l.jsxs("div",{className:"relative",children:[l.jsx(us,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),l.jsx(Be,{placeholder:"ابحث عن فصل...",value:p,onChange:P=>m(P.target.value),className:"pr-10"})]})})}),l.jsx(Se,{children:l.jsx(ht,{className:"p-0",children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(Ln,{children:[l.jsx(Bn,{children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right",children:"اسم الفصل"}),l.jsx(Ve,{className:"text-right",children:"المرحلة الدراسية"}),l.jsx(Ve,{className:"text-right",children:"المعلم"}),l.jsx(Ve,{className:"text-right",children:"الطلاب"}),l.jsx(Ve,{className:"text-right",children:"السعة"}),l.jsx(Ve,{className:"text-center",children:"الإجراءات"})]})}),l.jsx(Fn,{children:H.length>0?H.map(P=>l.jsxs(Tt,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>t(`/dashboard/classes/${P.id}`),children:[l.jsx(Oe,{className:"font-bold text-orange-600 hover:text-orange-700",children:P.name}),l.jsx(Oe,{children:l.jsxs("div",{className:"flex flex-col",children:[l.jsx("span",{children:P.stage}),l.jsx("span",{className:"text-xs text-gray-500",children:P.grade_level})]})}),l.jsx(Oe,{children:P.teacher_name||"-"}),l.jsx(Oe,{children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(nd,{className:"h-4 w-4 text-gray-400"}),l.jsxs("span",{children:[P.studentCount||0," / ",P.capacity]})]})}),l.jsx(Oe,{children:l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:l.jsx("div",{className:"bg-orange-500 h-2 rounded-full",style:{width:`${Math.min(100,(P.studentCount||0)/(P.capacity||1)*100)}%`}})})}),l.jsx(Oe,{onClick:O=>O.stopPropagation(),children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx(me,{size:"sm",variant:"outline",onClick:()=>G(P),children:l.jsx(Ca,{className:"h-4 w-4"})}),l.jsx(me,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>ae(P.id||""),children:l.jsx(Oi,{className:"h-4 w-4"})})]})})]},P.id)):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:6,className:"text-center text-gray-500 py-8",children:"لا توجد نتائج"})})})]})})})}),l.jsx(vr,{open:_,onOpenChange:N,children:l.jsxs(Cr,{onInteractOutside:P=>P.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"تعديل بيانات الفصل"}),l.jsx(Ur,{children:"قم بتعديل بيانات الفصل"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"edit-name",children:"اسم الفصل"}),l.jsx(Be,{id:"edit-name",value:I.name,onChange:P=>T({...I,name:P.target.value})})]}),l.jsx("div",{className:"grid grid-cols-1 gap-4",children:l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"edit-grade",children:"المرحلة الدراسية / الصف"}),l.jsxs(Ht,{value:I.grade_id,onValueChange:P=>{const O=w.find(ne=>ne.id===P);O&&T({...I,grade_id:P,grade_level:O.name,stage:O.stage})},children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"اختر المرحلة الدراسية"})}),l.jsx(zt,{children:w.map(P=>l.jsxs(et,{value:P.id||"",children:[P.name," - ",P.stage]},P.id))})]})]})}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"edit-capacity",children:"السعة الاستيعابية"}),l.jsx(Be,{id:"edit-capacity",type:"number",value:I.capacity,onChange:P=>T({...I,capacity:Number(P.target.value)})})]}),l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"edit-teacher",children:"المعلم المسؤول"}),l.jsx(Be,{id:"edit-teacher",value:I.teacher_name,onChange:P=>T({...I,teacher_name:P.target.value})})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>N(!1),children:"إلغاء"}),l.jsx(me,{className:"bg-orange-500 hover:bg-orange-600 text-black",onClick:z,children:"حفظ التعديلات"})]})]})})]})}function Ep(){const{grades:t,isLoading:e,addGrade:n,updateGrade:i,deleteGrade:u}=Dl(),{settings:d}=Na(),[g,w]=D.useState(""),[p,m]=D.useState(!1),[b,C]=D.useState(!1),[_,N]=D.useState({name:"",stage:"",description:""}),[I,T]=D.useState(null),k=t.filter(V=>V.name.toLowerCase().includes(g.toLowerCase())||(V.description||"").toLowerCase().includes(g.toLowerCase())),M=async()=>{if(!_.name||!_.stage){xe.error("الرجاء ملء الحقول الأساسية");return}try{await n({name:_.name,stage:_.stage,description:_.description}),m(!1),z()}catch(V){console.error(V)}},H=async()=>{if(!(!I||!I.id))try{await i({id:I.id,data:{name:_.name,stage:_.stage,description:_.description}}),C(!1)}catch(V){console.error(V)}},B=async V=>{if(!window.confirm("هل أنت متأكد من حذف هذه المرحلة؟"))return;const G=t.find(P=>P.id===V);if(G&&(G.classCount||0)>0){xe.error("لا يمكن حذف مرحلة مرتبطة بفصول دراسية");return}try{await u(V)}catch(P){console.error(P)}},z=()=>{N({name:"",stage:"",description:""})},ae=V=>{T(V),N({name:V.name,stage:V.stage,description:V.description||""}),C(!0)};return e?l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"جاري تحميل البيانات..."})]})}):l.jsxs("div",{className:"space-y-6",dir:"rtl",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl text-black mb-1",children:"المراحل الدراسية"}),l.jsx("p",{className:"text-gray-600",children:"إدارة المراحل الدراسية وتعريف الصفوف"})]}),l.jsxs(vr,{open:p,onOpenChange:m,children:[l.jsx(ha,{asChild:!0,children:l.jsxs(me,{onClick:z,className:"bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(Xs,{className:"ml-2 h-4 w-4"}),"إضافة مرحلة جديدة"]})}),l.jsxs(Cr,{onInteractOutside:V=>V.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"إضافة مرحلة دراسية جديدة"}),l.jsx(Ur,{children:"أدخل بيانات المرحلة الدراسية الجديدة"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"add-name",children:"اسم الصف (مثال: الصف الأول)"}),l.jsx(Be,{id:"add-name",value:_.name,onChange:V=>N({..._,name:V.target.value}),placeholder:"مثال: الصف الأول"})]}),l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"add-stage",children:"المرحلة العامة"}),l.jsxs(Ht,{value:_.stage,onValueChange:V=>N({..._,stage:V}),children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"اختر المرحلة"})}),l.jsx(zt,{children:d.available_stages.map(V=>l.jsx(et,{value:V,children:V},V))})]})]}),l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"add-description",children:"الوصف"}),l.jsx(Be,{id:"add-description",value:_.description,onChange:V=>N({..._,description:V.target.value}),placeholder:"وصف إضافي..."})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),l.jsx(me,{className:"bg-orange-500 hover:bg-orange-600 text-black",onClick:M,children:"إضافة المرحلة"})]})]})]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"إجمالي المراحل/الصفوف"}),l.jsx(We,{className:"text-3xl text-black",children:t.length})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"إجمالي الفصول المفتوحة"}),l.jsx(We,{className:"text-3xl text-black",children:t.reduce((V,G)=>V+(G.classCount||0),0)})]})})]}),l.jsx(Se,{children:l.jsx(ht,{className:"pt-6",children:l.jsxs("div",{className:"relative",children:[l.jsx(us,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),l.jsx(Be,{placeholder:"ابحث عن مرحلة دراسية...",value:g,onChange:V=>w(V.target.value),className:"pr-10"})]})})}),l.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[k.map(V=>l.jsxs(Se,{className:"hover:border-orange-500 transition-colors",children:[l.jsx(Ue,{children:l.jsx("div",{className:"flex items-start justify-between",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"bg-orange-500/10 p-3 rounded-lg",children:l.jsx(gl,{className:"h-6 w-6 text-orange-500"})}),l.jsxs("div",{children:[l.jsx(We,{className:"text-black",children:V.name}),l.jsx(nt,{className:"mt-1",children:V.stage})]})]})})}),l.jsxs(ht,{className:"space-y-4",children:[l.jsx("p",{className:"text-sm text-gray-500",children:V.description||"لا يوجد وصف"}),l.jsxs("div",{className:"flex items-center justify-between pt-2",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"عدد الفصول"}),l.jsxs(vt,{variant:"secondary",children:[V.classCount||0," فصل"]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-1",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"إجمالي الطلاب"}),l.jsxs(vt,{variant:"outline",className:"text-orange-600 border-orange-200",children:[V.studentCount||0," طالب"]})]}),l.jsxs("div",{className:"pt-4 border-t flex gap-2 justify-end",children:[l.jsx(me,{size:"sm",variant:"outline",onClick:()=>ae(V),children:l.jsx(Ca,{className:"h-4 w-4"})}),l.jsx(me,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>B(V.id||""),children:l.jsx(Oi,{className:"h-4 w-4"})})]})]})]},V.id)),k.length===0&&l.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"لا توجد مراحل مطابقة للبحث"})]}),l.jsx(vr,{open:b,onOpenChange:C,children:l.jsxs(Cr,{onInteractOutside:V=>V.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"تعديل بيانات المرحلة"}),l.jsx(Ur,{children:"قم بتعديل بيانات المرحلة الدراسية"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"edit-name",children:"اسم الصف"}),l.jsx(Be,{id:"edit-name",value:_.name,onChange:V=>N({..._,name:V.target.value})})]}),l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"edit-stage",children:"المرحلة العامة"}),l.jsxs(Ht,{value:_.stage,onValueChange:V=>N({..._,stage:V}),children:[l.jsx(qt,{children:l.jsx(Gt,{})}),l.jsx(zt,{children:d.available_stages.map(V=>l.jsx(et,{value:V,children:V},V))})]})]}),l.jsxs("div",{children:[l.jsx(_e,{htmlFor:"edit-description",children:"الوصف"}),l.jsx(Be,{id:"edit-description",value:_.description,onChange:V=>N({..._,description:V.target.value})})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>C(!1),children:"إلغاء"}),l.jsx(me,{className:"bg-orange-500 hover:bg-orange-600 text-black",onClick:H,children:"حفظ التعديلات"})]})]})})]})}function Ge(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function bt(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function fr(t,e){const n=Ge(t);return isNaN(e)?bt(t,NaN):(e&&n.setDate(n.getDate()+e),n)}function en(t,e){const n=Ge(t);if(isNaN(e))return bt(t,NaN);if(!e)return n;const i=n.getDate(),u=bt(t,n.getTime());u.setMonth(n.getMonth()+e+1,0);const d=u.getDate();return i>=d?u:(n.setFullYear(u.getFullYear(),u.getMonth(),i),n)}const Pl=6048e5,Ap=864e5,Np=6e4,Sp=36e5,Ip=1e3;let Tp={};function hs(){return Tp}function Wr(t,e){const n=hs(),i=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,u=Ge(t),d=u.getDay(),g=(d<i?7:0)+d-i;return u.setDate(u.getDate()-g),u.setHours(0,0,0,0),u}function Cn(t){return Wr(t,{weekStartsOn:1})}function ph(t){const e=Ge(t),n=e.getFullYear(),i=bt(t,0);i.setFullYear(n+1,0,4),i.setHours(0,0,0,0);const u=Cn(i),d=bt(t,0);d.setFullYear(n,0,4),d.setHours(0,0,0,0);const g=Cn(d);return e.getTime()>=u.getTime()?n+1:e.getTime()>=g.getTime()?n:n-1}function zs(t){const e=Ge(t);return e.setHours(0,0,0,0),e}function Ys(t){const e=Ge(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function xn(t,e){const n=zs(t),i=zs(e),u=+n-Ys(n),d=+i-Ys(i);return Math.round((u-d)/Ap)}function Op(t){const e=ph(t),n=bt(t,0);return n.setFullYear(e,0,4),n.setHours(0,0,0,0),Cn(n)}function Zo(t,e){const n=e*7;return fr(t,n)}function Rp(t,e){return en(t,e*12)}function jp(t){let e;return t.forEach(function(n){const i=Ge(n);(e===void 0||e<i||isNaN(Number(i)))&&(e=i)}),e||new Date(NaN)}function kp(t){let e;return t.forEach(n=>{const i=Ge(n);(!e||e>i||isNaN(+i))&&(e=i)}),e||new Date(NaN)}function Rr(t,e){const n=zs(t),i=zs(e);return+n==+i}function Ml(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Dp(t){if(!Ml(t)&&typeof t!="number")return!1;const e=Ge(t);return!isNaN(Number(e))}function Ti(t,e){const n=Ge(t),i=Ge(e),u=n.getFullYear()-i.getFullYear(),d=n.getMonth()-i.getMonth();return u*12+d}function Pp(t,e,n){const i=Wr(t,n),u=Wr(e,n),d=+i-Ys(i),g=+u-Ys(u);return Math.round((d-g)/Pl)}function Ll(t){const e=Ge(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function kr(t){const e=Ge(t);return e.setDate(1),e.setHours(0,0,0,0),e}function wh(t){const e=Ge(t),n=bt(t,0);return n.setFullYear(e.getFullYear(),0,1),n.setHours(0,0,0,0),n}function Bl(t,e){const n=hs(),i=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,u=Ge(t),d=u.getDay(),g=(d<i?-7:0)+6-(d-i);return u.setDate(u.getDate()+g),u.setHours(23,59,59,999),u}function yh(t){return Bl(t,{weekStartsOn:1})}const Mp={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Lp=(t,e,n)=>{let i;const u=Mp[t];return typeof u=="string"?i=u:e===1?i=u.one:i=u.other.replace("{{count}}",e.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+i:i+" ago":i};function Vs(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const Bp={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Fp={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Up={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Wp={date:Vs({formats:Bp,defaultWidth:"full"}),time:Vs({formats:Fp,defaultWidth:"full"}),dateTime:Vs({formats:Up,defaultWidth:"full"})},Vp={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Hp=(t,e,n,i)=>Vp[t];function hn(t){return(e,n)=>{const i=n?.context?String(n.context):"standalone";let u;if(i==="formatting"&&t.formattingValues){const g=t.defaultFormattingWidth||t.defaultWidth,w=n?.width?String(n.width):g;u=t.formattingValues[w]||t.formattingValues[g]}else{const g=t.defaultWidth,w=n?.width?String(n.width):t.defaultWidth;u=t.values[w]||t.values[g]}const d=t.argumentCallback?t.argumentCallback(e):e;return u[d]}}const Gp={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},qp={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},zp={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Yp={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Xp={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},$p={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Kp=(t,e)=>{const n=Number(t),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Qp={ordinalNumber:Kp,era:hn({values:Gp,defaultWidth:"wide"}),quarter:hn({values:qp,defaultWidth:"wide",argumentCallback:t=>t-1}),month:hn({values:zp,defaultWidth:"wide"}),day:hn({values:Yp,defaultWidth:"wide"}),dayPeriod:hn({values:Xp,defaultWidth:"wide",formattingValues:$p,defaultFormattingWidth:"wide"})};function fn(t){return(e,n={})=>{const i=n.width,u=i&&t.matchPatterns[i]||t.matchPatterns[t.defaultMatchWidth],d=e.match(u);if(!d)return null;const g=d[0],w=i&&t.parsePatterns[i]||t.parsePatterns[t.defaultParseWidth],p=Array.isArray(w)?Jp(w,C=>C.test(g)):Zp(w,C=>C.test(g));let m;m=t.valueCallback?t.valueCallback(p):p,m=n.valueCallback?n.valueCallback(m):m;const b=e.slice(g.length);return{value:m,rest:b}}}function Zp(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function Jp(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function bh(t){return(e,n={})=>{const i=e.match(t.matchPattern);if(!i)return null;const u=i[0],d=e.match(t.parsePattern);if(!d)return null;let g=t.valueCallback?t.valueCallback(d[0]):d[0];g=n.valueCallback?n.valueCallback(g):g;const w=e.slice(u.length);return{value:g,rest:w}}}const ew=/^(\d+)(th|st|nd|rd)?/i,tw=/\d+/i,rw={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},nw={any:[/^b/i,/^(a|c)/i]},sw={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},iw={any:[/1/i,/2/i,/3/i,/4/i]},aw={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ow={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},lw={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},cw={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},uw={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},dw={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},hw={ordinalNumber:bh({matchPattern:ew,parsePattern:tw,valueCallback:t=>parseInt(t,10)}),era:fn({matchPatterns:rw,defaultMatchWidth:"wide",parsePatterns:nw,defaultParseWidth:"any"}),quarter:fn({matchPatterns:sw,defaultMatchWidth:"wide",parsePatterns:iw,defaultParseWidth:"any",valueCallback:t=>t+1}),month:fn({matchPatterns:aw,defaultMatchWidth:"wide",parsePatterns:ow,defaultParseWidth:"any"}),day:fn({matchPatterns:lw,defaultMatchWidth:"wide",parsePatterns:cw,defaultParseWidth:"any"}),dayPeriod:fn({matchPatterns:uw,defaultMatchWidth:"any",parsePatterns:dw,defaultParseWidth:"any"})},Fl={code:"en-US",formatDistance:Lp,formatLong:Wp,formatRelative:Hp,localize:Qp,match:hw,options:{weekStartsOn:0,firstWeekContainsDate:1}};function fw(t){const e=Ge(t);return xn(e,wh(e))+1}function Ul(t){const e=Ge(t),n=+Cn(e)-+Op(e);return Math.round(n/Pl)+1}function Wl(t,e){const n=Ge(t),i=n.getFullYear(),u=hs(),d=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??u.firstWeekContainsDate??u.locale?.options?.firstWeekContainsDate??1,g=bt(t,0);g.setFullYear(i+1,0,d),g.setHours(0,0,0,0);const w=Wr(g,e),p=bt(t,0);p.setFullYear(i,0,d),p.setHours(0,0,0,0);const m=Wr(p,e);return n.getTime()>=w.getTime()?i+1:n.getTime()>=m.getTime()?i:i-1}function gw(t,e){const n=hs(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,u=Wl(t,e),d=bt(t,0);return d.setFullYear(u,0,i),d.setHours(0,0,0,0),Wr(d,e)}function Vl(t,e){const n=Ge(t),i=+Wr(n,e)-+gw(n,e);return Math.round(i/Pl)+1}function dt(t,e){const n=t<0?"-":"",i=Math.abs(t).toString().padStart(e,"0");return n+i}const kn={y(t,e){const n=t.getFullYear(),i=n>0?n:1-n;return dt(e==="yy"?i%100:i,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):dt(n+1,2)},d(t,e){return dt(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return dt(t.getHours()%12||12,e.length)},H(t,e){return dt(t.getHours(),e.length)},m(t,e){return dt(t.getMinutes(),e.length)},s(t,e){return dt(t.getSeconds(),e.length)},S(t,e){const n=e.length,i=t.getMilliseconds(),u=Math.trunc(i*Math.pow(10,n-3));return dt(u,e.length)}},Os={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},pu={G:function(t,e,n){const i=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(i,{width:"abbreviated"});case"GGGGG":return n.era(i,{width:"narrow"});case"GGGG":default:return n.era(i,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const i=t.getFullYear(),u=i>0?i:1-i;return n.ordinalNumber(u,{unit:"year"})}return kn.y(t,e)},Y:function(t,e,n,i){const u=Wl(t,i),d=u>0?u:1-u;if(e==="YY"){const g=d%100;return dt(g,2)}return e==="Yo"?n.ordinalNumber(d,{unit:"year"}):dt(d,e.length)},R:function(t,e){const n=ph(t);return dt(n,e.length)},u:function(t,e){const n=t.getFullYear();return dt(n,e.length)},Q:function(t,e,n){const i=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(i);case"QQ":return dt(i,2);case"Qo":return n.ordinalNumber(i,{unit:"quarter"});case"QQQ":return n.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(i,{width:"wide",context:"formatting"})}},q:function(t,e,n){const i=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(i);case"qq":return dt(i,2);case"qo":return n.ordinalNumber(i,{unit:"quarter"});case"qqq":return n.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(i,{width:"wide",context:"standalone"})}},M:function(t,e,n){const i=t.getMonth();switch(e){case"M":case"MM":return kn.M(t,e);case"Mo":return n.ordinalNumber(i+1,{unit:"month"});case"MMM":return n.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(i,{width:"wide",context:"formatting"})}},L:function(t,e,n){const i=t.getMonth();switch(e){case"L":return String(i+1);case"LL":return dt(i+1,2);case"Lo":return n.ordinalNumber(i+1,{unit:"month"});case"LLL":return n.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(i,{width:"wide",context:"standalone"})}},w:function(t,e,n,i){const u=Vl(t,i);return e==="wo"?n.ordinalNumber(u,{unit:"week"}):dt(u,e.length)},I:function(t,e,n){const i=Ul(t);return e==="Io"?n.ordinalNumber(i,{unit:"week"}):dt(i,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):kn.d(t,e)},D:function(t,e,n){const i=fw(t);return e==="Do"?n.ordinalNumber(i,{unit:"dayOfYear"}):dt(i,e.length)},E:function(t,e,n){const i=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(i,{width:"short",context:"formatting"});case"EEEE":default:return n.day(i,{width:"wide",context:"formatting"})}},e:function(t,e,n,i){const u=t.getDay(),d=(u-i.weekStartsOn+8)%7||7;switch(e){case"e":return String(d);case"ee":return dt(d,2);case"eo":return n.ordinalNumber(d,{unit:"day"});case"eee":return n.day(u,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(u,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(u,{width:"short",context:"formatting"});case"eeee":default:return n.day(u,{width:"wide",context:"formatting"})}},c:function(t,e,n,i){const u=t.getDay(),d=(u-i.weekStartsOn+8)%7||7;switch(e){case"c":return String(d);case"cc":return dt(d,e.length);case"co":return n.ordinalNumber(d,{unit:"day"});case"ccc":return n.day(u,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(u,{width:"narrow",context:"standalone"});case"cccccc":return n.day(u,{width:"short",context:"standalone"});case"cccc":default:return n.day(u,{width:"wide",context:"standalone"})}},i:function(t,e,n){const i=t.getDay(),u=i===0?7:i;switch(e){case"i":return String(u);case"ii":return dt(u,e.length);case"io":return n.ordinalNumber(u,{unit:"day"});case"iii":return n.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(i,{width:"short",context:"formatting"});case"iiii":default:return n.day(i,{width:"wide",context:"formatting"})}},a:function(t,e,n){const u=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(u,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(u,{width:"wide",context:"formatting"})}},b:function(t,e,n){const i=t.getHours();let u;switch(i===12?u=Os.noon:i===0?u=Os.midnight:u=i/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(u,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(u,{width:"wide",context:"formatting"})}},B:function(t,e,n){const i=t.getHours();let u;switch(i>=17?u=Os.evening:i>=12?u=Os.afternoon:i>=4?u=Os.morning:u=Os.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(u,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(u,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let i=t.getHours()%12;return i===0&&(i=12),n.ordinalNumber(i,{unit:"hour"})}return kn.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):kn.H(t,e)},K:function(t,e,n){const i=t.getHours()%12;return e==="Ko"?n.ordinalNumber(i,{unit:"hour"}):dt(i,e.length)},k:function(t,e,n){let i=t.getHours();return i===0&&(i=24),e==="ko"?n.ordinalNumber(i,{unit:"hour"}):dt(i,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):kn.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):kn.s(t,e)},S:function(t,e){return kn.S(t,e)},X:function(t,e,n){const i=t.getTimezoneOffset();if(i===0)return"Z";switch(e){case"X":return yu(i);case"XXXX":case"XX":return Jn(i);case"XXXXX":case"XXX":default:return Jn(i,":")}},x:function(t,e,n){const i=t.getTimezoneOffset();switch(e){case"x":return yu(i);case"xxxx":case"xx":return Jn(i);case"xxxxx":case"xxx":default:return Jn(i,":")}},O:function(t,e,n){const i=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+wu(i,":");case"OOOO":default:return"GMT"+Jn(i,":")}},z:function(t,e,n){const i=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+wu(i,":");case"zzzz":default:return"GMT"+Jn(i,":")}},t:function(t,e,n){const i=Math.trunc(t.getTime()/1e3);return dt(i,e.length)},T:function(t,e,n){const i=t.getTime();return dt(i,e.length)}};function wu(t,e=""){const n=t>0?"-":"+",i=Math.abs(t),u=Math.trunc(i/60),d=i%60;return d===0?n+String(u):n+String(u)+e+dt(d,2)}function yu(t,e){return t%60===0?(t>0?"-":"+")+dt(Math.abs(t)/60,2):Jn(t,e)}function Jn(t,e=""){const n=t>0?"-":"+",i=Math.abs(t),u=dt(Math.trunc(i/60),2),d=dt(i%60,2);return n+u+e+d}const bu=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},vh=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},mw=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],i=n[1],u=n[2];if(!u)return bu(t,e);let d;switch(i){case"P":d=e.dateTime({width:"short"});break;case"PP":d=e.dateTime({width:"medium"});break;case"PPP":d=e.dateTime({width:"long"});break;case"PPPP":default:d=e.dateTime({width:"full"});break}return d.replace("{{date}}",bu(i,e)).replace("{{time}}",vh(u,e))},Jo={p:vh,P:mw},xw=/^D+$/,pw=/^Y+$/,ww=["D","DD","YY","YYYY"];function Ch(t){return xw.test(t)}function _h(t){return pw.test(t)}function el(t,e,n){const i=yw(t,e,n);if(console.warn(i),ww.includes(t))throw new RangeError(i)}function yw(t,e,n){const i=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${i} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const bw=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,vw=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Cw=/^'([^]*?)'?$/,_w=/''/g,Ew=/[a-zA-Z]/;function It(t,e,n){const i=hs(),u=n?.locale??i.locale??Fl,d=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,g=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0,w=Ge(t);if(!Dp(w))throw new RangeError("Invalid time value");let p=e.match(vw).map(b=>{const C=b[0];if(C==="p"||C==="P"){const _=Jo[C];return _(b,u.formatLong)}return b}).join("").match(bw).map(b=>{if(b==="''")return{isToken:!1,value:"'"};const C=b[0];if(C==="'")return{isToken:!1,value:Aw(b)};if(pu[C])return{isToken:!0,value:b};if(C.match(Ew))throw new RangeError("Format string contains an unescaped latin alphabet character `"+C+"`");return{isToken:!1,value:b}});u.localize.preprocessor&&(p=u.localize.preprocessor(w,p));const m={firstWeekContainsDate:d,weekStartsOn:g,locale:u};return p.map(b=>{if(!b.isToken)return b.value;const C=b.value;(!n?.useAdditionalWeekYearTokens&&_h(C)||!n?.useAdditionalDayOfYearTokens&&Ch(C))&&el(C,e,String(t));const _=pu[C[0]];return _(w,C,u.localize,m)}).join("")}function Aw(t){const e=t.match(Cw);return e?e[1].replace(_w,"'"):t}function Nw(t){const e=Ge(t),n=e.getFullYear(),i=e.getMonth(),u=bt(t,0);return u.setFullYear(n,i+1,0),u.setHours(0,0,0,0),u.getDate()}function Sw(){return Object.assign({},hs())}function Iw(t){let n=Ge(t).getDay();return n===0&&(n=7),n}function Tw(t){return Math.trunc(+Ge(t)/1e3)}function Ow(t){const e=Ge(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(0,0,0,0),e}function Rw(t,e){return Pp(Ow(t),kr(t),e)+1}function tl(t,e){const n=Ge(t),i=Ge(e);return n.getTime()>i.getTime()}function Eh(t,e){const n=Ge(t),i=Ge(e);return+n<+i}function jw(t,e){const n=e instanceof Date?bt(e,0):new e(0);return n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),n}const kw=10;class Ah{subPriority=0;validate(e,n){return!0}}class Dw extends Ah{constructor(e,n,i,u,d){super(),this.value=e,this.validateValue=n,this.setValue=i,this.priority=u,d&&(this.subPriority=d)}validate(e,n){return this.validateValue(e,this.value,n)}set(e,n,i){return this.setValue(e,n,this.value,i)}}class Pw extends Ah{priority=kw;subPriority=-1;set(e,n){return n.timestampIsSet?e:bt(e,jw(e,Date))}}class ot{run(e,n,i,u){const d=this.parse(e,n,i,u);return d?{setter:new Dw(d.value,this.validate,this.set,this.priority,this.subPriority),rest:d.rest}:null}validate(e,n,i){return!0}}class Mw extends ot{priority=140;parse(e,n,i){switch(n){case"G":case"GG":case"GGG":return i.era(e,{width:"abbreviated"})||i.era(e,{width:"narrow"});case"GGGGG":return i.era(e,{width:"narrow"});case"GGGG":default:return i.era(e,{width:"wide"})||i.era(e,{width:"abbreviated"})||i.era(e,{width:"narrow"})}}set(e,n,i){return n.era=i,e.setFullYear(i,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["R","u","t","T"]}const Yt={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},gn={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Xt(t,e){return t&&{value:e(t.value),rest:t.rest}}function jt(t,e){const n=e.match(t);return n?{value:parseInt(n[0],10),rest:e.slice(n[0].length)}:null}function mn(t,e){const n=e.match(t);if(!n)return null;if(n[0]==="Z")return{value:0,rest:e.slice(1)};const i=n[1]==="+"?1:-1,u=n[2]?parseInt(n[2],10):0,d=n[3]?parseInt(n[3],10):0,g=n[5]?parseInt(n[5],10):0;return{value:i*(u*Sp+d*Np+g*Ip),rest:e.slice(n[0].length)}}function Nh(t){return jt(Yt.anyDigitsSigned,t)}function Ft(t,e){switch(t){case 1:return jt(Yt.singleDigit,e);case 2:return jt(Yt.twoDigits,e);case 3:return jt(Yt.threeDigits,e);case 4:return jt(Yt.fourDigits,e);default:return jt(new RegExp("^\\d{1,"+t+"}"),e)}}function ga(t,e){switch(t){case 1:return jt(Yt.singleDigitSigned,e);case 2:return jt(Yt.twoDigitsSigned,e);case 3:return jt(Yt.threeDigitsSigned,e);case 4:return jt(Yt.fourDigitsSigned,e);default:return jt(new RegExp("^-?\\d{1,"+t+"}"),e)}}function Hl(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Sh(t,e){const n=e>0,i=n?e:1-e;let u;if(i<=50)u=t||100;else{const d=i+50,g=Math.trunc(d/100)*100,w=t>=d%100;u=t+g-(w?100:0)}return n?u:1-u}function Ih(t){return t%400===0||t%4===0&&t%100!==0}class Lw extends ot{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(e,n,i){const u=d=>({year:d,isTwoDigitYear:n==="yy"});switch(n){case"y":return Xt(Ft(4,e),u);case"yo":return Xt(i.ordinalNumber(e,{unit:"year"}),u);default:return Xt(Ft(n.length,e),u)}}validate(e,n){return n.isTwoDigitYear||n.year>0}set(e,n,i){const u=e.getFullYear();if(i.isTwoDigitYear){const g=Sh(i.year,u);return e.setFullYear(g,0,1),e.setHours(0,0,0,0),e}const d=!("era"in n)||n.era===1?i.year:1-i.year;return e.setFullYear(d,0,1),e.setHours(0,0,0,0),e}}class Bw extends ot{priority=130;parse(e,n,i){const u=d=>({year:d,isTwoDigitYear:n==="YY"});switch(n){case"Y":return Xt(Ft(4,e),u);case"Yo":return Xt(i.ordinalNumber(e,{unit:"year"}),u);default:return Xt(Ft(n.length,e),u)}}validate(e,n){return n.isTwoDigitYear||n.year>0}set(e,n,i,u){const d=Wl(e,u);if(i.isTwoDigitYear){const w=Sh(i.year,d);return e.setFullYear(w,0,u.firstWeekContainsDate),e.setHours(0,0,0,0),Wr(e,u)}const g=!("era"in n)||n.era===1?i.year:1-i.year;return e.setFullYear(g,0,u.firstWeekContainsDate),e.setHours(0,0,0,0),Wr(e,u)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class Fw extends ot{priority=130;parse(e,n){return ga(n==="R"?4:n.length,e)}set(e,n,i){const u=bt(e,0);return u.setFullYear(i,0,4),u.setHours(0,0,0,0),Cn(u)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class Uw extends ot{priority=130;parse(e,n){return ga(n==="u"?4:n.length,e)}set(e,n,i){return e.setFullYear(i,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class Ww extends ot{priority=120;parse(e,n,i){switch(n){case"Q":case"QQ":return Ft(n.length,e);case"Qo":return i.ordinalNumber(e,{unit:"quarter"});case"QQQ":return i.quarter(e,{width:"abbreviated",context:"formatting"})||i.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return i.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(e,{width:"wide",context:"formatting"})||i.quarter(e,{width:"abbreviated",context:"formatting"})||i.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,n){return n>=1&&n<=4}set(e,n,i){return e.setMonth((i-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class Vw extends ot{priority=120;parse(e,n,i){switch(n){case"q":case"qq":return Ft(n.length,e);case"qo":return i.ordinalNumber(e,{unit:"quarter"});case"qqq":return i.quarter(e,{width:"abbreviated",context:"standalone"})||i.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return i.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(e,{width:"wide",context:"standalone"})||i.quarter(e,{width:"abbreviated",context:"standalone"})||i.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,n){return n>=1&&n<=4}set(e,n,i){return e.setMonth((i-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class Hw extends ot{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(e,n,i){const u=d=>d-1;switch(n){case"M":return Xt(jt(Yt.month,e),u);case"MM":return Xt(Ft(2,e),u);case"Mo":return Xt(i.ordinalNumber(e,{unit:"month"}),u);case"MMM":return i.month(e,{width:"abbreviated",context:"formatting"})||i.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return i.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(e,{width:"wide",context:"formatting"})||i.month(e,{width:"abbreviated",context:"formatting"})||i.month(e,{width:"narrow",context:"formatting"})}}validate(e,n){return n>=0&&n<=11}set(e,n,i){return e.setMonth(i,1),e.setHours(0,0,0,0),e}}class Gw extends ot{priority=110;parse(e,n,i){const u=d=>d-1;switch(n){case"L":return Xt(jt(Yt.month,e),u);case"LL":return Xt(Ft(2,e),u);case"Lo":return Xt(i.ordinalNumber(e,{unit:"month"}),u);case"LLL":return i.month(e,{width:"abbreviated",context:"standalone"})||i.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return i.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(e,{width:"wide",context:"standalone"})||i.month(e,{width:"abbreviated",context:"standalone"})||i.month(e,{width:"narrow",context:"standalone"})}}validate(e,n){return n>=0&&n<=11}set(e,n,i){return e.setMonth(i,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function qw(t,e,n){const i=Ge(t),u=Vl(i,n)-e;return i.setDate(i.getDate()-u*7),i}class zw extends ot{priority=100;parse(e,n,i){switch(n){case"w":return jt(Yt.week,e);case"wo":return i.ordinalNumber(e,{unit:"week"});default:return Ft(n.length,e)}}validate(e,n){return n>=1&&n<=53}set(e,n,i,u){return Wr(qw(e,i,u),u)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function Yw(t,e){const n=Ge(t),i=Ul(n)-e;return n.setDate(n.getDate()-i*7),n}class Xw extends ot{priority=100;parse(e,n,i){switch(n){case"I":return jt(Yt.week,e);case"Io":return i.ordinalNumber(e,{unit:"week"});default:return Ft(n.length,e)}}validate(e,n){return n>=1&&n<=53}set(e,n,i){return Cn(Yw(e,i))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const $w=[31,28,31,30,31,30,31,31,30,31,30,31],Kw=[31,29,31,30,31,30,31,31,30,31,30,31];class Qw extends ot{priority=90;subPriority=1;parse(e,n,i){switch(n){case"d":return jt(Yt.date,e);case"do":return i.ordinalNumber(e,{unit:"date"});default:return Ft(n.length,e)}}validate(e,n){const i=e.getFullYear(),u=Ih(i),d=e.getMonth();return u?n>=1&&n<=Kw[d]:n>=1&&n<=$w[d]}set(e,n,i){return e.setDate(i),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class Zw extends ot{priority=90;subpriority=1;parse(e,n,i){switch(n){case"D":case"DD":return jt(Yt.dayOfYear,e);case"Do":return i.ordinalNumber(e,{unit:"date"});default:return Ft(n.length,e)}}validate(e,n){const i=e.getFullYear();return Ih(i)?n>=1&&n<=366:n>=1&&n<=365}set(e,n,i){return e.setMonth(0,i),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function Gl(t,e,n){const i=hs(),u=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0,d=Ge(t),g=d.getDay(),p=(e%7+7)%7,m=7-u,b=e<0||e>6?e-(g+m)%7:(p+m)%7-(g+m)%7;return fr(d,b)}class Jw extends ot{priority=90;parse(e,n,i){switch(n){case"E":case"EE":case"EEE":return i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return i.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return i.day(e,{width:"wide",context:"formatting"})||i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"})}}validate(e,n){return n>=0&&n<=6}set(e,n,i,u){return e=Gl(e,i,u),e.setHours(0,0,0,0),e}incompatibleTokens=["D","i","e","c","t","T"]}class ey extends ot{priority=90;parse(e,n,i,u){const d=g=>{const w=Math.floor((g-1)/7)*7;return(g+u.weekStartsOn+6)%7+w};switch(n){case"e":case"ee":return Xt(Ft(n.length,e),d);case"eo":return Xt(i.ordinalNumber(e,{unit:"day"}),d);case"eee":return i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});case"eeeee":return i.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return i.day(e,{width:"wide",context:"formatting"})||i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"})}}validate(e,n){return n>=0&&n<=6}set(e,n,i,u){return e=Gl(e,i,u),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class ty extends ot{priority=90;parse(e,n,i,u){const d=g=>{const w=Math.floor((g-1)/7)*7;return(g+u.weekStartsOn+6)%7+w};switch(n){case"c":case"cc":return Xt(Ft(n.length,e),d);case"co":return Xt(i.ordinalNumber(e,{unit:"day"}),d);case"ccc":return i.day(e,{width:"abbreviated",context:"standalone"})||i.day(e,{width:"short",context:"standalone"})||i.day(e,{width:"narrow",context:"standalone"});case"ccccc":return i.day(e,{width:"narrow",context:"standalone"});case"cccccc":return i.day(e,{width:"short",context:"standalone"})||i.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return i.day(e,{width:"wide",context:"standalone"})||i.day(e,{width:"abbreviated",context:"standalone"})||i.day(e,{width:"short",context:"standalone"})||i.day(e,{width:"narrow",context:"standalone"})}}validate(e,n){return n>=0&&n<=6}set(e,n,i,u){return e=Gl(e,i,u),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function ry(t,e){const n=Ge(t),i=Iw(n),u=e-i;return fr(n,u)}class ny extends ot{priority=90;parse(e,n,i){const u=d=>d===0?7:d;switch(n){case"i":case"ii":return Ft(n.length,e);case"io":return i.ordinalNumber(e,{unit:"day"});case"iii":return Xt(i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"}),u);case"iiiii":return Xt(i.day(e,{width:"narrow",context:"formatting"}),u);case"iiiiii":return Xt(i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"}),u);case"iiii":default:return Xt(i.day(e,{width:"wide",context:"formatting"})||i.day(e,{width:"abbreviated",context:"formatting"})||i.day(e,{width:"short",context:"formatting"})||i.day(e,{width:"narrow",context:"formatting"}),u)}}validate(e,n){return n>=1&&n<=7}set(e,n,i){return e=ry(e,i),e.setHours(0,0,0,0),e}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class sy extends ot{priority=80;parse(e,n,i){switch(n){case"a":case"aa":case"aaa":return i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return i.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(e,{width:"wide",context:"formatting"})||i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,n,i){return e.setHours(Hl(i),0,0,0),e}incompatibleTokens=["b","B","H","k","t","T"]}class iy extends ot{priority=80;parse(e,n,i){switch(n){case"b":case"bb":case"bbb":return i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return i.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(e,{width:"wide",context:"formatting"})||i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,n,i){return e.setHours(Hl(i),0,0,0),e}incompatibleTokens=["a","B","H","k","t","T"]}class ay extends ot{priority=80;parse(e,n,i){switch(n){case"B":case"BB":case"BBB":return i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return i.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(e,{width:"wide",context:"formatting"})||i.dayPeriod(e,{width:"abbreviated",context:"formatting"})||i.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,n,i){return e.setHours(Hl(i),0,0,0),e}incompatibleTokens=["a","b","t","T"]}class oy extends ot{priority=70;parse(e,n,i){switch(n){case"h":return jt(Yt.hour12h,e);case"ho":return i.ordinalNumber(e,{unit:"hour"});default:return Ft(n.length,e)}}validate(e,n){return n>=1&&n<=12}set(e,n,i){const u=e.getHours()>=12;return u&&i<12?e.setHours(i+12,0,0,0):!u&&i===12?e.setHours(0,0,0,0):e.setHours(i,0,0,0),e}incompatibleTokens=["H","K","k","t","T"]}class ly extends ot{priority=70;parse(e,n,i){switch(n){case"H":return jt(Yt.hour23h,e);case"Ho":return i.ordinalNumber(e,{unit:"hour"});default:return Ft(n.length,e)}}validate(e,n){return n>=0&&n<=23}set(e,n,i){return e.setHours(i,0,0,0),e}incompatibleTokens=["a","b","h","K","k","t","T"]}class cy extends ot{priority=70;parse(e,n,i){switch(n){case"K":return jt(Yt.hour11h,e);case"Ko":return i.ordinalNumber(e,{unit:"hour"});default:return Ft(n.length,e)}}validate(e,n){return n>=0&&n<=11}set(e,n,i){return e.getHours()>=12&&i<12?e.setHours(i+12,0,0,0):e.setHours(i,0,0,0),e}incompatibleTokens=["h","H","k","t","T"]}class uy extends ot{priority=70;parse(e,n,i){switch(n){case"k":return jt(Yt.hour24h,e);case"ko":return i.ordinalNumber(e,{unit:"hour"});default:return Ft(n.length,e)}}validate(e,n){return n>=1&&n<=24}set(e,n,i){const u=i<=24?i%24:i;return e.setHours(u,0,0,0),e}incompatibleTokens=["a","b","h","H","K","t","T"]}class dy extends ot{priority=60;parse(e,n,i){switch(n){case"m":return jt(Yt.minute,e);case"mo":return i.ordinalNumber(e,{unit:"minute"});default:return Ft(n.length,e)}}validate(e,n){return n>=0&&n<=59}set(e,n,i){return e.setMinutes(i,0,0),e}incompatibleTokens=["t","T"]}class hy extends ot{priority=50;parse(e,n,i){switch(n){case"s":return jt(Yt.second,e);case"so":return i.ordinalNumber(e,{unit:"second"});default:return Ft(n.length,e)}}validate(e,n){return n>=0&&n<=59}set(e,n,i){return e.setSeconds(i,0),e}incompatibleTokens=["t","T"]}class fy extends ot{priority=30;parse(e,n){const i=u=>Math.trunc(u*Math.pow(10,-n.length+3));return Xt(Ft(n.length,e),i)}set(e,n,i){return e.setMilliseconds(i),e}incompatibleTokens=["t","T"]}class gy extends ot{priority=10;parse(e,n){switch(n){case"X":return mn(gn.basicOptionalMinutes,e);case"XX":return mn(gn.basic,e);case"XXXX":return mn(gn.basicOptionalSeconds,e);case"XXXXX":return mn(gn.extendedOptionalSeconds,e);case"XXX":default:return mn(gn.extended,e)}}set(e,n,i){return n.timestampIsSet?e:bt(e,e.getTime()-Ys(e)-i)}incompatibleTokens=["t","T","x"]}class my extends ot{priority=10;parse(e,n){switch(n){case"x":return mn(gn.basicOptionalMinutes,e);case"xx":return mn(gn.basic,e);case"xxxx":return mn(gn.basicOptionalSeconds,e);case"xxxxx":return mn(gn.extendedOptionalSeconds,e);case"xxx":default:return mn(gn.extended,e)}}set(e,n,i){return n.timestampIsSet?e:bt(e,e.getTime()-Ys(e)-i)}incompatibleTokens=["t","T","X"]}class xy extends ot{priority=40;parse(e){return Nh(e)}set(e,n,i){return[bt(e,i*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class py extends ot{priority=20;parse(e){return Nh(e)}set(e,n,i){return[bt(e,i),{timestampIsSet:!0}]}incompatibleTokens="*"}const wy={G:new Mw,y:new Lw,Y:new Bw,R:new Fw,u:new Uw,Q:new Ww,q:new Vw,M:new Hw,L:new Gw,w:new zw,I:new Xw,d:new Qw,D:new Zw,E:new Jw,e:new ey,c:new ty,i:new ny,a:new sy,b:new iy,B:new ay,h:new oy,H:new ly,K:new cy,k:new uy,m:new dy,s:new hy,S:new fy,X:new gy,x:new my,t:new xy,T:new py},yy=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,by=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,vy=/^'([^]*?)'?$/,Cy=/''/g,_y=/\S/,Ey=/[a-zA-Z]/;function vu(t,e,n,i){const u=Sw(),d=u.locale??Fl,g=u.firstWeekContainsDate??u.locale?.options?.firstWeekContainsDate??1,w=u.weekStartsOn??u.locale?.options?.weekStartsOn??0,p={firstWeekContainsDate:g,weekStartsOn:w,locale:d},m=[new Pw],b=e.match(by).map(T=>{const k=T[0];if(k in Jo){const M=Jo[k];return M(T,d.formatLong)}return T}).join("").match(yy),C=[];for(let T of b){_h(T)&&el(T,e,t),Ch(T)&&el(T,e,t);const k=T[0],M=wy[k];if(M){const{incompatibleTokens:H}=M;if(Array.isArray(H)){const z=C.find(ae=>H.includes(ae.token)||ae.token===k);if(z)throw new RangeError(`The format string mustn't contain \`${z.fullToken}\` and \`${T}\` at the same time`)}else if(M.incompatibleTokens==="*"&&C.length>0)throw new RangeError(`The format string mustn't contain \`${T}\` and any other token at the same time`);C.push({token:k,fullToken:T});const B=M.run(t,T,d.match,p);if(!B)return bt(n,NaN);m.push(B.setter),t=B.rest}else{if(k.match(Ey))throw new RangeError("Format string contains an unescaped latin alphabet character `"+k+"`");if(T==="''"?T="'":k==="'"&&(T=Ay(T)),t.indexOf(T)===0)t=t.slice(T.length);else return bt(n,NaN)}}if(t.length>0&&_y.test(t))return bt(n,NaN);const _=m.map(T=>T.priority).sort((T,k)=>k-T).filter((T,k,M)=>M.indexOf(T)===k).map(T=>m.filter(k=>k.priority===T).sort((k,M)=>M.subPriority-k.subPriority)).map(T=>T[0]);let N=Ge(n);if(isNaN(N.getTime()))return bt(n,NaN);const I={};for(const T of _){if(!T.validate(N,p))return bt(n,NaN);const k=T.set(N,I,p);Array.isArray(k)?(N=k[0],Object.assign(I,k[1])):N=k}return bt(n,N)}function Ay(t){return t.match(vy)[1].replace(Cy,"'")}function ql(t,e){const n=Ge(t),i=Ge(e);return n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()}function Ny(t,e){const n=Ge(t),i=Ge(e);return n.getFullYear()===i.getFullYear()}function Sy(t,e){const n=+Ge(t),[i,u]=[+Ge(e.start),+Ge(e.end)].sort((d,g)=>d-g);return n>=i&&n<=u}function co(t,e){return fr(t,-e)}function uo(t,e){const n=Ge(t),i=n.getFullYear(),u=n.getDate(),d=bt(t,0);d.setFullYear(i,e,15),d.setHours(0,0,0,0);const g=Nw(d);return n.setMonth(e,Math.min(u,g)),n}function Cu(t,e){const n=Ge(t);return isNaN(+n)?bt(t,NaN):(n.setFullYear(e),n)}const Iy={lessThanXSeconds:{one:"أقل من ثانية",two:"أقل من ثانيتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانيتان",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتان",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريبا",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتان",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومان",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريبا",two:"أسبوعين تقريبا",threeToTen:"{{count}} أسابيع تقريبا",other:"{{count}} أسبوعا تقريبا"},xWeeks:{one:"أسبوع واحد",two:"أسبوعان",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوعا"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريبا",threeToTen:"{{count}} أشهر تقريبا",other:"{{count}} شهرا تقريباً"},xMonths:{one:"شهر واحد",two:"شهران",threeToTen:"{{count}} أشهر",other:"{{count}} شهرا"},aboutXYears:{one:"سنة واحدة تقريباً",two:"سنتين تقريبا",threeToTen:"{{count}} سنوات تقريباً",other:"{{count}} سنة تقريباً"},xYears:{one:"سنة واحد",two:"سنتان",threeToTen:"{{count}} سنوات",other:"{{count}} سنة"},overXYears:{one:"أكثر من سنة",two:"أكثر من سنتين",threeToTen:"أكثر من {{count}} سنوات",other:"أكثر من {{count}} سنة"},almostXYears:{one:"ما يقارب سنة واحدة",two:"ما يقارب سنتين",threeToTen:"ما يقارب {{count}} سنوات",other:"ما يقارب {{count}} سنة"}},Ty=(t,e,n)=>{const i=Iy[t];let u;return typeof i=="string"?u=i:e===1?u=i.one:e===2?u=i.two:e<=10?u=i.threeToTen.replace("{{count}}",String(e)):u=i.other.replace("{{count}}",String(e)),n?.addSuffix?n.comparison&&n.comparison>0?"خلال "+u:"منذ "+u:u},Oy={full:"EEEE، do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},Ry={full:"HH:mm:ss",long:"HH:mm:ss",medium:"HH:mm:ss",short:"HH:mm"},jy={full:"{{date}} 'عند الساعة' {{time}}",long:"{{date}} 'عند الساعة' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ky={date:Vs({formats:Oy,defaultWidth:"full"}),time:Vs({formats:Ry,defaultWidth:"full"}),dateTime:Vs({formats:jy,defaultWidth:"full"})},Dy={lastWeek:"eeee 'الماضي عند الساعة' p",yesterday:"'الأمس عند الساعة' p",today:"'اليوم عند الساعة' p",tomorrow:"'غدا عند الساعة' p",nextWeek:"eeee 'القادم عند الساعة' p",other:"P"},Py=t=>Dy[t],My={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},Ly={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},By={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},Fy={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},Uy={narrow:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"}},Wy={narrow:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"}},Vy=t=>String(t),Hy={ordinalNumber:Vy,era:hn({values:My,defaultWidth:"wide"}),quarter:hn({values:Ly,defaultWidth:"wide",argumentCallback:t=>t-1}),month:hn({values:By,defaultWidth:"wide"}),day:hn({values:Fy,defaultWidth:"wide"}),dayPeriod:hn({values:Uy,defaultWidth:"wide",formattingValues:Wy,defaultFormattingWidth:"wide"})},Gy=/^(\d+)(th|st|nd|rd)?/i,qy=/\d+/i,zy={narrow:/[قب]/,abbreviated:/[قب]\.م\./,wide:/(قبل|بعد) الميلاد/},Yy={any:[/قبل/,/بعد/]},Xy={narrow:/^[1234]/i,abbreviated:/ر[1234]/,wide:/الربع (الأول|الثاني|الثالث|الرابع)/},$y={any:[/1/i,/2/i,/3/i,/4/i]},Ky={narrow:/^[أيفمسند]/,abbreviated:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/,wide:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/},Qy={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^يناير/i,/^فبراير/i,/^مارس/i,/^أبريل/i,/^مايو/i,/^يونيو/i,/^يوليو/i,/^أغسطس/i,/^سبتمبر/i,/^أكتوبر/i,/^نوفمبر/i,/^ديسمبر/i]},Zy={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},Jy={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},e2={narrow:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/,any:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/},t2={any:{am:/^ص/,pm:/^م/,midnight:/منتصف الليل/,noon:/الظهر/,afternoon:/بعد الظهر/,morning:/في الصباح/,evening:/في المساء/,night:/في الليل/}},r2={ordinalNumber:bh({matchPattern:Gy,parsePattern:qy,valueCallback:t=>parseInt(t,10)}),era:fn({matchPatterns:zy,defaultMatchWidth:"wide",parsePatterns:Yy,defaultParseWidth:"any"}),quarter:fn({matchPatterns:Xy,defaultMatchWidth:"wide",parsePatterns:$y,defaultParseWidth:"any",valueCallback:t=>t+1}),month:fn({matchPatterns:Ky,defaultMatchWidth:"wide",parsePatterns:Qy,defaultParseWidth:"any"}),day:fn({matchPatterns:Zy,defaultMatchWidth:"wide",parsePatterns:Jy,defaultParseWidth:"any"}),dayPeriod:fn({matchPatterns:e2,defaultMatchWidth:"any",parsePatterns:t2,defaultParseWidth:"any"})},es={code:"ar",formatDistance:Ty,formatLong:ky,formatRelative:Py,localize:Hy,match:r2,options:{weekStartsOn:6,firstWeekContainsDate:1}};var Le=function(){return Le=Object.assign||function(e){for(var n,i=1,u=arguments.length;i<u;i++){n=arguments[i];for(var d in n)Object.prototype.hasOwnProperty.call(n,d)&&(e[d]=n[d])}return e},Le.apply(this,arguments)};function n2(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,i=Object.getOwnPropertySymbols(t);u<i.length;u++)e.indexOf(i[u])<0&&Object.prototype.propertyIsEnumerable.call(t,i[u])&&(n[i[u]]=t[i[u]]);return n}function Th(t,e,n){for(var i=0,u=e.length,d;i<u;i++)(d||!(i in e))&&(d||(d=Array.prototype.slice.call(e,0,i)),d[i]=e[i]);return t.concat(d||Array.prototype.slice.call(e))}function ki(t){return t.mode==="multiple"}function Di(t){return t.mode==="range"}function Sa(t){return t.mode==="single"}var s2={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function i2(t,e){return It(t,"LLLL y",e)}function a2(t,e){return It(t,"d",e)}function o2(t,e){return It(t,"LLLL",e)}function l2(t){return"".concat(t)}function c2(t,e){return It(t,"cccccc",e)}function u2(t,e){return It(t,"yyyy",e)}var d2=Object.freeze({__proto__:null,formatCaption:i2,formatDay:a2,formatMonthCaption:o2,formatWeekNumber:l2,formatWeekdayName:c2,formatYearCaption:u2}),h2=function(t,e,n){return It(t,"do MMMM (EEEE)",n)},f2=function(){return"Month: "},g2=function(){return"Go to next month"},m2=function(){return"Go to previous month"},x2=function(t,e){return It(t,"cccc",e)},p2=function(t){return"Week n. ".concat(t)},w2=function(){return"Year: "},y2=Object.freeze({__proto__:null,labelDay:h2,labelMonthDropdown:f2,labelNext:g2,labelPrevious:m2,labelWeekNumber:p2,labelWeekday:x2,labelYearDropdown:w2});function b2(){var t="buttons",e=s2,n=Fl,i={},u={},d=1,g={},w=new Date;return{captionLayout:t,classNames:e,formatters:d2,labels:y2,locale:n,modifiersClassNames:i,modifiers:u,numberOfMonths:d,styles:g,today:w,mode:"default"}}function v2(t){var e=t.fromYear,n=t.toYear,i=t.fromMonth,u=t.toMonth,d=t.fromDate,g=t.toDate;return i?d=kr(i):e&&(d=new Date(e,0,1)),u?g=Ll(u):n&&(g=new Date(n,11,31)),{fromDate:d?zs(d):void 0,toDate:g?zs(g):void 0}}var Oh=D.createContext(void 0);function C2(t){var e,n=t.initialProps,i=b2(),u=v2(n),d=u.fromDate,g=u.toDate,w=(e=n.captionLayout)!==null&&e!==void 0?e:i.captionLayout;w!=="buttons"&&(!d||!g)&&(w="buttons");var p;(Sa(n)||ki(n)||Di(n))&&(p=n.onSelect);var m=Le(Le(Le({},i),n),{captionLayout:w,classNames:Le(Le({},i.classNames),n.classNames),components:Le({},n.components),formatters:Le(Le({},i.formatters),n.formatters),fromDate:d,labels:Le(Le({},i.labels),n.labels),mode:n.mode||i.mode,modifiers:Le(Le({},i.modifiers),n.modifiers),modifiersClassNames:Le(Le({},i.modifiersClassNames),n.modifiersClassNames),onSelect:p,styles:Le(Le({},i.styles),n.styles),toDate:g});return l.jsx(Oh.Provider,{value:m,children:t.children})}function Ct(){var t=D.useContext(Oh);if(!t)throw new Error("useDayPicker must be used within a DayPickerProvider.");return t}function Rh(t){var e=Ct(),n=e.locale,i=e.classNames,u=e.styles,d=e.formatters.formatCaption;return l.jsx("div",{className:i.caption_label,style:u.caption_label,"aria-live":"polite",role:"presentation",id:t.id,children:d(t.displayMonth,{locale:n})})}function _2(t){return l.jsx("svg",Le({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},t,{children:l.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function jh(t){var e,n,i=t.onChange,u=t.value,d=t.children,g=t.caption,w=t.className,p=t.style,m=Ct(),b=(n=(e=m.components)===null||e===void 0?void 0:e.IconDropdown)!==null&&n!==void 0?n:_2;return l.jsxs("div",{className:w,style:p,children:[l.jsx("span",{className:m.classNames.vhidden,children:t["aria-label"]}),l.jsx("select",{name:t.name,"aria-label":t["aria-label"],className:m.classNames.dropdown,style:m.styles.dropdown,value:u,onChange:i,children:d}),l.jsxs("div",{className:m.classNames.caption_label,style:m.styles.caption_label,"aria-hidden":"true",children:[g,l.jsx(b,{className:m.classNames.dropdown_icon,style:m.styles.dropdown_icon})]})]})}function E2(t){var e,n=Ct(),i=n.fromDate,u=n.toDate,d=n.styles,g=n.locale,w=n.formatters.formatMonthCaption,p=n.classNames,m=n.components,b=n.labels.labelMonthDropdown;if(!i)return l.jsx(l.Fragment,{});if(!u)return l.jsx(l.Fragment,{});var C=[];if(Ny(i,u))for(var _=kr(i),N=i.getMonth();N<=u.getMonth();N++)C.push(uo(_,N));else for(var _=kr(new Date),N=0;N<=11;N++)C.push(uo(_,N));var I=function(k){var M=Number(k.target.value),H=uo(kr(t.displayMonth),M);t.onChange(H)},T=(e=m?.Dropdown)!==null&&e!==void 0?e:jh;return l.jsx(T,{name:"months","aria-label":b(),className:p.dropdown_month,style:d.dropdown_month,onChange:I,value:t.displayMonth.getMonth(),caption:w(t.displayMonth,{locale:g}),children:C.map(function(k){return l.jsx("option",{value:k.getMonth(),children:w(k,{locale:g})},k.getMonth())})})}function A2(t){var e,n=t.displayMonth,i=Ct(),u=i.fromDate,d=i.toDate,g=i.locale,w=i.styles,p=i.classNames,m=i.components,b=i.formatters.formatYearCaption,C=i.labels.labelYearDropdown,_=[];if(!u)return l.jsx(l.Fragment,{});if(!d)return l.jsx(l.Fragment,{});for(var N=u.getFullYear(),I=d.getFullYear(),T=N;T<=I;T++)_.push(Cu(wh(new Date),T));var k=function(H){var B=Cu(kr(n),Number(H.target.value));t.onChange(B)},M=(e=m?.Dropdown)!==null&&e!==void 0?e:jh;return l.jsx(M,{name:"years","aria-label":C(),className:p.dropdown_year,style:w.dropdown_year,onChange:k,value:n.getFullYear(),caption:b(n,{locale:g}),children:_.map(function(H){return l.jsx("option",{value:H.getFullYear(),children:b(H,{locale:g})},H.getFullYear())})})}function N2(t,e){var n=D.useState(t),i=n[0],u=n[1],d=e===void 0?i:e;return[d,u]}function S2(t){var e=t.month,n=t.defaultMonth,i=t.today,u=e||n||i||new Date,d=t.toDate,g=t.fromDate,w=t.numberOfMonths,p=w===void 0?1:w;if(d&&Ti(d,u)<0){var m=-1*(p-1);u=en(d,m)}return g&&Ti(u,g)<0&&(u=g),kr(u)}function I2(){var t=Ct(),e=S2(t),n=N2(e,t.month),i=n[0],u=n[1],d=function(g){var w;if(!t.disableNavigation){var p=kr(g);u(p),(w=t.onMonthChange)===null||w===void 0||w.call(t,p)}};return[i,d]}function T2(t,e){for(var n=e.reverseMonths,i=e.numberOfMonths,u=kr(t),d=kr(en(u,i)),g=Ti(d,u),w=[],p=0;p<g;p++){var m=en(u,p);w.push(m)}return n&&(w=w.reverse()),w}function O2(t,e){if(!e.disableNavigation){var n=e.toDate,i=e.pagedNavigation,u=e.numberOfMonths,d=u===void 0?1:u,g=i?d:1,w=kr(t);if(!n)return en(w,g);var p=Ti(n,t);if(!(p<d))return en(w,g)}}function R2(t,e){if(!e.disableNavigation){var n=e.fromDate,i=e.pagedNavigation,u=e.numberOfMonths,d=u===void 0?1:u,g=i?d:1,w=kr(t);if(!n)return en(w,-g);var p=Ti(w,n);if(!(p<=0))return en(w,-g)}}var kh=D.createContext(void 0);function j2(t){var e=Ct(),n=I2(),i=n[0],u=n[1],d=T2(i,e),g=O2(i,e),w=R2(i,e),p=function(C){return d.some(function(_){return ql(C,_)})},m=function(C,_){p(C)||(_&&Eh(C,_)?u(en(C,1+e.numberOfMonths*-1)):u(C))},b={currentMonth:i,displayMonths:d,goToMonth:u,goToDate:m,previousMonth:w,nextMonth:g,isDateDisplayed:p};return l.jsx(kh.Provider,{value:b,children:t.children})}function Pi(){var t=D.useContext(kh);if(!t)throw new Error("useNavigation must be used within a NavigationProvider");return t}function _u(t){var e,n=Ct(),i=n.classNames,u=n.styles,d=n.components,g=Pi().goToMonth,w=function(b){g(en(b,t.displayIndex?-t.displayIndex:0))},p=(e=d?.CaptionLabel)!==null&&e!==void 0?e:Rh,m=l.jsx(p,{id:t.id,displayMonth:t.displayMonth});return l.jsxs("div",{className:i.caption_dropdowns,style:u.caption_dropdowns,children:[l.jsx("div",{className:i.vhidden,children:m}),l.jsx(E2,{onChange:w,displayMonth:t.displayMonth}),l.jsx(A2,{onChange:w,displayMonth:t.displayMonth})]})}function k2(t){return l.jsx("svg",Le({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:l.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function D2(t){return l.jsx("svg",Le({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:l.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var ma=D.forwardRef(function(t,e){var n=Ct(),i=n.classNames,u=n.styles,d=[i.button_reset,i.button];t.className&&d.push(t.className);var g=d.join(" "),w=Le(Le({},u.button_reset),u.button);return t.style&&Object.assign(w,t.style),l.jsx("button",Le({},t,{ref:e,type:"button",className:g,style:w}))});function P2(t){var e,n,i=Ct(),u=i.dir,d=i.locale,g=i.classNames,w=i.styles,p=i.labels,m=p.labelPrevious,b=p.labelNext,C=i.components;if(!t.nextMonth&&!t.previousMonth)return l.jsx(l.Fragment,{});var _=m(t.previousMonth,{locale:d}),N=[g.nav_button,g.nav_button_previous].join(" "),I=b(t.nextMonth,{locale:d}),T=[g.nav_button,g.nav_button_next].join(" "),k=(e=C?.IconRight)!==null&&e!==void 0?e:D2,M=(n=C?.IconLeft)!==null&&n!==void 0?n:k2;return l.jsxs("div",{className:g.nav,style:w.nav,children:[!t.hidePrevious&&l.jsx(ma,{name:"previous-month","aria-label":_,className:N,style:w.nav_button_previous,disabled:!t.previousMonth,onClick:t.onPreviousClick,children:u==="rtl"?l.jsx(k,{className:g.nav_icon,style:w.nav_icon}):l.jsx(M,{className:g.nav_icon,style:w.nav_icon})}),!t.hideNext&&l.jsx(ma,{name:"next-month","aria-label":I,className:T,style:w.nav_button_next,disabled:!t.nextMonth,onClick:t.onNextClick,children:u==="rtl"?l.jsx(M,{className:g.nav_icon,style:w.nav_icon}):l.jsx(k,{className:g.nav_icon,style:w.nav_icon})})]})}function Eu(t){var e=Ct().numberOfMonths,n=Pi(),i=n.previousMonth,u=n.nextMonth,d=n.goToMonth,g=n.displayMonths,w=g.findIndex(function(I){return ql(t.displayMonth,I)}),p=w===0,m=w===g.length-1,b=e>1&&(p||!m),C=e>1&&(m||!p),_=function(){i&&d(i)},N=function(){u&&d(u)};return l.jsx(P2,{displayMonth:t.displayMonth,hideNext:b,hidePrevious:C,nextMonth:u,previousMonth:i,onPreviousClick:_,onNextClick:N})}function M2(t){var e,n=Ct(),i=n.classNames,u=n.disableNavigation,d=n.styles,g=n.captionLayout,w=n.components,p=(e=w?.CaptionLabel)!==null&&e!==void 0?e:Rh,m;return u?m=l.jsx(p,{id:t.id,displayMonth:t.displayMonth}):g==="dropdown"?m=l.jsx(_u,{displayMonth:t.displayMonth,id:t.id}):g==="dropdown-buttons"?m=l.jsxs(l.Fragment,{children:[l.jsx(_u,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id}),l.jsx(Eu,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id})]}):m=l.jsxs(l.Fragment,{children:[l.jsx(p,{id:t.id,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),l.jsx(Eu,{displayMonth:t.displayMonth,id:t.id})]}),l.jsx("div",{className:i.caption,style:d.caption,children:m})}function L2(t){var e=Ct(),n=e.footer,i=e.styles,u=e.classNames.tfoot;return n?l.jsx("tfoot",{className:u,style:i.tfoot,children:l.jsx("tr",{children:l.jsx("td",{colSpan:8,children:n})})}):l.jsx(l.Fragment,{})}function B2(t,e,n){for(var i=n?Cn(new Date):Wr(new Date,{locale:t,weekStartsOn:e}),u=[],d=0;d<7;d++){var g=fr(i,d);u.push(g)}return u}function F2(){var t=Ct(),e=t.classNames,n=t.styles,i=t.showWeekNumber,u=t.locale,d=t.weekStartsOn,g=t.ISOWeek,w=t.formatters.formatWeekdayName,p=t.labels.labelWeekday,m=B2(u,d,g);return l.jsxs("tr",{style:n.head_row,className:e.head_row,children:[i&&l.jsx("td",{style:n.head_cell,className:e.head_cell}),m.map(function(b,C){return l.jsx("th",{scope:"col",className:e.head_cell,style:n.head_cell,"aria-label":p(b,{locale:u}),children:w(b,{locale:u})},C)})]})}function U2(){var t,e=Ct(),n=e.classNames,i=e.styles,u=e.components,d=(t=u?.HeadRow)!==null&&t!==void 0?t:F2;return l.jsx("thead",{style:i.head,className:n.head,children:l.jsx(d,{})})}function W2(t){var e=Ct(),n=e.locale,i=e.formatters.formatDay;return l.jsx(l.Fragment,{children:i(t.date,{locale:n})})}var zl=D.createContext(void 0);function V2(t){if(!ki(t.initialProps)){var e={selected:void 0,modifiers:{disabled:[]}};return l.jsx(zl.Provider,{value:e,children:t.children})}return l.jsx(H2,{initialProps:t.initialProps,children:t.children})}function H2(t){var e=t.initialProps,n=t.children,i=e.selected,u=e.min,d=e.max,g=function(m,b,C){var _,N;(_=e.onDayClick)===null||_===void 0||_.call(e,m,b,C);var I=!!(b.selected&&u&&i?.length===u);if(!I){var T=!!(!b.selected&&d&&i?.length===d);if(!T){var k=i?Th([],i):[];if(b.selected){var M=k.findIndex(function(H){return Rr(m,H)});k.splice(M,1)}else k.push(m);(N=e.onSelect)===null||N===void 0||N.call(e,k,m,b,C)}}},w={disabled:[]};i&&w.disabled.push(function(m){var b=d&&i.length>d-1,C=i.some(function(_){return Rr(_,m)});return!!(b&&!C)});var p={selected:i,onDayClick:g,modifiers:w};return l.jsx(zl.Provider,{value:p,children:n})}function Yl(){var t=D.useContext(zl);if(!t)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return t}function G2(t,e){var n=e||{},i=n.from,u=n.to;return i&&u?Rr(u,t)&&Rr(i,t)?void 0:Rr(u,t)?{from:u,to:void 0}:Rr(i,t)?void 0:tl(i,t)?{from:t,to:u}:{from:i,to:t}:u?tl(t,u)?{from:u,to:t}:{from:t,to:u}:i?Eh(t,i)?{from:t,to:i}:{from:i,to:t}:{from:t,to:void 0}}var Xl=D.createContext(void 0);function q2(t){if(!Di(t.initialProps)){var e={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return l.jsx(Xl.Provider,{value:e,children:t.children})}return l.jsx(z2,{initialProps:t.initialProps,children:t.children})}function z2(t){var e=t.initialProps,n=t.children,i=e.selected,u=i||{},d=u.from,g=u.to,w=e.min,p=e.max,m=function(N,I,T){var k,M;(k=e.onDayClick)===null||k===void 0||k.call(e,N,I,T);var H=G2(N,i);(M=e.onSelect)===null||M===void 0||M.call(e,H,N,I,T)},b={range_start:[],range_end:[],range_middle:[],disabled:[]};if(d?(b.range_start=[d],g?(b.range_end=[g],Rr(d,g)||(b.range_middle=[{after:d,before:g}])):b.range_end=[d]):g&&(b.range_start=[g],b.range_end=[g]),w&&(d&&!g&&b.disabled.push({after:co(d,w-1),before:fr(d,w-1)}),d&&g&&b.disabled.push({after:d,before:fr(d,w-1)}),!d&&g&&b.disabled.push({after:co(g,w-1),before:fr(g,w-1)})),p){if(d&&!g&&(b.disabled.push({before:fr(d,-p+1)}),b.disabled.push({after:fr(d,p-1)})),d&&g){var C=xn(g,d)+1,_=p-C;b.disabled.push({before:co(d,_)}),b.disabled.push({after:fr(g,_)})}!d&&g&&(b.disabled.push({before:fr(g,-p+1)}),b.disabled.push({after:fr(g,p-1)}))}return l.jsx(Xl.Provider,{value:{selected:i,onDayClick:m,modifiers:b},children:n})}function $l(){var t=D.useContext(Xl);if(!t)throw new Error("useSelectRange must be used within a SelectRangeProvider");return t}function sa(t){return Array.isArray(t)?Th([],t):t!==void 0?[t]:[]}function Y2(t){var e={};return Object.entries(t).forEach(function(n){var i=n[0],u=n[1];e[i]=sa(u)}),e}var tn;(function(t){t.Outside="outside",t.Disabled="disabled",t.Selected="selected",t.Hidden="hidden",t.Today="today",t.RangeStart="range_start",t.RangeEnd="range_end",t.RangeMiddle="range_middle"})(tn||(tn={}));var X2=tn.Selected,wn=tn.Disabled,$2=tn.Hidden,K2=tn.Today,ho=tn.RangeEnd,fo=tn.RangeMiddle,go=tn.RangeStart,Q2=tn.Outside;function Z2(t,e,n){var i,u=(i={},i[X2]=sa(t.selected),i[wn]=sa(t.disabled),i[$2]=sa(t.hidden),i[K2]=[t.today],i[ho]=[],i[fo]=[],i[go]=[],i[Q2]=[],i);return t.fromDate&&u[wn].push({before:t.fromDate}),t.toDate&&u[wn].push({after:t.toDate}),ki(t)?u[wn]=u[wn].concat(e.modifiers[wn]):Di(t)&&(u[wn]=u[wn].concat(n.modifiers[wn]),u[go]=n.modifiers[go],u[fo]=n.modifiers[fo],u[ho]=n.modifiers[ho]),u}var Dh=D.createContext(void 0);function J2(t){var e=Ct(),n=Yl(),i=$l(),u=Z2(e,n,i),d=Y2(e.modifiers),g=Le(Le({},u),d);return l.jsx(Dh.Provider,{value:g,children:t.children})}function Ph(){var t=D.useContext(Dh);if(!t)throw new Error("useModifiers must be used within a ModifiersProvider");return t}function eb(t){return!!(t&&typeof t=="object"&&"before"in t&&"after"in t)}function tb(t){return!!(t&&typeof t=="object"&&"from"in t)}function rb(t){return!!(t&&typeof t=="object"&&"after"in t)}function nb(t){return!!(t&&typeof t=="object"&&"before"in t)}function sb(t){return!!(t&&typeof t=="object"&&"dayOfWeek"in t)}function ib(t,e){var n,i=e.from,u=e.to;if(i&&u){var d=xn(u,i)<0;d&&(n=[u,i],i=n[0],u=n[1]);var g=xn(t,i)>=0&&xn(u,t)>=0;return g}return u?Rr(u,t):i?Rr(i,t):!1}function ab(t){return Ml(t)}function ob(t){return Array.isArray(t)&&t.every(Ml)}function lb(t,e){return e.some(function(n){if(typeof n=="boolean")return n;if(ab(n))return Rr(t,n);if(ob(n))return n.includes(t);if(tb(n))return ib(t,n);if(sb(n))return n.dayOfWeek.includes(t.getDay());if(eb(n)){var i=xn(n.before,t),u=xn(n.after,t),d=i>0,g=u<0,w=tl(n.before,n.after);return w?g&&d:d||g}return rb(n)?xn(t,n.after)>0:nb(n)?xn(n.before,t)>0:typeof n=="function"?n(t):!1})}function Kl(t,e,n){var i=Object.keys(e).reduce(function(d,g){var w=e[g];return lb(t,w)&&d.push(g),d},[]),u={};return i.forEach(function(d){return u[d]=!0}),n&&!ql(t,n)&&(u.outside=!0),u}function cb(t,e){for(var n=kr(t[0]),i=Ll(t[t.length-1]),u,d,g=n;g<=i;){var w=Kl(g,e),p=!w.disabled&&!w.hidden;if(!p){g=fr(g,1);continue}if(w.selected)return g;w.today&&!d&&(d=g),u||(u=g),g=fr(g,1)}return d||u}var ub=365;function Mh(t,e){var n=e.moveBy,i=e.direction,u=e.context,d=e.modifiers,g=e.retry,w=g===void 0?{count:0,lastFocused:t}:g,p=u.weekStartsOn,m=u.fromDate,b=u.toDate,C=u.locale,_={day:fr,week:Zo,month:en,year:Rp,startOfWeek:function(k){return u.ISOWeek?Cn(k):Wr(k,{locale:C,weekStartsOn:p})},endOfWeek:function(k){return u.ISOWeek?yh(k):Bl(k,{locale:C,weekStartsOn:p})}},N=_[n](t,i==="after"?1:-1);i==="before"&&m?N=jp([m,N]):i==="after"&&b&&(N=kp([b,N]));var I=!0;if(d){var T=Kl(N,d);I=!T.disabled&&!T.hidden}return I?N:w.count>ub?w.lastFocused:Mh(N,{moveBy:n,direction:i,context:u,modifiers:d,retry:Le(Le({},w),{count:w.count+1})})}var Lh=D.createContext(void 0);function db(t){var e=Pi(),n=Ph(),i=D.useState(),u=i[0],d=i[1],g=D.useState(),w=g[0],p=g[1],m=cb(e.displayMonths,n),b=u??(w&&e.isDateDisplayed(w))?w:m,C=function(){p(u),d(void 0)},_=function(k){d(k)},N=Ct(),I=function(k,M){if(u){var H=Mh(u,{moveBy:k,direction:M,context:N,modifiers:n});Rr(u,H)||(e.goToDate(H,u),_(H))}},T={focusedDay:u,focusTarget:b,blur:C,focus:_,focusDayAfter:function(){return I("day","after")},focusDayBefore:function(){return I("day","before")},focusWeekAfter:function(){return I("week","after")},focusWeekBefore:function(){return I("week","before")},focusMonthBefore:function(){return I("month","before")},focusMonthAfter:function(){return I("month","after")},focusYearBefore:function(){return I("year","before")},focusYearAfter:function(){return I("year","after")},focusStartOfWeek:function(){return I("startOfWeek","before")},focusEndOfWeek:function(){return I("endOfWeek","after")}};return l.jsx(Lh.Provider,{value:T,children:t.children})}function Ql(){var t=D.useContext(Lh);if(!t)throw new Error("useFocusContext must be used within a FocusProvider");return t}function hb(t,e){var n=Ph(),i=Kl(t,n,e);return i}var Zl=D.createContext(void 0);function fb(t){if(!Sa(t.initialProps)){var e={selected:void 0};return l.jsx(Zl.Provider,{value:e,children:t.children})}return l.jsx(gb,{initialProps:t.initialProps,children:t.children})}function gb(t){var e=t.initialProps,n=t.children,i=function(d,g,w){var p,m,b;if((p=e.onDayClick)===null||p===void 0||p.call(e,d,g,w),g.selected&&!e.required){(m=e.onSelect)===null||m===void 0||m.call(e,void 0,d,g,w);return}(b=e.onSelect)===null||b===void 0||b.call(e,d,d,g,w)},u={selected:e.selected,onDayClick:i};return l.jsx(Zl.Provider,{value:u,children:n})}function Bh(){var t=D.useContext(Zl);if(!t)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return t}function mb(t,e){var n=Ct(),i=Bh(),u=Yl(),d=$l(),g=Ql(),w=g.focusDayAfter,p=g.focusDayBefore,m=g.focusWeekAfter,b=g.focusWeekBefore,C=g.blur,_=g.focus,N=g.focusMonthBefore,I=g.focusMonthAfter,T=g.focusYearBefore,k=g.focusYearAfter,M=g.focusStartOfWeek,H=g.focusEndOfWeek,B=function(Y){var Q,Fe,qe,lt;Sa(n)?(Q=i.onDayClick)===null||Q===void 0||Q.call(i,t,e,Y):ki(n)?(Fe=u.onDayClick)===null||Fe===void 0||Fe.call(u,t,e,Y):Di(n)?(qe=d.onDayClick)===null||qe===void 0||qe.call(d,t,e,Y):(lt=n.onDayClick)===null||lt===void 0||lt.call(n,t,e,Y)},z=function(Y){var Q;_(t),(Q=n.onDayFocus)===null||Q===void 0||Q.call(n,t,e,Y)},ae=function(Y){var Q;C(),(Q=n.onDayBlur)===null||Q===void 0||Q.call(n,t,e,Y)},V=function(Y){var Q;(Q=n.onDayMouseEnter)===null||Q===void 0||Q.call(n,t,e,Y)},G=function(Y){var Q;(Q=n.onDayMouseLeave)===null||Q===void 0||Q.call(n,t,e,Y)},P=function(Y){var Q;(Q=n.onDayPointerEnter)===null||Q===void 0||Q.call(n,t,e,Y)},O=function(Y){var Q;(Q=n.onDayPointerLeave)===null||Q===void 0||Q.call(n,t,e,Y)},ne=function(Y){var Q;(Q=n.onDayTouchCancel)===null||Q===void 0||Q.call(n,t,e,Y)},oe=function(Y){var Q;(Q=n.onDayTouchEnd)===null||Q===void 0||Q.call(n,t,e,Y)},ue=function(Y){var Q;(Q=n.onDayTouchMove)===null||Q===void 0||Q.call(n,t,e,Y)},te=function(Y){var Q;(Q=n.onDayTouchStart)===null||Q===void 0||Q.call(n,t,e,Y)},ge=function(Y){var Q;(Q=n.onDayKeyUp)===null||Q===void 0||Q.call(n,t,e,Y)},q=function(Y){var Q;switch(Y.key){case"ArrowLeft":Y.preventDefault(),Y.stopPropagation(),n.dir==="rtl"?w():p();break;case"ArrowRight":Y.preventDefault(),Y.stopPropagation(),n.dir==="rtl"?p():w();break;case"ArrowDown":Y.preventDefault(),Y.stopPropagation(),m();break;case"ArrowUp":Y.preventDefault(),Y.stopPropagation(),b();break;case"PageUp":Y.preventDefault(),Y.stopPropagation(),Y.shiftKey?T():N();break;case"PageDown":Y.preventDefault(),Y.stopPropagation(),Y.shiftKey?k():I();break;case"Home":Y.preventDefault(),Y.stopPropagation(),M();break;case"End":Y.preventDefault(),Y.stopPropagation(),H();break}(Q=n.onDayKeyDown)===null||Q===void 0||Q.call(n,t,e,Y)},Z={onClick:B,onFocus:z,onBlur:ae,onKeyDown:q,onKeyUp:ge,onMouseEnter:V,onMouseLeave:G,onPointerEnter:P,onPointerLeave:O,onTouchCancel:ne,onTouchEnd:oe,onTouchMove:ue,onTouchStart:te};return Z}function xb(){var t=Ct(),e=Bh(),n=Yl(),i=$l(),u=Sa(t)?e.selected:ki(t)?n.selected:Di(t)?i.selected:void 0;return u}function pb(t){return Object.values(tn).includes(t)}function wb(t,e){var n=[t.classNames.day];return Object.keys(e).forEach(function(i){var u=t.modifiersClassNames[i];if(u)n.push(u);else if(pb(i)){var d=t.classNames["day_".concat(i)];d&&n.push(d)}}),n}function yb(t,e){var n=Le({},t.styles.day);return Object.keys(e).forEach(function(i){var u;n=Le(Le({},n),(u=t.modifiersStyles)===null||u===void 0?void 0:u[i])}),n}function bb(t,e,n){var i,u,d,g=Ct(),w=Ql(),p=hb(t,e),m=mb(t,p),b=xb(),C=!!(g.onDayClick||g.mode!=="default");D.useEffect(function(){var V;p.outside||w.focusedDay&&C&&Rr(w.focusedDay,t)&&((V=n.current)===null||V===void 0||V.focus())},[w.focusedDay,t,n,C,p.outside]);var _=wb(g,p).join(" "),N=yb(g,p),I=!!(p.outside&&!g.showOutsideDays||p.hidden),T=(d=(u=g.components)===null||u===void 0?void 0:u.DayContent)!==null&&d!==void 0?d:W2,k=l.jsx(T,{date:t,displayMonth:e,activeModifiers:p}),M={style:N,className:_,children:k,role:"gridcell"},H=w.focusTarget&&Rr(w.focusTarget,t)&&!p.outside,B=w.focusedDay&&Rr(w.focusedDay,t),z=Le(Le(Le({},M),(i={disabled:p.disabled,role:"gridcell"},i["aria-selected"]=p.selected,i.tabIndex=B||H?0:-1,i)),m),ae={isButton:C,isHidden:I,activeModifiers:p,selectedDays:b,buttonProps:z,divProps:M};return ae}function vb(t){var e=D.useRef(null),n=bb(t.date,t.displayMonth,e);return n.isHidden?l.jsx("div",{role:"gridcell"}):n.isButton?l.jsx(ma,Le({name:"day",ref:e},n.buttonProps)):l.jsx("div",Le({},n.divProps))}function Cb(t){var e=t.number,n=t.dates,i=Ct(),u=i.onWeekNumberClick,d=i.styles,g=i.classNames,w=i.locale,p=i.labels.labelWeekNumber,m=i.formatters.formatWeekNumber,b=m(Number(e),{locale:w});if(!u)return l.jsx("span",{className:g.weeknumber,style:d.weeknumber,children:b});var C=p(Number(e),{locale:w}),_=function(N){u(e,n,N)};return l.jsx(ma,{name:"week-number","aria-label":C,className:g.weeknumber,style:d.weeknumber,onClick:_,children:b})}function _b(t){var e,n,i=Ct(),u=i.styles,d=i.classNames,g=i.showWeekNumber,w=i.components,p=(e=w?.Day)!==null&&e!==void 0?e:vb,m=(n=w?.WeekNumber)!==null&&n!==void 0?n:Cb,b;return g&&(b=l.jsx("td",{className:d.cell,style:u.cell,children:l.jsx(m,{number:t.weekNumber,dates:t.dates})})),l.jsxs("tr",{className:d.row,style:u.row,children:[b,t.dates.map(function(C){return l.jsx("td",{className:d.cell,style:u.cell,role:"presentation",children:l.jsx(p,{displayMonth:t.displayMonth,date:C})},Tw(C))})]})}function Au(t,e,n){for(var i=n?.ISOWeek?yh(e):Bl(e,n),u=n?.ISOWeek?Cn(t):Wr(t,n),d=xn(i,u),g=[],w=0;w<=d;w++)g.push(fr(u,w));var p=g.reduce(function(m,b){var C=n?.ISOWeek?Ul(b):Vl(b,n),_=m.find(function(N){return N.weekNumber===C});return _?(_.dates.push(b),m):(m.push({weekNumber:C,dates:[b]}),m)},[]);return p}function Eb(t,e){var n=Au(kr(t),Ll(t),e);if(e?.useFixedWeeks){var i=Rw(t,e);if(i<6){var u=n[n.length-1],d=u.dates[u.dates.length-1],g=Zo(d,6-i),w=Au(Zo(d,1),g,e);n.push.apply(n,w)}}return n}function Ab(t){var e,n,i,u=Ct(),d=u.locale,g=u.classNames,w=u.styles,p=u.hideHead,m=u.fixedWeeks,b=u.components,C=u.weekStartsOn,_=u.firstWeekContainsDate,N=u.ISOWeek,I=Eb(t.displayMonth,{useFixedWeeks:!!m,ISOWeek:N,locale:d,weekStartsOn:C,firstWeekContainsDate:_}),T=(e=b?.Head)!==null&&e!==void 0?e:U2,k=(n=b?.Row)!==null&&n!==void 0?n:_b,M=(i=b?.Footer)!==null&&i!==void 0?i:L2;return l.jsxs("table",{id:t.id,className:g.table,style:w.table,role:"grid","aria-labelledby":t["aria-labelledby"],children:[!p&&l.jsx(T,{}),l.jsx("tbody",{className:g.tbody,style:w.tbody,children:I.map(function(H){return l.jsx(k,{displayMonth:t.displayMonth,dates:H.dates,weekNumber:H.weekNumber},H.weekNumber)})}),l.jsx(M,{displayMonth:t.displayMonth})]})}function Nb(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Sb=Nb()?D.useLayoutEffect:D.useEffect,mo=!1,Ib=0;function Nu(){return"react-day-picker-".concat(++Ib)}function Tb(t){var e,n=t??(mo?Nu():null),i=D.useState(n),u=i[0],d=i[1];return Sb(function(){u===null&&d(Nu())},[]),D.useEffect(function(){mo===!1&&(mo=!0)},[]),(e=t??u)!==null&&e!==void 0?e:void 0}function Ob(t){var e,n,i=Ct(),u=i.dir,d=i.classNames,g=i.styles,w=i.components,p=Pi().displayMonths,m=Tb(i.id?"".concat(i.id,"-").concat(t.displayIndex):void 0),b=i.id?"".concat(i.id,"-grid-").concat(t.displayIndex):void 0,C=[d.month],_=g.month,N=t.displayIndex===0,I=t.displayIndex===p.length-1,T=!N&&!I;u==="rtl"&&(e=[N,I],I=e[0],N=e[1]),N&&(C.push(d.caption_start),_=Le(Le({},_),g.caption_start)),I&&(C.push(d.caption_end),_=Le(Le({},_),g.caption_end)),T&&(C.push(d.caption_between),_=Le(Le({},_),g.caption_between));var k=(n=w?.Caption)!==null&&n!==void 0?n:M2;return l.jsxs("div",{className:C.join(" "),style:_,children:[l.jsx(k,{id:m,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),l.jsx(Ab,{id:b,"aria-labelledby":m,displayMonth:t.displayMonth})]},t.displayIndex)}function Rb(t){var e=Ct(),n=e.classNames,i=e.styles;return l.jsx("div",{className:n.months,style:i.months,children:t.children})}function jb(t){var e,n,i=t.initialProps,u=Ct(),d=Ql(),g=Pi(),w=D.useState(!1),p=w[0],m=w[1];D.useEffect(function(){u.initialFocus&&d.focusTarget&&(p||(d.focus(d.focusTarget),m(!0)))},[u.initialFocus,p,d.focus,d.focusTarget,d]);var b=[u.classNames.root,u.className];u.numberOfMonths>1&&b.push(u.classNames.multiple_months),u.showWeekNumber&&b.push(u.classNames.with_weeknumber);var C=Le(Le({},u.styles.root),u.style),_=Object.keys(i).filter(function(I){return I.startsWith("data-")}).reduce(function(I,T){var k;return Le(Le({},I),(k={},k[T]=i[T],k))},{}),N=(n=(e=i.components)===null||e===void 0?void 0:e.Months)!==null&&n!==void 0?n:Rb;return l.jsx("div",Le({className:b.join(" "),style:C,dir:u.dir,id:u.id,nonce:i.nonce,title:i.title,lang:i.lang},_,{children:l.jsx(N,{children:g.displayMonths.map(function(I,T){return l.jsx(Ob,{displayIndex:T,displayMonth:I},T)})})}))}function kb(t){var e=t.children,n=n2(t,["children"]);return l.jsx(C2,{initialProps:n,children:l.jsx(j2,{children:l.jsx(fb,{initialProps:n,children:l.jsx(V2,{initialProps:n,children:l.jsx(q2,{initialProps:n,children:l.jsx(J2,{children:l.jsx(db,{children:e})})})})})})})}function Db(t){return l.jsx(kb,Le({},t,{children:l.jsx(jb,{initialProps:t})}))}function Su({className:t,classNames:e,showOutsideDays:n=!0,...i}){return l.jsx(Db,{showOutsideDays:n,className:Ce("p-3",t),classNames:{months:"flex flex-col sm:flex-row gap-2",month:"flex flex-col gap-4",caption:"flex justify-center pt-1 relative items-center w-full",caption_label:"text-sm font-medium",nav:"flex items-center gap-1",nav_button:Ce(qs({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-x-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:Ce("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md",i.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:Ce(qs({variant:"ghost"}),"size-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",day_range_end:"day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...e},components:{IconLeft:({className:u,...d})=>l.jsx(od,{className:Ce("size-4",u),...d}),IconRight:({className:u,...d})=>l.jsx(ld,{className:Ce("size-4",u),...d})},...i})}function rl({...t}){return l.jsx(i0,{"data-slot":"popover",...t})}function nl({...t}){return l.jsx(a0,{"data-slot":"popover-trigger",...t})}function sl({className:t,align:e="center",sideOffset:n=4,...i}){return l.jsx(o0,{children:l.jsx(l0,{"data-slot":"popover-content",align:e,sideOffset:n,className:Ce("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...i})})}var Pb=Symbol("radix.slottable");function Mb(t){const e=({children:n})=>l.jsx(l.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=Pb,e}var Fh="AlertDialog",[Lb]=u0(Fh,[Zu]),En=Zu(),Uh=t=>{const{__scopeAlertDialog:e,...n}=t,i=En(e);return l.jsx(ul,{...i,...n,modal:!0})};Uh.displayName=Fh;var Bb="AlertDialogTrigger",Wh=D.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...i}=t,u=En(n);return l.jsx(Qu,{...u,...i,ref:e})});Wh.displayName=Bb;var Fb="AlertDialogPortal",Vh=t=>{const{__scopeAlertDialog:e,...n}=t,i=En(e);return l.jsx(fl,{...i,...n})};Vh.displayName=Fb;var Ub="AlertDialogOverlay",Hh=D.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...i}=t,u=En(n);return l.jsx(cl,{...u,...i,ref:e})});Hh.displayName=Ub;var Hs="AlertDialogContent",[Wb,Vb]=Lb(Hs),Hb=Mb("AlertDialogContent"),Gh=D.forwardRef((t,e)=>{const{__scopeAlertDialog:n,children:i,...u}=t,d=En(n),g=D.useRef(null),w=Ju(e,g),p=D.useRef(null);return l.jsx(c0,{contentName:Hs,titleName:qh,docsSlug:"alert-dialog",children:l.jsx(Wb,{scope:n,cancelRef:p,children:l.jsxs(dl,{role:"alertdialog",...d,...u,ref:w,onOpenAutoFocus:d0(u.onOpenAutoFocus,m=>{m.preventDefault(),p.current?.focus({preventScroll:!0})}),onPointerDownOutside:m=>m.preventDefault(),onInteractOutside:m=>m.preventDefault(),children:[l.jsx(Hb,{children:i}),l.jsx(qb,{contentRef:g})]})})})});Gh.displayName=Hs;var qh="AlertDialogTitle",zh=D.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...i}=t,u=En(n);return l.jsx($u,{...u,...i,ref:e})});zh.displayName=qh;var Yh="AlertDialogDescription",Xh=D.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...i}=t,u=En(n);return l.jsx(Ku,{...u,...i,ref:e})});Xh.displayName=Yh;var Gb="AlertDialogAction",$h=D.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...i}=t,u=En(n);return l.jsx(hl,{...u,...i,ref:e})});$h.displayName=Gb;var Kh="AlertDialogCancel",Qh=D.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...i}=t,{cancelRef:u}=Vb(Kh,n),d=En(n),g=Ju(e,u);return l.jsx(hl,{...d,...i,ref:g})});Qh.displayName=Kh;var qb=({contentRef:t})=>{const e=`\`${Hs}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Hs}\` by passing a \`${Yh}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Hs}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return D.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(e)},[e,t]),null},zb=Uh,Yb=Wh,Xb=Vh,$b=Hh,Kb=Gh,Qb=$h,Zb=Qh,Jb=zh,ev=Xh;function xo({...t}){return l.jsx(zb,{"data-slot":"alert-dialog",...t})}function po({...t}){return l.jsx(Yb,{"data-slot":"alert-dialog-trigger",...t})}function tv({...t}){return l.jsx(Xb,{"data-slot":"alert-dialog-portal",...t})}function rv({className:t,...e}){return l.jsx($b,{"data-slot":"alert-dialog-overlay",className:Ce("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...e})}function wo({className:t,...e}){return l.jsxs(tv,{children:[l.jsx(rv,{}),l.jsx(Kb,{"data-slot":"alert-dialog-content",className:Ce("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...e})]})}function yo({className:t,...e}){return l.jsx("div",{"data-slot":"alert-dialog-header",className:Ce("flex flex-col gap-2 text-center sm:text-left",t),...e})}function bo({className:t,...e}){return l.jsx("div",{"data-slot":"alert-dialog-footer",className:Ce("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...e})}function vo({className:t,...e}){return l.jsx(Jb,{"data-slot":"alert-dialog-title",className:Ce("text-lg font-semibold",t),...e})}function Co({className:t,...e}){return l.jsx(ev,{"data-slot":"alert-dialog-description",className:Ce("text-muted-foreground text-sm",t),...e})}function _o({className:t,...e}){return l.jsx(Qb,{className:Ce(qs(),t),...e})}function Eo({className:t,...e}){return l.jsx(Zb,{className:Ce(qs({variant:"outline"}),t),...e})}const hi={async getAll(){const{data:t,error:e}=await ze.from("payments").select(`
        *,
        students (
          name,
          class_id
        )
      `).order("created_at",{ascending:!1});if(e)throw e;return t},async getByStudentId(t){const{data:e,error:n}=await ze.from("payments").select("*").eq("student_id",t).order("created_at",{ascending:!1});if(n)throw n;return e},async create(t){const{data:e,error:n}=await ze.from("payments").insert([t]).select().single();if(n)throw n;return e},async update(t,e){const{data:n,error:i}=await ze.from("payments").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return n},async delete(t){const{error:e}=await ze.from("payments").delete().eq("id",t);if(e)throw e},async getStats(){const{data:t,error:e}=await ze.from("payments").select("amount, status");if(e)throw e;const n=t.reduce((d,g)=>d+Number(g.amount),0),i=t.filter(d=>d.status==="paid").reduce((d,g)=>d+Number(g.amount),0),u=t.filter(d=>d.status==="unpaid").reduce((d,g)=>d+Number(g.amount),0);return{totalAmount:n,collectedAmount:i,pendingAmount:u,collectionRate:n>0?i/n*100:0}}},nv=()=>{const t=Vn(),e=os({queryKey:["payments"],queryFn:()=>hi.getAll(),staleTime:1e3*60*5}),n=os({queryKey:["payments-stats"],queryFn:()=>hi.getStats(),staleTime:1e3*60*5}),i=jr({mutationFn:g=>hi.create(g),onSuccess:()=>{xe.success("تم إضافة الفاتورة بنجاح"),t.invalidateQueries({queryKey:["payments"]}),t.invalidateQueries({queryKey:["payments-stats"]})},onError:()=>{xe.error("حدث خطأ في إنشاء الفاتورة")}}),u=jr({mutationFn:({id:g,data:w})=>hi.update(g,w),onSuccess:()=>{xe.success("تم تحديث حالة الفاتورة"),t.invalidateQueries({queryKey:["payments"]}),t.invalidateQueries({queryKey:["payments-stats"]})},onError:()=>{xe.error("فشل تحديث الحالة")}}),d=jr({mutationFn:g=>hi.delete(g),onSuccess:()=>{xe.success("تم حذف الفاتورة بنجاح"),t.invalidateQueries({queryKey:["payments"]}),t.invalidateQueries({queryKey:["payments-stats"]})},onError:()=>{xe.error("فشل حذف الفاتورة")}});return{payments:e.data||[],stats:n.data,isLoading:e.isLoading||n.isLoading,isError:e.isError||n.isError,createPayment:i.mutateAsync,updatePayment:u.mutateAsync,deletePayment:d.mutateAsync}};function sv(){const{payments:t,stats:e,isLoading:n,createPayment:i,updatePayment:u,deletePayment:d}=nv(),{students:g,isLoading:w}=ds(),{classes:p}=Zs(),[m,b]=D.useState(""),[C,_]=D.useState("all"),[N,I]=D.useState(""),[T,k]=D.useState("all"),[M,H]=D.useState(""),[B,z]=D.useState(!1),[ae,V]=D.useState(!1),[G,P]=D.useState(!1),[O,ne]=D.useState(null),[oe,ue]=D.useState(1),te=10,[ge,q]=D.useState({studentId:"",amount:"",description:"",dueDate:new Date}),[Z,Y]=D.useState({targetType:"all",classFilter:"",studentId:"",amount:"",description:"",dueDate:new Date}),Q=t.filter(F=>{const he=F.students?.name||"",Pe=F.notes||"",Ze=F.created_at?It(new Date(F.created_at),"yyyy-MM-dd"):"",_t=he.toLowerCase().includes(m.toLowerCase())||Pe.toLowerCase().includes(m.toLowerCase()),Nt=Pe.toLowerCase().includes(N.toLowerCase()),wr=T==="all"||T==="paid"&&F.status==="paid"||T==="unpaid"&&F.status!=="paid",tt=!M||Ze.includes(M),Te=C==="all"||C==="paid"&&F.status==="paid"||C==="unpaid"&&F.status!=="paid";return _t&&Nt&&wr&&tt&&Te}),Fe=Math.ceil(Q.length/te),qe=Q.slice((oe-1)*te,oe*te),lt=async()=>{if(!ge.studentId||!ge.amount||!ge.description){xe.error("الرجاء ملء جميع الحقول المطلوبة");return}const F=g.find(he=>he.id===ge.studentId);if(!F){xe.error("الطالب غير موجود");return}if(F.payment_status==="exempt"){xe.error("⚠️ هذا الطالب معفي من المصاريف");return}try{const he=ge.dueDate,Pe=It(he,"MMMM",{locale:es}),Ze=parseInt(It(he,"yyyy"));await i({student_id:ge.studentId,amount:parseFloat(ge.amount),notes:ge.description,month:Pe,year:Ze,status:"unpaid"}),q({studentId:"",amount:"",description:"",dueDate:new Date}),z(!1)}catch(he){console.error("Error creating invoice:",he)}},re=async()=>{if(!Z.amount||!Z.description){xe.error("الرجاء ملء جميع الحقول المطلوبة");return}let F=[];if(Z.targetType==="all")F=g.filter(he=>he.payment_status==="regular");else if(Z.targetType==="class"){if(!Z.classFilter){xe.error("الرجاء اختيار الصف");return}F=g.filter(he=>he.classes?.id===Z.classFilter&&he.payment_status==="regular")}else if(Z.targetType==="student"){if(!Z.studentId){xe.error("الرجاء اختيار الطالب");return}const he=g.find(Pe=>Pe.id===Z.studentId);if(he){if(he.payment_status==="exempt"){xe.error("⚠️ هذا الطالب معفي من المصاريف");return}F=[he]}}if(F.length===0){xe.error("لا توجد طلاب مؤهلين لإصدار الفواتير");return}try{const he=Z.dueDate,Pe=It(he,"MMMM",{locale:es}),Ze=parseInt(It(he,"yyyy")),_t=F.map(Nt=>i({student_id:Nt.id,amount:parseFloat(Z.amount),notes:Z.description,month:Pe,year:Ze,status:"unpaid"}));await Promise.all(_t),Y({targetType:"all",classFilter:"",studentId:"",amount:"",description:"",dueDate:new Date}),P(!1),xe.success(`تم إصدار ${F.length} فاتورة بنجاح`)}catch(he){console.error("Error processing bulk invoices:",he)}},W=async F=>{try{if(!F.id)return;await u({id:F.id,data:{status:"paid",payment_date:new Date().toISOString()}})}catch(he){console.error("Error updating payment status:",he)}},ce=async F=>{try{if(!F.id)return;await u({id:F.id,data:{status:"unpaid",payment_date:void 0}})}catch(he){console.error("Error updating payment status:",he)}},$=F=>{xe.success("تم تنزيل الفاتورة (ميزة تجريبية)")};return n||w?l.jsx("div",{className:"p-8 text-center",children:"جاري تحميل البيانات..."}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl text-black mb-1",children:"إدارة المدفوعات"}),l.jsx("p",{className:"text-gray-600",children:"إصدار وإدارة الفواتير والمدفوعات"})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(vr,{open:B,onOpenChange:z,children:[l.jsx(ha,{asChild:!0,children:l.jsxs(me,{className:"bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(Xs,{className:"ml-2 h-4 w-4"}),"إضافة فاتورة"]})}),l.jsxs(Cr,{onInteractOutside:F=>F.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"إضافة فاتورة جديدة"}),l.jsx(Ur,{children:"أدخل بيانات الفاتورة"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs(_e,{htmlFor:"add-student",children:["الطالب ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsxs(Ht,{value:ge.studentId,onValueChange:F=>q({...ge,studentId:F}),children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"اختر الطالب"})}),l.jsx(zt,{children:g.map(F=>l.jsxs(et,{value:F.id||"",children:[F.name," - ",F.classes?.name||"بدون صف"," ",F.payment_status==="exempt"?"(معفى)":""]},F.id))})]}),ge.studentId&&g.find(F=>F.id===ge.studentId)?.payment_status==="exempt"&&l.jsxs("div",{className:"flex items-center gap-2 mt-2 p-2 bg-red-50 text-red-600 rounded-md text-sm border border-red-100 animate-pulse",children:[l.jsx(Ms,{className:"h-4 w-4"}),l.jsx("span",{children:"هذا الطالب معفي من المصاريف"})]})]}),l.jsxs("div",{children:[l.jsxs(_e,{htmlFor:"add-amount",children:["المبلغ (ج.م) ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Be,{id:"add-amount",type:"number",value:ge.amount,onChange:F=>q({...ge,amount:F.target.value}),placeholder:"1000"})]}),l.jsxs("div",{children:[l.jsxs(_e,{htmlFor:"add-description",children:["الوصف ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Be,{id:"add-description",value:ge.description,onChange:F=>q({...ge,description:F.target.value}),placeholder:"رسوم شهر نوفمبر"})]}),l.jsxs("div",{children:[l.jsxs(_e,{children:["تاريخ الاستحقاق ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsxs(rl,{children:[l.jsx(nl,{asChild:!0,children:l.jsx(me,{variant:"outline",className:"w-full justify-start text-right",children:It(ge.dueDate,"PPP",{locale:es})})}),l.jsx(sl,{className:"w-auto p-0",children:l.jsx(Su,{mode:"single",selected:ge.dueDate,onSelect:F=>F&&q({...ge,dueDate:F}),initialFocus:!0})})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>z(!1),children:"إلغاء"}),l.jsx(me,{className:"bg-orange-500 hover:bg-orange-600 text-black",onClick:lt,disabled:ge.studentId?g.find(F=>F.id===ge.studentId)?.payment_status==="exempt":!1,children:"إضافة الفاتورة"})]})]})]}),l.jsxs(vr,{open:G,onOpenChange:P,children:[l.jsx(ha,{asChild:!0,children:l.jsxs(me,{variant:"outline",children:[l.jsx(sd,{className:"ml-2 h-4 w-4"}),"إصدار فواتير جماعي"]})}),l.jsxs(Cr,{onInteractOutside:F=>F.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"إصدار فواتير جماعي"}),l.jsx(Ur,{children:"إصدار فواتير لعدة طلاب دفعة واحدة"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(_e,{children:"نوع الإصدار"}),l.jsxs(Ht,{value:Z.targetType,onValueChange:F=>Y({...Z,targetType:F}),children:[l.jsx(qt,{children:l.jsx(Gt,{})}),l.jsxs(zt,{children:[l.jsx(et,{value:"all",children:"جميع الطلاب"}),l.jsx(et,{value:"class",children:"طلاب صف معين"}),l.jsx(et,{value:"student",children:"طالب معين"})]})]})]}),Z.targetType==="class"&&l.jsxs("div",{children:[l.jsx(_e,{children:"الصف"}),l.jsxs(Ht,{value:Z.classFilter,onValueChange:F=>Y({...Z,classFilter:F}),children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"اختر الصف"})}),l.jsx(zt,{children:p.map(F=>l.jsx(et,{value:F.id,children:F.name},F.id))})]})]}),Z.targetType==="student"&&l.jsxs("div",{children:[l.jsx(_e,{children:"الطالب"}),l.jsxs(Ht,{value:Z.studentId,onValueChange:F=>Y({...Z,studentId:F}),children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"اختر الطالب"})}),l.jsx(zt,{children:g.map(F=>l.jsxs(et,{value:F.id||"",children:[F.name," - ",F.classes?.name||""," ",F.payment_status==="exempt"?"(معفى)":""]},F.id))})]}),Z.targetType==="student"&&Z.studentId&&g.find(F=>F.id===Z.studentId)?.payment_status==="exempt"&&l.jsxs("div",{className:"flex items-center gap-2 mt-2 p-2 bg-red-50 text-red-600 rounded-md text-sm border border-red-100 animate-pulse",children:[l.jsx(Ms,{className:"h-4 w-4"}),l.jsx("span",{children:"هذا الطالب معفي من المصاريف"})]})]}),l.jsxs("div",{children:[l.jsxs(_e,{children:["المبلغ (ج.م) ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Be,{type:"number",value:Z.amount,onChange:F=>Y({...Z,amount:F.target.value}),placeholder:"1000"})]}),l.jsxs("div",{children:[l.jsxs(_e,{children:["الوصف ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Be,{value:Z.description,onChange:F=>Y({...Z,description:F.target.value}),placeholder:"رسوم شهر نوفمبر"})]}),l.jsxs("div",{children:[l.jsxs(_e,{children:["تاريخ الاستحقاق ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsxs(rl,{children:[l.jsx(nl,{asChild:!0,children:l.jsx(me,{variant:"outline",className:"w-full justify-start text-right",children:It(Z.dueDate,"PPP",{locale:es})})}),l.jsx(sl,{className:"w-auto p-0",children:l.jsx(Su,{mode:"single",selected:Z.dueDate,onSelect:F=>F&&Y({...Z,dueDate:F}),initialFocus:!0})})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>P(!1),children:"إلغاء"}),l.jsx(me,{className:"bg-orange-500 hover:bg-orange-600 text-black",onClick:re,disabled:Z.targetType==="student"&&Z.studentId?g.find(F=>F.id===Z.studentId)?.payment_status==="exempt":!1,children:"إصدار الفواتير"})]})]})]})]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"إجمالي المدفوعات"}),l.jsxs(We,{className:"text-3xl text-black",children:[e?.totalAmount||0," ج.م"]})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"المدفوعات المحصلة"}),l.jsxs(We,{className:"text-3xl text-green-600",children:[e?.collectedAmount||0," ج.م"]})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"المدفوعات المستحقة"}),l.jsxs(We,{className:"text-3xl text-red-600",children:[e?.pendingAmount||0," ج.م"]})]})})]}),l.jsx(Se,{children:l.jsx(ht,{className:"pt-6",children:l.jsxs("div",{className:"relative w-full",children:[l.jsx(us,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),l.jsx(Be,{placeholder:"البحث العام (اسم الطالب، الوصف)...",value:m,onChange:F=>b(F.target.value),className:"pr-10"})]})})}),l.jsx(Se,{children:l.jsx(ht,{className:"p-0",children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(Ln,{children:[l.jsx(Bn,{children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right min-w-[150px]",children:l.jsxs("div",{className:"flex flex-col gap-2 py-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{children:"التاريخ"}),l.jsx(Ka,{className:"h-3 w-3 text-gray-400"})]}),l.jsx(Be,{placeholder:"فلترة بالتاريخ...",className:"h-8 text-xs font-normal",value:M,onChange:F=>H(F.target.value)})]})}),l.jsx(Ve,{className:"text-right",children:"اسم الطالب"}),l.jsx(Ve,{className:"text-right min-w-[200px]",children:l.jsxs("div",{className:"flex flex-col gap-2 py-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{children:"الوصف"}),l.jsx(Ka,{className:"h-3 w-3 text-gray-400"})]}),l.jsx(Be,{placeholder:"فلترة بالوصف...",className:"h-8 text-xs font-normal",value:N,onChange:F=>I(F.target.value)})]})}),l.jsx(Ve,{className:"text-right",children:"المبلغ"}),l.jsx(Ve,{className:"text-right",children:"الشهر/السنة"}),l.jsx(Ve,{className:"text-right min-w-[150px]",children:l.jsxs("div",{className:"flex flex-col gap-2 py-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{children:"الحالة"}),l.jsx(Ka,{className:"h-3 w-3 text-gray-400"})]}),l.jsxs(Ht,{value:T,onValueChange:F=>k(F),children:[l.jsx(qt,{className:"h-8 text-xs",children:l.jsx(Gt,{})}),l.jsxs(zt,{children:[l.jsx(et,{value:"all",children:"الكل"}),l.jsx(et,{value:"paid",children:"مدفوعة"}),l.jsx(et,{value:"unpaid",children:"غير مدفوعة"})]})]})]})}),l.jsx(Ve,{className:"text-center",children:"الإجراءات"})]})}),l.jsx(Fn,{children:qe.length>0?qe.map(F=>l.jsxs(Tt,{children:[l.jsx(Oe,{className:"font-medium text-xs text-gray-500",children:F.created_at?It(new Date(F.created_at),"yyyy-MM-dd"):"-"}),l.jsx(Oe,{children:F.students?.name||"غير معروف"}),l.jsx(Oe,{children:F.notes||"-"}),l.jsxs(Oe,{children:[F.amount," ج.م"]}),l.jsxs(Oe,{children:[F.month," ",F.year]}),l.jsx(Oe,{children:l.jsx(vt,{variant:F.status==="paid"?"default":"destructive",children:F.status==="paid"?l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(vi,{className:"h-3 w-3"}),"مدفوعة"]}):l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(Ms,{className:"h-3 w-3"}),"غير مدفوعة"]})})}),l.jsx(Oe,{children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx(me,{size:"sm",variant:"outline",onClick:()=>{ne(F),V(!0)},title:"عرض التفاصيل",children:l.jsx(cd,{className:"h-4 w-4"})}),l.jsx(me,{size:"sm",variant:"outline",onClick:()=>$(),title:"تنزيل الفاتورة",children:l.jsx(bi,{className:"h-4 w-4"})}),l.jsxs(xo,{children:[l.jsx(po,{asChild:!0,children:l.jsx(me,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",title:"حذف الفاتورة",children:l.jsx(Oi,{className:"h-4 w-4"})})}),l.jsxs(wo,{children:[l.jsxs(yo,{children:[l.jsx(vo,{children:"حذف الفاتورة"}),l.jsx(Co,{children:"هل أنت متأكد من حذف هذه الفاتورة؟ لا يمكن التراجع عن هذا الإجراء."})]}),l.jsxs(bo,{children:[l.jsx(Eo,{children:"إلغاء"}),l.jsx(_o,{onClick:()=>F.id&&d(F.id),className:"bg-red-600 hover:bg-red-700",children:"حذف"})]})]})]}),F.status==="paid"?l.jsxs(xo,{children:[l.jsx(po,{asChild:!0,children:l.jsx(me,{size:"sm",variant:"outline",className:"text-orange-600",children:l.jsx(Ms,{className:"h-4 w-4"})})}),l.jsxs(wo,{children:[l.jsxs(yo,{children:[l.jsx(vo,{children:"تحديث حالة الفاتورة"}),l.jsx(Co,{children:"هل تريد تحديث حالة الفاتورة إلى غير مدفوعة؟"})]}),l.jsxs(bo,{children:[l.jsx(Eo,{children:"إلغاء"}),l.jsx(_o,{onClick:()=>ce(F),children:"تأكيد"})]})]})]}):l.jsxs(xo,{children:[l.jsx(po,{asChild:!0,children:l.jsx(me,{size:"sm",variant:"outline",className:"text-green-600",children:l.jsx(vi,{className:"h-4 w-4"})})}),l.jsxs(wo,{children:[l.jsxs(yo,{children:[l.jsx(vo,{children:"تأكيد الدفع"}),l.jsx(Co,{children:"هل تريد تحديث حالة الفاتورة إلى مدفوعة؟"})]}),l.jsxs(bo,{children:[l.jsx(Eo,{children:"إلغاء"}),l.jsx(_o,{onClick:()=>W(F),children:"تأكيد"})]})]})]})]})})]},F.id)):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:7,className:"text-center text-gray-500 py-8",children:"لا توجد فواتير"})})})]})})})}),Fe>1&&l.jsx(Ol,{dir:"ltr",children:l.jsxs(Rl,{children:[l.jsx(vn,{children:l.jsx(jl,{onClick:()=>ue(Math.max(1,oe-1)),className:oe===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Fe},(F,he)=>he+1).map(F=>l.jsx(vn,{children:l.jsx(ji,{onClick:()=>ue(F),isActive:oe===F,className:"cursor-pointer",children:F})},F)),l.jsx(vn,{children:l.jsx(kl,{onClick:()=>ue(Math.min(Fe,oe+1)),className:oe===Fe?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),l.jsx(vr,{open:ae,onOpenChange:V,children:l.jsxs(Cr,{children:[l.jsx(_r,{children:l.jsx(Er,{children:"تفاصيل الفاتورة"})}),l.jsx("div",{className:"space-y-4",children:l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"اسم الطالب"}),l.jsx("p",{className:"text-black",children:O?.students?.name})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"المبلغ"}),l.jsxs("p",{className:"text-black",children:[O?.amount," ج.م"]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"الوصف"}),l.jsx("p",{className:"text-black",children:O?.notes})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"تاريخ الإصدار"}),l.jsx("p",{className:"text-black",children:O?.created_at&&It(new Date(O.created_at),"PPP",{locale:es})})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"فترة الاستحقاق"}),l.jsxs("p",{className:"text-black",children:[O?.month," ",O?.year]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"الحالة"}),l.jsx(vt,{variant:O?.status==="paid"?"default":"destructive",children:O?.status==="paid"?"مدفوعة":"غير مدفوعة"})]}),O?.status==="paid"&&O.payment_date&&l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"تاريخ الدفع"}),l.jsx("p",{className:"text-black",children:It(new Date(O.payment_date),"PPP",{locale:es})})]})]})}),l.jsx(Fr,{children:l.jsx(me,{variant:"outline",onClick:()=>V(!1),children:"إغلاق"})})]})})]})}const il={async getByStudentId(t){const{data:e,error:n}=await ze.from("attendance").select("*").eq("student_id",t).order("date",{ascending:!1});if(n)throw n;return e},async getAll(){const{data:t,error:e}=await ze.from("attendance").select(`
                *,
                students (
                    name,
                    class_id,
                    classes (
                        name
                    )
                )
            `).order("date",{ascending:!1});if(e)throw e;return t},async markAttendance(t){const{data:e,error:n}=await ze.from("attendance").upsert([t],{onConflict:"student_id, date"}).select().single();if(n)throw n;return e},async update(t,e){const{data:n,error:i}=await ze.from("attendance").update(e).eq("id",t).select().single();if(i)throw i;return n},async delete(t){const{error:e}=await ze.from("attendance").delete().eq("id",t);if(e)throw e},async getStats(t,e,n){const{data:i,error:u}=await ze.from("attendance").select("*").eq("student_id",t).gte("date",e).lte("date",n);if(u)throw u;const d=i?.length||0,g=i?.filter(w=>w.present).length||0;return{total:d,present:g,absent:d-g,percentage:d>0?g/d*100:0}}};function iv({student:t,open:e,onOpenChange:n}){const[i,u]=D.useState("all"),[d,g]=D.useState("all"),[w,p]=D.useState([]),[m,b]=D.useState(!1);D.useEffect(()=>{t&&e&&C()},[t,e]);const C=async()=>{if(!(!t||!t.id))try{b(!0);const O=(await il.getByStudentId(t.id)||[]).map(ne=>({id:ne.id,date:ne.date,checkIn:ne.created_at?It(new Date(ne.created_at),"HH:mm"):"-",checkOut:"-",status:ne.present?"present":"absent"}));p(O)}catch(P){console.error("Error fetching student attendance:",P),xe.error("فشل جلب سجلات الحضور")}finally{b(!1)}};if(!t)return null;const _={name:t.studentName||t.name||"غير معروف",class:t.class||t.className||t.classes?.name||"-",grade:t.grade||t.classes?.grade_level||"-",enrollmentDate:t.enrollmentDate||(t.created_at?It(new Date(t.created_at),"yyyy-MM-dd"):"-")},N=w.filter(P=>{const O=i==="all"||P.date.startsWith(i),ne=d==="all"||P.status===d;return O&&ne}),I=w.length,T=w.filter(P=>P.status==="present").length,k=w.filter(P=>P.status==="late").length,M=w.filter(P=>P.status==="absent").length,H=I>0?((T+k)/I*100).toFixed(1):"0",z=(()=>{const P=new Map;return w.forEach(O=>{const ne=O.date.substring(0,7);P.has(ne)||P.set(ne,{present:0,late:0,absent:0,total:0});const oe=P.get(ne);oe.total++,O.status==="present"?oe.present++:O.status==="late"?oe.late++:oe.absent++}),Array.from(P.entries()).sort((O,ne)=>ne[0].localeCompare(O[0])).slice(0,6)})(),ae=P=>{switch(P){case"present":return l.jsx(vt,{className:"bg-green-500",children:"حاضر"});case"late":return l.jsx(vt,{className:"bg-yellow-500",children:"متأخر"});case"absent":return l.jsx(vt,{className:"bg-red-500",children:"غائب"});default:return l.jsx(vt,{children:P})}},V=P=>{const O=["يناير","فبراير","مارس","إبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],[ne,oe]=P.split("-");return`${O[parseInt(oe)-1]} ${ne}`},G=()=>{xe.success("جاري تصدير التقرير إلى PDF... (ميزة تجريبية)")};return l.jsx(vr,{open:e,onOpenChange:n,children:l.jsxs(Cr,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",onInteractOutside:P=>P.preventDefault(),children:[l.jsxs(_r,{children:[l.jsxs(Er,{className:"flex items-center gap-2 text-xl",children:[l.jsx(yi,{className:"h-6 w-6 text-orange-500"}),"تقرير حضور الطالب"]}),l.jsx(Ur,{children:"سجل الحضور الكامل"})]}),m?l.jsx("div",{className:"p-8 text-center",children:"جاري تحميل البيانات..."}):l.jsxs("div",{className:"space-y-6 mt-4",children:[l.jsx(Se,{className:"border-orange-200",children:l.jsx(ht,{className:"pt-6",children:l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"اسم الطالب"}),l.jsx("p",{className:"text-black",children:_.name})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"الصف"}),l.jsx("p",{className:"text-black",children:_.class})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"المرحلة"}),l.jsx("p",{className:"text-black",children:_.grade})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-600",children:"تاريخ التسجيل"}),l.jsx("p",{className:"text-black",dir:"ltr",children:_.enrollmentDate})]})]})})}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsxs(nt,{className:"flex items-center gap-2",children:[l.jsx(pl,{className:"h-4 w-4"}),"إجمالي الأيام"]}),l.jsx(We,{className:"text-3xl text-black",children:I})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsxs(nt,{className:"flex items-center gap-2",children:[l.jsx(vi,{className:"h-4 w-4"}),"الحضور"]}),l.jsx(We,{className:"text-3xl text-green-600",children:T})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsxs(nt,{className:"flex items-center gap-2",children:[l.jsx(ud,{className:"h-4 w-4"}),"التأخير"]}),l.jsx(We,{className:"text-3xl text-yellow-600",children:k})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsxs(nt,{className:"flex items-center gap-2",children:[l.jsx(Oo,{className:"h-4 w-4"}),"الغياب"]}),l.jsx(We,{className:"text-3xl text-red-600",children:M})]})})]}),l.jsxs(Se,{children:[l.jsx(Ue,{children:l.jsxs(We,{className:"flex items-center gap-2",children:[l.jsx(Ro,{className:"h-5 w-5 text-orange-500"}),"نسبة الحضور"]})}),l.jsx(ht,{children:l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"معدل الحضور الكلي"}),l.jsxs("span",{className:"text-3xl text-orange-500",children:[H,"%"]})]}),l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:l.jsx("div",{className:"bg-orange-500 h-4 rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${H}%`},children:l.jsxs("span",{className:"text-xs text-white font-bold",children:[H,"%"]})})})]})})]}),z.length>0&&l.jsxs(Se,{children:[l.jsxs(Ue,{children:[l.jsx(We,{children:"الإحصائيات الشهرية"}),l.jsx(nt,{children:"آخر شهور"})]}),l.jsx(ht,{children:l.jsx("div",{className:"space-y-3",children:z.map(([P,O])=>{const ne=O.total>0?((O.present+O.late)/O.total*100).toFixed(1):"0";return l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex items-center justify-between text-sm",children:[l.jsx("span",{className:"text-black",children:V(P)}),l.jsxs("div",{className:"flex gap-3 text-xs",children:[l.jsxs("span",{className:"text-green-600",children:["حاضر: ",O.present]}),l.jsxs("span",{className:"text-yellow-600",children:["متأخر: ",O.late]}),l.jsxs("span",{className:"text-red-600",children:["غائب: ",O.absent]}),l.jsxs("span",{className:"text-orange-500 font-bold",children:[ne,"%"]})]})]}),l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:l.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all",style:{width:`${ne}%`}})})]},P)})})})]}),l.jsx(Se,{children:l.jsx(ht,{className:"pt-6",children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"تصفية حسب الشهر:"}),l.jsxs(Ht,{value:i,onValueChange:u,children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"جميع الأشهر"})}),l.jsxs(zt,{children:[l.jsx(et,{value:"all",children:"جميع الأشهر"}),l.jsx(et,{value:"2025-11",children:"نوفمبر 2025"}),l.jsx(et,{value:"2025-10",children:"أكتوبر 2025"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"تصفية حسب الحالة:"}),l.jsxs(Ht,{value:d,onValueChange:g,children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"جميع الحالات"})}),l.jsxs(zt,{children:[l.jsx(et,{value:"all",children:"جميع الحالات"}),l.jsx(et,{value:"present",children:"حاضر فقط"}),l.jsx(et,{value:"late",children:"متأخر فقط"}),l.jsx(et,{value:"absent",children:"غائب فقط"})]})]})]}),l.jsx("div",{className:"flex items-end",children:l.jsxs(me,{onClick:G,className:"w-full bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(bi,{className:"ml-2 h-4 w-4"}),"تصدير التقرير"]})})]})})}),l.jsxs(Se,{children:[l.jsxs(Ue,{children:[l.jsx(We,{children:"سجل الحضور التفصيلي"}),l.jsxs(nt,{children:["عرض ",N.length," من أصل ",w.length," سجل"]})]}),l.jsx(ht,{className:"p-0",children:l.jsx("div",{className:"overflow-x-auto max-h-[400px] overflow-y-auto",children:l.jsxs(Ln,{children:[l.jsx(Bn,{className:"sticky top-0 bg-white",children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right",children:"التاريخ"}),l.jsx(Ve,{className:"text-right",children:"اليوم"}),l.jsx(Ve,{className:"text-right",children:"وقت الحضور"}),l.jsx(Ve,{className:"text-right",children:"وقت الانصراف"}),l.jsx(Ve,{className:"text-center",children:"الحالة"})]})}),l.jsx(Fn,{children:N.length>0?N.map(P=>{const O=new Date(P.date),oe=["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][O.getDay()];return l.jsxs(Tt,{children:[l.jsx(Oe,{dir:"ltr",className:"text-right",children:P.date}),l.jsx(Oe,{children:oe}),l.jsx(Oe,{dir:"ltr",className:"text-right",children:P.checkIn}),l.jsx(Oe,{dir:"ltr",className:"text-right",children:P.checkOut}),l.jsx(Oe,{className:"text-center",children:ae(P.status)})]},P.id)}):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:5,className:"text-center text-gray-500 py-8",children:"لا توجد نتائج"})})})]})})})]})]})]})})}const Ia=()=>{const t=Vn(),e=os({queryKey:["attendance"],queryFn:()=>il.getAll(),staleTime:1e3*60*2}),n=jr({mutationFn:i=>il.markAttendance(i),onSuccess:()=>{t.invalidateQueries({queryKey:["attendance"]})},onError:i=>{console.error("Error marking attendance:",i)}});return{attendance:e.data||[],isLoading:e.isLoading,isError:e.isError,markAttendance:n.mutateAsync}};function av(){const[t,e]=D.useState(""),[n,i]=D.useState(""),[u,d]=D.useState("all"),[g,w]=D.useState("all"),[p,m]=D.useState(null),[b,C]=D.useState(!1),{attendance:_,isLoading:N}=Ia(),{students:I,isLoading:T}=ds(),k=(_||[]).map(te=>({id:te.id,studentName:te.students?.name||"Unknown",date:te.date,checkIn:te.created_at?It(new Date(te.created_at),"HH:mm"):"-",checkOut:"-",status:te.present?"present":"absent",class:te.students?.classes?.name||"-"})),M=k.filter(te=>{const ge=te.studentName.toLowerCase().includes(t.toLowerCase()),q=u==="all"||te.studentName===u,Z=g==="all"||te.class===g,Y=!n||te.date===n;return ge&&q&&Z&&Y}),H=()=>{xe.success("جاري تصدير التقرير إلى PDF... (ميزة تجريبية)")},B=()=>{xe.success("جاري تصدير التقرير إلى CSV... (ميزة تجريبية)")},z=te=>{switch(te){case"present":return l.jsx(vt,{className:"bg-green-500",children:"حاضر"});case"late":return l.jsx(vt,{className:"bg-yellow-500",children:"متأخر"});case"absent":return l.jsx(vt,{className:"bg-red-500",children:"غائب"});default:return l.jsx(vt,{children:te})}},ae=M.filter(te=>te.status==="present").length,V=M.filter(te=>te.status==="late").length,G=M.filter(te=>te.status==="absent").length,P=M.length>0?((ae+V)/M.length*100).toFixed(1):"0",O=Array.from(new Set(k.map(te=>te.studentName))),ne=Array.from(new Set(k.map(te=>te.class).filter(te=>te!=="-"))),oe=te=>{const ge=I.find(q=>q.name===te);ge?.id&&(m(ge.id),C(!0))},ue=I.find(te=>te.id===p)||null;return N||T?l.jsx("div",{className:"p-8 text-center",children:"جاري تحميل التقارير..."}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl text-black mb-1",children:"تقارير الحضور"}),l.jsx("p",{className:"text-gray-600",children:"عرض وتصدير تقارير حضور الطلاب"})]}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsx(wl,{className:"h-6 w-6 text-orange-500"})})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"إجمالي السجلات"}),l.jsx(We,{className:"text-3xl text-black",children:M.length})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"الحضور"}),l.jsx(We,{className:"text-3xl text-green-600",children:ae})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"التأخير"}),l.jsx(We,{className:"text-3xl text-yellow-600",children:V})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"الغياب"}),l.jsx(We,{className:"text-3xl text-red-600",children:G})]})})]}),l.jsx(Se,{children:l.jsx(ht,{className:"pt-6",children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx(us,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),l.jsx(Be,{placeholder:"ابحث عن طالب...",value:t,onChange:te=>e(te.target.value),className:"pr-10"})]}),l.jsx("div",{children:l.jsxs(Ht,{value:u,onValueChange:d,children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"جميع الطلاب"})}),l.jsxs(zt,{children:[l.jsx(et,{value:"all",children:"جميع الطلاب"}),O.map(te=>l.jsx(et,{value:te,children:te},te))]})]})}),l.jsx("div",{children:l.jsxs(Ht,{value:g,onValueChange:w,children:[l.jsx(qt,{children:l.jsx(Gt,{placeholder:"جميع الصفوف"})}),l.jsxs(zt,{children:[l.jsx(et,{value:"all",children:"جميع الصفوف"}),ne.map(te=>l.jsx(et,{value:te,children:te},te))]})]})}),l.jsx("div",{children:l.jsx(Be,{type:"date",value:n,onChange:te=>i(te.target.value),placeholder:"التاريخ"})}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(me,{variant:"outline",className:"flex-1",onClick:H,children:[l.jsx(bi,{className:"ml-2 h-4 w-4"}),"PDF"]}),l.jsxs(me,{variant:"outline",className:"flex-1",onClick:B,children:[l.jsx(bi,{className:"ml-2 h-4 w-4"}),"CSV"]})]})]})})}),l.jsxs(Se,{children:[l.jsx(Ue,{children:l.jsx(We,{children:"ملخص الحضور"})}),l.jsx(ht,{children:l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"نسبة الحضور الإجمالية"}),l.jsxs("span",{className:"text-2xl text-orange-500",children:[P,"%"]})]}),l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:l.jsx("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-300",style:{width:`${P}%`}})})]})})]}),l.jsx(Se,{children:l.jsx(ht,{className:"p-0",children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(Ln,{children:[l.jsx(Bn,{children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right",children:"الطالب"}),l.jsx(Ve,{className:"text-right",children:"الصف"}),l.jsx(Ve,{className:"text-right",children:"التاريخ"}),l.jsx(Ve,{className:"text-right",children:"وقت الحضور"}),l.jsx(Ve,{className:"text-right",children:"وقت الانصراف"}),l.jsx(Ve,{className:"text-center",children:"الحالة"})]})}),l.jsx(Fn,{children:M.length>0?M.map(te=>l.jsxs(Tt,{className:"hover:bg-gray-50",children:[l.jsx(Oe,{className:"cursor-pointer text-orange-600 hover:text-orange-700 hover:underline transition-colors",onClick:()=>oe(te.studentName),title:"اضغط لعرض تقرير الطالب الكامل",children:te.studentName}),l.jsx(Oe,{children:te.class}),l.jsx(Oe,{dir:"ltr",className:"text-right",children:te.date}),l.jsx(Oe,{dir:"ltr",className:"text-right",children:te.checkIn}),l.jsx(Oe,{dir:"ltr",className:"text-right",children:te.checkOut}),l.jsx(Oe,{className:"text-center",children:z(te.status)})]},te.id)):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:6,className:"text-center text-gray-500 py-8",children:"لا توجد نتائج"})})})]})})})}),l.jsx(iv,{student:ue,open:b,onOpenChange:C})]})}var we;(function(t){t[t.QR_CODE=0]="QR_CODE",t[t.AZTEC=1]="AZTEC",t[t.CODABAR=2]="CODABAR",t[t.CODE_39=3]="CODE_39",t[t.CODE_93=4]="CODE_93",t[t.CODE_128=5]="CODE_128",t[t.DATA_MATRIX=6]="DATA_MATRIX",t[t.MAXICODE=7]="MAXICODE",t[t.ITF=8]="ITF",t[t.EAN_13=9]="EAN_13",t[t.EAN_8=10]="EAN_8",t[t.PDF_417=11]="PDF_417",t[t.RSS_14=12]="RSS_14",t[t.RSS_EXPANDED=13]="RSS_EXPANDED",t[t.UPC_A=14]="UPC_A",t[t.UPC_E=15]="UPC_E",t[t.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(we||(we={}));var Iu=new Map([[we.QR_CODE,"QR_CODE"],[we.AZTEC,"AZTEC"],[we.CODABAR,"CODABAR"],[we.CODE_39,"CODE_39"],[we.CODE_93,"CODE_93"],[we.CODE_128,"CODE_128"],[we.DATA_MATRIX,"DATA_MATRIX"],[we.MAXICODE,"MAXICODE"],[we.ITF,"ITF"],[we.EAN_13,"EAN_13"],[we.EAN_8,"EAN_8"],[we.PDF_417,"PDF_417"],[we.RSS_14,"RSS_14"],[we.RSS_EXPANDED,"RSS_EXPANDED"],[we.UPC_A,"UPC_A"],[we.UPC_E,"UPC_E"],[we.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),Tu;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.URL=1]="URL"})(Tu||(Tu={}));function ov(t){return Object.values(we).includes(t)}var xa;(function(t){t[t.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",t[t.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(xa||(xa={}));var lv=(function(){function t(){}return t.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",t.SCAN_DEFAULT_FPS=2,t.DEFAULT_DISABLE_FLIP=!1,t.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,t.DEFAULT_SUPPORTED_SCAN_TYPE=[xa.SCAN_TYPE_CAMERA,xa.SCAN_TYPE_FILE],t})(),Zh=(function(){function t(e,n){this.format=e,this.formatName=n}return t.prototype.toString=function(){return this.formatName},t.create=function(e){if(!Iu.has(e))throw"".concat(e," not in html5QrcodeSupportedFormatsTextMap");return new t(e,Iu.get(e))},t})(),Ou=(function(){function t(){}return t.createFromText=function(e){var n={text:e};return{decodedText:e,result:n}},t.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},t})(),al;(function(t){t[t.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",t[t.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",t[t.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(al||(al={}));var cv=(function(){function t(){}return t.createFrom=function(e){return{errorMessage:e,type:al.UNKWOWN_ERROR}},t})(),uv=(function(){function t(e){this.verbose=e}return t.prototype.log=function(e){this.verbose&&console.log(e)},t.prototype.warn=function(e){this.verbose&&console.warn(e)},t.prototype.logError=function(e,n){(this.verbose||n===!0)&&console.error(e)},t.prototype.logErrors=function(e){if(e.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},t})();function yn(t){return typeof t>"u"||t===null}var Fs=(function(){function t(){}return t.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},t.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},t.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},t.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},t.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},t.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},t.scannerPaused=function(){return"Scanner paused"},t})(),Jh=(function(){function t(){}return t.isMediaStreamConstraintsValid=function(e,n){if(typeof e!="object"){var i=typeof e;return n.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(i,"."),!0),!1}for(var u=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],d=new Set(u),g=Object.keys(e),w=0,p=g;w<p.length;w++){var m=p[w];if(d.has(m))return n.logError("".concat(m," is not supported videoConstaints."),!0),!1}return!0},t})(),mi={exports:{}},dv=mi.exports,Ru;function hv(){return Ru||(Ru=1,(function(t,e){(function(n,i){i(e)})(dv,(function(n){function i(E){return E==null}var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,r){E.__proto__=r}||function(E,r){for(var s in r)r.hasOwnProperty(s)&&(E[s]=r[s])};function d(E,r){u(E,r);function s(){this.constructor=E}E.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}function g(E,r){var s=Object.setPrototypeOf;s?s(E,r):E.__proto__=r}function w(E,r){r===void 0&&(r=E.constructor);var s=Error.captureStackTrace;s&&s(E,r)}var p=(function(E){d(r,E);function r(s){var a=this.constructor,o=E.call(this,s)||this;return Object.defineProperty(o,"name",{value:a.name,enumerable:!1}),g(o,a.prototype),w(o),o}return r})(Error);class m extends p{constructor(r=void 0){super(r),this.message=r}getKind(){return this.constructor.kind}}m.kind="Exception";class b extends m{}b.kind="ArgumentException";class C extends m{}C.kind="IllegalArgumentException";class _{constructor(r){if(this.binarizer=r,r===null)throw new C("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(r,s){return this.binarizer.getBlackRow(r,s)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(r,s,a,o){const c=this.binarizer.getLuminanceSource().crop(r,s,a,o);return new _(this.binarizer.createBinarizer(c))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const r=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new _(this.binarizer.createBinarizer(r))}rotateCounterClockwise45(){const r=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new _(this.binarizer.createBinarizer(r))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class N extends m{static getChecksumInstance(){return new N}}N.kind="ChecksumException";class I{constructor(r){this.source=r}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class T{static arraycopy(r,s,a,o,c){for(;c--;)a[o++]=r[s++]}static currentTimeMillis(){return Date.now()}}class k extends m{}k.kind="IndexOutOfBoundsException";class M extends k{constructor(r=void 0,s=void 0){super(s),this.index=r,this.message=s}}M.kind="ArrayIndexOutOfBoundsException";class H{static fill(r,s){for(let a=0,o=r.length;a<o;a++)r[a]=s}static fillWithin(r,s,a,o){H.rangeCheck(r.length,s,a);for(let c=s;c<a;c++)r[c]=o}static rangeCheck(r,s,a){if(s>a)throw new C("fromIndex("+s+") > toIndex("+a+")");if(s<0)throw new M(s);if(a>r)throw new M(a)}static asList(...r){return r}static create(r,s,a){return Array.from({length:r}).map(c=>Array.from({length:s}).fill(a))}static createInt32Array(r,s,a){return Array.from({length:r}).map(c=>Int32Array.from({length:s}).fill(a))}static equals(r,s){if(!r||!s||!r.length||!s.length||r.length!==s.length)return!1;for(let a=0,o=r.length;a<o;a++)if(r[a]!==s[a])return!1;return!0}static hashCode(r){if(r===null)return 0;let s=1;for(const a of r)s=31*s+a;return s}static fillUint8Array(r,s){for(let a=0;a!==r.length;a++)r[a]=s}static copyOf(r,s){return r.slice(0,s)}static copyOfUint8Array(r,s){if(r.length<=s){const a=new Uint8Array(s);return a.set(r),a}return r.slice(0,s)}static copyOfRange(r,s,a){const o=a-s,c=new Int32Array(o);return T.arraycopy(r,s,c,0,o),c}static binarySearch(r,s,a){a===void 0&&(a=H.numberComparator);let o=0,c=r.length-1;for(;o<=c;){const h=c+o>>1,f=a(s,r[h]);if(f>0)o=h+1;else if(f<0)c=h-1;else return h}return-o-1}static numberComparator(r,s){return r-s}}class B{static numberOfTrailingZeros(r){let s;if(r===0)return 32;let a=31;return s=r<<16,s!==0&&(a-=16,r=s),s=r<<8,s!==0&&(a-=8,r=s),s=r<<4,s!==0&&(a-=4,r=s),s=r<<2,s!==0&&(a-=2,r=s),a-(r<<1>>>31)}static numberOfLeadingZeros(r){if(r===0)return 32;let s=1;return r>>>16||(s+=16,r<<=16),r>>>24||(s+=8,r<<=8),r>>>28||(s+=4,r<<=4),r>>>30||(s+=2,r<<=2),s-=r>>>31,s}static toHexString(r){return r.toString(16)}static toBinaryString(r){return String(parseInt(String(r),2))}static bitCount(r){return r=r-(r>>>1&1431655765),r=(r&858993459)+(r>>>2&858993459),r=r+(r>>>4)&252645135,r=r+(r>>>8),r=r+(r>>>16),r&63}static truncDivision(r,s){return Math.trunc(r/s)}static parseInt(r,s=void 0){return parseInt(r,s)}}B.MIN_VALUE_32_BITS=-2147483648,B.MAX_VALUE=Number.MAX_SAFE_INTEGER;class z{constructor(r,s){r===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=r,s==null?this.bits=z.makeArray(r):this.bits=s)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(r){if(r>this.bits.length*32){const s=z.makeArray(r);T.arraycopy(this.bits,0,s,0,this.bits.length),this.bits=s}}get(r){return(this.bits[Math.floor(r/32)]&1<<(r&31))!==0}set(r){this.bits[Math.floor(r/32)]|=1<<(r&31)}flip(r){this.bits[Math.floor(r/32)]^=1<<(r&31)}getNextSet(r){const s=this.size;if(r>=s)return s;const a=this.bits;let o=Math.floor(r/32),c=a[o];c&=~((1<<(r&31))-1);const h=a.length;for(;c===0;){if(++o===h)return s;c=a[o]}const f=o*32+B.numberOfTrailingZeros(c);return f>s?s:f}getNextUnset(r){const s=this.size;if(r>=s)return s;const a=this.bits;let o=Math.floor(r/32),c=~a[o];c&=~((1<<(r&31))-1);const h=a.length;for(;c===0;){if(++o===h)return s;c=~a[o]}const f=o*32+B.numberOfTrailingZeros(c);return f>s?s:f}setBulk(r,s){this.bits[Math.floor(r/32)]=s}setRange(r,s){if(s<r||r<0||s>this.size)throw new C;if(s===r)return;s--;const a=Math.floor(r/32),o=Math.floor(s/32),c=this.bits;for(let h=a;h<=o;h++){const f=h>a?0:r&31,y=(2<<(h<o?31:s&31))-(1<<f);c[h]|=y}}clear(){const r=this.bits.length,s=this.bits;for(let a=0;a<r;a++)s[a]=0}isRange(r,s,a){if(s<r||r<0||s>this.size)throw new C;if(s===r)return!0;s--;const o=Math.floor(r/32),c=Math.floor(s/32),h=this.bits;for(let f=o;f<=c;f++){const x=f>o?0:r&31,v=(2<<(f<c?31:s&31))-(1<<x)&4294967295;if((h[f]&v)!==(a?v:0))return!1}return!0}appendBit(r){this.ensureCapacity(this.size+1),r&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(r,s){if(s<0||s>32)throw new C("Num bits must be between 0 and 32");this.ensureCapacity(this.size+s);for(let a=s;a>0;a--)this.appendBit((r>>a-1&1)===1)}appendBitArray(r){const s=r.size;this.ensureCapacity(this.size+s);for(let a=0;a<s;a++)this.appendBit(r.get(a))}xor(r){if(this.size!==r.size)throw new C("Sizes don't match");const s=this.bits;for(let a=0,o=s.length;a<o;a++)s[a]^=r.bits[a]}toBytes(r,s,a,o){for(let c=0;c<o;c++){let h=0;for(let f=0;f<8;f++)this.get(r)&&(h|=1<<7-f),r++;s[a+c]=h}}getBitArray(){return this.bits}reverse(){const r=new Int32Array(this.bits.length),s=Math.floor((this.size-1)/32),a=s+1,o=this.bits;for(let c=0;c<a;c++){let h=o[c];h=h>>1&1431655765|(h&1431655765)<<1,h=h>>2&858993459|(h&858993459)<<2,h=h>>4&252645135|(h&252645135)<<4,h=h>>8&16711935|(h&16711935)<<8,h=h>>16&65535|(h&65535)<<16,r[s-c]=h}if(this.size!==a*32){const c=a*32-this.size;let h=r[0]>>>c;for(let f=1;f<a;f++){const x=r[f];h|=x<<32-c,r[f-1]=h,h=x>>>c}r[a-1]=h}this.bits=r}static makeArray(r){return new Int32Array(Math.floor((r+31)/32))}equals(r){if(!(r instanceof z))return!1;const s=r;return this.size===s.size&&H.equals(this.bits,s.bits)}hashCode(){return 31*this.size+H.hashCode(this.bits)}toString(){let r="";for(let s=0,a=this.size;s<a;s++)(s&7)===0&&(r+=" "),r+=this.get(s)?"X":".";return r}clone(){return new z(this.size,this.bits.slice())}}var ae;(function(E){E[E.OTHER=0]="OTHER",E[E.PURE_BARCODE=1]="PURE_BARCODE",E[E.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",E[E.TRY_HARDER=3]="TRY_HARDER",E[E.CHARACTER_SET=4]="CHARACTER_SET",E[E.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",E[E.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",E[E.ASSUME_GS1=7]="ASSUME_GS1",E[E.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",E[E.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",E[E.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(ae||(ae={}));var V=ae;class G extends m{static getFormatInstance(){return new G}}G.kind="FormatException";var P;(function(E){E[E.Cp437=0]="Cp437",E[E.ISO8859_1=1]="ISO8859_1",E[E.ISO8859_2=2]="ISO8859_2",E[E.ISO8859_3=3]="ISO8859_3",E[E.ISO8859_4=4]="ISO8859_4",E[E.ISO8859_5=5]="ISO8859_5",E[E.ISO8859_6=6]="ISO8859_6",E[E.ISO8859_7=7]="ISO8859_7",E[E.ISO8859_8=8]="ISO8859_8",E[E.ISO8859_9=9]="ISO8859_9",E[E.ISO8859_10=10]="ISO8859_10",E[E.ISO8859_11=11]="ISO8859_11",E[E.ISO8859_13=12]="ISO8859_13",E[E.ISO8859_14=13]="ISO8859_14",E[E.ISO8859_15=14]="ISO8859_15",E[E.ISO8859_16=15]="ISO8859_16",E[E.SJIS=16]="SJIS",E[E.Cp1250=17]="Cp1250",E[E.Cp1251=18]="Cp1251",E[E.Cp1252=19]="Cp1252",E[E.Cp1256=20]="Cp1256",E[E.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",E[E.UTF8=22]="UTF8",E[E.ASCII=23]="ASCII",E[E.Big5=24]="Big5",E[E.GB18030=25]="GB18030",E[E.EUC_KR=26]="EUC_KR"})(P||(P={}));class O{constructor(r,s,a,...o){this.valueIdentifier=r,this.name=a,typeof s=="number"?this.values=Int32Array.from([s]):this.values=s,this.otherEncodingNames=o,O.VALUE_IDENTIFIER_TO_ECI.set(r,this),O.NAME_TO_ECI.set(a,this);const c=this.values;for(let h=0,f=c.length;h!==f;h++){const x=c[h];O.VALUES_TO_ECI.set(x,this)}for(const h of o)O.NAME_TO_ECI.set(h,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(r){if(r<0||r>=900)throw new G("incorect value");const s=O.VALUES_TO_ECI.get(r);if(s===void 0)throw new G("incorect value");return s}static getCharacterSetECIByName(r){const s=O.NAME_TO_ECI.get(r);if(s===void 0)throw new G("incorect value");return s}equals(r){if(!(r instanceof O))return!1;const s=r;return this.getName()===s.getName()}}O.VALUE_IDENTIFIER_TO_ECI=new Map,O.VALUES_TO_ECI=new Map,O.NAME_TO_ECI=new Map,O.Cp437=new O(P.Cp437,Int32Array.from([0,2]),"Cp437"),O.ISO8859_1=new O(P.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),O.ISO8859_2=new O(P.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),O.ISO8859_3=new O(P.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),O.ISO8859_4=new O(P.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),O.ISO8859_5=new O(P.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),O.ISO8859_6=new O(P.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),O.ISO8859_7=new O(P.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),O.ISO8859_8=new O(P.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),O.ISO8859_9=new O(P.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),O.ISO8859_10=new O(P.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),O.ISO8859_11=new O(P.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),O.ISO8859_13=new O(P.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),O.ISO8859_14=new O(P.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),O.ISO8859_15=new O(P.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),O.ISO8859_16=new O(P.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),O.SJIS=new O(P.SJIS,20,"SJIS","Shift_JIS"),O.Cp1250=new O(P.Cp1250,21,"Cp1250","windows-1250"),O.Cp1251=new O(P.Cp1251,22,"Cp1251","windows-1251"),O.Cp1252=new O(P.Cp1252,23,"Cp1252","windows-1252"),O.Cp1256=new O(P.Cp1256,24,"Cp1256","windows-1256"),O.UnicodeBigUnmarked=new O(P.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),O.UTF8=new O(P.UTF8,26,"UTF8","UTF-8"),O.ASCII=new O(P.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),O.Big5=new O(P.Big5,28,"Big5"),O.GB18030=new O(P.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),O.EUC_KR=new O(P.EUC_KR,30,"EUC_KR","EUC-KR");class ne extends m{}ne.kind="UnsupportedOperationException";class oe{static decode(r,s){const a=this.encodingName(s);return this.customDecoder?this.customDecoder(r,a):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(a)?this.decodeFallback(r,a):new TextDecoder(a).decode(r)}static shouldDecodeOnFallback(r){return!oe.isBrowser()&&r==="ISO-8859-1"}static encode(r,s){const a=this.encodingName(s);return this.customEncoder?this.customEncoder(r,a):typeof TextEncoder>"u"?this.encodeFallback(r):new TextEncoder().encode(r)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(r){return typeof r=="string"?r:r.getName()}static encodingCharacterSet(r){return r instanceof O?r:O.getCharacterSetECIByName(r)}static decodeFallback(r,s){const a=this.encodingCharacterSet(s);if(oe.isDecodeFallbackSupported(a)){let o="";for(let c=0,h=r.length;c<h;c++){let f=r[c].toString(16);f.length<2&&(f="0"+f),o+="%"+f}return decodeURIComponent(o)}if(a.equals(O.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(r.buffer));throw new ne(`Encoding ${this.encodingName(s)} not supported by fallback.`)}static isDecodeFallbackSupported(r){return r.equals(O.UTF8)||r.equals(O.ISO8859_1)||r.equals(O.ASCII)}static encodeFallback(r){const a=btoa(unescape(encodeURIComponent(r))).split(""),o=[];for(let c=0;c<a.length;c++)o.push(a[c].charCodeAt(0));return new Uint8Array(o)}}class ue{static castAsNonUtf8Char(r,s=null){const a=s?s.getName():this.ISO88591;return oe.decode(new Uint8Array([r]),a)}static guessEncoding(r,s){if(s!=null&&s.get(V.CHARACTER_SET)!==void 0)return s.get(V.CHARACTER_SET).toString();const a=r.length;let o=!0,c=!0,h=!0,f=0,x=0,y=0,v=0,A=0,S=0,j=0,L=0,U=0,X=0,ee=0;const le=r.length>3&&r[0]===239&&r[1]===187&&r[2]===191;for(let de=0;de<a&&(o||c||h);de++){const ie=r[de]&255;h&&(f>0?(ie&128)===0?h=!1:f--:(ie&128)!==0&&((ie&64)===0?h=!1:(f++,(ie&32)===0?x++:(f++,(ie&16)===0?y++:(f++,(ie&8)===0?v++:h=!1))))),o&&(ie>127&&ie<160?o=!1:ie>159&&(ie<192||ie===215||ie===247)&&ee++),c&&(A>0?ie<64||ie===127||ie>252?c=!1:A--:ie===128||ie===160||ie>239?c=!1:ie>160&&ie<224?(S++,L=0,j++,j>U&&(U=j)):ie>127?(A++,j=0,L++,L>X&&(X=L)):(j=0,L=0))}return h&&f>0&&(h=!1),c&&A>0&&(c=!1),h&&(le||x+y+v>0)?ue.UTF8:c&&(ue.ASSUME_SHIFT_JIS||U>=3||X>=3)?ue.SHIFT_JIS:o&&c?U===2&&S===2||ee*10>=a?ue.SHIFT_JIS:ue.ISO88591:o?ue.ISO88591:c?ue.SHIFT_JIS:h?ue.UTF8:ue.PLATFORM_DEFAULT_ENCODING}static format(r,...s){let a=-1;function o(h,f,x,y,v,A){if(h==="%%")return"%";if(s[++a]===void 0)return;h=y?parseInt(y.substr(1)):void 0;let S=v?parseInt(v.substr(1)):void 0,j;switch(A){case"s":j=s[a];break;case"c":j=s[a][0];break;case"f":j=parseFloat(s[a]).toFixed(h);break;case"p":j=parseFloat(s[a]).toPrecision(h);break;case"e":j=parseFloat(s[a]).toExponential(h);break;case"x":j=parseInt(s[a]).toString(S||16);break;case"d":j=parseFloat(parseInt(s[a],S||10).toPrecision(h)).toFixed(0);break}j=typeof j=="object"?JSON.stringify(j):(+j).toString(S);let L=parseInt(x),U=x&&x[0]+""=="0"?"0":" ";for(;j.length<L;)j=f!==void 0?j+U:U+j;return j}let c=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return r.replace(c,o)}static getBytes(r,s){return oe.encode(r,s)}static getCharCode(r,s=0){return r.charCodeAt(s)}static getCharAt(r){return String.fromCharCode(r)}}ue.SHIFT_JIS=O.SJIS.getName(),ue.GB2312="GB2312",ue.ISO88591=O.ISO8859_1.getName(),ue.EUC_JP="EUC_JP",ue.UTF8=O.UTF8.getName(),ue.PLATFORM_DEFAULT_ENCODING=ue.UTF8,ue.ASSUME_SHIFT_JIS=!1;class te{constructor(r=""){this.value=r}enableDecoding(r){return this.encoding=r,this}append(r){return typeof r=="string"?this.value+=r.toString():this.encoding?this.value+=ue.castAsNonUtf8Char(r,this.encoding):this.value+=String.fromCharCode(r),this}appendChars(r,s,a){for(let o=s;s<s+a;o++)this.append(r[o]);return this}length(){return this.value.length}charAt(r){return this.value.charAt(r)}deleteCharAt(r){this.value=this.value.substr(0,r)+this.value.substring(r+1)}setCharAt(r,s){this.value=this.value.substr(0,r)+s+this.value.substr(r+1)}substring(r,s){return this.value.substring(r,s)}setLengthToZero(){this.value=""}toString(){return this.value}insert(r,s){this.value=this.value.substr(0,r)+s+this.value.substr(r+s.length)}}class ge{constructor(r,s,a,o){if(this.width=r,this.height=s,this.rowSize=a,this.bits=o,s==null&&(s=r),this.height=s,r<1||s<1)throw new C("Both dimensions must be greater than 0");a==null&&(a=Math.floor((r+31)/32)),this.rowSize=a,o==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(r){const s=r.length,a=r[0].length,o=new ge(a,s);for(let c=0;c<s;c++){const h=r[c];for(let f=0;f<a;f++)h[f]&&o.set(f,c)}return o}static parseFromString(r,s,a){if(r===null)throw new C("stringRepresentation cannot be null");const o=new Array(r.length);let c=0,h=0,f=-1,x=0,y=0;for(;y<r.length;)if(r.charAt(y)===`
`||r.charAt(y)==="\r"){if(c>h){if(f===-1)f=c-h;else if(c-h!==f)throw new C("row lengths do not match");h=c,x++}y++}else if(r.substring(y,y+s.length)===s)y+=s.length,o[c]=!0,c++;else if(r.substring(y,y+a.length)===a)y+=a.length,o[c]=!1,c++;else throw new C("illegal character encountered: "+r.substring(y));if(c>h){if(f===-1)f=c-h;else if(c-h!==f)throw new C("row lengths do not match");x++}const v=new ge(f,x);for(let A=0;A<c;A++)o[A]&&v.set(Math.floor(A%f),Math.floor(A/f));return v}get(r,s){const a=s*this.rowSize+Math.floor(r/32);return(this.bits[a]>>>(r&31)&1)!==0}set(r,s){const a=s*this.rowSize+Math.floor(r/32);this.bits[a]|=1<<(r&31)&4294967295}unset(r,s){const a=s*this.rowSize+Math.floor(r/32);this.bits[a]&=~(1<<(r&31)&4294967295)}flip(r,s){const a=s*this.rowSize+Math.floor(r/32);this.bits[a]^=1<<(r&31)&4294967295}xor(r){if(this.width!==r.getWidth()||this.height!==r.getHeight()||this.rowSize!==r.getRowSize())throw new C("input matrix dimensions do not match");const s=new z(Math.floor(this.width/32)+1),a=this.rowSize,o=this.bits;for(let c=0,h=this.height;c<h;c++){const f=c*a,x=r.getRow(c,s).getBitArray();for(let y=0;y<a;y++)o[f+y]^=x[y]}}clear(){const r=this.bits,s=r.length;for(let a=0;a<s;a++)r[a]=0}setRegion(r,s,a,o){if(s<0||r<0)throw new C("Left and top must be nonnegative");if(o<1||a<1)throw new C("Height and width must be at least 1");const c=r+a,h=s+o;if(h>this.height||c>this.width)throw new C("The region must fit inside the matrix");const f=this.rowSize,x=this.bits;for(let y=s;y<h;y++){const v=y*f;for(let A=r;A<c;A++)x[v+Math.floor(A/32)]|=1<<(A&31)&4294967295}}getRow(r,s){s==null||s.getSize()<this.width?s=new z(this.width):s.clear();const a=this.rowSize,o=this.bits,c=r*a;for(let h=0;h<a;h++)s.setBulk(h*32,o[c+h]);return s}setRow(r,s){T.arraycopy(s.getBitArray(),0,this.bits,r*this.rowSize,this.rowSize)}rotate180(){const r=this.getWidth(),s=this.getHeight();let a=new z(r),o=new z(r);for(let c=0,h=Math.floor((s+1)/2);c<h;c++)a=this.getRow(c,a),o=this.getRow(s-1-c,o),a.reverse(),o.reverse(),this.setRow(c,o),this.setRow(s-1-c,a)}getEnclosingRectangle(){const r=this.width,s=this.height,a=this.rowSize,o=this.bits;let c=r,h=s,f=-1,x=-1;for(let y=0;y<s;y++)for(let v=0;v<a;v++){const A=o[y*a+v];if(A!==0){if(y<h&&(h=y),y>x&&(x=y),v*32<c){let S=0;for(;(A<<31-S&4294967295)===0;)S++;v*32+S<c&&(c=v*32+S)}if(v*32+31>f){let S=31;for(;!(A>>>S);)S--;v*32+S>f&&(f=v*32+S)}}}return f<c||x<h?null:Int32Array.from([c,h,f-c+1,x-h+1])}getTopLeftOnBit(){const r=this.rowSize,s=this.bits;let a=0;for(;a<s.length&&s[a]===0;)a++;if(a===s.length)return null;const o=a/r;let c=a%r*32;const h=s[a];let f=0;for(;(h<<31-f&4294967295)===0;)f++;return c+=f,Int32Array.from([c,o])}getBottomRightOnBit(){const r=this.rowSize,s=this.bits;let a=s.length-1;for(;a>=0&&s[a]===0;)a--;if(a<0)return null;const o=Math.floor(a/r);let c=Math.floor(a%r)*32;const h=s[a];let f=31;for(;!(h>>>f);)f--;return c+=f,Int32Array.from([c,o])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(r){if(!(r instanceof ge))return!1;const s=r;return this.width===s.width&&this.height===s.height&&this.rowSize===s.rowSize&&H.equals(this.bits,s.bits)}hashCode(){let r=this.width;return r=31*r+this.width,r=31*r+this.height,r=31*r+this.rowSize,r=31*r+H.hashCode(this.bits),r}toString(r="X ",s="  ",a=`
`){return this.buildToString(r,s,a)}buildToString(r,s,a){let o=new te;for(let c=0,h=this.height;c<h;c++){for(let f=0,x=this.width;f<x;f++)o.append(this.get(f,c)?r:s);o.append(a)}return o.toString()}clone(){return new ge(this.width,this.height,this.rowSize,this.bits.slice())}}class q extends m{static getNotFoundInstance(){return new q}}q.kind="NotFoundException";class Z extends I{constructor(r){super(r),this.luminances=Z.EMPTY,this.buckets=new Int32Array(Z.LUMINANCE_BUCKETS)}getBlackRow(r,s){const a=this.getLuminanceSource(),o=a.getWidth();s==null||s.getSize()<o?s=new z(o):s.clear(),this.initArrays(o);const c=a.getRow(r,this.luminances),h=this.buckets;for(let x=0;x<o;x++)h[(c[x]&255)>>Z.LUMINANCE_SHIFT]++;const f=Z.estimateBlackPoint(h);if(o<3)for(let x=0;x<o;x++)(c[x]&255)<f&&s.set(x);else{let x=c[0]&255,y=c[1]&255;for(let v=1;v<o-1;v++){const A=c[v+1]&255;(y*4-x-A)/2<f&&s.set(v),x=y,y=A}}return s}getBlackMatrix(){const r=this.getLuminanceSource(),s=r.getWidth(),a=r.getHeight(),o=new ge(s,a);this.initArrays(s);const c=this.buckets;for(let x=1;x<5;x++){const y=Math.floor(a*x/5),v=r.getRow(y,this.luminances),A=Math.floor(s*4/5);for(let S=Math.floor(s/5);S<A;S++){const j=v[S]&255;c[j>>Z.LUMINANCE_SHIFT]++}}const h=Z.estimateBlackPoint(c),f=r.getMatrix();for(let x=0;x<a;x++){const y=x*s;for(let v=0;v<s;v++)(f[y+v]&255)<h&&o.set(v,x)}return o}createBinarizer(r){return new Z(r)}initArrays(r){this.luminances.length<r&&(this.luminances=new Uint8ClampedArray(r));const s=this.buckets;for(let a=0;a<Z.LUMINANCE_BUCKETS;a++)s[a]=0}static estimateBlackPoint(r){const s=r.length;let a=0,o=0,c=0;for(let v=0;v<s;v++)r[v]>c&&(o=v,c=r[v]),r[v]>a&&(a=r[v]);let h=0,f=0;for(let v=0;v<s;v++){const A=v-o,S=r[v]*A*A;S>f&&(h=v,f=S)}if(o>h){const v=o;o=h,h=v}if(h-o<=s/16)throw new q;let x=h-1,y=-1;for(let v=h-1;v>o;v--){const A=v-o,S=A*A*(h-v)*(a-r[v]);S>y&&(x=v,y=S)}return x<<Z.LUMINANCE_SHIFT}}Z.LUMINANCE_BITS=5,Z.LUMINANCE_SHIFT=8-Z.LUMINANCE_BITS,Z.LUMINANCE_BUCKETS=1<<Z.LUMINANCE_BITS,Z.EMPTY=Uint8ClampedArray.from([0]);class Y extends Z{constructor(r){super(r),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const r=this.getLuminanceSource(),s=r.getWidth(),a=r.getHeight();if(s>=Y.MINIMUM_DIMENSION&&a>=Y.MINIMUM_DIMENSION){const o=r.getMatrix();let c=s>>Y.BLOCK_SIZE_POWER;(s&Y.BLOCK_SIZE_MASK)!==0&&c++;let h=a>>Y.BLOCK_SIZE_POWER;(a&Y.BLOCK_SIZE_MASK)!==0&&h++;const f=Y.calculateBlackPoints(o,c,h,s,a),x=new ge(s,a);Y.calculateThresholdForBlock(o,c,h,s,a,f,x),this.matrix=x}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(r){return new Y(r)}static calculateThresholdForBlock(r,s,a,o,c,h,f){const x=c-Y.BLOCK_SIZE,y=o-Y.BLOCK_SIZE;for(let v=0;v<a;v++){let A=v<<Y.BLOCK_SIZE_POWER;A>x&&(A=x);const S=Y.cap(v,2,a-3);for(let j=0;j<s;j++){let L=j<<Y.BLOCK_SIZE_POWER;L>y&&(L=y);const U=Y.cap(j,2,s-3);let X=0;for(let le=-2;le<=2;le++){const de=h[S+le];X+=de[U-2]+de[U-1]+de[U]+de[U+1]+de[U+2]}const ee=X/25;Y.thresholdBlock(r,L,A,ee,o,f)}}}static cap(r,s,a){return r<s?s:r>a?a:r}static thresholdBlock(r,s,a,o,c,h){for(let f=0,x=a*c+s;f<Y.BLOCK_SIZE;f++,x+=c)for(let y=0;y<Y.BLOCK_SIZE;y++)(r[x+y]&255)<=o&&h.set(s+y,a+f)}static calculateBlackPoints(r,s,a,o,c){const h=c-Y.BLOCK_SIZE,f=o-Y.BLOCK_SIZE,x=new Array(a);for(let y=0;y<a;y++){x[y]=new Int32Array(s);let v=y<<Y.BLOCK_SIZE_POWER;v>h&&(v=h);for(let A=0;A<s;A++){let S=A<<Y.BLOCK_SIZE_POWER;S>f&&(S=f);let j=0,L=255,U=0;for(let ee=0,le=v*o+S;ee<Y.BLOCK_SIZE;ee++,le+=o){for(let de=0;de<Y.BLOCK_SIZE;de++){const ie=r[le+de]&255;j+=ie,ie<L&&(L=ie),ie>U&&(U=ie)}if(U-L>Y.MIN_DYNAMIC_RANGE)for(ee++,le+=o;ee<Y.BLOCK_SIZE;ee++,le+=o)for(let de=0;de<Y.BLOCK_SIZE;de++)j+=r[le+de]&255}let X=j>>Y.BLOCK_SIZE_POWER*2;if(U-L<=Y.MIN_DYNAMIC_RANGE&&(X=L/2,y>0&&A>0)){const ee=(x[y-1][A]+2*x[y][A-1]+x[y-1][A-1])/4;L<ee&&(X=ee)}x[y][A]=X}}return x}}Y.BLOCK_SIZE_POWER=3,Y.BLOCK_SIZE=1<<Y.BLOCK_SIZE_POWER,Y.BLOCK_SIZE_MASK=Y.BLOCK_SIZE-1,Y.MINIMUM_DIMENSION=Y.BLOCK_SIZE*5,Y.MIN_DYNAMIC_RANGE=24;class Q{constructor(r,s){this.width=r,this.height=s}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(r,s,a,o){throw new ne("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new ne("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new ne("This luminance source does not support rotation by 45 degrees.")}toString(){const r=new Uint8ClampedArray(this.width);let s=new te;for(let a=0;a<this.height;a++){const o=this.getRow(a,r);for(let c=0;c<this.width;c++){const h=o[c]&255;let f;h<64?f="#":h<128?f="+":h<192?f=".":f=" ",s.append(f)}s.append(`
`)}return s.toString()}}class Fe extends Q{constructor(r){super(r.getWidth(),r.getHeight()),this.delegate=r}getRow(r,s){const a=this.delegate.getRow(r,s),o=this.getWidth();for(let c=0;c<o;c++)a[c]=255-(a[c]&255);return a}getMatrix(){const r=this.delegate.getMatrix(),s=this.getWidth()*this.getHeight(),a=new Uint8ClampedArray(s);for(let o=0;o<s;o++)a[o]=255-(r[o]&255);return a}isCropSupported(){return this.delegate.isCropSupported()}crop(r,s,a,o){return new Fe(this.delegate.crop(r,s,a,o))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new Fe(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new Fe(this.delegate.rotateCounterClockwise45())}}class qe extends Q{constructor(r){super(r.width,r.height),this.canvas=r,this.tempCanvasElement=null,this.buffer=qe.makeBufferFromCanvasImageData(r)}static makeBufferFromCanvasImageData(r){const s=r.getContext("2d").getImageData(0,0,r.width,r.height);return qe.toGrayscaleBuffer(s.data,r.width,r.height)}static toGrayscaleBuffer(r,s,a){const o=new Uint8ClampedArray(s*a);for(let c=0,h=0,f=r.length;c<f;c+=4,h++){let x;if(r[c+3]===0)x=255;else{const v=r[c],A=r[c+1],S=r[c+2];x=306*v+601*A+117*S+512>>10}o[h]=x}return o}getRow(r,s){if(r<0||r>=this.getHeight())throw new C("Requested row is outside the image: "+r);const a=this.getWidth(),o=r*a;return s===null?s=this.buffer.slice(o,o+a):(s.length<a&&(s=new Uint8ClampedArray(a)),s.set(this.buffer.slice(o,o+a))),s}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(r,s,a,o){return super.crop(r,s,a,o),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const r=this.canvas.ownerDocument.createElement("canvas");r.width=this.canvas.width,r.height=this.canvas.height,this.tempCanvasElement=r}return this.tempCanvasElement}rotate(r){const s=this.getTempCanvasElement(),a=s.getContext("2d"),o=r*qe.DEGREE_TO_RADIANS,c=this.canvas.width,h=this.canvas.height,f=Math.ceil(Math.abs(Math.cos(o))*c+Math.abs(Math.sin(o))*h),x=Math.ceil(Math.abs(Math.sin(o))*c+Math.abs(Math.cos(o))*h);return s.width=f,s.height=x,a.translate(f/2,x/2),a.rotate(o),a.drawImage(this.canvas,c/-2,h/-2),this.buffer=qe.makeBufferFromCanvasImageData(s),this}invert(){return new Fe(this)}}qe.DEGREE_TO_RADIANS=Math.PI/180;class lt{constructor(r,s,a){this.deviceId=r,this.label=s,this.kind="videoinput",this.groupId=a||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var re=(globalThis||Xi||self||window||void 0)&&(globalThis||Xi||self||window||void 0).__awaiter||function(E,r,s,a){function o(c){return c instanceof s?c:new s(function(h){h(c)})}return new(s||(s=Promise))(function(c,h){function f(v){try{y(a.next(v))}catch(A){h(A)}}function x(v){try{y(a.throw(v))}catch(A){h(A)}}function y(v){v.done?c(v.value):o(v.value).then(f,x)}y((a=a.apply(E,r||[])).next())})};class W{constructor(r,s=500,a){this.reader=r,this.timeBetweenScansMillis=s,this._hints=a,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(r){this._timeBetweenDecodingAttempts=r<0?0:r}set hints(r){this._hints=r||null}get hints(){return this._hints}listVideoInputDevices(){return re(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const r=yield navigator.mediaDevices.enumerateDevices(),s=[];for(const a of r){const o=a.kind==="video"?"videoinput":a.kind;if(o!=="videoinput")continue;const c=a.deviceId||a.id,h=a.label||`Video device ${s.length+1}`,f=a.groupId,x={deviceId:c,label:h,kind:o,groupId:f};s.push(x)}return s})}getVideoInputDevices(){return re(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(s=>new lt(s.deviceId,s.label))})}findDeviceById(r){return re(this,void 0,void 0,function*(){const s=yield this.listVideoInputDevices();return s?s.find(a=>a.deviceId===r):null})}decodeFromInputVideoDevice(r,s){return re(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(r,s)})}decodeOnceFromVideoDevice(r,s){return re(this,void 0,void 0,function*(){this.reset();let a;r?a={deviceId:{exact:r}}:a={facingMode:"environment"};const o={video:a};return yield this.decodeOnceFromConstraints(o,s)})}decodeOnceFromConstraints(r,s){return re(this,void 0,void 0,function*(){const a=yield navigator.mediaDevices.getUserMedia(r);return yield this.decodeOnceFromStream(a,s)})}decodeOnceFromStream(r,s){return re(this,void 0,void 0,function*(){this.reset();const a=yield this.attachStreamToVideo(r,s);return yield this.decodeOnce(a)})}decodeFromInputVideoDeviceContinuously(r,s,a){return re(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(r,s,a)})}decodeFromVideoDevice(r,s,a){return re(this,void 0,void 0,function*(){let o;r?o={deviceId:{exact:r}}:o={facingMode:"environment"};const c={video:o};return yield this.decodeFromConstraints(c,s,a)})}decodeFromConstraints(r,s,a){return re(this,void 0,void 0,function*(){const o=yield navigator.mediaDevices.getUserMedia(r);return yield this.decodeFromStream(o,s,a)})}decodeFromStream(r,s,a){return re(this,void 0,void 0,function*(){this.reset();const o=yield this.attachStreamToVideo(r,s);return yield this.decodeContinuously(o,a)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(r,s){return re(this,void 0,void 0,function*(){const a=this.prepareVideoElement(s);return this.addVideoSource(a,r),this.videoElement=a,this.stream=r,yield this.playVideoOnLoadAsync(a),a})}playVideoOnLoadAsync(r){return new Promise((s,a)=>this.playVideoOnLoad(r,()=>s()))}playVideoOnLoad(r,s){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(r),r.addEventListener("ended",this.videoEndedListener),r.addEventListener("canplay",this.videoCanPlayListener),r.addEventListener("playing",s),this.tryPlayVideo(r)}isVideoPlaying(r){return r.currentTime>0&&!r.paused&&!r.ended&&r.readyState>2}tryPlayVideo(r){return re(this,void 0,void 0,function*(){if(this.isVideoPlaying(r)){console.warn("Trying to play video that is already playing.");return}try{yield r.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(r,s){const a=document.getElementById(r);if(!a)throw new b(`element with id '${r}' not found`);if(a.nodeName.toLowerCase()!==s.toLowerCase())throw new b(`element with id '${r}' must be an ${s} element`);return a}decodeFromImage(r,s){if(!r&&!s)throw new b("either imageElement with a src set or an url must be provided");return s&&!r?this.decodeFromImageUrl(s):this.decodeFromImageElement(r)}decodeFromVideo(r,s){if(!r&&!s)throw new b("Either an element with a src set or an URL must be provided");return s&&!r?this.decodeFromVideoUrl(s):this.decodeFromVideoElement(r)}decodeFromVideoContinuously(r,s,a){if(r===void 0&&s===void 0)throw new b("Either an element with a src set or an URL must be provided");return s&&!r?this.decodeFromVideoUrlContinuously(s,a):this.decodeFromVideoElementContinuously(r,a)}decodeFromImageElement(r){if(!r)throw new b("An image element must be provided.");this.reset();const s=this.prepareImageElement(r);this.imageElement=s;let a;return this.isImageLoaded(s)?a=this.decodeOnce(s,!1,!0):a=this._decodeOnLoadImage(s),a}decodeFromVideoElement(r){const s=this._decodeFromVideoElementSetup(r);return this._decodeOnLoadVideo(s)}decodeFromVideoElementContinuously(r,s){const a=this._decodeFromVideoElementSetup(r);return this._decodeOnLoadVideoContinuously(a,s)}_decodeFromVideoElementSetup(r){if(!r)throw new b("A video element must be provided.");this.reset();const s=this.prepareVideoElement(r);return this.videoElement=s,s}decodeFromImageUrl(r){if(!r)throw new b("An URL must be provided.");this.reset();const s=this.prepareImageElement();this.imageElement=s;const a=this._decodeOnLoadImage(s);return s.src=r,a}decodeFromVideoUrl(r){if(!r)throw new b("An URL must be provided.");this.reset();const s=this.prepareVideoElement(),a=this.decodeFromVideoElement(s);return s.src=r,a}decodeFromVideoUrlContinuously(r,s){if(!r)throw new b("An URL must be provided.");this.reset();const a=this.prepareVideoElement(),o=this.decodeFromVideoElementContinuously(a,s);return a.src=r,o}_decodeOnLoadImage(r){return new Promise((s,a)=>{this.imageLoadedListener=()=>this.decodeOnce(r,!1,!0).then(s,a),r.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(r){return re(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(r),yield this.decodeOnce(r)})}_decodeOnLoadVideoContinuously(r,s){return re(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(r),this.decodeContinuously(r,s)})}isImageLoaded(r){return!(!r.complete||r.naturalWidth===0)}prepareImageElement(r){let s;return typeof r>"u"&&(s=document.createElement("img"),s.width=200,s.height=200),typeof r=="string"&&(s=this.getMediaElement(r,"img")),r instanceof HTMLImageElement&&(s=r),s}prepareVideoElement(r){let s;return!r&&typeof document<"u"&&(s=document.createElement("video"),s.width=200,s.height=200),typeof r=="string"&&(s=this.getMediaElement(r,"video")),r instanceof HTMLVideoElement&&(s=r),s.setAttribute("autoplay","true"),s.setAttribute("muted","true"),s.setAttribute("playsinline","true"),s}decodeOnce(r,s=!0,a=!0){this._stopAsyncDecode=!1;const o=(c,h)=>{if(this._stopAsyncDecode){h(new q("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const f=this.decode(r);c(f)}catch(f){const x=s&&f instanceof q,v=(f instanceof N||f instanceof G)&&a;if(x||v)return setTimeout(o,this._timeBetweenDecodingAttempts,c,h);h(f)}};return new Promise((c,h)=>o(c,h))}decodeContinuously(r,s){this._stopContinuousDecode=!1;const a=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const o=this.decode(r);s(o,null),setTimeout(a,this.timeBetweenScansMillis)}catch(o){s(null,o);const c=o instanceof N||o instanceof G,h=o instanceof q;(c||h)&&setTimeout(a,this._timeBetweenDecodingAttempts)}};a()}decode(r){const s=this.createBinaryBitmap(r);return this.decodeBitmap(s)}_isHTMLVideoElement(r){return r.videoWidth!==0}drawFrameOnCanvas(r,s,a){s||(s={sx:0,sy:0,sWidth:r.videoWidth,sHeight:r.videoHeight,dx:0,dy:0,dWidth:r.videoWidth,dHeight:r.videoHeight}),a||(a=this.captureCanvasContext),a.drawImage(r,s.sx,s.sy,s.sWidth,s.sHeight,s.dx,s.dy,s.dWidth,s.dHeight)}drawImageOnCanvas(r,s,a=this.captureCanvasContext){s||(s={sx:0,sy:0,sWidth:r.naturalWidth,sHeight:r.naturalHeight,dx:0,dy:0,dWidth:r.naturalWidth,dHeight:r.naturalHeight}),a||(a=this.captureCanvasContext),a.drawImage(r,s.sx,s.sy,s.sWidth,s.sHeight,s.dx,s.dy,s.dWidth,s.dHeight)}createBinaryBitmap(r){this.getCaptureCanvasContext(r),this._isHTMLVideoElement(r)?this.drawFrameOnCanvas(r):this.drawImageOnCanvas(r);const s=this.getCaptureCanvas(r),a=new qe(s),o=new Y(a);return new _(o)}getCaptureCanvasContext(r){if(!this.captureCanvasContext){const a=this.getCaptureCanvas(r).getContext("2d");this.captureCanvasContext=a}return this.captureCanvasContext}getCaptureCanvas(r){if(!this.captureCanvas){const s=this.createCaptureCanvas(r);this.captureCanvas=s}return this.captureCanvas}decodeBitmap(r){return this.reader.decode(r,this._hints)}createCaptureCanvas(r){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const s=document.createElement("canvas");let a,o;return typeof r<"u"&&(r instanceof HTMLVideoElement?(a=r.videoWidth,o=r.videoHeight):r instanceof HTMLImageElement&&(a=r.naturalWidth||r.width,o=r.naturalHeight||r.height)),s.style.width=a+"px",s.style.height=o+"px",s.width=a,s.height=o,s}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(r=>r.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(r,s){try{r.srcObject=s}catch{r.src=URL.createObjectURL(s)}}cleanVideoSource(r){try{r.srcObject=null}catch{r.src=""}this.videoElement.removeAttribute("src")}}class ce{constructor(r,s,a=s==null?0:8*s.length,o,c,h=T.currentTimeMillis()){this.text=r,this.rawBytes=s,this.numBits=a,this.resultPoints=o,this.format=c,this.timestamp=h,this.text=r,this.rawBytes=s,a==null?this.numBits=s==null?0:8*s.length:this.numBits=a,this.resultPoints=o,this.format=c,this.resultMetadata=null,h==null?this.timestamp=T.currentTimeMillis():this.timestamp=h}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(r,s){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(r,s)}putAllMetadata(r){r!==null&&(this.resultMetadata===null?this.resultMetadata=r:this.resultMetadata=new Map(r))}addResultPoints(r){const s=this.resultPoints;if(s===null)this.resultPoints=r;else if(r!==null&&r.length>0){const a=new Array(s.length+r.length);T.arraycopy(s,0,a,0,s.length),T.arraycopy(r,0,a,s.length,r.length),this.resultPoints=a}}getTimestamp(){return this.timestamp}toString(){return this.text}}var $;(function(E){E[E.AZTEC=0]="AZTEC",E[E.CODABAR=1]="CODABAR",E[E.CODE_39=2]="CODE_39",E[E.CODE_93=3]="CODE_93",E[E.CODE_128=4]="CODE_128",E[E.DATA_MATRIX=5]="DATA_MATRIX",E[E.EAN_8=6]="EAN_8",E[E.EAN_13=7]="EAN_13",E[E.ITF=8]="ITF",E[E.MAXICODE=9]="MAXICODE",E[E.PDF_417=10]="PDF_417",E[E.QR_CODE=11]="QR_CODE",E[E.RSS_14=12]="RSS_14",E[E.RSS_EXPANDED=13]="RSS_EXPANDED",E[E.UPC_A=14]="UPC_A",E[E.UPC_E=15]="UPC_E",E[E.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})($||($={}));var F=$,he;(function(E){E[E.OTHER=0]="OTHER",E[E.ORIENTATION=1]="ORIENTATION",E[E.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",E[E.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",E[E.ISSUE_NUMBER=4]="ISSUE_NUMBER",E[E.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",E[E.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",E[E.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",E[E.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",E[E.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",E[E.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(he||(he={}));var Pe=he;class Ze{constructor(r,s,a,o,c=-1,h=-1){this.rawBytes=r,this.text=s,this.byteSegments=a,this.ecLevel=o,this.structuredAppendSequenceNumber=c,this.structuredAppendParity=h,this.numBits=r==null?0:8*r.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(r){this.numBits=r}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(r){this.errorsCorrected=r}getErasures(){return this.erasures}setErasures(r){this.erasures=r}getOther(){return this.other}setOther(r){this.other=r}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class _t{exp(r){return this.expTable[r]}log(r){if(r===0)throw new C;return this.logTable[r]}static addOrSubtract(r,s){return r^s}}class Nt{constructor(r,s){if(s.length===0)throw new C;this.field=r;const a=s.length;if(a>1&&s[0]===0){let o=1;for(;o<a&&s[o]===0;)o++;o===a?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(a-o),T.arraycopy(s,o,this.coefficients,0,this.coefficients.length))}else this.coefficients=s}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(r){return this.coefficients[this.coefficients.length-1-r]}evaluateAt(r){if(r===0)return this.getCoefficient(0);const s=this.coefficients;let a;if(r===1){a=0;for(let h=0,f=s.length;h!==f;h++){const x=s[h];a=_t.addOrSubtract(a,x)}return a}a=s[0];const o=s.length,c=this.field;for(let h=1;h<o;h++)a=_t.addOrSubtract(c.multiply(r,a),s[h]);return a}addOrSubtract(r){if(!this.field.equals(r.field))throw new C("GenericGFPolys do not have same GenericGF field");if(this.isZero())return r;if(r.isZero())return this;let s=this.coefficients,a=r.coefficients;if(s.length>a.length){const h=s;s=a,a=h}let o=new Int32Array(a.length);const c=a.length-s.length;T.arraycopy(a,0,o,0,c);for(let h=c;h<a.length;h++)o[h]=_t.addOrSubtract(s[h-c],a[h]);return new Nt(this.field,o)}multiply(r){if(!this.field.equals(r.field))throw new C("GenericGFPolys do not have same GenericGF field");if(this.isZero()||r.isZero())return this.field.getZero();const s=this.coefficients,a=s.length,o=r.coefficients,c=o.length,h=new Int32Array(a+c-1),f=this.field;for(let x=0;x<a;x++){const y=s[x];for(let v=0;v<c;v++)h[x+v]=_t.addOrSubtract(h[x+v],f.multiply(y,o[v]))}return new Nt(f,h)}multiplyScalar(r){if(r===0)return this.field.getZero();if(r===1)return this;const s=this.coefficients.length,a=this.field,o=new Int32Array(s),c=this.coefficients;for(let h=0;h<s;h++)o[h]=a.multiply(c[h],r);return new Nt(a,o)}multiplyByMonomial(r,s){if(r<0)throw new C;if(s===0)return this.field.getZero();const a=this.coefficients,o=a.length,c=new Int32Array(o+r),h=this.field;for(let f=0;f<o;f++)c[f]=h.multiply(a[f],s);return new Nt(h,c)}divide(r){if(!this.field.equals(r.field))throw new C("GenericGFPolys do not have same GenericGF field");if(r.isZero())throw new C("Divide by 0");const s=this.field;let a=s.getZero(),o=this;const c=r.getCoefficient(r.getDegree()),h=s.inverse(c);for(;o.getDegree()>=r.getDegree()&&!o.isZero();){const f=o.getDegree()-r.getDegree(),x=s.multiply(o.getCoefficient(o.getDegree()),h),y=r.multiplyByMonomial(f,x),v=s.buildMonomial(f,x);a=a.addOrSubtract(v),o=o.addOrSubtract(y)}return[a,o]}toString(){let r="";for(let s=this.getDegree();s>=0;s--){let a=this.getCoefficient(s);if(a!==0){if(a<0?(r+=" - ",a=-a):r.length>0&&(r+=" + "),s===0||a!==1){const o=this.field.log(a);o===0?r+="1":o===1?r+="a":(r+="a^",r+=o)}s!==0&&(s===1?r+="x":(r+="x^",r+=s))}}return r}}class wr extends m{}wr.kind="ArithmeticException";class tt extends _t{constructor(r,s,a){super(),this.primitive=r,this.size=s,this.generatorBase=a;const o=new Int32Array(s);let c=1;for(let f=0;f<s;f++)o[f]=c,c*=2,c>=s&&(c^=r,c&=s-1);this.expTable=o;const h=new Int32Array(s);for(let f=0;f<s-1;f++)h[o[f]]=f;this.logTable=h,this.zero=new Nt(this,Int32Array.from([0])),this.one=new Nt(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(r,s){if(r<0)throw new C;if(s===0)return this.zero;const a=new Int32Array(r+1);return a[0]=s,new Nt(this,a)}inverse(r){if(r===0)throw new wr;return this.expTable[this.size-this.logTable[r]-1]}multiply(r,s){return r===0||s===0?0:this.expTable[(this.logTable[r]+this.logTable[s])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+B.toHexString(this.primitive)+","+this.size+")"}equals(r){return r===this}}tt.AZTEC_DATA_12=new tt(4201,4096,1),tt.AZTEC_DATA_10=new tt(1033,1024,1),tt.AZTEC_DATA_6=new tt(67,64,1),tt.AZTEC_PARAM=new tt(19,16,1),tt.QR_CODE_FIELD_256=new tt(285,256,0),tt.DATA_MATRIX_FIELD_256=new tt(301,256,1),tt.AZTEC_DATA_8=tt.DATA_MATRIX_FIELD_256,tt.MAXICODE_FIELD_64=tt.AZTEC_DATA_6;class Te extends m{}Te.kind="ReedSolomonException";class je extends m{}je.kind="IllegalStateException";class Ut{constructor(r){this.field=r}decode(r,s){const a=this.field,o=new Nt(a,r),c=new Int32Array(s);let h=!0;for(let j=0;j<s;j++){const L=o.evaluateAt(a.exp(j+a.getGeneratorBase()));c[c.length-1-j]=L,L!==0&&(h=!1)}if(h)return;const f=new Nt(a,c),x=this.runEuclideanAlgorithm(a.buildMonomial(s,1),f,s),y=x[0],v=x[1],A=this.findErrorLocations(y),S=this.findErrorMagnitudes(v,A);for(let j=0;j<A.length;j++){const L=r.length-1-a.log(A[j]);if(L<0)throw new Te("Bad error location");r[L]=tt.addOrSubtract(r[L],S[j])}}runEuclideanAlgorithm(r,s,a){if(r.getDegree()<s.getDegree()){const j=r;r=s,s=j}const o=this.field;let c=r,h=s,f=o.getZero(),x=o.getOne();for(;h.getDegree()>=(a/2|0);){let j=c,L=f;if(c=h,f=x,c.isZero())throw new Te("r_{i-1} was zero");h=j;let U=o.getZero();const X=c.getCoefficient(c.getDegree()),ee=o.inverse(X);for(;h.getDegree()>=c.getDegree()&&!h.isZero();){const le=h.getDegree()-c.getDegree(),de=o.multiply(h.getCoefficient(h.getDegree()),ee);U=U.addOrSubtract(o.buildMonomial(le,de)),h=h.addOrSubtract(c.multiplyByMonomial(le,de))}if(x=U.multiply(f).addOrSubtract(L),h.getDegree()>=c.getDegree())throw new je("Division algorithm failed to reduce polynomial?")}const y=x.getCoefficient(0);if(y===0)throw new Te("sigmaTilde(0) was zero");const v=o.inverse(y),A=x.multiplyScalar(v),S=h.multiplyScalar(v);return[A,S]}findErrorLocations(r){const s=r.getDegree();if(s===1)return Int32Array.from([r.getCoefficient(1)]);const a=new Int32Array(s);let o=0;const c=this.field;for(let h=1;h<c.getSize()&&o<s;h++)r.evaluateAt(h)===0&&(a[o]=c.inverse(h),o++);if(o!==s)throw new Te("Error locator degree does not match number of roots");return a}findErrorMagnitudes(r,s){const a=s.length,o=new Int32Array(a),c=this.field;for(let h=0;h<a;h++){const f=c.inverse(s[h]);let x=1;for(let y=0;y<a;y++)if(h!==y){const v=c.multiply(s[y],f),A=(v&1)===0?v|1:v&-2;x=c.multiply(x,A)}o[h]=c.multiply(r.evaluateAt(f),c.inverse(x)),c.getGeneratorBase()!==0&&(o[h]=c.multiply(o[h],f))}return o}}var ct;(function(E){E[E.UPPER=0]="UPPER",E[E.LOWER=1]="LOWER",E[E.MIXED=2]="MIXED",E[E.DIGIT=3]="DIGIT",E[E.PUNCT=4]="PUNCT",E[E.BINARY=5]="BINARY"})(ct||(ct={}));class Xe{decode(r){this.ddata=r;let s=r.getBits(),a=this.extractBits(s),o=this.correctBits(a),c=Xe.convertBoolArrayToByteArray(o),h=Xe.getEncodedData(o),f=new Ze(c,h,null,null);return f.setNumBits(o.length),f}static highLevelDecode(r){return this.getEncodedData(r)}static getEncodedData(r){let s=r.length,a=ct.UPPER,o=ct.UPPER,c="",h=0;for(;h<s;)if(o===ct.BINARY){if(s-h<5)break;let f=Xe.readCode(r,h,5);if(h+=5,f===0){if(s-h<11)break;f=Xe.readCode(r,h,11)+31,h+=11}for(let x=0;x<f;x++){if(s-h<8){h=s;break}const y=Xe.readCode(r,h,8);c+=ue.castAsNonUtf8Char(y),h+=8}o=a}else{let f=o===ct.DIGIT?4:5;if(s-h<f)break;let x=Xe.readCode(r,h,f);h+=f;let y=Xe.getCharacter(o,x);y.startsWith("CTRL_")?(a=o,o=Xe.getTable(y.charAt(5)),y.charAt(6)==="L"&&(a=o)):(c+=y,o=a)}return c}static getTable(r){switch(r){case"L":return ct.LOWER;case"P":return ct.PUNCT;case"M":return ct.MIXED;case"D":return ct.DIGIT;case"B":return ct.BINARY;case"U":default:return ct.UPPER}}static getCharacter(r,s){switch(r){case ct.UPPER:return Xe.UPPER_TABLE[s];case ct.LOWER:return Xe.LOWER_TABLE[s];case ct.MIXED:return Xe.MIXED_TABLE[s];case ct.PUNCT:return Xe.PUNCT_TABLE[s];case ct.DIGIT:return Xe.DIGIT_TABLE[s];default:throw new je("Bad table")}}correctBits(r){let s,a;this.ddata.getNbLayers()<=2?(a=6,s=tt.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(a=8,s=tt.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(a=10,s=tt.AZTEC_DATA_10):(a=12,s=tt.AZTEC_DATA_12);let o=this.ddata.getNbDatablocks(),c=r.length/a;if(c<o)throw new G;let h=r.length%a,f=new Int32Array(c);for(let S=0;S<c;S++,h+=a)f[S]=Xe.readCode(r,h,a);try{new Ut(s).decode(f,c-o)}catch(S){throw new G(S)}let x=(1<<a)-1,y=0;for(let S=0;S<o;S++){let j=f[S];if(j===0||j===x)throw new G;(j===1||j===x-1)&&y++}let v=new Array(o*a-y),A=0;for(let S=0;S<o;S++){let j=f[S];if(j===1||j===x-1)v.fill(j>1,A,A+a-1),A+=a-1;else for(let L=a-1;L>=0;--L)v[A++]=(j&1<<L)!==0}return v}extractBits(r){let s=this.ddata.isCompact(),a=this.ddata.getNbLayers(),o=(s?11:14)+a*4,c=new Int32Array(o),h=new Array(this.totalBitsInLayer(a,s));if(s)for(let f=0;f<c.length;f++)c[f]=f;else{let f=o+1+2*B.truncDivision(B.truncDivision(o,2)-1,15),x=o/2,y=B.truncDivision(f,2);for(let v=0;v<x;v++){let A=v+B.truncDivision(v,15);c[x-v-1]=y-A-1,c[x+v]=y+A+1}}for(let f=0,x=0;f<a;f++){let y=(a-f)*4+(s?9:12),v=f*2,A=o-1-v;for(let S=0;S<y;S++){let j=S*2;for(let L=0;L<2;L++)h[x+j+L]=r.get(c[v+L],c[v+S]),h[x+2*y+j+L]=r.get(c[v+S],c[A-L]),h[x+4*y+j+L]=r.get(c[A-L],c[A-S]),h[x+6*y+j+L]=r.get(c[A-S],c[v+L])}x+=y*8}return h}static readCode(r,s,a){let o=0;for(let c=s;c<s+a;c++)o<<=1,r[c]&&(o|=1);return o}static readByte(r,s){let a=r.length-s;return a>=8?Xe.readCode(r,s,8):Xe.readCode(r,s,a)<<8-a}static convertBoolArrayToByteArray(r){let s=new Uint8Array((r.length+7)/8);for(let a=0;a<s.length;a++)s[a]=Xe.readByte(r,8*a);return s}totalBitsInLayer(r,s){return((s?88:112)+16*r)*r}}Xe.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Xe.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Xe.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Xe.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Xe.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class Ae{constructor(){}static round(r){return r===NaN?0:r<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:r>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:r+(r<0?-.5:.5)|0}static distance(r,s,a,o){const c=r-a,h=s-o;return Math.sqrt(c*c+h*h)}static sum(r){let s=0;for(let a=0,o=r.length;a!==o;a++){const c=r[a];s+=c}return s}}class sr{static floatToIntBits(r){return r}}sr.MAX_VALUE=Number.MAX_SAFE_INTEGER;class ye{constructor(r,s){this.x=r,this.y=s}getX(){return this.x}getY(){return this.y}equals(r){if(r instanceof ye){const s=r;return this.x===s.x&&this.y===s.y}return!1}hashCode(){return 31*sr.floatToIntBits(this.x)+sr.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(r){const s=this.distance(r[0],r[1]),a=this.distance(r[1],r[2]),o=this.distance(r[0],r[2]);let c,h,f;if(a>=s&&a>=o?(h=r[0],c=r[1],f=r[2]):o>=a&&o>=s?(h=r[1],c=r[0],f=r[2]):(h=r[2],c=r[0],f=r[1]),this.crossProductZ(c,h,f)<0){const x=c;c=f,f=x}r[0]=c,r[1]=h,r[2]=f}static distance(r,s){return Ae.distance(r.x,r.y,s.x,s.y)}static crossProductZ(r,s,a){const o=s.x,c=s.y;return(a.x-o)*(r.y-c)-(a.y-c)*(r.x-o)}}class gr{constructor(r,s){this.bits=r,this.points=s}getBits(){return this.bits}getPoints(){return this.points}}class rn extends gr{constructor(r,s,a,o,c){super(r,s),this.compact=a,this.nbDatablocks=o,this.nbLayers=c}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Qt{constructor(r,s,a,o){this.image=r,this.height=r.getHeight(),this.width=r.getWidth(),s==null&&(s=Qt.INIT_SIZE),a==null&&(a=r.getWidth()/2|0),o==null&&(o=r.getHeight()/2|0);const c=s/2|0;if(this.leftInit=a-c,this.rightInit=a+c,this.upInit=o-c,this.downInit=o+c,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new q}detect(){let r=this.leftInit,s=this.rightInit,a=this.upInit,o=this.downInit,c=!1,h=!0,f=!1,x=!1,y=!1,v=!1,A=!1;const S=this.width,j=this.height;for(;h;){h=!1;let L=!0;for(;(L||!x)&&s<S;)L=this.containsBlackPoint(a,o,s,!1),L?(s++,h=!0,x=!0):x||s++;if(s>=S){c=!0;break}let U=!0;for(;(U||!y)&&o<j;)U=this.containsBlackPoint(r,s,o,!0),U?(o++,h=!0,y=!0):y||o++;if(o>=j){c=!0;break}let X=!0;for(;(X||!v)&&r>=0;)X=this.containsBlackPoint(a,o,r,!1),X?(r--,h=!0,v=!0):v||r--;if(r<0){c=!0;break}let ee=!0;for(;(ee||!A)&&a>=0;)ee=this.containsBlackPoint(r,s,a,!0),ee?(a--,h=!0,A=!0):A||a--;if(a<0){c=!0;break}h&&(f=!0)}if(!c&&f){const L=s-r;let U=null;for(let de=1;U===null&&de<L;de++)U=this.getBlackPointOnSegment(r,o-de,r+de,o);if(U==null)throw new q;let X=null;for(let de=1;X===null&&de<L;de++)X=this.getBlackPointOnSegment(r,a+de,r+de,a);if(X==null)throw new q;let ee=null;for(let de=1;ee===null&&de<L;de++)ee=this.getBlackPointOnSegment(s,a+de,s-de,a);if(ee==null)throw new q;let le=null;for(let de=1;le===null&&de<L;de++)le=this.getBlackPointOnSegment(s,o-de,s-de,o);if(le==null)throw new q;return this.centerEdges(le,U,ee,X)}else throw new q}getBlackPointOnSegment(r,s,a,o){const c=Ae.round(Ae.distance(r,s,a,o)),h=(a-r)/c,f=(o-s)/c,x=this.image;for(let y=0;y<c;y++){const v=Ae.round(r+y*h),A=Ae.round(s+y*f);if(x.get(v,A))return new ye(v,A)}return null}centerEdges(r,s,a,o){const c=r.getX(),h=r.getY(),f=s.getX(),x=s.getY(),y=a.getX(),v=a.getY(),A=o.getX(),S=o.getY(),j=Qt.CORR;return c<this.width/2?[new ye(A-j,S+j),new ye(f+j,x+j),new ye(y-j,v-j),new ye(c+j,h-j)]:[new ye(A+j,S+j),new ye(f+j,x-j),new ye(y-j,v+j),new ye(c-j,h-j)]}containsBlackPoint(r,s,a,o){const c=this.image;if(o){for(let h=r;h<=s;h++)if(c.get(h,a))return!0}else for(let h=r;h<=s;h++)if(c.get(a,h))return!0;return!1}}Qt.INIT_SIZE=10,Qt.CORR=1;class Vr{static checkAndNudgePoints(r,s){const a=r.getWidth(),o=r.getHeight();let c=!0;for(let h=0;h<s.length&&c;h+=2){const f=Math.floor(s[h]),x=Math.floor(s[h+1]);if(f<-1||f>a||x<-1||x>o)throw new q;c=!1,f===-1?(s[h]=0,c=!0):f===a&&(s[h]=a-1,c=!0),x===-1?(s[h+1]=0,c=!0):x===o&&(s[h+1]=o-1,c=!0)}c=!0;for(let h=s.length-2;h>=0&&c;h-=2){const f=Math.floor(s[h]),x=Math.floor(s[h+1]);if(f<-1||f>a||x<-1||x>o)throw new q;c=!1,f===-1?(s[h]=0,c=!0):f===a&&(s[h]=a-1,c=!0),x===-1?(s[h+1]=0,c=!0):x===o&&(s[h+1]=o-1,c=!0)}}}class $t{constructor(r,s,a,o,c,h,f,x,y){this.a11=r,this.a21=s,this.a31=a,this.a12=o,this.a22=c,this.a32=h,this.a13=f,this.a23=x,this.a33=y}static quadrilateralToQuadrilateral(r,s,a,o,c,h,f,x,y,v,A,S,j,L,U,X){const ee=$t.quadrilateralToSquare(r,s,a,o,c,h,f,x);return $t.squareToQuadrilateral(y,v,A,S,j,L,U,X).times(ee)}transformPoints(r){const s=r.length,a=this.a11,o=this.a12,c=this.a13,h=this.a21,f=this.a22,x=this.a23,y=this.a31,v=this.a32,A=this.a33;for(let S=0;S<s;S+=2){const j=r[S],L=r[S+1],U=c*j+x*L+A;r[S]=(a*j+h*L+y)/U,r[S+1]=(o*j+f*L+v)/U}}transformPointsWithValues(r,s){const a=this.a11,o=this.a12,c=this.a13,h=this.a21,f=this.a22,x=this.a23,y=this.a31,v=this.a32,A=this.a33,S=r.length;for(let j=0;j<S;j++){const L=r[j],U=s[j],X=c*L+x*U+A;r[j]=(a*L+h*U+y)/X,s[j]=(o*L+f*U+v)/X}}static squareToQuadrilateral(r,s,a,o,c,h,f,x){const y=r-a+c-f,v=s-o+h-x;if(y===0&&v===0)return new $t(a-r,c-a,r,o-s,h-o,s,0,0,1);{const A=a-c,S=f-c,j=o-h,L=x-h,U=A*L-S*j,X=(y*L-S*v)/U,ee=(A*v-y*j)/U;return new $t(a-r+X*a,f-r+ee*f,r,o-s+X*o,x-s+ee*x,s,X,ee,1)}}static quadrilateralToSquare(r,s,a,o,c,h,f,x){return $t.squareToQuadrilateral(r,s,a,o,c,h,f,x).buildAdjoint()}buildAdjoint(){return new $t(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(r){return new $t(this.a11*r.a11+this.a21*r.a12+this.a31*r.a13,this.a11*r.a21+this.a21*r.a22+this.a31*r.a23,this.a11*r.a31+this.a21*r.a32+this.a31*r.a33,this.a12*r.a11+this.a22*r.a12+this.a32*r.a13,this.a12*r.a21+this.a22*r.a22+this.a32*r.a23,this.a12*r.a31+this.a22*r.a32+this.a32*r.a33,this.a13*r.a11+this.a23*r.a12+this.a33*r.a13,this.a13*r.a21+this.a23*r.a22+this.a33*r.a23,this.a13*r.a31+this.a23*r.a32+this.a33*r.a33)}}class nn extends Vr{sampleGrid(r,s,a,o,c,h,f,x,y,v,A,S,j,L,U,X,ee,le,de){const ie=$t.quadrilateralToQuadrilateral(o,c,h,f,x,y,v,A,S,j,L,U,X,ee,le,de);return this.sampleGridWithTransform(r,s,a,ie)}sampleGridWithTransform(r,s,a,o){if(s<=0||a<=0)throw new q;const c=new ge(s,a),h=new Float32Array(2*s);for(let f=0;f<a;f++){const x=h.length,y=f+.5;for(let v=0;v<x;v+=2)h[v]=v/2+.5,h[v+1]=y;o.transformPoints(h),Vr.checkAndNudgePoints(r,h);try{for(let v=0;v<x;v+=2)r.get(Math.floor(h[v]),Math.floor(h[v+1]))&&c.set(v/2,f)}catch{throw new q}}return c}}class Xr{static setGridSampler(r){Xr.gridSampler=r}static getInstance(){return Xr.gridSampler}}Xr.gridSampler=new nn;class ir{constructor(r,s){this.x=r,this.y=s}toResultPoint(){return new ye(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Li{constructor(r){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=r}detect(){return this.detectMirror(!1)}detectMirror(r){let s=this.getMatrixCenter(),a=this.getBullsEyeCorners(s);if(r){let h=a[0];a[0]=a[2],a[2]=h}this.extractParameters(a);let o=this.sampleGrid(this.image,a[this.shift%4],a[(this.shift+1)%4],a[(this.shift+2)%4],a[(this.shift+3)%4]),c=this.getMatrixCornerPoints(a);return new rn(o,c,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(r){if(!this.isValidPoint(r[0])||!this.isValidPoint(r[1])||!this.isValidPoint(r[2])||!this.isValidPoint(r[3]))throw new q;let s=2*this.nbCenterLayers,a=new Int32Array([this.sampleLine(r[0],r[1],s),this.sampleLine(r[1],r[2],s),this.sampleLine(r[2],r[3],s),this.sampleLine(r[3],r[0],s)]);this.shift=this.getRotation(a,s);let o=0;for(let h=0;h<4;h++){let f=a[(this.shift+h)%4];this.compact?(o<<=7,o+=f>>1&127):(o<<=10,o+=(f>>2&992)+(f>>1&31))}let c=this.getCorrectedParameterData(o,this.compact);this.compact?(this.nbLayers=(c>>6)+1,this.nbDataBlocks=(c&63)+1):(this.nbLayers=(c>>11)+1,this.nbDataBlocks=(c&2047)+1)}getRotation(r,s){let a=0;r.forEach((o,c,h)=>{let f=(o>>s-2<<1)+(o&1);a=(a<<3)+f}),a=((a&1)<<11)+(a>>1);for(let o=0;o<4;o++)if(B.bitCount(a^this.EXPECTED_CORNER_BITS[o])<=2)return o;throw new q}getCorrectedParameterData(r,s){let a,o;s?(a=7,o=2):(a=10,o=4);let c=a-o,h=new Int32Array(a);for(let x=a-1;x>=0;--x)h[x]=r&15,r>>=4;try{new Ut(tt.AZTEC_PARAM).decode(h,c)}catch{throw new q}let f=0;for(let x=0;x<o;x++)f=(f<<4)+h[x];return f}getBullsEyeCorners(r){let s=r,a=r,o=r,c=r,h=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let A=this.getFirstDifferent(s,h,1,-1),S=this.getFirstDifferent(a,h,1,1),j=this.getFirstDifferent(o,h,-1,1),L=this.getFirstDifferent(c,h,-1,-1);if(this.nbCenterLayers>2){let U=this.distancePoint(L,A)*this.nbCenterLayers/(this.distancePoint(c,s)*(this.nbCenterLayers+2));if(U<.75||U>1.25||!this.isWhiteOrBlackRectangle(A,S,j,L))break}s=A,a=S,o=j,c=L,h=!h}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new q;this.compact=this.nbCenterLayers===5;let f=new ye(s.getX()+.5,s.getY()-.5),x=new ye(a.getX()+.5,a.getY()+.5),y=new ye(o.getX()-.5,o.getY()+.5),v=new ye(c.getX()-.5,c.getY()-.5);return this.expandSquare([f,x,y,v],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let r,s,a,o;try{let f=new Qt(this.image).detect();r=f[0],s=f[1],a=f[2],o=f[3]}catch{let x=this.image.getWidth()/2,y=this.image.getHeight()/2;r=this.getFirstDifferent(new ir(x+7,y-7),!1,1,-1).toResultPoint(),s=this.getFirstDifferent(new ir(x+7,y+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new ir(x-7,y+7),!1,-1,1).toResultPoint(),o=this.getFirstDifferent(new ir(x-7,y-7),!1,-1,-1).toResultPoint()}let c=Ae.round((r.getX()+o.getX()+s.getX()+a.getX())/4),h=Ae.round((r.getY()+o.getY()+s.getY()+a.getY())/4);try{let f=new Qt(this.image,15,c,h).detect();r=f[0],s=f[1],a=f[2],o=f[3]}catch{r=this.getFirstDifferent(new ir(c+7,h-7),!1,1,-1).toResultPoint(),s=this.getFirstDifferent(new ir(c+7,h+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new ir(c-7,h+7),!1,-1,1).toResultPoint(),o=this.getFirstDifferent(new ir(c-7,h-7),!1,-1,-1).toResultPoint()}return c=Ae.round((r.getX()+o.getX()+s.getX()+a.getX())/4),h=Ae.round((r.getY()+o.getY()+s.getY()+a.getY())/4),new ir(c,h)}getMatrixCornerPoints(r){return this.expandSquare(r,2*this.nbCenterLayers,this.getDimension())}sampleGrid(r,s,a,o,c){let h=Xr.getInstance(),f=this.getDimension(),x=f/2-this.nbCenterLayers,y=f/2+this.nbCenterLayers;return h.sampleGrid(r,f,f,x,x,y,x,y,y,x,y,s.getX(),s.getY(),a.getX(),a.getY(),o.getX(),o.getY(),c.getX(),c.getY())}sampleLine(r,s,a){let o=0,c=this.distanceResultPoint(r,s),h=c/a,f=r.getX(),x=r.getY(),y=h*(s.getX()-r.getX())/c,v=h*(s.getY()-r.getY())/c;for(let A=0;A<a;A++)this.image.get(Ae.round(f+A*y),Ae.round(x+A*v))&&(o|=1<<a-A-1);return o}isWhiteOrBlackRectangle(r,s,a,o){let c=3;r=new ir(r.getX()-c,r.getY()+c),s=new ir(s.getX()-c,s.getY()-c),a=new ir(a.getX()+c,a.getY()-c),o=new ir(o.getX()+c,o.getY()+c);let h=this.getColor(o,r);if(h===0)return!1;let f=this.getColor(r,s);return f!==h||(f=this.getColor(s,a),f!==h)?!1:(f=this.getColor(a,o),f===h)}getColor(r,s){let a=this.distancePoint(r,s),o=(s.getX()-r.getX())/a,c=(s.getY()-r.getY())/a,h=0,f=r.getX(),x=r.getY(),y=this.image.get(r.getX(),r.getY()),v=Math.ceil(a);for(let S=0;S<v;S++)f+=o,x+=c,this.image.get(Ae.round(f),Ae.round(x))!==y&&h++;let A=h/a;return A>.1&&A<.9?0:A<=.1===y?1:-1}getFirstDifferent(r,s,a,o){let c=r.getX()+a,h=r.getY()+o;for(;this.isValid(c,h)&&this.image.get(c,h)===s;)c+=a,h+=o;for(c-=a,h-=o;this.isValid(c,h)&&this.image.get(c,h)===s;)c+=a;for(c-=a;this.isValid(c,h)&&this.image.get(c,h)===s;)h+=o;return h-=o,new ir(c,h)}expandSquare(r,s,a){let o=a/(2*s),c=r[0].getX()-r[2].getX(),h=r[0].getY()-r[2].getY(),f=(r[0].getX()+r[2].getX())/2,x=(r[0].getY()+r[2].getY())/2,y=new ye(f+o*c,x+o*h),v=new ye(f-o*c,x-o*h);c=r[1].getX()-r[3].getX(),h=r[1].getY()-r[3].getY(),f=(r[1].getX()+r[3].getX())/2,x=(r[1].getY()+r[3].getY())/2;let A=new ye(f+o*c,x+o*h),S=new ye(f-o*c,x-o*h);return[y,A,v,S]}isValid(r,s){return r>=0&&r<this.image.getWidth()&&s>0&&s<this.image.getHeight()}isValidPoint(r){let s=Ae.round(r.getX()),a=Ae.round(r.getY());return this.isValid(s,a)}distancePoint(r,s){return Ae.distance(r.getX(),r.getY(),s.getX(),s.getY())}distanceResultPoint(r,s){return Ae.distance(r.getX(),r.getY(),s.getX(),s.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(B.truncDivision(this.nbLayers-4,8)+1)+15}}class fs{decode(r,s=null){let a=null,o=new Li(r.getBlackMatrix()),c=null,h=null;try{let v=o.detectMirror(!1);c=v.getPoints(),this.reportFoundResultPoints(s,c),h=new Xe().decode(v)}catch(v){a=v}if(h==null)try{let v=o.detectMirror(!0);c=v.getPoints(),this.reportFoundResultPoints(s,c),h=new Xe().decode(v)}catch(v){throw a??v}let f=new ce(h.getText(),h.getRawBytes(),h.getNumBits(),c,F.AZTEC,T.currentTimeMillis()),x=h.getByteSegments();x!=null&&f.putMetadata(Pe.BYTE_SEGMENTS,x);let y=h.getECLevel();return y!=null&&f.putMetadata(Pe.ERROR_CORRECTION_LEVEL,y),f}reportFoundResultPoints(r,s){if(r!=null){let a=r.get(V.NEED_RESULT_POINT_CALLBACK);a!=null&&s.forEach((o,c,h)=>{a.foundPossibleResultPoint(o)})}}reset(){}}class Oa extends W{constructor(r=500){super(new fs,r)}}class ft{decode(r,s){try{return this.doDecode(r,s)}catch{if(s&&s.get(V.TRY_HARDER)===!0&&r.isRotateSupported()){const c=r.rotateCounterClockwise(),h=this.doDecode(c,s),f=h.getResultMetadata();let x=270;f!==null&&f.get(Pe.ORIENTATION)===!0&&(x=x+f.get(Pe.ORIENTATION)%360),h.putMetadata(Pe.ORIENTATION,x);const y=h.getResultPoints();if(y!==null){const v=c.getHeight();for(let A=0;A<y.length;A++)y[A]=new ye(v-y[A].getY()-1,y[A].getX())}return h}else throw new q}}reset(){}doDecode(r,s){const a=r.getWidth(),o=r.getHeight();let c=new z(a);const h=s&&s.get(V.TRY_HARDER)===!0,f=Math.max(1,o>>(h?8:5));let x;h?x=o:x=15;const y=Math.trunc(o/2);for(let v=0;v<x;v++){const A=Math.trunc((v+1)/2),S=(v&1)===0,j=y+f*(S?A:-A);if(j<0||j>=o)break;try{c=r.getBlackRow(j,c)}catch{continue}for(let L=0;L<2;L++){if(L===1&&(c.reverse(),s&&s.get(V.NEED_RESULT_POINT_CALLBACK)===!0)){const U=new Map;s.forEach((X,ee)=>U.set(ee,X)),U.delete(V.NEED_RESULT_POINT_CALLBACK),s=U}try{const U=this.decodeRow(j,c,s);if(L===1){U.putMetadata(Pe.ORIENTATION,180);const X=U.getResultPoints();X!==null&&(X[0]=new ye(a-X[0].getX()-1,X[0].getY()),X[1]=new ye(a-X[1].getX()-1,X[1].getY()))}return U}catch{}}}throw new q}static recordPattern(r,s,a){const o=a.length;for(let y=0;y<o;y++)a[y]=0;const c=r.getSize();if(s>=c)throw new q;let h=!r.get(s),f=0,x=s;for(;x<c;){if(r.get(x)!==h)a[f]++;else{if(++f===o)break;a[f]=1,h=!h}x++}if(!(f===o||f===o-1&&x===c))throw new q}static recordPatternInReverse(r,s,a){let o=a.length,c=r.get(s);for(;s>0&&o>=0;)r.get(--s)!==c&&(o--,c=!c);if(o>=0)throw new q;ft.recordPattern(r,s+1,a)}static patternMatchVariance(r,s,a){const o=r.length;let c=0,h=0;for(let y=0;y<o;y++)c+=r[y],h+=s[y];if(c<h)return Number.POSITIVE_INFINITY;const f=c/h;a*=f;let x=0;for(let y=0;y<o;y++){const v=r[y],A=s[y]*f,S=v>A?v-A:A-v;if(S>a)return Number.POSITIVE_INFINITY;x+=S}return x/c}}class fe extends ft{static findStartPattern(r){const s=r.getSize(),a=r.getNextSet(0);let o=0,c=Int32Array.from([0,0,0,0,0,0]),h=a,f=!1;const x=6;for(let y=a;y<s;y++)if(r.get(y)!==f)c[o]++;else{if(o===x-1){let v=fe.MAX_AVG_VARIANCE,A=-1;for(let S=fe.CODE_START_A;S<=fe.CODE_START_C;S++){const j=ft.patternMatchVariance(c,fe.CODE_PATTERNS[S],fe.MAX_INDIVIDUAL_VARIANCE);j<v&&(v=j,A=S)}if(A>=0&&r.isRange(Math.max(0,h-(y-h)/2),h,!1))return Int32Array.from([h,y,A]);h+=c[0]+c[1],c=c.slice(2,c.length-1),c[o-1]=0,c[o]=0,o--}else o++;c[o]=1,f=!f}throw new q}static decodeCode(r,s,a){ft.recordPattern(r,a,s);let o=fe.MAX_AVG_VARIANCE,c=-1;for(let h=0;h<fe.CODE_PATTERNS.length;h++){const f=fe.CODE_PATTERNS[h],x=this.patternMatchVariance(s,f,fe.MAX_INDIVIDUAL_VARIANCE);x<o&&(o=x,c=h)}if(c>=0)return c;throw new q}decodeRow(r,s,a){const o=a&&a.get(V.ASSUME_GS1)===!0,c=fe.findStartPattern(s),h=c[2];let f=0;const x=new Uint8Array(20);x[f++]=h;let y;switch(h){case fe.CODE_START_A:y=fe.CODE_CODE_A;break;case fe.CODE_START_B:y=fe.CODE_CODE_B;break;case fe.CODE_START_C:y=fe.CODE_CODE_C;break;default:throw new G}let v=!1,A=!1,S="",j=c[0],L=c[1];const U=Int32Array.from([0,0,0,0,0,0]);let X=0,ee=0,le=h,de=0,ie=!0,Je=!1,He=!1;for(;!v;){const Cs=A;switch(A=!1,X=ee,ee=fe.decodeCode(s,U,L),x[f++]=ee,ee!==fe.CODE_STOP&&(ie=!0),ee!==fe.CODE_STOP&&(de++,le+=de*ee),j=L,L+=U.reduce((Hf,Gf)=>Hf+Gf,0),ee){case fe.CODE_START_A:case fe.CODE_START_B:case fe.CODE_START_C:throw new G}switch(y){case fe.CODE_CODE_A:if(ee<64)He===Je?S+=String.fromCharCode(32+ee):S+=String.fromCharCode(32+ee+128),He=!1;else if(ee<96)He===Je?S+=String.fromCharCode(ee-64):S+=String.fromCharCode(ee+64),He=!1;else switch(ee!==fe.CODE_STOP&&(ie=!1),ee){case fe.CODE_FNC_1:o&&(S.length===0?S+="]C1":S+="");break;case fe.CODE_FNC_2:case fe.CODE_FNC_3:break;case fe.CODE_FNC_4_A:!Je&&He?(Je=!0,He=!1):Je&&He?(Je=!1,He=!1):He=!0;break;case fe.CODE_SHIFT:A=!0,y=fe.CODE_CODE_B;break;case fe.CODE_CODE_B:y=fe.CODE_CODE_B;break;case fe.CODE_CODE_C:y=fe.CODE_CODE_C;break;case fe.CODE_STOP:v=!0;break}break;case fe.CODE_CODE_B:if(ee<96)He===Je?S+=String.fromCharCode(32+ee):S+=String.fromCharCode(32+ee+128),He=!1;else switch(ee!==fe.CODE_STOP&&(ie=!1),ee){case fe.CODE_FNC_1:o&&(S.length===0?S+="]C1":S+="");break;case fe.CODE_FNC_2:case fe.CODE_FNC_3:break;case fe.CODE_FNC_4_B:!Je&&He?(Je=!0,He=!1):Je&&He?(Je=!1,He=!1):He=!0;break;case fe.CODE_SHIFT:A=!0,y=fe.CODE_CODE_A;break;case fe.CODE_CODE_A:y=fe.CODE_CODE_A;break;case fe.CODE_CODE_C:y=fe.CODE_CODE_C;break;case fe.CODE_STOP:v=!0;break}break;case fe.CODE_CODE_C:if(ee<100)ee<10&&(S+="0"),S+=ee;else switch(ee!==fe.CODE_STOP&&(ie=!1),ee){case fe.CODE_FNC_1:o&&(S.length===0?S+="]C1":S+="");break;case fe.CODE_CODE_A:y=fe.CODE_CODE_A;break;case fe.CODE_CODE_B:y=fe.CODE_CODE_B;break;case fe.CODE_STOP:v=!0;break}break}Cs&&(y=y===fe.CODE_CODE_A?fe.CODE_CODE_B:fe.CODE_CODE_A)}const Ir=L-j;if(L=s.getNextUnset(L),!s.isRange(L,Math.min(s.getSize(),L+(L-j)/2),!1))throw new q;if(le-=de*X,le%103!==X)throw new N;const Kr=S.length;if(Kr===0)throw new q;Kr>0&&ie&&(y===fe.CODE_CODE_C?S=S.substring(0,Kr-2):S=S.substring(0,Kr-1));const Tr=(c[1]+c[0])/2,pt=j+Ir/2,ur=x.length,Dr=new Uint8Array(ur);for(let Cs=0;Cs<ur;Cs++)Dr[Cs]=x[Cs];const vs=[new ye(Tr,r),new ye(pt,r)];return new ce(S,Dr,0,vs,F.CODE_128,new Date().getTime())}}fe.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],fe.MAX_AVG_VARIANCE=.25,fe.MAX_INDIVIDUAL_VARIANCE=.7,fe.CODE_SHIFT=98,fe.CODE_CODE_C=99,fe.CODE_CODE_B=100,fe.CODE_CODE_A=101,fe.CODE_FNC_1=102,fe.CODE_FNC_2=97,fe.CODE_FNC_3=96,fe.CODE_FNC_4_A=101,fe.CODE_FNC_4_B=100,fe.CODE_START_A=103,fe.CODE_START_B=104,fe.CODE_START_C=105,fe.CODE_STOP=106;class Wt extends ft{constructor(r=!1,s=!1){super(),this.usingCheckDigit=r,this.extendedMode=s,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(r,s,a){let o=this.counters;o.fill(0),this.decodeRowResult="";let c=Wt.findAsteriskPattern(s,o),h=s.getNextSet(c[1]),f=s.getSize(),x,y;do{Wt.recordPattern(s,h,o);let U=Wt.toNarrowWidePattern(o);if(U<0)throw new q;x=Wt.patternToChar(U),this.decodeRowResult+=x,y=h;for(let X of o)h+=X;h=s.getNextSet(h)}while(x!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let v=0;for(let U of o)v+=U;let A=h-y-v;if(h!==f&&A*2<v)throw new q;if(this.usingCheckDigit){let U=this.decodeRowResult.length-1,X=0;for(let ee=0;ee<U;ee++)X+=Wt.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(ee));if(this.decodeRowResult.charAt(U)!==Wt.ALPHABET_STRING.charAt(X%43))throw new N;this.decodeRowResult=this.decodeRowResult.substring(0,U)}if(this.decodeRowResult.length===0)throw new q;let S;this.extendedMode?S=Wt.decodeExtended(this.decodeRowResult):S=this.decodeRowResult;let j=(c[1]+c[0])/2,L=y+v/2;return new ce(S,null,0,[new ye(j,r),new ye(L,r)],F.CODE_39,new Date().getTime())}static findAsteriskPattern(r,s){let a=r.getSize(),o=r.getNextSet(0),c=0,h=o,f=!1,x=s.length;for(let y=o;y<a;y++)if(r.get(y)!==f)s[c]++;else{if(c===x-1){if(this.toNarrowWidePattern(s)===Wt.ASTERISK_ENCODING&&r.isRange(Math.max(0,h-Math.floor((y-h)/2)),h,!1))return[h,y];h+=s[0]+s[1],s.copyWithin(0,2,2+c-1),s[c-1]=0,s[c]=0,c--}else c++;s[c]=1,f=!f}throw new q}static toNarrowWidePattern(r){let s=r.length,a=0,o;do{let c=2147483647;for(let x of r)x<c&&x>a&&(c=x);a=c,o=0;let h=0,f=0;for(let x=0;x<s;x++){let y=r[x];y>a&&(f|=1<<s-1-x,o++,h+=y)}if(o===3){for(let x=0;x<s&&o>0;x++){let y=r[x];if(y>a&&(o--,y*2>=h))return-1}return f}}while(o>3);return-1}static patternToChar(r){for(let s=0;s<Wt.CHARACTER_ENCODINGS.length;s++)if(Wt.CHARACTER_ENCODINGS[s]===r)return Wt.ALPHABET_STRING.charAt(s);if(r===Wt.ASTERISK_ENCODING)return"*";throw new q}static decodeExtended(r){let s=r.length,a="";for(let o=0;o<s;o++){let c=r.charAt(o);if(c==="+"||c==="$"||c==="%"||c==="/"){let h=r.charAt(o+1),f="\0";switch(c){case"+":if(h>="A"&&h<="Z")f=String.fromCharCode(h.charCodeAt(0)+32);else throw new G;break;case"$":if(h>="A"&&h<="Z")f=String.fromCharCode(h.charCodeAt(0)-64);else throw new G;break;case"%":if(h>="A"&&h<="E")f=String.fromCharCode(h.charCodeAt(0)-38);else if(h>="F"&&h<="J")f=String.fromCharCode(h.charCodeAt(0)-11);else if(h>="K"&&h<="O")f=String.fromCharCode(h.charCodeAt(0)+16);else if(h>="P"&&h<="T")f=String.fromCharCode(h.charCodeAt(0)+43);else if(h==="U")f="\0";else if(h==="V")f="@";else if(h==="W")f="`";else if(h==="X"||h==="Y"||h==="Z")f="";else throw new G;break;case"/":if(h>="A"&&h<="O")f=String.fromCharCode(h.charCodeAt(0)-32);else if(h==="Z")f=":";else throw new G;break}a+=f,o++}else a+=c}return a}}Wt.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Wt.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Wt.ASTERISK_ENCODING=148;class mt extends ft{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(r,s,a){let o=this.decodeStart(s),c=this.decodeEnd(s),h=new te;mt.decodeMiddle(s,o[1],c[0],h);let f=h.toString(),x=null;a!=null&&(x=a.get(V.ALLOWED_LENGTHS)),x==null&&(x=mt.DEFAULT_ALLOWED_LENGTHS);let y=f.length,v=!1,A=0;for(let L of x){if(y===L){v=!0;break}L>A&&(A=L)}if(!v&&y>A&&(v=!0),!v)throw new G;const S=[new ye(o[1],r),new ye(c[0],r)];return new ce(f,null,0,S,F.ITF,new Date().getTime())}static decodeMiddle(r,s,a,o){let c=new Int32Array(10),h=new Int32Array(5),f=new Int32Array(5);for(c.fill(0),h.fill(0),f.fill(0);s<a;){ft.recordPattern(r,s,c);for(let y=0;y<5;y++){let v=2*y;h[y]=c[v],f[y]=c[v+1]}let x=mt.decodeDigit(h);o.append(x.toString()),x=this.decodeDigit(f),o.append(x.toString()),c.forEach(function(y){s+=y})}}decodeStart(r){let s=mt.skipWhiteSpace(r),a=mt.findGuardPattern(r,s,mt.START_PATTERN);return this.narrowLineWidth=(a[1]-a[0])/4,this.validateQuietZone(r,a[0]),a}validateQuietZone(r,s){let a=this.narrowLineWidth*10;a=a<s?a:s;for(let o=s-1;a>0&&o>=0&&!r.get(o);o--)a--;if(a!==0)throw new q}static skipWhiteSpace(r){const s=r.getSize(),a=r.getNextSet(0);if(a===s)throw new q;return a}decodeEnd(r){r.reverse();try{let s=mt.skipWhiteSpace(r),a;try{a=mt.findGuardPattern(r,s,mt.END_PATTERN_REVERSED[0])}catch(c){c instanceof q&&(a=mt.findGuardPattern(r,s,mt.END_PATTERN_REVERSED[1]))}this.validateQuietZone(r,a[0]);let o=a[0];return a[0]=r.getSize()-a[1],a[1]=r.getSize()-o,a}finally{r.reverse()}}static findGuardPattern(r,s,a){let o=a.length,c=new Int32Array(o),h=r.getSize(),f=!1,x=0,y=s;c.fill(0);for(let v=s;v<h;v++)if(r.get(v)!==f)c[x]++;else{if(x===o-1){if(ft.patternMatchVariance(c,a,mt.MAX_INDIVIDUAL_VARIANCE)<mt.MAX_AVG_VARIANCE)return[y,v];y+=c[0]+c[1],T.arraycopy(c,2,c,0,x-1),c[x-1]=0,c[x]=0,x--}else x++;c[x]=1,f=!f}throw new q}static decodeDigit(r){let s=mt.MAX_AVG_VARIANCE,a=-1,o=mt.PATTERNS.length;for(let c=0;c<o;c++){let h=mt.PATTERNS[c],f=ft.patternMatchVariance(r,h,mt.MAX_INDIVIDUAL_VARIANCE);f<s?(s=f,a=c):f===s&&(a=-1)}if(a>=0)return a%10;throw new q}}mt.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],mt.MAX_AVG_VARIANCE=.38,mt.MAX_INDIVIDUAL_VARIANCE=.5,mt.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],mt.START_PATTERN=Int32Array.from([1,1,1,1]),mt.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class kt extends ft{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(r){let s=!1,a,o=0,c=Int32Array.from([0,0,0]);for(;!s;){c=Int32Array.from([0,0,0]),a=kt.findGuardPattern(r,o,!1,this.START_END_PATTERN,c);let h=a[0];o=a[1];let f=h-(o-h);f>=0&&(s=r.isRange(f,h,!1))}return a}static checkChecksum(r){return kt.checkStandardUPCEANChecksum(r)}static checkStandardUPCEANChecksum(r){let s=r.length;if(s===0)return!1;let a=parseInt(r.charAt(s-1),10);return kt.getStandardUPCEANChecksum(r.substring(0,s-1))===a}static getStandardUPCEANChecksum(r){let s=r.length,a=0;for(let o=s-1;o>=0;o-=2){let c=r.charAt(o).charCodeAt(0)-48;if(c<0||c>9)throw new G;a+=c}a*=3;for(let o=s-2;o>=0;o-=2){let c=r.charAt(o).charCodeAt(0)-48;if(c<0||c>9)throw new G;a+=c}return(1e3-a)%10}static decodeEnd(r,s){return kt.findGuardPattern(r,s,!1,kt.START_END_PATTERN,new Int32Array(kt.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(r,s,a,o){return this.findGuardPattern(r,s,a,o,new Int32Array(o.length))}static findGuardPattern(r,s,a,o,c){let h=r.getSize();s=a?r.getNextUnset(s):r.getNextSet(s);let f=0,x=s,y=o.length,v=a;for(let A=s;A<h;A++)if(r.get(A)!==v)c[f]++;else{if(f===y-1){if(ft.patternMatchVariance(c,o,kt.MAX_INDIVIDUAL_VARIANCE)<kt.MAX_AVG_VARIANCE)return Int32Array.from([x,A]);x+=c[0]+c[1];let S=c.slice(2,c.length-1);for(let j=0;j<f-1;j++)c[j]=S[j];c[f-1]=0,c[f]=0,f--}else f++;c[f]=1,v=!v}throw new q}static decodeDigit(r,s,a,o){this.recordPattern(r,a,s);let c=this.MAX_AVG_VARIANCE,h=-1,f=o.length;for(let x=0;x<f;x++){let y=o[x],v=ft.patternMatchVariance(s,y,kt.MAX_INDIVIDUAL_VARIANCE);v<c&&(c=v,h=x)}if(h>=0)return h;throw new q}}kt.MAX_AVG_VARIANCE=.48,kt.MAX_INDIVIDUAL_VARIANCE=.7,kt.START_END_PATTERN=Int32Array.from([1,1,1]),kt.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),kt.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),kt.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class ei{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(r,s,a){let o=this.decodeRowStringBuffer,c=this.decodeMiddle(s,a,o),h=o.toString(),f=ei.parseExtensionString(h),x=[new ye((a[0]+a[1])/2,r),new ye(c,r)],y=new ce(h,null,0,x,F.UPC_EAN_EXTENSION,new Date().getTime());return f!=null&&y.putAllMetadata(f),y}decodeMiddle(r,s,a){let o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let c=r.getSize(),h=s[1],f=0;for(let y=0;y<5&&h<c;y++){let v=kt.decodeDigit(r,o,h,kt.L_AND_G_PATTERNS);a+=String.fromCharCode(48+v%10);for(let A of o)h+=A;v>=10&&(f|=1<<4-y),y!==4&&(h=r.getNextSet(h),h=r.getNextUnset(h))}if(a.length!==5)throw new q;let x=this.determineCheckDigit(f);if(ei.extensionChecksum(a.toString())!==x)throw new q;return h}static extensionChecksum(r){let s=r.length,a=0;for(let o=s-2;o>=0;o-=2)a+=r.charAt(o).charCodeAt(0)-48;a*=3;for(let o=s-1;o>=0;o-=2)a+=r.charAt(o).charCodeAt(0)-48;return a*=3,a%10}determineCheckDigit(r){for(let s=0;s<10;s++)if(r===this.CHECK_DIGIT_ENCODINGS[s])return s;throw new q}static parseExtensionString(r){if(r.length!==5)return null;let s=ei.parseExtension5String(r);return s==null?null:new Map([[Pe.SUGGESTED_PRICE,s]])}static parseExtension5String(r){let s;switch(r.charAt(0)){case"0":s="£";break;case"5":s="$";break;case"9":switch(r){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}s="";break;default:s="";break}let a=parseInt(r.substring(1)),o=(a/100).toString(),c=a%100,h=c<10?"0"+c:c.toString();return s+o+"."+h}}class Ra{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(r,s,a){let o=this.decodeRowStringBuffer,c=this.decodeMiddle(s,a,o),h=o.toString(),f=Ra.parseExtensionString(h),x=[new ye((a[0]+a[1])/2,r),new ye(c,r)],y=new ce(h,null,0,x,F.UPC_EAN_EXTENSION,new Date().getTime());return f!=null&&y.putAllMetadata(f),y}decodeMiddle(r,s,a){let o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let c=r.getSize(),h=s[1],f=0;for(let x=0;x<2&&h<c;x++){let y=kt.decodeDigit(r,o,h,kt.L_AND_G_PATTERNS);a+=String.fromCharCode(48+y%10);for(let v of o)h+=v;y>=10&&(f|=1<<1-x),x!==1&&(h=r.getNextSet(h),h=r.getNextUnset(h))}if(a.length!==2)throw new q;if(parseInt(a.toString())%4!==f)throw new q;return h}static parseExtensionString(r){return r.length!==2?null:new Map([[Pe.ISSUE_NUMBER,parseInt(r)]])}}class nc{static decodeRow(r,s,a){let o=kt.findGuardPattern(s,a,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new ei().decodeRow(r,s,o)}catch{return new Ra().decodeRow(r,s,o)}}}nc.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class it extends kt{constructor(){super(),this.decodeRowStringBuffer="",it.L_AND_G_PATTERNS=it.L_PATTERNS.map(r=>Int32Array.from(r));for(let r=10;r<20;r++){let s=it.L_PATTERNS[r-10],a=new Int32Array(s.length);for(let o=0;o<s.length;o++)a[o]=s[s.length-o-1];it.L_AND_G_PATTERNS[r]=a}}decodeRow(r,s,a){let o=it.findStartGuardPattern(s),c=a==null?null:a.get(V.NEED_RESULT_POINT_CALLBACK);if(c!=null){const ie=new ye((o[0]+o[1])/2,r);c.foundPossibleResultPoint(ie)}let h=this.decodeMiddle(s,o,this.decodeRowStringBuffer),f=h.rowOffset,x=h.resultString;if(c!=null){const ie=new ye(f,r);c.foundPossibleResultPoint(ie)}let y=this.decodeEnd(s,f);if(c!=null){const ie=new ye((y[0]+y[1])/2,r);c.foundPossibleResultPoint(ie)}let v=y[1],A=v+(v-y[0]);if(A>=s.getSize()||!s.isRange(v,A,!1))throw new q;let S=x.toString();if(S.length<8)throw new G;if(!it.checkChecksum(S))throw new N;let j=(o[1]+o[0])/2,L=(y[1]+y[0])/2,U=this.getBarcodeFormat(),X=[new ye(j,r),new ye(L,r)],ee=new ce(S,null,0,X,U,new Date().getTime()),le=0;try{let ie=nc.decodeRow(r,s,y[1]);ee.putMetadata(Pe.UPC_EAN_EXTENSION,ie.getText()),ee.putAllMetadata(ie.getResultMetadata()),ee.addResultPoints(ie.getResultPoints()),le=ie.getText().length}catch{}let de=a==null?null:a.get(V.ALLOWED_EAN_EXTENSIONS);if(de!=null){let ie=!1;for(let Je in de)if(le.toString()===Je){ie=!0;break}if(!ie)throw new q}return ee}decodeEnd(r,s){return it.findGuardPattern(r,s,!1,it.START_END_PATTERN,new Int32Array(it.START_END_PATTERN.length).fill(0))}static checkChecksum(r){return it.checkStandardUPCEANChecksum(r)}static checkStandardUPCEANChecksum(r){let s=r.length;if(s===0)return!1;let a=parseInt(r.charAt(s-1),10);return it.getStandardUPCEANChecksum(r.substring(0,s-1))===a}static getStandardUPCEANChecksum(r){let s=r.length,a=0;for(let o=s-1;o>=0;o-=2){let c=r.charAt(o).charCodeAt(0)-48;if(c<0||c>9)throw new G;a+=c}a*=3;for(let o=s-2;o>=0;o-=2){let c=r.charAt(o).charCodeAt(0)-48;if(c<0||c>9)throw new G;a+=c}return(1e3-a)%10}}class Hn extends it{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(r,s,a){let o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let c=r.getSize(),h=s[1],f=0;for(let y=0;y<6&&h<c;y++){let v=it.decodeDigit(r,o,h,it.L_AND_G_PATTERNS);a+=String.fromCharCode(48+v%10);for(let A of o)h+=A;v>=10&&(f|=1<<5-y)}a=Hn.determineFirstDigit(a,f),h=it.findGuardPattern(r,h,!0,it.MIDDLE_PATTERN,new Int32Array(it.MIDDLE_PATTERN.length).fill(0))[1];for(let y=0;y<6&&h<c;y++){let v=it.decodeDigit(r,o,h,it.L_PATTERNS);a+=String.fromCharCode(48+v);for(let A of o)h+=A}return{rowOffset:h,resultString:a}}getBarcodeFormat(){return F.EAN_13}static determineFirstDigit(r,s){for(let a=0;a<10;a++)if(s===this.FIRST_DIGIT_ENCODINGS[a])return r=String.fromCharCode(48+a)+r,r;throw new q}}Hn.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class sc extends it{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(r,s,a){const o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let c=r.getSize(),h=s[1];for(let x=0;x<4&&h<c;x++){let y=it.decodeDigit(r,o,h,it.L_PATTERNS);a+=String.fromCharCode(48+y);for(let v of o)h+=v}h=it.findGuardPattern(r,h,!0,it.MIDDLE_PATTERN,new Int32Array(it.MIDDLE_PATTERN.length).fill(0))[1];for(let x=0;x<4&&h<c;x++){let y=it.decodeDigit(r,o,h,it.L_PATTERNS);a+=String.fromCharCode(48+y);for(let v of o)h+=v}return{rowOffset:h,resultString:a}}getBarcodeFormat(){return F.EAN_8}}class ic extends it{constructor(){super(...arguments),this.ean13Reader=new Hn}getBarcodeFormat(){return F.UPC_A}decode(r,s){return this.maybeReturnResult(this.ean13Reader.decode(r))}decodeRow(r,s,a){return this.maybeReturnResult(this.ean13Reader.decodeRow(r,s,a))}decodeMiddle(r,s,a){return this.ean13Reader.decodeMiddle(r,s,a)}maybeReturnResult(r){let s=r.getText();if(s.charAt(0)==="0"){let a=new ce(s.substring(1),null,null,r.getResultPoints(),F.UPC_A);return r.getResultMetadata()!=null&&a.putAllMetadata(r.getResultMetadata()),a}else throw new q}reset(){this.ean13Reader.reset()}}class $r extends it{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(r,s,a){const o=this.decodeMiddleCounters.map(y=>y);o[0]=0,o[1]=0,o[2]=0,o[3]=0;const c=r.getSize();let h=s[1],f=0;for(let y=0;y<6&&h<c;y++){const v=$r.decodeDigit(r,o,h,$r.L_AND_G_PATTERNS);a+=String.fromCharCode(48+v%10);for(let A of o)h+=A;v>=10&&(f|=1<<5-y)}let x=$r.determineNumSysAndCheckDigit(a,f);return{rowOffset:h,resultString:x}}decodeEnd(r,s){return $r.findGuardPatternWithoutCounters(r,s,!0,$r.MIDDLE_END_PATTERN)}checkChecksum(r){return it.checkChecksum($r.convertUPCEtoUPCA(r))}static determineNumSysAndCheckDigit(r,s){for(let a=0;a<=1;a++)for(let o=0;o<10;o++)if(s===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[a][o]){let c=String.fromCharCode(48+a),h=String.fromCharCode(48+o);return c+r+h}throw q.getNotFoundInstance()}getBarcodeFormat(){return F.UPC_E}static convertUPCEtoUPCA(r){const s=r.slice(1,7).split("").map(c=>c.charCodeAt(0)),a=new te;a.append(r.charAt(0));let o=s[5];switch(o){case 0:case 1:case 2:a.appendChars(s,0,2),a.append(o),a.append("0000"),a.appendChars(s,2,3);break;case 3:a.appendChars(s,0,3),a.append("00000"),a.appendChars(s,3,2);break;case 4:a.appendChars(s,0,4),a.append("00000"),a.append(s[4]);break;default:a.appendChars(s,0,5),a.append("0000"),a.append(o);break}return r.length>=8&&a.append(r.charAt(7)),a.toString()}}$r.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),$r.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class ja extends ft{constructor(r){super();let s=r==null?null:r.get(V.POSSIBLE_FORMATS),a=[];i(s)?(a.push(new Hn),a.push(new ic),a.push(new sc),a.push(new $r)):(s.indexOf(F.EAN_13)>-1&&a.push(new Hn),s.indexOf(F.UPC_A)>-1&&a.push(new ic),s.indexOf(F.EAN_8)>-1&&a.push(new sc),s.indexOf(F.UPC_E)>-1&&a.push(new $r)),this.readers=a}decodeRow(r,s,a){for(let o of this.readers)try{const c=o.decodeRow(r,s,a),h=c.getBarcodeFormat()===F.EAN_13&&c.getText().charAt(0)==="0",f=a==null?null:a.get(V.POSSIBLE_FORMATS),x=f==null||f.includes(F.UPC_A);if(h&&x){const y=c.getRawBytes(),v=new ce(c.getText().substring(1),y,y?y.length:null,c.getResultPoints(),F.UPC_A);return v.putAllMetadata(c.getResultMetadata()),v}return c}catch{}throw new q}reset(){for(let r of this.readers)r.reset()}}class mr extends ft{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(r,s){for(let a=0;a<s.length;a++)if(ft.patternMatchVariance(r,s[a],mr.MAX_INDIVIDUAL_VARIANCE)<mr.MAX_AVG_VARIANCE)return a;throw new q}static count(r){return Ae.sum(new Int32Array(r))}static increment(r,s){let a=0,o=s[0];for(let c=1;c<r.length;c++)s[c]>o&&(o=s[c],a=c);r[a]++}static decrement(r,s){let a=0,o=s[0];for(let c=1;c<r.length;c++)s[c]<o&&(o=s[c],a=c);r[a]--}static isFinderPattern(r){let s=r[0]+r[1],a=s+r[2]+r[3],o=s/a;if(o>=mr.MIN_FINDER_PATTERN_RATIO&&o<=mr.MAX_FINDER_PATTERN_RATIO){let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(let f of r)f>h&&(h=f),f<c&&(c=f);return h<10*c}return!1}}mr.MAX_AVG_VARIANCE=.2,mr.MAX_INDIVIDUAL_VARIANCE=.45,mr.MIN_FINDER_PATTERN_RATIO=9.5/12,mr.MAX_FINDER_PATTERN_RATIO=12.5/14;class gs{constructor(r,s){this.value=r,this.checksumPortion=s}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(r){if(!(r instanceof gs))return!1;const s=r;return this.value===s.value&&this.checksumPortion===s.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Bi{constructor(r,s,a,o,c){this.value=r,this.startEnd=s,this.value=r,this.startEnd=s,this.resultPoints=new Array,this.resultPoints.push(new ye(a,c)),this.resultPoints.push(new ye(o,c))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(r){if(!(r instanceof Bi))return!1;const s=r;return this.value===s.value}hashCode(){return this.value}}class sn{constructor(){}static getRSSvalue(r,s,a){let o=0;for(let x of r)o+=x;let c=0,h=0,f=r.length;for(let x=0;x<f-1;x++){let y;for(y=1,h|=1<<x;y<r[x];y++,h&=~(1<<x)){let v=sn.combins(o-y-1,f-x-2);if(a&&h===0&&o-y-(f-x-1)>=f-x-1&&(v-=sn.combins(o-y-(f-x),f-x-2)),f-x-1>1){let A=0;for(let S=o-y-(f-x-2);S>s;S--)A+=sn.combins(o-y-S-1,f-x-3);v-=A*(f-1-x)}else o-y>s&&v--;c+=v}o-=y}return c}static combins(r,s){let a,o;r-s>s?(o=s,a=r-s):(o=r-s,a=s);let c=1,h=1;for(let f=r;f>a;f--)c*=f,h<=o&&(c/=h,h++);for(;h<=o;)c/=h,h++;return c}}class mf{static buildBitArray(r){let s=r.length*2-1;r[r.length-1].getRightChar()==null&&(s-=1);let a=12*s,o=new z(a),c=0,f=r[0].getRightChar().getValue();for(let x=11;x>=0;--x)(f&1<<x)!=0&&o.set(c),c++;for(let x=1;x<r.length;++x){let y=r[x],v=y.getLeftChar().getValue();for(let A=11;A>=0;--A)(v&1<<A)!=0&&o.set(c),c++;if(y.getRightChar()!=null){let A=y.getRightChar().getValue();for(let S=11;S>=0;--S)(A&1<<S)!=0&&o.set(c),c++}}return o}}class Gn{constructor(r,s){s?this.decodedInformation=null:(this.finished=r,this.decodedInformation=s)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class ka{constructor(r){this.newPosition=r}getNewPosition(){return this.newPosition}}class Ar extends ka{constructor(r,s){super(r),this.value=s}getValue(){return this.value}isFNC1(){return this.value===Ar.FNC1}}Ar.FNC1="$";class qn extends ka{constructor(r,s,a){super(r),a?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=s}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Hr extends ka{constructor(r,s,a){if(super(r),s<0||s>10||a<0||a>10)throw new G;this.firstDigit=s,this.secondDigit=a}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Hr.FNC1}isSecondDigitFNC1(){return this.secondDigit===Hr.FNC1}isAnyFNC1(){return this.firstDigit===Hr.FNC1||this.secondDigit===Hr.FNC1}}Hr.FNC1=10;class pe{constructor(){}static parseFieldsInGeneralPurpose(r){if(!r)return null;if(r.length<2)throw new q;let s=r.substring(0,2);for(let c of pe.TWO_DIGIT_DATA_LENGTH)if(c[0]===s)return c[1]===pe.VARIABLE_LENGTH?pe.processVariableAI(2,c[2],r):pe.processFixedAI(2,c[1],r);if(r.length<3)throw new q;let a=r.substring(0,3);for(let c of pe.THREE_DIGIT_DATA_LENGTH)if(c[0]===a)return c[1]===pe.VARIABLE_LENGTH?pe.processVariableAI(3,c[2],r):pe.processFixedAI(3,c[1],r);for(let c of pe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(c[0]===a)return c[1]===pe.VARIABLE_LENGTH?pe.processVariableAI(4,c[2],r):pe.processFixedAI(4,c[1],r);if(r.length<4)throw new q;let o=r.substring(0,4);for(let c of pe.FOUR_DIGIT_DATA_LENGTH)if(c[0]===o)return c[1]===pe.VARIABLE_LENGTH?pe.processVariableAI(4,c[2],r):pe.processFixedAI(4,c[1],r);throw new q}static processFixedAI(r,s,a){if(a.length<r)throw new q;let o=a.substring(0,r);if(a.length<r+s)throw new q;let c=a.substring(r,r+s),h=a.substring(r+s),f="("+o+")"+c,x=pe.parseFieldsInGeneralPurpose(h);return x==null?f:f+x}static processVariableAI(r,s,a){let o=a.substring(0,r),c;a.length<r+s?c=a.length:c=r+s;let h=a.substring(r,c),f=a.substring(c),x="("+o+")"+h,y=pe.parseFieldsInGeneralPurpose(f);return y==null?x:x+y}}pe.VARIABLE_LENGTH=[],pe.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",pe.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",pe.VARIABLE_LENGTH,20],["22",pe.VARIABLE_LENGTH,29],["30",pe.VARIABLE_LENGTH,8],["37",pe.VARIABLE_LENGTH,8],["90",pe.VARIABLE_LENGTH,30],["91",pe.VARIABLE_LENGTH,30],["92",pe.VARIABLE_LENGTH,30],["93",pe.VARIABLE_LENGTH,30],["94",pe.VARIABLE_LENGTH,30],["95",pe.VARIABLE_LENGTH,30],["96",pe.VARIABLE_LENGTH,30],["97",pe.VARIABLE_LENGTH,3],["98",pe.VARIABLE_LENGTH,30],["99",pe.VARIABLE_LENGTH,30]],pe.THREE_DIGIT_DATA_LENGTH=[["240",pe.VARIABLE_LENGTH,30],["241",pe.VARIABLE_LENGTH,30],["242",pe.VARIABLE_LENGTH,6],["250",pe.VARIABLE_LENGTH,30],["251",pe.VARIABLE_LENGTH,30],["253",pe.VARIABLE_LENGTH,17],["254",pe.VARIABLE_LENGTH,20],["400",pe.VARIABLE_LENGTH,30],["401",pe.VARIABLE_LENGTH,30],["402",17],["403",pe.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",pe.VARIABLE_LENGTH,20],["421",pe.VARIABLE_LENGTH,15],["422",3],["423",pe.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],pe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",pe.VARIABLE_LENGTH,15],["391",pe.VARIABLE_LENGTH,18],["392",pe.VARIABLE_LENGTH,15],["393",pe.VARIABLE_LENGTH,18],["703",pe.VARIABLE_LENGTH,30]],pe.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",pe.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",pe.VARIABLE_LENGTH,20],["8003",pe.VARIABLE_LENGTH,30],["8004",pe.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",pe.VARIABLE_LENGTH,30],["8008",pe.VARIABLE_LENGTH,12],["8018",18],["8020",pe.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",pe.VARIABLE_LENGTH,70],["8200",pe.VARIABLE_LENGTH,70]];class ms{constructor(r){this.buffer=new te,this.information=r}decodeAllCodes(r,s){let a=s,o=null;do{let c=this.decodeGeneralPurposeField(a,o),h=pe.parseFieldsInGeneralPurpose(c.getNewString());if(h!=null&&r.append(h),c.isRemaining()?o=""+c.getRemainingValue():o=null,a===c.getNewPosition())break;a=c.getNewPosition()}while(!0);return r.toString()}isStillNumeric(r){if(r+7>this.information.getSize())return r+4<=this.information.getSize();for(let s=r;s<r+3;++s)if(this.information.get(s))return!0;return this.information.get(r+3)}decodeNumeric(r){if(r+7>this.information.getSize()){let c=this.extractNumericValueFromBitArray(r,4);return c===0?new Hr(this.information.getSize(),Hr.FNC1,Hr.FNC1):new Hr(this.information.getSize(),c-1,Hr.FNC1)}let s=this.extractNumericValueFromBitArray(r,7),a=(s-8)/11,o=(s-8)%11;return new Hr(r+7,a,o)}extractNumericValueFromBitArray(r,s){return ms.extractNumericValueFromBitArray(this.information,r,s)}static extractNumericValueFromBitArray(r,s,a){let o=0;for(let c=0;c<a;++c)r.get(s+c)&&(o|=1<<a-c-1);return o}decodeGeneralPurposeField(r,s){this.buffer.setLengthToZero(),s!=null&&this.buffer.append(s),this.current.setPosition(r);let a=this.parseBlocks();return a!=null&&a.isRemaining()?new qn(this.current.getPosition(),this.buffer.toString(),a.getRemainingValue()):new qn(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let r,s;do{let a=this.current.getPosition();if(this.current.isAlpha()?(s=this.parseAlphaBlock(),r=s.isFinished()):this.current.isIsoIec646()?(s=this.parseIsoIec646Block(),r=s.isFinished()):(s=this.parseNumericBlock(),r=s.isFinished()),!(a!==this.current.getPosition())&&!r)break}while(!r);return s.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let r=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(r.getNewPosition()),r.isFirstDigitFNC1()){let s;return r.isSecondDigitFNC1()?s=new qn(this.current.getPosition(),this.buffer.toString()):s=new qn(this.current.getPosition(),this.buffer.toString(),r.getSecondDigit()),new Gn(!0,s)}if(this.buffer.append(r.getFirstDigit()),r.isSecondDigitFNC1()){let s=new qn(this.current.getPosition(),this.buffer.toString());return new Gn(!0,s)}this.buffer.append(r.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Gn(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let r=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(r.getNewPosition()),r.isFNC1()){let s=new qn(this.current.getPosition(),this.buffer.toString());return new Gn(!0,s)}this.buffer.append(r.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Gn(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let r=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(r.getNewPosition()),r.isFNC1()){let s=new qn(this.current.getPosition(),this.buffer.toString());return new Gn(!0,s)}this.buffer.append(r.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Gn(!1)}isStillIsoIec646(r){if(r+5>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(r,5);if(s>=5&&s<16)return!0;if(r+7>this.information.getSize())return!1;let a=this.extractNumericValueFromBitArray(r,7);if(a>=64&&a<116)return!0;if(r+8>this.information.getSize())return!1;let o=this.extractNumericValueFromBitArray(r,8);return o>=232&&o<253}decodeIsoIec646(r){let s=this.extractNumericValueFromBitArray(r,5);if(s===15)return new Ar(r+5,Ar.FNC1);if(s>=5&&s<15)return new Ar(r+5,"0"+(s-5));let a=this.extractNumericValueFromBitArray(r,7);if(a>=64&&a<90)return new Ar(r+7,""+(a+1));if(a>=90&&a<116)return new Ar(r+7,""+(a+7));let o=this.extractNumericValueFromBitArray(r,8),c;switch(o){case 232:c="!";break;case 233:c='"';break;case 234:c="%";break;case 235:c="&";break;case 236:c="'";break;case 237:c="(";break;case 238:c=")";break;case 239:c="*";break;case 240:c="+";break;case 241:c=",";break;case 242:c="-";break;case 243:c=".";break;case 244:c="/";break;case 245:c=":";break;case 246:c=";";break;case 247:c="<";break;case 248:c="=";break;case 249:c=">";break;case 250:c="?";break;case 251:c="_";break;case 252:c=" ";break;default:throw new G}return new Ar(r+8,c)}isStillAlpha(r){if(r+5>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(r,5);if(s>=5&&s<16)return!0;if(r+6>this.information.getSize())return!1;let a=this.extractNumericValueFromBitArray(r,6);return a>=16&&a<63}decodeAlphanumeric(r){let s=this.extractNumericValueFromBitArray(r,5);if(s===15)return new Ar(r+5,Ar.FNC1);if(s>=5&&s<15)return new Ar(r+5,"0"+(s-5));let a=this.extractNumericValueFromBitArray(r,6);if(a>=32&&a<58)return new Ar(r+6,""+(a+33));let o;switch(a){case 58:o="*";break;case 59:o=",";break;case 60:o="-";break;case 61:o=".";break;case 62:o="/";break;default:throw new je("Decoding invalid alphanumeric value: "+a)}return new Ar(r+6,o)}isAlphaTo646ToAlphaLatch(r){if(r+1>this.information.getSize())return!1;for(let s=0;s<5&&s+r<this.information.getSize();++s)if(s===2){if(!this.information.get(r+2))return!1}else if(this.information.get(r+s))return!1;return!0}isAlphaOr646ToNumericLatch(r){if(r+3>this.information.getSize())return!1;for(let s=r;s<r+3;++s)if(this.information.get(s))return!1;return!0}isNumericToAlphaNumericLatch(r){if(r+1>this.information.getSize())return!1;for(let s=0;s<4&&s+r<this.information.getSize();++s)if(this.information.get(r+s))return!1;return!0}}class Da{constructor(r){this.information=r,this.generalDecoder=new ms(r)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Nr extends Da{constructor(r){super(r)}encodeCompressedGtin(r,s){r.append("(01)");let a=r.length();r.append("9"),this.encodeCompressedGtinWithoutAI(r,s,a)}encodeCompressedGtinWithoutAI(r,s,a){for(let o=0;o<4;++o){let c=this.getGeneralDecoder().extractNumericValueFromBitArray(s+10*o,10);c/100===0&&r.append("0"),c/10===0&&r.append("0"),r.append(c)}Nr.appendCheckDigit(r,a)}static appendCheckDigit(r,s){let a=0;for(let o=0;o<13;o++){let c=r.charAt(o+s).charCodeAt(0)-48;a+=(o&1)===0?3*c:c}a=10-a%10,a===10&&(a=0),r.append(a)}}Nr.GTIN_SIZE=40;class xs extends Nr{constructor(r){super(r)}parseInformation(){let r=new te;r.append("(01)");let s=r.length(),a=this.getGeneralDecoder().extractNumericValueFromBitArray(xs.HEADER_SIZE,4);return r.append(a),this.encodeCompressedGtinWithoutAI(r,xs.HEADER_SIZE+4,s),this.getGeneralDecoder().decodeAllCodes(r,xs.HEADER_SIZE+44)}}xs.HEADER_SIZE=4;class Fi extends Da{constructor(r){super(r)}parseInformation(){let r=new te;return this.getGeneralDecoder().decodeAllCodes(r,Fi.HEADER_SIZE)}}Fi.HEADER_SIZE=5;class Ui extends Nr{constructor(r){super(r)}encodeCompressedWeight(r,s,a){let o=this.getGeneralDecoder().extractNumericValueFromBitArray(s,a);this.addWeightCode(r,o);let c=this.checkWeight(o),h=1e5;for(let f=0;f<5;++f)c/h===0&&r.append("0"),h/=10;r.append(c)}}class an extends Ui{constructor(r){super(r)}parseInformation(){if(this.getInformation().getSize()!=an.HEADER_SIZE+Ui.GTIN_SIZE+an.WEIGHT_SIZE)throw new q;let r=new te;return this.encodeCompressedGtin(r,an.HEADER_SIZE),this.encodeCompressedWeight(r,an.HEADER_SIZE+Ui.GTIN_SIZE,an.WEIGHT_SIZE),r.toString()}}an.HEADER_SIZE=5,an.WEIGHT_SIZE=15;class xf extends an{constructor(r){super(r)}addWeightCode(r,s){r.append("(3103)")}checkWeight(r){return r}}class pf extends an{constructor(r){super(r)}addWeightCode(r,s){s<1e4?r.append("(3202)"):r.append("(3203)")}checkWeight(r){return r<1e4?r:r-1e4}}class on extends Nr{constructor(r){super(r)}parseInformation(){if(this.getInformation().getSize()<on.HEADER_SIZE+Nr.GTIN_SIZE)throw new q;let r=new te;this.encodeCompressedGtin(r,on.HEADER_SIZE);let s=this.getGeneralDecoder().extractNumericValueFromBitArray(on.HEADER_SIZE+Nr.GTIN_SIZE,on.LAST_DIGIT_SIZE);r.append("(392"),r.append(s),r.append(")");let a=this.getGeneralDecoder().decodeGeneralPurposeField(on.HEADER_SIZE+Nr.GTIN_SIZE+on.LAST_DIGIT_SIZE,null);return r.append(a.getNewString()),r.toString()}}on.HEADER_SIZE=8,on.LAST_DIGIT_SIZE=2;class yr extends Nr{constructor(r){super(r)}parseInformation(){if(this.getInformation().getSize()<yr.HEADER_SIZE+Nr.GTIN_SIZE)throw new q;let r=new te;this.encodeCompressedGtin(r,yr.HEADER_SIZE);let s=this.getGeneralDecoder().extractNumericValueFromBitArray(yr.HEADER_SIZE+Nr.GTIN_SIZE,yr.LAST_DIGIT_SIZE);r.append("(393"),r.append(s),r.append(")");let a=this.getGeneralDecoder().extractNumericValueFromBitArray(yr.HEADER_SIZE+Nr.GTIN_SIZE+yr.LAST_DIGIT_SIZE,yr.FIRST_THREE_DIGITS_SIZE);a/100==0&&r.append("0"),a/10==0&&r.append("0"),r.append(a);let o=this.getGeneralDecoder().decodeGeneralPurposeField(yr.HEADER_SIZE+Nr.GTIN_SIZE+yr.LAST_DIGIT_SIZE+yr.FIRST_THREE_DIGITS_SIZE,null);return r.append(o.getNewString()),r.toString()}}yr.HEADER_SIZE=8,yr.LAST_DIGIT_SIZE=2,yr.FIRST_THREE_DIGITS_SIZE=10;class St extends Ui{constructor(r,s,a){super(r),this.dateCode=a,this.firstAIdigits=s}parseInformation(){if(this.getInformation().getSize()!=St.HEADER_SIZE+St.GTIN_SIZE+St.WEIGHT_SIZE+St.DATE_SIZE)throw new q;let r=new te;return this.encodeCompressedGtin(r,St.HEADER_SIZE),this.encodeCompressedWeight(r,St.HEADER_SIZE+St.GTIN_SIZE,St.WEIGHT_SIZE),this.encodeCompressedDate(r,St.HEADER_SIZE+St.GTIN_SIZE+St.WEIGHT_SIZE),r.toString()}encodeCompressedDate(r,s){let a=this.getGeneralDecoder().extractNumericValueFromBitArray(s,St.DATE_SIZE);if(a==38400)return;r.append("("),r.append(this.dateCode),r.append(")");let o=a%32;a/=32;let c=a%12+1;a/=12;let h=a;h/10==0&&r.append("0"),r.append(h),c/10==0&&r.append("0"),r.append(c),o/10==0&&r.append("0"),r.append(o)}addWeightCode(r,s){r.append("("),r.append(this.firstAIdigits),r.append(s/1e5),r.append(")")}checkWeight(r){return r%1e5}}St.HEADER_SIZE=8,St.WEIGHT_SIZE=20,St.DATE_SIZE=16;function ac(E){try{if(E.get(1))return new xs(E);if(!E.get(2))return new Fi(E);switch(ms.extractNumericValueFromBitArray(E,1,4)){case 4:return new xf(E);case 5:return new pf(E)}switch(ms.extractNumericValueFromBitArray(E,1,5)){case 12:return new on(E);case 13:return new yr(E)}switch(ms.extractNumericValueFromBitArray(E,1,7)){case 56:return new St(E,"310","11");case 57:return new St(E,"320","11");case 58:return new St(E,"310","13");case 59:return new St(E,"320","13");case 60:return new St(E,"310","15");case 61:return new St(E,"320","15");case 62:return new St(E,"310","17");case 63:return new St(E,"320","17")}}catch(r){throw console.log(r),new je("unknown decoder: "+E)}}class An{constructor(r,s,a,o){this.leftchar=r,this.rightchar=s,this.finderpattern=a,this.maybeLast=o}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(r,s){return r instanceof An?An.equalsOrNull(r.leftchar,s.leftchar)&&An.equalsOrNull(r.rightchar,s.rightchar)&&An.equalsOrNull(r.finderpattern,s.finderpattern):!1}static equalsOrNull(r,s){return r===null?s===null:An.equals(r,s)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Pa{constructor(r,s,a){this.pairs=r,this.rowNumber=s,this.wasReversed=a}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(r){return this.checkEqualitity(this,r)}toString(){return"{ "+this.pairs+" }"}equals(r,s){return r instanceof Pa?this.checkEqualitity(r,s)&&r.wasReversed===s.wasReversed:!1}checkEqualitity(r,s){if(!r||!s)return;let a;return r.forEach((o,c)=>{s.forEach(h=>{o.getLeftChar().getValue()===h.getLeftChar().getValue()&&o.getRightChar().getValue()===h.getRightChar().getValue()&&o.getFinderPatter().getValue()===h.getFinderPatter().getValue()&&(a=!0)})}),a}}class se extends mr{constructor(r){super(...arguments),this.pairs=new Array(se.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=r===!0}decodeRow(r,s,a){this.pairs.length=0,this.startFromEven=!1;try{return se.constructResult(this.decodeRow2pairs(r,s))}catch(o){this.verbose&&console.log(o)}return this.pairs.length=0,this.startFromEven=!0,se.constructResult(this.decodeRow2pairs(r,s))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(r,s){let a=!1;for(;!a;)try{this.pairs.push(this.retrieveNextPair(s,this.pairs,r))}catch(c){if(c instanceof q){if(!this.pairs.length)throw new q;a=!0}}if(this.checkChecksum())return this.pairs;let o;if(this.rows.length?o=!0:o=!1,this.storeRow(r,!1),o){let c=this.checkRowsBoolean(!1);if(c!=null||(c=this.checkRowsBoolean(!0),c!=null))return c}throw new q}checkRowsBoolean(r){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,r&&(this.rows=this.rows.reverse());let s=null;try{s=this.checkRows(new Array,0)}catch(a){this.verbose&&console.log(a)}return r&&(this.rows=this.rows.reverse()),s}checkRows(r,s){for(let a=s;a<this.rows.length;a++){let o=this.rows[a];this.pairs.length=0;for(let h of r)this.pairs.push(h.getPairs());if(this.pairs.push(o.getPairs()),!se.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let c=new Array(r);c.push(o);try{return this.checkRows(c,a+1)}catch(h){this.verbose&&console.log(h)}}throw new q}static isValidSequence(r){for(let s of se.FINDER_PATTERN_SEQUENCES){if(r.length>s.length)continue;let a=!0;for(let o=0;o<r.length;o++)if(r[o].getFinderPattern().getValue()!=s[o]){a=!1;break}if(a)return!0}return!1}storeRow(r,s){let a=0,o=!1,c=!1;for(;a<this.rows.length;){let h=this.rows[a];if(h.getRowNumber()>r){c=h.isEquivalent(this.pairs);break}o=h.isEquivalent(this.pairs),a++}c||o||se.isPartialRow(this.pairs,this.rows)||(this.rows.push(a,new Pa(this.pairs,r,s)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(r,s){for(let a of s)if(a.getPairs().length!==r.length){for(let o of a.getPairs())for(let c of r)if(An.equals(o,c))break}}static isPartialRow(r,s){for(let a of s){let o=!0;for(let c of r){let h=!1;for(let f of a.getPairs())if(c.equals(f)){h=!0;break}if(!h){o=!1;break}}if(o)return!0}return!1}getRows(){return this.rows}static constructResult(r){let s=mf.buildBitArray(r),o=ac(s).parseInformation(),c=r[0].getFinderPattern().getResultPoints(),h=r[r.length-1].getFinderPattern().getResultPoints(),f=[c[0],c[1],h[0],h[1]];return new ce(o,null,null,f,F.RSS_EXPANDED,null)}checkChecksum(){let r=this.pairs.get(0),s=r.getLeftChar(),a=r.getRightChar();if(a==null)return!1;let o=a.getChecksumPortion(),c=2;for(let f=1;f<this.pairs.size();++f){let x=this.pairs.get(f);o+=x.getLeftChar().getChecksumPortion(),c++;let y=x.getRightChar();y!=null&&(o+=y.getChecksumPortion(),c++)}return o%=211,211*(c-4)+o==s.getValue()}static getNextSecondBar(r,s){let a;return r.get(s)?(a=r.getNextUnset(s),a=r.getNextSet(a)):(a=r.getNextSet(s),a=r.getNextUnset(a)),a}retrieveNextPair(r,s,a){let o=s.length%2==0;this.startFromEven&&(o=!o);let c,h=!0,f=-1;do this.findNextPair(r,s,f),c=this.parseFoundFinderPattern(r,a,o),c==null?f=se.getNextSecondBar(r,this.startEnd[0]):h=!1;while(h);let x=this.decodeDataCharacter(r,c,o,!0);if(!this.isEmptyPair(s)&&s[s.length-1].mustBeLast())throw new q;let y;try{y=this.decodeDataCharacter(r,c,o,!1)}catch(v){y=null,this.verbose&&console.log(v)}return new An(x,y,c,!0)}isEmptyPair(r){return r.length===0}findNextPair(r,s,a){let o=this.getDecodeFinderCounters();o[0]=0,o[1]=0,o[2]=0,o[3]=0;let c=r.getSize(),h;a>=0?h=a:this.isEmptyPair(s)?h=0:h=s[s.length-1].getFinderPattern().getStartEnd()[1];let f=s.length%2!=0;this.startFromEven&&(f=!f);let x=!1;for(;h<c&&(x=!r.get(h),!!x);)h++;let y=0,v=h;for(let A=h;A<c;A++)if(r.get(A)!=x)o[y]++;else{if(y==3){if(f&&se.reverseCounters(o),se.isFinderPattern(o)){this.startEnd[0]=v,this.startEnd[1]=A;return}f&&se.reverseCounters(o),v+=o[0]+o[1],o[0]=o[2],o[1]=o[3],o[2]=0,o[3]=0,y--}else y++;o[y]=1,x=!x}throw new q}static reverseCounters(r){let s=r.length;for(let a=0;a<s/2;++a){let o=r[a];r[a]=r[s-a-1],r[s-a-1]=o}}parseFoundFinderPattern(r,s,a){let o,c,h;if(a){let y=this.startEnd[0]-1;for(;y>=0&&!r.get(y);)y--;y++,o=this.startEnd[0]-y,c=y,h=this.startEnd[1]}else c=this.startEnd[0],h=r.getNextUnset(this.startEnd[1]+1),o=h-this.startEnd[1];let f=this.getDecodeFinderCounters();T.arraycopy(f,0,f,1,f.length-1),f[0]=o;let x;try{x=this.parseFinderValue(f,se.FINDER_PATTERNS)}catch{return null}return new Bi(x,[c,h],c,h,s)}decodeDataCharacter(r,s,a,o){let c=this.getDataCharacterCounters();for(let pt=0;pt<c.length;pt++)c[pt]=0;if(o)se.recordPatternInReverse(r,s.getStartEnd()[0],c);else{se.recordPattern(r,s.getStartEnd()[1],c);for(let pt=0,ur=c.length-1;pt<ur;pt++,ur--){let Dr=c[pt];c[pt]=c[ur],c[ur]=Dr}}let h=17,f=Ae.sum(new Int32Array(c))/h,x=(s.getStartEnd()[1]-s.getStartEnd()[0])/15;if(Math.abs(f-x)/x>.3)throw new q;let y=this.getOddCounts(),v=this.getEvenCounts(),A=this.getOddRoundingErrors(),S=this.getEvenRoundingErrors();for(let pt=0;pt<c.length;pt++){let ur=1*c[pt]/f,Dr=ur+.5;if(Dr<1){if(ur<.3)throw new q;Dr=1}else if(Dr>8){if(ur>8.7)throw new q;Dr=8}let vs=pt/2;(pt&1)==0?(y[vs]=Dr,A[vs]=ur-Dr):(v[vs]=Dr,S[vs]=ur-Dr)}this.adjustOddEvenCounts(h);let j=4*s.getValue()+(a?0:2)+(o?0:1)-1,L=0,U=0;for(let pt=y.length-1;pt>=0;pt--){if(se.isNotA1left(s,a,o)){let ur=se.WEIGHTS[j][2*pt];U+=y[pt]*ur}L+=y[pt]}let X=0;for(let pt=v.length-1;pt>=0;pt--)if(se.isNotA1left(s,a,o)){let ur=se.WEIGHTS[j][2*pt+1];X+=v[pt]*ur}let ee=U+X;if((L&1)!=0||L>13||L<4)throw new q;let le=(13-L)/2,de=se.SYMBOL_WIDEST[le],ie=9-de,Je=sn.getRSSvalue(y,de,!0),He=sn.getRSSvalue(v,ie,!1),Ir=se.EVEN_TOTAL_SUBSET[le],Kr=se.GSUM[le],Tr=Je*Ir+He+Kr;return new gs(Tr,ee)}static isNotA1left(r,s,a){return!(r.getValue()==0&&s&&a)}adjustOddEvenCounts(r){let s=Ae.sum(new Int32Array(this.getOddCounts())),a=Ae.sum(new Int32Array(this.getEvenCounts())),o=!1,c=!1;s>13?c=!0:s<4&&(o=!0);let h=!1,f=!1;a>13?f=!0:a<4&&(h=!0);let x=s+a-r,y=(s&1)==1,v=(a&1)==0;if(x==1)if(y){if(v)throw new q;c=!0}else{if(!v)throw new q;f=!0}else if(x==-1)if(y){if(v)throw new q;o=!0}else{if(!v)throw new q;h=!0}else if(x==0){if(y){if(!v)throw new q;s<a?(o=!0,f=!0):(c=!0,h=!0)}else if(v)throw new q}else throw new q;if(o){if(c)throw new q;se.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(c&&se.decrement(this.getOddCounts(),this.getOddRoundingErrors()),h){if(f)throw new q;se.increment(this.getEvenCounts(),this.getOddRoundingErrors())}f&&se.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}se.SYMBOL_WIDEST=[7,5,4,3,1],se.EVEN_TOTAL_SUBSET=[4,20,52,104,204],se.GSUM=[0,348,1388,2948,3988],se.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],se.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],se.FINDER_PAT_A=0,se.FINDER_PAT_B=1,se.FINDER_PAT_C=2,se.FINDER_PAT_D=3,se.FINDER_PAT_E=4,se.FINDER_PAT_F=5,se.FINDER_PATTERN_SEQUENCES=[[se.FINDER_PAT_A,se.FINDER_PAT_A],[se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B],[se.FINDER_PAT_A,se.FINDER_PAT_C,se.FINDER_PAT_B,se.FINDER_PAT_D],[se.FINDER_PAT_A,se.FINDER_PAT_E,se.FINDER_PAT_B,se.FINDER_PAT_D,se.FINDER_PAT_C],[se.FINDER_PAT_A,se.FINDER_PAT_E,se.FINDER_PAT_B,se.FINDER_PAT_D,se.FINDER_PAT_D,se.FINDER_PAT_F],[se.FINDER_PAT_A,se.FINDER_PAT_E,se.FINDER_PAT_B,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_F,se.FINDER_PAT_F],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_D],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_E],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_F,se.FINDER_PAT_F],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_E,se.FINDER_PAT_F,se.FINDER_PAT_F]],se.MAX_PAIRS=11;class wf extends gs{constructor(r,s,a){super(r,s),this.count=0,this.finderPattern=a}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Dt extends mr{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(r,s,a){const o=this.decodePair(s,!1,r,a);Dt.addOrTally(this.possibleLeftPairs,o),s.reverse();let c=this.decodePair(s,!0,r,a);Dt.addOrTally(this.possibleRightPairs,c),s.reverse();for(let h of this.possibleLeftPairs)if(h.getCount()>1){for(let f of this.possibleRightPairs)if(f.getCount()>1&&Dt.checkChecksum(h,f))return Dt.constructResult(h,f)}throw new q}static addOrTally(r,s){if(s==null)return;let a=!1;for(let o of r)if(o.getValue()===s.getValue()){o.incrementCount(),a=!0;break}a||r.push(s)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(r,s){let a=4537077*r.getValue()+s.getValue(),o=new String(a).toString(),c=new te;for(let y=13-o.length;y>0;y--)c.append("0");c.append(o);let h=0;for(let y=0;y<13;y++){let v=c.charAt(y).charCodeAt(0)-48;h+=(y&1)===0?3*v:v}h=10-h%10,h===10&&(h=0),c.append(h.toString());let f=r.getFinderPattern().getResultPoints(),x=s.getFinderPattern().getResultPoints();return new ce(c.toString(),null,0,[f[0],f[1],x[0],x[1]],F.RSS_14,new Date().getTime())}static checkChecksum(r,s){let a=(r.getChecksumPortion()+16*s.getChecksumPortion())%79,o=9*r.getFinderPattern().getValue()+s.getFinderPattern().getValue();return o>72&&o--,o>8&&o--,a===o}decodePair(r,s,a,o){try{let c=this.findFinderPattern(r,s),h=this.parseFoundFinderPattern(r,a,s,c),f=o==null?null:o.get(V.NEED_RESULT_POINT_CALLBACK);if(f!=null){let v=(c[0]+c[1])/2;s&&(v=r.getSize()-1-v),f.foundPossibleResultPoint(new ye(v,a))}let x=this.decodeDataCharacter(r,h,!0),y=this.decodeDataCharacter(r,h,!1);return new wf(1597*x.getValue()+y.getValue(),x.getChecksumPortion()+4*y.getChecksumPortion(),h)}catch{return null}}decodeDataCharacter(r,s,a){let o=this.getDataCharacterCounters();for(let X=0;X<o.length;X++)o[X]=0;if(a)ft.recordPatternInReverse(r,s.getStartEnd()[0],o);else{ft.recordPattern(r,s.getStartEnd()[1]+1,o);for(let X=0,ee=o.length-1;X<ee;X++,ee--){let le=o[X];o[X]=o[ee],o[ee]=le}}let c=a?16:15,h=Ae.sum(new Int32Array(o))/c,f=this.getOddCounts(),x=this.getEvenCounts(),y=this.getOddRoundingErrors(),v=this.getEvenRoundingErrors();for(let X=0;X<o.length;X++){let ee=o[X]/h,le=Math.floor(ee+.5);le<1?le=1:le>8&&(le=8);let de=Math.floor(X/2);(X&1)===0?(f[de]=le,y[de]=ee-le):(x[de]=le,v[de]=ee-le)}this.adjustOddEvenCounts(a,c);let A=0,S=0;for(let X=f.length-1;X>=0;X--)S*=9,S+=f[X],A+=f[X];let j=0,L=0;for(let X=x.length-1;X>=0;X--)j*=9,j+=x[X],L+=x[X];let U=S+3*j;if(a){if((A&1)!==0||A>12||A<4)throw new q;let X=(12-A)/2,ee=Dt.OUTSIDE_ODD_WIDEST[X],le=9-ee,de=sn.getRSSvalue(f,ee,!1),ie=sn.getRSSvalue(x,le,!0),Je=Dt.OUTSIDE_EVEN_TOTAL_SUBSET[X],He=Dt.OUTSIDE_GSUM[X];return new gs(de*Je+ie+He,U)}else{if((L&1)!==0||L>10||L<4)throw new q;let X=(10-L)/2,ee=Dt.INSIDE_ODD_WIDEST[X],le=9-ee,de=sn.getRSSvalue(f,ee,!0),ie=sn.getRSSvalue(x,le,!1),Je=Dt.INSIDE_ODD_TOTAL_SUBSET[X],He=Dt.INSIDE_GSUM[X];return new gs(ie*Je+de+He,U)}}findFinderPattern(r,s){let a=this.getDecodeFinderCounters();a[0]=0,a[1]=0,a[2]=0,a[3]=0;let o=r.getSize(),c=!1,h=0;for(;h<o&&(c=!r.get(h),s!==c);)h++;let f=0,x=h;for(let y=h;y<o;y++)if(r.get(y)!==c)a[f]++;else{if(f===3){if(mr.isFinderPattern(a))return[x,y];x+=a[0]+a[1],a[0]=a[2],a[1]=a[3],a[2]=0,a[3]=0,f--}else f++;a[f]=1,c=!c}throw new q}parseFoundFinderPattern(r,s,a,o){let c=r.get(o[0]),h=o[0]-1;for(;h>=0&&c!==r.get(h);)h--;h++;const f=o[0]-h,x=this.getDecodeFinderCounters(),y=new Int32Array(x.length);T.arraycopy(x,0,y,1,x.length-1),y[0]=f;const v=this.parseFinderValue(y,Dt.FINDER_PATTERNS);let A=h,S=o[1];return a&&(A=r.getSize()-1-A,S=r.getSize()-1-S),new Bi(v,[h,o[1]],A,S,s)}adjustOddEvenCounts(r,s){let a=Ae.sum(new Int32Array(this.getOddCounts())),o=Ae.sum(new Int32Array(this.getEvenCounts())),c=!1,h=!1,f=!1,x=!1;r?(a>12?h=!0:a<4&&(c=!0),o>12?x=!0:o<4&&(f=!0)):(a>11?h=!0:a<5&&(c=!0),o>10?x=!0:o<4&&(f=!0));let y=a+o-s,v=(a&1)===(r?1:0),A=(o&1)===1;if(y===1)if(v){if(A)throw new q;h=!0}else{if(!A)throw new q;x=!0}else if(y===-1)if(v){if(A)throw new q;c=!0}else{if(!A)throw new q;f=!0}else if(y===0){if(v){if(!A)throw new q;a<o?(c=!0,x=!0):(h=!0,f=!0)}else if(A)throw new q}else throw new q;if(c){if(h)throw new q;mr.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(h&&mr.decrement(this.getOddCounts(),this.getOddRoundingErrors()),f){if(x)throw new q;mr.increment(this.getEvenCounts(),this.getOddRoundingErrors())}x&&mr.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Dt.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Dt.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Dt.OUTSIDE_GSUM=[0,161,961,2015,2715],Dt.INSIDE_GSUM=[0,336,1036,1516],Dt.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Dt.INSIDE_ODD_WIDEST=[2,4,6,8],Dt.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class ps extends ft{constructor(r,s){super(),this.readers=[],this.verbose=s===!0;const a=r?r.get(V.POSSIBLE_FORMATS):null,o=r&&r.get(V.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;a?((a.includes(F.EAN_13)||a.includes(F.UPC_A)||a.includes(F.EAN_8)||a.includes(F.UPC_E))&&this.readers.push(new ja(r)),a.includes(F.CODE_39)&&this.readers.push(new Wt(o)),a.includes(F.CODE_128)&&this.readers.push(new fe),a.includes(F.ITF)&&this.readers.push(new mt),a.includes(F.RSS_14)&&this.readers.push(new Dt),a.includes(F.RSS_EXPANDED)&&this.readers.push(new se(this.verbose))):(this.readers.push(new ja(r)),this.readers.push(new Wt),this.readers.push(new ja(r)),this.readers.push(new fe),this.readers.push(new mt),this.readers.push(new Dt),this.readers.push(new se(this.verbose)))}decodeRow(r,s,a){for(let o=0;o<this.readers.length;o++)try{return this.readers[o].decodeRow(r,s,a)}catch{}throw new q}reset(){this.readers.forEach(r=>r.reset())}}class yf extends W{constructor(r=500,s){super(new ps(s),r,s)}}class ut{constructor(r,s,a){this.ecCodewords=r,this.ecBlocks=[s],a&&this.ecBlocks.push(a)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class at{constructor(r,s){this.count=r,this.dataCodewords=s}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class rt{constructor(r,s,a,o,c,h){this.versionNumber=r,this.symbolSizeRows=s,this.symbolSizeColumns=a,this.dataRegionSizeRows=o,this.dataRegionSizeColumns=c,this.ecBlocks=h;let f=0;const x=h.getECCodewords(),y=h.getECBlocks();for(let v of y)f+=v.getCount()*(v.getDataCodewords()+x);this.totalCodewords=f}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(r,s){if((r&1)!==0||(s&1)!==0)throw new G;for(let a of rt.VERSIONS)if(a.symbolSizeRows===r&&a.symbolSizeColumns===s)return a;throw new G}toString(){return""+this.versionNumber}static buildVersions(){return[new rt(1,10,10,8,8,new ut(5,new at(1,3))),new rt(2,12,12,10,10,new ut(7,new at(1,5))),new rt(3,14,14,12,12,new ut(10,new at(1,8))),new rt(4,16,16,14,14,new ut(12,new at(1,12))),new rt(5,18,18,16,16,new ut(14,new at(1,18))),new rt(6,20,20,18,18,new ut(18,new at(1,22))),new rt(7,22,22,20,20,new ut(20,new at(1,30))),new rt(8,24,24,22,22,new ut(24,new at(1,36))),new rt(9,26,26,24,24,new ut(28,new at(1,44))),new rt(10,32,32,14,14,new ut(36,new at(1,62))),new rt(11,36,36,16,16,new ut(42,new at(1,86))),new rt(12,40,40,18,18,new ut(48,new at(1,114))),new rt(13,44,44,20,20,new ut(56,new at(1,144))),new rt(14,48,48,22,22,new ut(68,new at(1,174))),new rt(15,52,52,24,24,new ut(42,new at(2,102))),new rt(16,64,64,14,14,new ut(56,new at(2,140))),new rt(17,72,72,16,16,new ut(36,new at(4,92))),new rt(18,80,80,18,18,new ut(48,new at(4,114))),new rt(19,88,88,20,20,new ut(56,new at(4,144))),new rt(20,96,96,22,22,new ut(68,new at(4,174))),new rt(21,104,104,24,24,new ut(56,new at(6,136))),new rt(22,120,120,18,18,new ut(68,new at(6,175))),new rt(23,132,132,20,20,new ut(62,new at(8,163))),new rt(24,144,144,22,22,new ut(62,new at(8,156),new at(2,155))),new rt(25,8,18,6,16,new ut(7,new at(1,5))),new rt(26,8,32,6,14,new ut(11,new at(1,10))),new rt(27,12,26,10,24,new ut(14,new at(1,16))),new rt(28,12,36,10,16,new ut(18,new at(1,22))),new rt(29,16,36,14,16,new ut(24,new at(1,32))),new rt(30,16,48,14,22,new ut(28,new at(1,49)))]}}rt.VERSIONS=rt.buildVersions();class Ma{constructor(r){const s=r.getHeight();if(s<8||s>144||(s&1)!==0)throw new G;this.version=Ma.readVersion(r),this.mappingBitMatrix=this.extractDataRegion(r),this.readMappingMatrix=new ge(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(r){const s=r.getHeight(),a=r.getWidth();return rt.getVersionForDimensions(s,a)}readCodewords(){const r=new Int8Array(this.version.getTotalCodewords());let s=0,a=4,o=0;const c=this.mappingBitMatrix.getHeight(),h=this.mappingBitMatrix.getWidth();let f=!1,x=!1,y=!1,v=!1;do if(a===c&&o===0&&!f)r[s++]=this.readCorner1(c,h)&255,a-=2,o+=2,f=!0;else if(a===c-2&&o===0&&(h&3)!==0&&!x)r[s++]=this.readCorner2(c,h)&255,a-=2,o+=2,x=!0;else if(a===c+4&&o===2&&(h&7)===0&&!y)r[s++]=this.readCorner3(c,h)&255,a-=2,o+=2,y=!0;else if(a===c-2&&o===0&&(h&7)===4&&!v)r[s++]=this.readCorner4(c,h)&255,a-=2,o+=2,v=!0;else{do a<c&&o>=0&&!this.readMappingMatrix.get(o,a)&&(r[s++]=this.readUtah(a,o,c,h)&255),a-=2,o+=2;while(a>=0&&o<h);a+=1,o+=3;do a>=0&&o<h&&!this.readMappingMatrix.get(o,a)&&(r[s++]=this.readUtah(a,o,c,h)&255),a+=2,o-=2;while(a<c&&o>=0);a+=3,o+=1}while(a<c||o<h);if(s!==this.version.getTotalCodewords())throw new G;return r}readModule(r,s,a,o){return r<0&&(r+=a,s+=4-(a+4&7)),s<0&&(s+=o,r+=4-(o+4&7)),this.readMappingMatrix.set(s,r),this.mappingBitMatrix.get(s,r)}readUtah(r,s,a,o){let c=0;return this.readModule(r-2,s-2,a,o)&&(c|=1),c<<=1,this.readModule(r-2,s-1,a,o)&&(c|=1),c<<=1,this.readModule(r-1,s-2,a,o)&&(c|=1),c<<=1,this.readModule(r-1,s-1,a,o)&&(c|=1),c<<=1,this.readModule(r-1,s,a,o)&&(c|=1),c<<=1,this.readModule(r,s-2,a,o)&&(c|=1),c<<=1,this.readModule(r,s-1,a,o)&&(c|=1),c<<=1,this.readModule(r,s,a,o)&&(c|=1),c}readCorner1(r,s){let a=0;return this.readModule(r-1,0,r,s)&&(a|=1),a<<=1,this.readModule(r-1,1,r,s)&&(a|=1),a<<=1,this.readModule(r-1,2,r,s)&&(a|=1),a<<=1,this.readModule(0,s-2,r,s)&&(a|=1),a<<=1,this.readModule(0,s-1,r,s)&&(a|=1),a<<=1,this.readModule(1,s-1,r,s)&&(a|=1),a<<=1,this.readModule(2,s-1,r,s)&&(a|=1),a<<=1,this.readModule(3,s-1,r,s)&&(a|=1),a}readCorner2(r,s){let a=0;return this.readModule(r-3,0,r,s)&&(a|=1),a<<=1,this.readModule(r-2,0,r,s)&&(a|=1),a<<=1,this.readModule(r-1,0,r,s)&&(a|=1),a<<=1,this.readModule(0,s-4,r,s)&&(a|=1),a<<=1,this.readModule(0,s-3,r,s)&&(a|=1),a<<=1,this.readModule(0,s-2,r,s)&&(a|=1),a<<=1,this.readModule(0,s-1,r,s)&&(a|=1),a<<=1,this.readModule(1,s-1,r,s)&&(a|=1),a}readCorner3(r,s){let a=0;return this.readModule(r-1,0,r,s)&&(a|=1),a<<=1,this.readModule(r-1,s-1,r,s)&&(a|=1),a<<=1,this.readModule(0,s-3,r,s)&&(a|=1),a<<=1,this.readModule(0,s-2,r,s)&&(a|=1),a<<=1,this.readModule(0,s-1,r,s)&&(a|=1),a<<=1,this.readModule(1,s-3,r,s)&&(a|=1),a<<=1,this.readModule(1,s-2,r,s)&&(a|=1),a<<=1,this.readModule(1,s-1,r,s)&&(a|=1),a}readCorner4(r,s){let a=0;return this.readModule(r-3,0,r,s)&&(a|=1),a<<=1,this.readModule(r-2,0,r,s)&&(a|=1),a<<=1,this.readModule(r-1,0,r,s)&&(a|=1),a<<=1,this.readModule(0,s-2,r,s)&&(a|=1),a<<=1,this.readModule(0,s-1,r,s)&&(a|=1),a<<=1,this.readModule(1,s-1,r,s)&&(a|=1),a<<=1,this.readModule(2,s-1,r,s)&&(a|=1),a<<=1,this.readModule(3,s-1,r,s)&&(a|=1),a}extractDataRegion(r){const s=this.version.getSymbolSizeRows(),a=this.version.getSymbolSizeColumns();if(r.getHeight()!==s)throw new C("Dimension of bitMatrix must match the version size");const o=this.version.getDataRegionSizeRows(),c=this.version.getDataRegionSizeColumns(),h=s/o|0,f=a/c|0,x=h*o,y=f*c,v=new ge(y,x);for(let A=0;A<h;++A){const S=A*o;for(let j=0;j<f;++j){const L=j*c;for(let U=0;U<o;++U){const X=A*(o+2)+1+U,ee=S+U;for(let le=0;le<c;++le){const de=j*(c+2)+1+le;if(r.get(de,X)){const ie=L+le;v.set(ie,ee)}}}}}return v}}class La{constructor(r,s){this.numDataCodewords=r,this.codewords=s}static getDataBlocks(r,s){const a=s.getECBlocks();let o=0;const c=a.getECBlocks();for(let U of c)o+=U.getCount();const h=new Array(o);let f=0;for(let U of c)for(let X=0;X<U.getCount();X++){const ee=U.getDataCodewords(),le=a.getECCodewords()+ee;h[f++]=new La(ee,new Uint8Array(le))}const y=h[0].codewords.length-a.getECCodewords(),v=y-1;let A=0;for(let U=0;U<v;U++)for(let X=0;X<f;X++)h[X].codewords[U]=r[A++];const S=s.getVersionNumber()===24,j=S?8:f;for(let U=0;U<j;U++)h[U].codewords[y-1]=r[A++];const L=h[0].codewords.length;for(let U=y;U<L;U++)for(let X=0;X<f;X++){const ee=S?(X+8)%f:X,le=S&&ee>7?U-1:U;h[ee].codewords[le]=r[A++]}if(A!==r.length)throw new C;return h}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Ba{constructor(r){this.bytes=r,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(r){if(r<1||r>32||r>this.available())throw new C(""+r);let s=0,a=this.bitOffset,o=this.byteOffset;const c=this.bytes;if(a>0){const h=8-a,f=r<h?r:h,x=h-f,y=255>>8-f<<x;s=(c[o]&y)>>x,r-=f,a+=f,a===8&&(a=0,o++)}if(r>0){for(;r>=8;)s=s<<8|c[o]&255,o++,r-=8;if(r>0){const h=8-r,f=255>>h<<h;s=s<<r|(c[o]&f)>>h,a+=r}}return this.bitOffset=a,this.byteOffset=o,s}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Zt;(function(E){E[E.PAD_ENCODE=0]="PAD_ENCODE",E[E.ASCII_ENCODE=1]="ASCII_ENCODE",E[E.C40_ENCODE=2]="C40_ENCODE",E[E.TEXT_ENCODE=3]="TEXT_ENCODE",E[E.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",E[E.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",E[E.BASE256_ENCODE=6]="BASE256_ENCODE"})(Zt||(Zt={}));class Nn{static decode(r){const s=new Ba(r),a=new te,o=new te,c=new Array;let h=Zt.ASCII_ENCODE;do if(h===Zt.ASCII_ENCODE)h=this.decodeAsciiSegment(s,a,o);else{switch(h){case Zt.C40_ENCODE:this.decodeC40Segment(s,a);break;case Zt.TEXT_ENCODE:this.decodeTextSegment(s,a);break;case Zt.ANSIX12_ENCODE:this.decodeAnsiX12Segment(s,a);break;case Zt.EDIFACT_ENCODE:this.decodeEdifactSegment(s,a);break;case Zt.BASE256_ENCODE:this.decodeBase256Segment(s,a,c);break;default:throw new G}h=Zt.ASCII_ENCODE}while(h!==Zt.PAD_ENCODE&&s.available()>0);return o.length()>0&&a.append(o.toString()),new Ze(r,a.toString(),c.length===0?null:c,null)}static decodeAsciiSegment(r,s,a){let o=!1;do{let c=r.readBits(8);if(c===0)throw new G;if(c<=128)return o&&(c+=128),s.append(String.fromCharCode(c-1)),Zt.ASCII_ENCODE;if(c===129)return Zt.PAD_ENCODE;if(c<=229){const h=c-130;h<10&&s.append("0"),s.append(""+h)}else switch(c){case 230:return Zt.C40_ENCODE;case 231:return Zt.BASE256_ENCODE;case 232:s.append("");break;case 233:case 234:break;case 235:o=!0;break;case 236:s.append("[)>05"),a.insert(0,"");break;case 237:s.append("[)>06"),a.insert(0,"");break;case 238:return Zt.ANSIX12_ENCODE;case 239:return Zt.TEXT_ENCODE;case 240:return Zt.EDIFACT_ENCODE;case 241:break;default:if(c!==254||r.available()!==0)throw new G;break}}while(r.available()>0);return Zt.ASCII_ENCODE}static decodeC40Segment(r,s){let a=!1;const o=[];let c=0;do{if(r.available()===8)return;const h=r.readBits(8);if(h===254)return;this.parseTwoBytes(h,r.readBits(8),o);for(let f=0;f<3;f++){const x=o[f];switch(c){case 0:if(x<3)c=x+1;else if(x<this.C40_BASIC_SET_CHARS.length){const y=this.C40_BASIC_SET_CHARS[x];a?(s.append(String.fromCharCode(y.charCodeAt(0)+128)),a=!1):s.append(y)}else throw new G;break;case 1:a?(s.append(String.fromCharCode(x+128)),a=!1):s.append(String.fromCharCode(x)),c=0;break;case 2:if(x<this.C40_SHIFT2_SET_CHARS.length){const y=this.C40_SHIFT2_SET_CHARS[x];a?(s.append(String.fromCharCode(y.charCodeAt(0)+128)),a=!1):s.append(y)}else switch(x){case 27:s.append("");break;case 30:a=!0;break;default:throw new G}c=0;break;case 3:a?(s.append(String.fromCharCode(x+224)),a=!1):s.append(String.fromCharCode(x+96)),c=0;break;default:throw new G}}}while(r.available()>0)}static decodeTextSegment(r,s){let a=!1,o=[],c=0;do{if(r.available()===8)return;const h=r.readBits(8);if(h===254)return;this.parseTwoBytes(h,r.readBits(8),o);for(let f=0;f<3;f++){const x=o[f];switch(c){case 0:if(x<3)c=x+1;else if(x<this.TEXT_BASIC_SET_CHARS.length){const y=this.TEXT_BASIC_SET_CHARS[x];a?(s.append(String.fromCharCode(y.charCodeAt(0)+128)),a=!1):s.append(y)}else throw new G;break;case 1:a?(s.append(String.fromCharCode(x+128)),a=!1):s.append(String.fromCharCode(x)),c=0;break;case 2:if(x<this.TEXT_SHIFT2_SET_CHARS.length){const y=this.TEXT_SHIFT2_SET_CHARS[x];a?(s.append(String.fromCharCode(y.charCodeAt(0)+128)),a=!1):s.append(y)}else switch(x){case 27:s.append("");break;case 30:a=!0;break;default:throw new G}c=0;break;case 3:if(x<this.TEXT_SHIFT3_SET_CHARS.length){const y=this.TEXT_SHIFT3_SET_CHARS[x];a?(s.append(String.fromCharCode(y.charCodeAt(0)+128)),a=!1):s.append(y),c=0}else throw new G;break;default:throw new G}}}while(r.available()>0)}static decodeAnsiX12Segment(r,s){const a=[];do{if(r.available()===8)return;const o=r.readBits(8);if(o===254)return;this.parseTwoBytes(o,r.readBits(8),a);for(let c=0;c<3;c++){const h=a[c];switch(h){case 0:s.append("\r");break;case 1:s.append("*");break;case 2:s.append(">");break;case 3:s.append(" ");break;default:if(h<14)s.append(String.fromCharCode(h+44));else if(h<40)s.append(String.fromCharCode(h+51));else throw new G;break}}}while(r.available()>0)}static parseTwoBytes(r,s,a){let o=(r<<8)+s-1,c=Math.floor(o/1600);a[0]=c,o-=c*1600,c=Math.floor(o/40),a[1]=c,a[2]=o-c*40}static decodeEdifactSegment(r,s){do{if(r.available()<=16)return;for(let a=0;a<4;a++){let o=r.readBits(6);if(o===31){const c=8-r.getBitOffset();c!==8&&r.readBits(c);return}(o&32)===0&&(o|=64),s.append(String.fromCharCode(o))}}while(r.available()>0)}static decodeBase256Segment(r,s,a){let o=1+r.getByteOffset();const c=this.unrandomize255State(r.readBits(8),o++);let h;if(c===0?h=r.available()/8|0:c<250?h=c:h=250*(c-249)+this.unrandomize255State(r.readBits(8),o++),h<0)throw new G;const f=new Uint8Array(h);for(let x=0;x<h;x++){if(r.available()<8)throw new G;f[x]=this.unrandomize255State(r.readBits(8),o++)}a.push(f);try{s.append(oe.decode(f,ue.ISO88591))}catch(x){throw new je("Platform does not support required encoding: "+x.message)}}static unrandomize255State(r,s){const a=149*s%255+1,o=r-a;return o>=0?o:o+256}}Nn.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Nn.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Nn.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Nn.TEXT_SHIFT2_SET_CHARS=Nn.C40_SHIFT2_SET_CHARS,Nn.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class bf{constructor(){this.rsDecoder=new Ut(tt.DATA_MATRIX_FIELD_256)}decode(r){const s=new Ma(r),a=s.getVersion(),o=s.readCodewords(),c=La.getDataBlocks(o,a);let h=0;for(let y of c)h+=y.getNumDataCodewords();const f=new Uint8Array(h),x=c.length;for(let y=0;y<x;y++){const v=c[y],A=v.getCodewords(),S=v.getNumDataCodewords();this.correctErrors(A,S);for(let j=0;j<S;j++)f[j*x+y]=A[j]}return Nn.decode(f)}correctErrors(r,s){const a=new Int32Array(r);try{this.rsDecoder.decode(a,r.length-s)}catch{throw new N}for(let o=0;o<s;o++)r[o]=a[o]}}class Vt{constructor(r){this.image=r,this.rectangleDetector=new Qt(this.image)}detect(){const r=this.rectangleDetector.detect();let s=this.detectSolid1(r);if(s=this.detectSolid2(s),s[3]=this.correctTopRight(s),!s[3])throw new q;s=this.shiftToModuleCenter(s);const a=s[0],o=s[1],c=s[2],h=s[3];let f=this.transitionsBetween(a,h)+1,x=this.transitionsBetween(c,h)+1;(f&1)===1&&(f+=1),(x&1)===1&&(x+=1),4*f<7*x&&4*x<7*f&&(f=x=Math.max(f,x));let y=Vt.sampleGrid(this.image,a,o,c,h,f,x);return new gr(y,[a,o,c,h])}static shiftPoint(r,s,a){let o=(s.getX()-r.getX())/(a+1),c=(s.getY()-r.getY())/(a+1);return new ye(r.getX()+o,r.getY()+c)}static moveAway(r,s,a){let o=r.getX(),c=r.getY();return o<s?o-=1:o+=1,c<a?c-=1:c+=1,new ye(o,c)}detectSolid1(r){let s=r[0],a=r[1],o=r[3],c=r[2],h=this.transitionsBetween(s,a),f=this.transitionsBetween(a,o),x=this.transitionsBetween(o,c),y=this.transitionsBetween(c,s),v=h,A=[c,s,a,o];return v>f&&(v=f,A[0]=s,A[1]=a,A[2]=o,A[3]=c),v>x&&(v=x,A[0]=a,A[1]=o,A[2]=c,A[3]=s),v>y&&(A[0]=o,A[1]=c,A[2]=s,A[3]=a),A}detectSolid2(r){let s=r[0],a=r[1],o=r[2],c=r[3],h=this.transitionsBetween(s,c),f=Vt.shiftPoint(a,o,(h+1)*4),x=Vt.shiftPoint(o,a,(h+1)*4),y=this.transitionsBetween(f,s),v=this.transitionsBetween(x,c);return y<v?(r[0]=s,r[1]=a,r[2]=o,r[3]=c):(r[0]=a,r[1]=o,r[2]=c,r[3]=s),r}correctTopRight(r){let s=r[0],a=r[1],o=r[2],c=r[3],h=this.transitionsBetween(s,c),f=this.transitionsBetween(a,c),x=Vt.shiftPoint(s,a,(f+1)*4),y=Vt.shiftPoint(o,a,(h+1)*4);h=this.transitionsBetween(x,c),f=this.transitionsBetween(y,c);let v=new ye(c.getX()+(o.getX()-a.getX())/(h+1),c.getY()+(o.getY()-a.getY())/(h+1)),A=new ye(c.getX()+(s.getX()-a.getX())/(f+1),c.getY()+(s.getY()-a.getY())/(f+1));if(!this.isValid(v))return this.isValid(A)?A:null;if(!this.isValid(A))return v;let S=this.transitionsBetween(x,v)+this.transitionsBetween(y,v),j=this.transitionsBetween(x,A)+this.transitionsBetween(y,A);return S>j?v:A}shiftToModuleCenter(r){let s=r[0],a=r[1],o=r[2],c=r[3],h=this.transitionsBetween(s,c)+1,f=this.transitionsBetween(o,c)+1,x=Vt.shiftPoint(s,a,f*4),y=Vt.shiftPoint(o,a,h*4);h=this.transitionsBetween(x,c)+1,f=this.transitionsBetween(y,c)+1,(h&1)===1&&(h+=1),(f&1)===1&&(f+=1);let v=(s.getX()+a.getX()+o.getX()+c.getX())/4,A=(s.getY()+a.getY()+o.getY()+c.getY())/4;s=Vt.moveAway(s,v,A),a=Vt.moveAway(a,v,A),o=Vt.moveAway(o,v,A),c=Vt.moveAway(c,v,A);let S,j;return x=Vt.shiftPoint(s,a,f*4),x=Vt.shiftPoint(x,c,h*4),S=Vt.shiftPoint(a,s,f*4),S=Vt.shiftPoint(S,o,h*4),y=Vt.shiftPoint(o,c,f*4),y=Vt.shiftPoint(y,a,h*4),j=Vt.shiftPoint(c,o,f*4),j=Vt.shiftPoint(j,s,h*4),[x,S,y,j]}isValid(r){return r.getX()>=0&&r.getX()<this.image.getWidth()&&r.getY()>0&&r.getY()<this.image.getHeight()}static sampleGrid(r,s,a,o,c,h,f){return Xr.getInstance().sampleGrid(r,h,f,.5,.5,h-.5,.5,h-.5,f-.5,.5,f-.5,s.getX(),s.getY(),c.getX(),c.getY(),o.getX(),o.getY(),a.getX(),a.getY())}transitionsBetween(r,s){let a=Math.trunc(r.getX()),o=Math.trunc(r.getY()),c=Math.trunc(s.getX()),h=Math.trunc(s.getY()),f=Math.abs(h-o)>Math.abs(c-a);if(f){let U=a;a=o,o=U,U=c,c=h,h=U}let x=Math.abs(c-a),y=Math.abs(h-o),v=-x/2,A=o<h?1:-1,S=a<c?1:-1,j=0,L=this.image.get(f?o:a,f?a:o);for(let U=a,X=o;U!==c;U+=S){let ee=this.image.get(f?X:U,f?U:X);if(ee!==L&&(j++,L=ee),v+=y,v>0){if(X===h)break;X+=A,v-=x}}return j}}class Sn{constructor(){this.decoder=new bf}decode(r,s=null){let a,o;if(s!=null&&s.has(V.PURE_BARCODE)){const y=Sn.extractPureBits(r.getBlackMatrix());a=this.decoder.decode(y),o=Sn.NO_POINTS}else{const y=new Vt(r.getBlackMatrix()).detect();a=this.decoder.decode(y.getBits()),o=y.getPoints()}const c=a.getRawBytes(),h=new ce(a.getText(),c,8*c.length,o,F.DATA_MATRIX,T.currentTimeMillis()),f=a.getByteSegments();f!=null&&h.putMetadata(Pe.BYTE_SEGMENTS,f);const x=a.getECLevel();return x!=null&&h.putMetadata(Pe.ERROR_CORRECTION_LEVEL,x),h}reset(){}static extractPureBits(r){const s=r.getTopLeftOnBit(),a=r.getBottomRightOnBit();if(s==null||a==null)throw new q;const o=this.moduleSize(s,r);let c=s[1];const h=a[1];let f=s[0];const y=(a[0]-f+1)/o,v=(h-c+1)/o;if(y<=0||v<=0)throw new q;const A=o/2;c+=A,f+=A;const S=new ge(y,v);for(let j=0;j<v;j++){const L=c+j*o;for(let U=0;U<y;U++)r.get(f+U*o,L)&&S.set(U,j)}return S}static moduleSize(r,s){const a=s.getWidth();let o=r[0];const c=r[1];for(;o<a&&s.get(o,c);)o++;if(o===a)throw new q;const h=o-r[0];if(h===0)throw new q;return h}}Sn.NO_POINTS=[];class vf extends W{constructor(r=500){super(new Sn,r)}}var ws;(function(E){E[E.L=0]="L",E[E.M=1]="M",E[E.Q=2]="Q",E[E.H=3]="H"})(ws||(ws={}));class wt{constructor(r,s,a){this.value=r,this.stringValue=s,this.bits=a,wt.FOR_BITS.set(a,this),wt.FOR_VALUE.set(r,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(r){switch(r){case"L":return wt.L;case"M":return wt.M;case"Q":return wt.Q;case"H":return wt.H;default:throw new b(r+"not available")}}toString(){return this.stringValue}equals(r){if(!(r instanceof wt))return!1;const s=r;return this.value===s.value}static forBits(r){if(r<0||r>=wt.FOR_BITS.size)throw new C;return wt.FOR_BITS.get(r)}}wt.FOR_BITS=new Map,wt.FOR_VALUE=new Map,wt.L=new wt(ws.L,"L",1),wt.M=new wt(ws.M,"M",0),wt.Q=new wt(ws.Q,"Q",3),wt.H=new wt(ws.H,"H",2);class xr{constructor(r){this.errorCorrectionLevel=wt.forBits(r>>3&3),this.dataMask=r&7}static numBitsDiffering(r,s){return B.bitCount(r^s)}static decodeFormatInformation(r,s){const a=xr.doDecodeFormatInformation(r,s);return a!==null?a:xr.doDecodeFormatInformation(r^xr.FORMAT_INFO_MASK_QR,s^xr.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(r,s){let a=Number.MAX_SAFE_INTEGER,o=0;for(const c of xr.FORMAT_INFO_DECODE_LOOKUP){const h=c[0];if(h===r||h===s)return new xr(c[1]);let f=xr.numBitsDiffering(r,h);f<a&&(o=c[1],a=f),r!==s&&(f=xr.numBitsDiffering(s,h),f<a&&(o=c[1],a=f))}return a<=3?new xr(o):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(r){if(!(r instanceof xr))return!1;const s=r;return this.errorCorrectionLevel===s.errorCorrectionLevel&&this.dataMask===s.dataMask}}xr.FORMAT_INFO_MASK_QR=21522,xr.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class K{constructor(r,...s){this.ecCodewordsPerBlock=r,this.ecBlocks=s}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let r=0;const s=this.ecBlocks;for(const a of s)r+=a.getCount();return r}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class R{constructor(r,s){this.count=r,this.dataCodewords=s}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Ne{constructor(r,s,...a){this.versionNumber=r,this.alignmentPatternCenters=s,this.ecBlocks=a;let o=0;const c=a[0].getECCodewordsPerBlock(),h=a[0].getECBlocks();for(const f of h)o+=f.getCount()*(f.getDataCodewords()+c);this.totalCodewords=o}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(r){return this.ecBlocks[r.getValue()]}static getProvisionalVersionForDimension(r){if(r%4!==1)throw new G;try{return this.getVersionForNumber((r-17)/4)}catch{throw new G}}static getVersionForNumber(r){if(r<1||r>40)throw new C;return Ne.VERSIONS[r-1]}static decodeVersionInformation(r){let s=Number.MAX_SAFE_INTEGER,a=0;for(let o=0;o<Ne.VERSION_DECODE_INFO.length;o++){const c=Ne.VERSION_DECODE_INFO[o];if(c===r)return Ne.getVersionForNumber(o+7);const h=xr.numBitsDiffering(r,c);h<s&&(a=o+7,s=h)}return s<=3?Ne.getVersionForNumber(a):null}buildFunctionPattern(){const r=this.getDimensionForVersion(),s=new ge(r);s.setRegion(0,0,9,9),s.setRegion(r-8,0,8,9),s.setRegion(0,r-8,9,8);const a=this.alignmentPatternCenters.length;for(let o=0;o<a;o++){const c=this.alignmentPatternCenters[o]-2;for(let h=0;h<a;h++)o===0&&(h===0||h===a-1)||o===a-1&&h===0||s.setRegion(this.alignmentPatternCenters[h]-2,c,5,5)}return s.setRegion(6,9,1,r-17),s.setRegion(9,6,r-17,1),this.versionNumber>6&&(s.setRegion(r-11,0,3,6),s.setRegion(0,r-11,6,3)),s}toString(){return""+this.versionNumber}}Ne.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Ne.VERSIONS=[new Ne(1,new Int32Array(0),new K(7,new R(1,19)),new K(10,new R(1,16)),new K(13,new R(1,13)),new K(17,new R(1,9))),new Ne(2,Int32Array.from([6,18]),new K(10,new R(1,34)),new K(16,new R(1,28)),new K(22,new R(1,22)),new K(28,new R(1,16))),new Ne(3,Int32Array.from([6,22]),new K(15,new R(1,55)),new K(26,new R(1,44)),new K(18,new R(2,17)),new K(22,new R(2,13))),new Ne(4,Int32Array.from([6,26]),new K(20,new R(1,80)),new K(18,new R(2,32)),new K(26,new R(2,24)),new K(16,new R(4,9))),new Ne(5,Int32Array.from([6,30]),new K(26,new R(1,108)),new K(24,new R(2,43)),new K(18,new R(2,15),new R(2,16)),new K(22,new R(2,11),new R(2,12))),new Ne(6,Int32Array.from([6,34]),new K(18,new R(2,68)),new K(16,new R(4,27)),new K(24,new R(4,19)),new K(28,new R(4,15))),new Ne(7,Int32Array.from([6,22,38]),new K(20,new R(2,78)),new K(18,new R(4,31)),new K(18,new R(2,14),new R(4,15)),new K(26,new R(4,13),new R(1,14))),new Ne(8,Int32Array.from([6,24,42]),new K(24,new R(2,97)),new K(22,new R(2,38),new R(2,39)),new K(22,new R(4,18),new R(2,19)),new K(26,new R(4,14),new R(2,15))),new Ne(9,Int32Array.from([6,26,46]),new K(30,new R(2,116)),new K(22,new R(3,36),new R(2,37)),new K(20,new R(4,16),new R(4,17)),new K(24,new R(4,12),new R(4,13))),new Ne(10,Int32Array.from([6,28,50]),new K(18,new R(2,68),new R(2,69)),new K(26,new R(4,43),new R(1,44)),new K(24,new R(6,19),new R(2,20)),new K(28,new R(6,15),new R(2,16))),new Ne(11,Int32Array.from([6,30,54]),new K(20,new R(4,81)),new K(30,new R(1,50),new R(4,51)),new K(28,new R(4,22),new R(4,23)),new K(24,new R(3,12),new R(8,13))),new Ne(12,Int32Array.from([6,32,58]),new K(24,new R(2,92),new R(2,93)),new K(22,new R(6,36),new R(2,37)),new K(26,new R(4,20),new R(6,21)),new K(28,new R(7,14),new R(4,15))),new Ne(13,Int32Array.from([6,34,62]),new K(26,new R(4,107)),new K(22,new R(8,37),new R(1,38)),new K(24,new R(8,20),new R(4,21)),new K(22,new R(12,11),new R(4,12))),new Ne(14,Int32Array.from([6,26,46,66]),new K(30,new R(3,115),new R(1,116)),new K(24,new R(4,40),new R(5,41)),new K(20,new R(11,16),new R(5,17)),new K(24,new R(11,12),new R(5,13))),new Ne(15,Int32Array.from([6,26,48,70]),new K(22,new R(5,87),new R(1,88)),new K(24,new R(5,41),new R(5,42)),new K(30,new R(5,24),new R(7,25)),new K(24,new R(11,12),new R(7,13))),new Ne(16,Int32Array.from([6,26,50,74]),new K(24,new R(5,98),new R(1,99)),new K(28,new R(7,45),new R(3,46)),new K(24,new R(15,19),new R(2,20)),new K(30,new R(3,15),new R(13,16))),new Ne(17,Int32Array.from([6,30,54,78]),new K(28,new R(1,107),new R(5,108)),new K(28,new R(10,46),new R(1,47)),new K(28,new R(1,22),new R(15,23)),new K(28,new R(2,14),new R(17,15))),new Ne(18,Int32Array.from([6,30,56,82]),new K(30,new R(5,120),new R(1,121)),new K(26,new R(9,43),new R(4,44)),new K(28,new R(17,22),new R(1,23)),new K(28,new R(2,14),new R(19,15))),new Ne(19,Int32Array.from([6,30,58,86]),new K(28,new R(3,113),new R(4,114)),new K(26,new R(3,44),new R(11,45)),new K(26,new R(17,21),new R(4,22)),new K(26,new R(9,13),new R(16,14))),new Ne(20,Int32Array.from([6,34,62,90]),new K(28,new R(3,107),new R(5,108)),new K(26,new R(3,41),new R(13,42)),new K(30,new R(15,24),new R(5,25)),new K(28,new R(15,15),new R(10,16))),new Ne(21,Int32Array.from([6,28,50,72,94]),new K(28,new R(4,116),new R(4,117)),new K(26,new R(17,42)),new K(28,new R(17,22),new R(6,23)),new K(30,new R(19,16),new R(6,17))),new Ne(22,Int32Array.from([6,26,50,74,98]),new K(28,new R(2,111),new R(7,112)),new K(28,new R(17,46)),new K(30,new R(7,24),new R(16,25)),new K(24,new R(34,13))),new Ne(23,Int32Array.from([6,30,54,78,102]),new K(30,new R(4,121),new R(5,122)),new K(28,new R(4,47),new R(14,48)),new K(30,new R(11,24),new R(14,25)),new K(30,new R(16,15),new R(14,16))),new Ne(24,Int32Array.from([6,28,54,80,106]),new K(30,new R(6,117),new R(4,118)),new K(28,new R(6,45),new R(14,46)),new K(30,new R(11,24),new R(16,25)),new K(30,new R(30,16),new R(2,17))),new Ne(25,Int32Array.from([6,32,58,84,110]),new K(26,new R(8,106),new R(4,107)),new K(28,new R(8,47),new R(13,48)),new K(30,new R(7,24),new R(22,25)),new K(30,new R(22,15),new R(13,16))),new Ne(26,Int32Array.from([6,30,58,86,114]),new K(28,new R(10,114),new R(2,115)),new K(28,new R(19,46),new R(4,47)),new K(28,new R(28,22),new R(6,23)),new K(30,new R(33,16),new R(4,17))),new Ne(27,Int32Array.from([6,34,62,90,118]),new K(30,new R(8,122),new R(4,123)),new K(28,new R(22,45),new R(3,46)),new K(30,new R(8,23),new R(26,24)),new K(30,new R(12,15),new R(28,16))),new Ne(28,Int32Array.from([6,26,50,74,98,122]),new K(30,new R(3,117),new R(10,118)),new K(28,new R(3,45),new R(23,46)),new K(30,new R(4,24),new R(31,25)),new K(30,new R(11,15),new R(31,16))),new Ne(29,Int32Array.from([6,30,54,78,102,126]),new K(30,new R(7,116),new R(7,117)),new K(28,new R(21,45),new R(7,46)),new K(30,new R(1,23),new R(37,24)),new K(30,new R(19,15),new R(26,16))),new Ne(30,Int32Array.from([6,26,52,78,104,130]),new K(30,new R(5,115),new R(10,116)),new K(28,new R(19,47),new R(10,48)),new K(30,new R(15,24),new R(25,25)),new K(30,new R(23,15),new R(25,16))),new Ne(31,Int32Array.from([6,30,56,82,108,134]),new K(30,new R(13,115),new R(3,116)),new K(28,new R(2,46),new R(29,47)),new K(30,new R(42,24),new R(1,25)),new K(30,new R(23,15),new R(28,16))),new Ne(32,Int32Array.from([6,34,60,86,112,138]),new K(30,new R(17,115)),new K(28,new R(10,46),new R(23,47)),new K(30,new R(10,24),new R(35,25)),new K(30,new R(19,15),new R(35,16))),new Ne(33,Int32Array.from([6,30,58,86,114,142]),new K(30,new R(17,115),new R(1,116)),new K(28,new R(14,46),new R(21,47)),new K(30,new R(29,24),new R(19,25)),new K(30,new R(11,15),new R(46,16))),new Ne(34,Int32Array.from([6,34,62,90,118,146]),new K(30,new R(13,115),new R(6,116)),new K(28,new R(14,46),new R(23,47)),new K(30,new R(44,24),new R(7,25)),new K(30,new R(59,16),new R(1,17))),new Ne(35,Int32Array.from([6,30,54,78,102,126,150]),new K(30,new R(12,121),new R(7,122)),new K(28,new R(12,47),new R(26,48)),new K(30,new R(39,24),new R(14,25)),new K(30,new R(22,15),new R(41,16))),new Ne(36,Int32Array.from([6,24,50,76,102,128,154]),new K(30,new R(6,121),new R(14,122)),new K(28,new R(6,47),new R(34,48)),new K(30,new R(46,24),new R(10,25)),new K(30,new R(2,15),new R(64,16))),new Ne(37,Int32Array.from([6,28,54,80,106,132,158]),new K(30,new R(17,122),new R(4,123)),new K(28,new R(29,46),new R(14,47)),new K(30,new R(49,24),new R(10,25)),new K(30,new R(24,15),new R(46,16))),new Ne(38,Int32Array.from([6,32,58,84,110,136,162]),new K(30,new R(4,122),new R(18,123)),new K(28,new R(13,46),new R(32,47)),new K(30,new R(48,24),new R(14,25)),new K(30,new R(42,15),new R(32,16))),new Ne(39,Int32Array.from([6,26,54,82,110,138,166]),new K(30,new R(20,117),new R(4,118)),new K(28,new R(40,47),new R(7,48)),new K(30,new R(43,24),new R(22,25)),new K(30,new R(10,15),new R(67,16))),new Ne(40,Int32Array.from([6,30,58,86,114,142,170]),new K(30,new R(19,118),new R(6,119)),new K(28,new R(18,47),new R(31,48)),new K(30,new R(34,24),new R(34,25)),new K(30,new R(20,15),new R(61,16)))];var ar;(function(E){E[E.DATA_MASK_000=0]="DATA_MASK_000",E[E.DATA_MASK_001=1]="DATA_MASK_001",E[E.DATA_MASK_010=2]="DATA_MASK_010",E[E.DATA_MASK_011=3]="DATA_MASK_011",E[E.DATA_MASK_100=4]="DATA_MASK_100",E[E.DATA_MASK_101=5]="DATA_MASK_101",E[E.DATA_MASK_110=6]="DATA_MASK_110",E[E.DATA_MASK_111=7]="DATA_MASK_111"})(ar||(ar={}));class Gr{constructor(r,s){this.value=r,this.isMasked=s}unmaskBitMatrix(r,s){for(let a=0;a<s;a++)for(let o=0;o<s;o++)this.isMasked(a,o)&&r.flip(o,a)}}Gr.values=new Map([[ar.DATA_MASK_000,new Gr(ar.DATA_MASK_000,(E,r)=>(E+r&1)===0)],[ar.DATA_MASK_001,new Gr(ar.DATA_MASK_001,(E,r)=>(E&1)===0)],[ar.DATA_MASK_010,new Gr(ar.DATA_MASK_010,(E,r)=>r%3===0)],[ar.DATA_MASK_011,new Gr(ar.DATA_MASK_011,(E,r)=>(E+r)%3===0)],[ar.DATA_MASK_100,new Gr(ar.DATA_MASK_100,(E,r)=>(Math.floor(E/2)+Math.floor(r/3)&1)===0)],[ar.DATA_MASK_101,new Gr(ar.DATA_MASK_101,(E,r)=>E*r%6===0)],[ar.DATA_MASK_110,new Gr(ar.DATA_MASK_110,(E,r)=>E*r%6<3)],[ar.DATA_MASK_111,new Gr(ar.DATA_MASK_111,(E,r)=>(E+r+E*r%3&1)===0)]]);class Cf{constructor(r){const s=r.getHeight();if(s<21||(s&3)!==1)throw new G;this.bitMatrix=r}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let r=0;for(let c=0;c<6;c++)r=this.copyBit(c,8,r);r=this.copyBit(7,8,r),r=this.copyBit(8,8,r),r=this.copyBit(8,7,r);for(let c=5;c>=0;c--)r=this.copyBit(8,c,r);const s=this.bitMatrix.getHeight();let a=0;const o=s-7;for(let c=s-1;c>=o;c--)a=this.copyBit(8,c,a);for(let c=s-8;c<s;c++)a=this.copyBit(c,8,a);if(this.parsedFormatInfo=xr.decodeFormatInformation(r,a),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new G}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const r=this.bitMatrix.getHeight(),s=Math.floor((r-17)/4);if(s<=6)return Ne.getVersionForNumber(s);let a=0;const o=r-11;for(let h=5;h>=0;h--)for(let f=r-9;f>=o;f--)a=this.copyBit(f,h,a);let c=Ne.decodeVersionInformation(a);if(c!==null&&c.getDimensionForVersion()===r)return this.parsedVersion=c,c;a=0;for(let h=5;h>=0;h--)for(let f=r-9;f>=o;f--)a=this.copyBit(h,f,a);if(c=Ne.decodeVersionInformation(a),c!==null&&c.getDimensionForVersion()===r)return this.parsedVersion=c,c;throw new G}copyBit(r,s,a){return(this.isMirror?this.bitMatrix.get(s,r):this.bitMatrix.get(r,s))?a<<1|1:a<<1}readCodewords(){const r=this.readFormatInformation(),s=this.readVersion(),a=Gr.values.get(r.getDataMask()),o=this.bitMatrix.getHeight();a.unmaskBitMatrix(this.bitMatrix,o);const c=s.buildFunctionPattern();let h=!0;const f=new Uint8Array(s.getTotalCodewords());let x=0,y=0,v=0;for(let A=o-1;A>0;A-=2){A===6&&A--;for(let S=0;S<o;S++){const j=h?o-1-S:S;for(let L=0;L<2;L++)c.get(A-L,j)||(v++,y<<=1,this.bitMatrix.get(A-L,j)&&(y|=1),v===8&&(f[x++]=y,v=0,y=0))}h=!h}if(x!==s.getTotalCodewords())throw new G;return f}remask(){if(this.parsedFormatInfo===null)return;const r=Gr.values[this.parsedFormatInfo.getDataMask()],s=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,s)}setMirror(r){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=r}mirror(){const r=this.bitMatrix;for(let s=0,a=r.getWidth();s<a;s++)for(let o=s+1,c=r.getHeight();o<c;o++)r.get(s,o)!==r.get(o,s)&&(r.flip(o,s),r.flip(s,o))}}class Fa{constructor(r,s){this.numDataCodewords=r,this.codewords=s}static getDataBlocks(r,s,a){if(r.length!==s.getTotalCodewords())throw new C;const o=s.getECBlocksForLevel(a);let c=0;const h=o.getECBlocks();for(const L of h)c+=L.getCount();const f=new Array(c);let x=0;for(const L of h)for(let U=0;U<L.getCount();U++){const X=L.getDataCodewords(),ee=o.getECCodewordsPerBlock()+X;f[x++]=new Fa(X,new Uint8Array(ee))}const y=f[0].codewords.length;let v=f.length-1;for(;v>=0&&f[v].codewords.length!==y;)v--;v++;const A=y-o.getECCodewordsPerBlock();let S=0;for(let L=0;L<A;L++)for(let U=0;U<x;U++)f[U].codewords[L]=r[S++];for(let L=v;L<x;L++)f[L].codewords[A]=r[S++];const j=f[0].codewords.length;for(let L=A;L<j;L++)for(let U=0;U<x;U++){const X=U<v?L:L+1;f[U].codewords[X]=r[S++]}return f}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var qr;(function(E){E[E.TERMINATOR=0]="TERMINATOR",E[E.NUMERIC=1]="NUMERIC",E[E.ALPHANUMERIC=2]="ALPHANUMERIC",E[E.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",E[E.BYTE=4]="BYTE",E[E.ECI=5]="ECI",E[E.KANJI=6]="KANJI",E[E.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",E[E.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",E[E.HANZI=9]="HANZI"})(qr||(qr={}));class Ie{constructor(r,s,a,o){this.value=r,this.stringValue=s,this.characterCountBitsForVersions=a,this.bits=o,Ie.FOR_BITS.set(o,this),Ie.FOR_VALUE.set(r,this)}static forBits(r){const s=Ie.FOR_BITS.get(r);if(s===void 0)throw new C;return s}getCharacterCountBits(r){const s=r.getVersionNumber();let a;return s<=9?a=0:s<=26?a=1:a=2,this.characterCountBitsForVersions[a]}getValue(){return this.value}getBits(){return this.bits}equals(r){if(!(r instanceof Ie))return!1;const s=r;return this.value===s.value}toString(){return this.stringValue}}Ie.FOR_BITS=new Map,Ie.FOR_VALUE=new Map,Ie.TERMINATOR=new Ie(qr.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Ie.NUMERIC=new Ie(qr.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Ie.ALPHANUMERIC=new Ie(qr.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Ie.STRUCTURED_APPEND=new Ie(qr.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Ie.BYTE=new Ie(qr.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Ie.ECI=new Ie(qr.ECI,"ECI",Int32Array.from([0,0,0]),7),Ie.KANJI=new Ie(qr.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Ie.FNC1_FIRST_POSITION=new Ie(qr.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Ie.FNC1_SECOND_POSITION=new Ie(qr.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Ie.HANZI=new Ie(qr.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Ot{static decode(r,s,a,o){const c=new Ba(r);let h=new te;const f=new Array;let x=-1,y=-1;try{let v=null,A=!1,S;do{if(c.available()<4)S=Ie.TERMINATOR;else{const j=c.readBits(4);S=Ie.forBits(j)}switch(S){case Ie.TERMINATOR:break;case Ie.FNC1_FIRST_POSITION:case Ie.FNC1_SECOND_POSITION:A=!0;break;case Ie.STRUCTURED_APPEND:if(c.available()<16)throw new G;x=c.readBits(8),y=c.readBits(8);break;case Ie.ECI:const j=Ot.parseECIValue(c);if(v=O.getCharacterSetECIByValue(j),v===null)throw new G;break;case Ie.HANZI:const L=c.readBits(4),U=c.readBits(S.getCharacterCountBits(s));L===Ot.GB2312_SUBSET&&Ot.decodeHanziSegment(c,h,U);break;default:const X=c.readBits(S.getCharacterCountBits(s));switch(S){case Ie.NUMERIC:Ot.decodeNumericSegment(c,h,X);break;case Ie.ALPHANUMERIC:Ot.decodeAlphanumericSegment(c,h,X,A);break;case Ie.BYTE:Ot.decodeByteSegment(c,h,X,v,f,o);break;case Ie.KANJI:Ot.decodeKanjiSegment(c,h,X);break;default:throw new G}break}}while(S!==Ie.TERMINATOR)}catch{throw new G}return new Ze(r,h.toString(),f.length===0?null:f,a===null?null:a.toString(),x,y)}static decodeHanziSegment(r,s,a){if(a*13>r.available())throw new G;const o=new Uint8Array(2*a);let c=0;for(;a>0;){const h=r.readBits(13);let f=h/96<<8&4294967295|h%96;f<959?f+=41377:f+=42657,o[c]=f>>8&255,o[c+1]=f&255,c+=2,a--}try{s.append(oe.decode(o,ue.GB2312))}catch(h){throw new G(h)}}static decodeKanjiSegment(r,s,a){if(a*13>r.available())throw new G;const o=new Uint8Array(2*a);let c=0;for(;a>0;){const h=r.readBits(13);let f=h/192<<8&4294967295|h%192;f<7936?f+=33088:f+=49472,o[c]=f>>8,o[c+1]=f,c+=2,a--}try{s.append(oe.decode(o,ue.SHIFT_JIS))}catch(h){throw new G(h)}}static decodeByteSegment(r,s,a,o,c,h){if(8*a>r.available())throw new G;const f=new Uint8Array(a);for(let y=0;y<a;y++)f[y]=r.readBits(8);let x;o===null?x=ue.guessEncoding(f,h):x=o.getName();try{s.append(oe.decode(f,x))}catch(y){throw new G(y)}c.push(f)}static toAlphaNumericChar(r){if(r>=Ot.ALPHANUMERIC_CHARS.length)throw new G;return Ot.ALPHANUMERIC_CHARS[r]}static decodeAlphanumericSegment(r,s,a,o){const c=s.length();for(;a>1;){if(r.available()<11)throw new G;const h=r.readBits(11);s.append(Ot.toAlphaNumericChar(Math.floor(h/45))),s.append(Ot.toAlphaNumericChar(h%45)),a-=2}if(a===1){if(r.available()<6)throw new G;s.append(Ot.toAlphaNumericChar(r.readBits(6)))}if(o)for(let h=c;h<s.length();h++)s.charAt(h)==="%"&&(h<s.length()-1&&s.charAt(h+1)==="%"?s.deleteCharAt(h+1):s.setCharAt(h,""))}static decodeNumericSegment(r,s,a){for(;a>=3;){if(r.available()<10)throw new G;const o=r.readBits(10);if(o>=1e3)throw new G;s.append(Ot.toAlphaNumericChar(Math.floor(o/100))),s.append(Ot.toAlphaNumericChar(Math.floor(o/10)%10)),s.append(Ot.toAlphaNumericChar(o%10)),a-=3}if(a===2){if(r.available()<7)throw new G;const o=r.readBits(7);if(o>=100)throw new G;s.append(Ot.toAlphaNumericChar(Math.floor(o/10))),s.append(Ot.toAlphaNumericChar(o%10))}else if(a===1){if(r.available()<4)throw new G;const o=r.readBits(4);if(o>=10)throw new G;s.append(Ot.toAlphaNumericChar(o))}}static parseECIValue(r){const s=r.readBits(8);if((s&128)===0)return s&127;if((s&192)===128){const a=r.readBits(8);return(s&63)<<8&4294967295|a}if((s&224)===192){const a=r.readBits(16);return(s&31)<<16&4294967295|a}throw new G}}Ot.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Ot.GB2312_SUBSET=1;class oc{constructor(r){this.mirrored=r}isMirrored(){return this.mirrored}applyMirroredCorrection(r){if(!this.mirrored||r===null||r.length<3)return;const s=r[0];r[0]=r[2],r[2]=s}}class _f{constructor(){this.rsDecoder=new Ut(tt.QR_CODE_FIELD_256)}decodeBooleanArray(r,s){return this.decodeBitMatrix(ge.parseFromBooleanArray(r),s)}decodeBitMatrix(r,s){const a=new Cf(r);let o=null;try{return this.decodeBitMatrixParser(a,s)}catch(c){o=c}try{a.remask(),a.setMirror(!0),a.readVersion(),a.readFormatInformation(),a.mirror();const c=this.decodeBitMatrixParser(a,s);return c.setOther(new oc(!0)),c}catch(c){throw o!==null?o:c}}decodeBitMatrixParser(r,s){const a=r.readVersion(),o=r.readFormatInformation().getErrorCorrectionLevel(),c=r.readCodewords(),h=Fa.getDataBlocks(c,a,o);let f=0;for(const v of h)f+=v.getNumDataCodewords();const x=new Uint8Array(f);let y=0;for(const v of h){const A=v.getCodewords(),S=v.getNumDataCodewords();this.correctErrors(A,S);for(let j=0;j<S;j++)x[y++]=A[j]}return Ot.decode(x,a,o,s)}correctErrors(r,s){const a=new Int32Array(r);try{this.rsDecoder.decode(a,r.length-s)}catch{throw new N}for(let o=0;o<s;o++)r[o]=a[o]}}class Ua extends ye{constructor(r,s,a){super(r,s),this.estimatedModuleSize=a}aboutEquals(r,s,a){if(Math.abs(s-this.getY())<=r&&Math.abs(a-this.getX())<=r){const o=Math.abs(r-this.estimatedModuleSize);return o<=1||o<=this.estimatedModuleSize}return!1}combineEstimate(r,s,a){const o=(this.getX()+s)/2,c=(this.getY()+r)/2,h=(this.estimatedModuleSize+a)/2;return new Ua(o,c,h)}}class Wi{constructor(r,s,a,o,c,h,f){this.image=r,this.startX=s,this.startY=a,this.width=o,this.height=c,this.moduleSize=h,this.resultPointCallback=f,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const r=this.startX,s=this.height,a=this.width,o=r+a,c=this.startY+s/2,h=new Int32Array(3),f=this.image;for(let x=0;x<s;x++){const y=c+((x&1)===0?Math.floor((x+1)/2):-Math.floor((x+1)/2));h[0]=0,h[1]=0,h[2]=0;let v=r;for(;v<o&&!f.get(v,y);)v++;let A=0;for(;v<o;){if(f.get(v,y))if(A===1)h[1]++;else if(A===2){if(this.foundPatternCross(h)){const S=this.handlePossibleCenter(h,y,v);if(S!==null)return S}h[0]=h[2],h[1]=1,h[2]=0,A=1}else h[++A]++;else A===1&&A++,h[A]++;v++}if(this.foundPatternCross(h)){const S=this.handlePossibleCenter(h,y,o);if(S!==null)return S}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new q}static centerFromEnd(r,s){return s-r[2]-r[1]/2}foundPatternCross(r){const s=this.moduleSize,a=s/2;for(let o=0;o<3;o++)if(Math.abs(s-r[o])>=a)return!1;return!0}crossCheckVertical(r,s,a,o){const c=this.image,h=c.getHeight(),f=this.crossCheckStateCount;f[0]=0,f[1]=0,f[2]=0;let x=r;for(;x>=0&&c.get(s,x)&&f[1]<=a;)f[1]++,x--;if(x<0||f[1]>a)return NaN;for(;x>=0&&!c.get(s,x)&&f[0]<=a;)f[0]++,x--;if(f[0]>a)return NaN;for(x=r+1;x<h&&c.get(s,x)&&f[1]<=a;)f[1]++,x++;if(x===h||f[1]>a)return NaN;for(;x<h&&!c.get(s,x)&&f[2]<=a;)f[2]++,x++;if(f[2]>a)return NaN;const y=f[0]+f[1]+f[2];return 5*Math.abs(y-o)>=2*o?NaN:this.foundPatternCross(f)?Wi.centerFromEnd(f,x):NaN}handlePossibleCenter(r,s,a){const o=r[0]+r[1]+r[2],c=Wi.centerFromEnd(r,a),h=this.crossCheckVertical(s,c,2*r[1],o);if(!isNaN(h)){const f=(r[0]+r[1]+r[2])/3;for(const y of this.possibleCenters)if(y.aboutEquals(f,h,c))return y.combineEstimate(h,c,f);const x=new Ua(c,h,f);this.possibleCenters.push(x),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(x)}return null}}class Wa extends ye{constructor(r,s,a,o){super(r,s),this.estimatedModuleSize=a,this.count=o,o===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(r,s,a){if(Math.abs(s-this.getY())<=r&&Math.abs(a-this.getX())<=r){const o=Math.abs(r-this.estimatedModuleSize);return o<=1||o<=this.estimatedModuleSize}return!1}combineEstimate(r,s,a){const o=this.count+1,c=(this.count*this.getX()+s)/o,h=(this.count*this.getY()+r)/o,f=(this.count*this.estimatedModuleSize+a)/o;return new Wa(c,h,f,o)}}class Ef{constructor(r){this.bottomLeft=r[0],this.topLeft=r[1],this.topRight=r[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class or{constructor(r,s){this.image=r,this.resultPointCallback=s,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=s}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(r){const s=r!=null&&r.get(V.TRY_HARDER)!==void 0,a=r!=null&&r.get(V.PURE_BARCODE)!==void 0,o=this.image,c=o.getHeight(),h=o.getWidth();let f=Math.floor(3*c/(4*or.MAX_MODULES));(f<or.MIN_SKIP||s)&&(f=or.MIN_SKIP);let x=!1;const y=new Int32Array(5);for(let A=f-1;A<c&&!x;A+=f){y[0]=0,y[1]=0,y[2]=0,y[3]=0,y[4]=0;let S=0;for(let j=0;j<h;j++)if(o.get(j,A))(S&1)===1&&S++,y[S]++;else if((S&1)===0)if(S===4)if(or.foundPatternCross(y)){if(this.handlePossibleCenter(y,A,j,a)===!0)if(f=2,this.hasSkipped===!0)x=this.haveMultiplyConfirmedCenters();else{const U=this.findRowSkip();U>y[2]&&(A+=U-y[2]-f,j=h-1)}else{y[0]=y[2],y[1]=y[3],y[2]=y[4],y[3]=1,y[4]=0,S=3;continue}S=0,y[0]=0,y[1]=0,y[2]=0,y[3]=0,y[4]=0}else y[0]=y[2],y[1]=y[3],y[2]=y[4],y[3]=1,y[4]=0,S=3;else y[++S]++;else y[S]++;or.foundPatternCross(y)&&this.handlePossibleCenter(y,A,h,a)===!0&&(f=y[0],this.hasSkipped&&(x=this.haveMultiplyConfirmedCenters()))}const v=this.selectBestPatterns();return ye.orderBestPatterns(v),new Ef(v)}static centerFromEnd(r,s){return s-r[4]-r[3]-r[2]/2}static foundPatternCross(r){let s=0;for(let c=0;c<5;c++){const h=r[c];if(h===0)return!1;s+=h}if(s<7)return!1;const a=s/7,o=a/2;return Math.abs(a-r[0])<o&&Math.abs(a-r[1])<o&&Math.abs(3*a-r[2])<3*o&&Math.abs(a-r[3])<o&&Math.abs(a-r[4])<o}getCrossCheckStateCount(){const r=this.crossCheckStateCount;return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r}crossCheckDiagonal(r,s,a,o){const c=this.getCrossCheckStateCount();let h=0;const f=this.image;for(;r>=h&&s>=h&&f.get(s-h,r-h);)c[2]++,h++;if(r<h||s<h)return!1;for(;r>=h&&s>=h&&!f.get(s-h,r-h)&&c[1]<=a;)c[1]++,h++;if(r<h||s<h||c[1]>a)return!1;for(;r>=h&&s>=h&&f.get(s-h,r-h)&&c[0]<=a;)c[0]++,h++;if(c[0]>a)return!1;const x=f.getHeight(),y=f.getWidth();for(h=1;r+h<x&&s+h<y&&f.get(s+h,r+h);)c[2]++,h++;if(r+h>=x||s+h>=y)return!1;for(;r+h<x&&s+h<y&&!f.get(s+h,r+h)&&c[3]<a;)c[3]++,h++;if(r+h>=x||s+h>=y||c[3]>=a)return!1;for(;r+h<x&&s+h<y&&f.get(s+h,r+h)&&c[4]<a;)c[4]++,h++;if(c[4]>=a)return!1;const v=c[0]+c[1]+c[2]+c[3]+c[4];return Math.abs(v-o)<2*o&&or.foundPatternCross(c)}crossCheckVertical(r,s,a,o){const c=this.image,h=c.getHeight(),f=this.getCrossCheckStateCount();let x=r;for(;x>=0&&c.get(s,x);)f[2]++,x--;if(x<0)return NaN;for(;x>=0&&!c.get(s,x)&&f[1]<=a;)f[1]++,x--;if(x<0||f[1]>a)return NaN;for(;x>=0&&c.get(s,x)&&f[0]<=a;)f[0]++,x--;if(f[0]>a)return NaN;for(x=r+1;x<h&&c.get(s,x);)f[2]++,x++;if(x===h)return NaN;for(;x<h&&!c.get(s,x)&&f[3]<a;)f[3]++,x++;if(x===h||f[3]>=a)return NaN;for(;x<h&&c.get(s,x)&&f[4]<a;)f[4]++,x++;if(f[4]>=a)return NaN;const y=f[0]+f[1]+f[2]+f[3]+f[4];return 5*Math.abs(y-o)>=2*o?NaN:or.foundPatternCross(f)?or.centerFromEnd(f,x):NaN}crossCheckHorizontal(r,s,a,o){const c=this.image,h=c.getWidth(),f=this.getCrossCheckStateCount();let x=r;for(;x>=0&&c.get(x,s);)f[2]++,x--;if(x<0)return NaN;for(;x>=0&&!c.get(x,s)&&f[1]<=a;)f[1]++,x--;if(x<0||f[1]>a)return NaN;for(;x>=0&&c.get(x,s)&&f[0]<=a;)f[0]++,x--;if(f[0]>a)return NaN;for(x=r+1;x<h&&c.get(x,s);)f[2]++,x++;if(x===h)return NaN;for(;x<h&&!c.get(x,s)&&f[3]<a;)f[3]++,x++;if(x===h||f[3]>=a)return NaN;for(;x<h&&c.get(x,s)&&f[4]<a;)f[4]++,x++;if(f[4]>=a)return NaN;const y=f[0]+f[1]+f[2]+f[3]+f[4];return 5*Math.abs(y-o)>=o?NaN:or.foundPatternCross(f)?or.centerFromEnd(f,x):NaN}handlePossibleCenter(r,s,a,o){const c=r[0]+r[1]+r[2]+r[3]+r[4];let h=or.centerFromEnd(r,a),f=this.crossCheckVertical(s,Math.floor(h),r[2],c);if(!isNaN(f)&&(h=this.crossCheckHorizontal(Math.floor(h),Math.floor(f),r[2],c),!isNaN(h)&&(!o||this.crossCheckDiagonal(Math.floor(f),Math.floor(h),r[2],c)))){const x=c/7;let y=!1;const v=this.possibleCenters;for(let A=0,S=v.length;A<S;A++){const j=v[A];if(j.aboutEquals(x,f,h)){v[A]=j.combineEstimate(f,h,x),y=!0;break}}if(!y){const A=new Wa(h,f,x);v.push(A),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(A)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let s=null;for(const a of this.possibleCenters)if(a.getCount()>=or.CENTER_QUORUM)if(s==null)s=a;else return this.hasSkipped=!0,Math.floor((Math.abs(s.getX()-a.getX())-Math.abs(s.getY()-a.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let r=0,s=0;const a=this.possibleCenters.length;for(const h of this.possibleCenters)h.getCount()>=or.CENTER_QUORUM&&(r++,s+=h.getEstimatedModuleSize());if(r<3)return!1;const o=s/a;let c=0;for(const h of this.possibleCenters)c+=Math.abs(h.getEstimatedModuleSize()-o);return c<=.05*s}selectBestPatterns(){const r=this.possibleCenters.length;if(r<3)throw new q;const s=this.possibleCenters;let a;if(r>3){let o=0,c=0;for(const x of this.possibleCenters){const y=x.getEstimatedModuleSize();o+=y,c+=y*y}a=o/r;let h=Math.sqrt(c/r-a*a);s.sort((x,y)=>{const v=Math.abs(y.getEstimatedModuleSize()-a),A=Math.abs(x.getEstimatedModuleSize()-a);return v<A?-1:v>A?1:0});const f=Math.max(.2*a,h);for(let x=0;x<s.length&&s.length>3;x++){const y=s[x];Math.abs(y.getEstimatedModuleSize()-a)>f&&(s.splice(x,1),x--)}}if(s.length>3){let o=0;for(const c of s)o+=c.getEstimatedModuleSize();a=o/s.length,s.sort((c,h)=>{if(h.getCount()===c.getCount()){const f=Math.abs(h.getEstimatedModuleSize()-a),x=Math.abs(c.getEstimatedModuleSize()-a);return f<x?1:f>x?-1:0}else return h.getCount()-c.getCount()}),s.splice(3)}return[s[0],s[1],s[2]]}}or.CENTER_QUORUM=2,or.MIN_SKIP=3,or.MAX_MODULES=57;class ti{constructor(r){this.image=r}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(r){this.resultPointCallback=r==null?null:r.get(V.NEED_RESULT_POINT_CALLBACK);const a=new or(this.image,this.resultPointCallback).find(r);return this.processFinderPatternInfo(a)}processFinderPatternInfo(r){const s=r.getTopLeft(),a=r.getTopRight(),o=r.getBottomLeft(),c=this.calculateModuleSize(s,a,o);if(c<1)throw new q("No pattern found in proccess finder.");const h=ti.computeDimension(s,a,o,c),f=Ne.getProvisionalVersionForDimension(h),x=f.getDimensionForVersion()-7;let y=null;if(f.getAlignmentPatternCenters().length>0){const j=a.getX()-s.getX()+o.getX(),L=a.getY()-s.getY()+o.getY(),U=1-3/x,X=Math.floor(s.getX()+U*(j-s.getX())),ee=Math.floor(s.getY()+U*(L-s.getY()));for(let le=4;le<=16;le<<=1)try{y=this.findAlignmentInRegion(c,X,ee,le);break}catch(de){if(!(de instanceof q))throw de}}const v=ti.createTransform(s,a,o,y,h),A=ti.sampleGrid(this.image,v,h);let S;return y===null?S=[o,s,a]:S=[o,s,a,y],new gr(A,S)}static createTransform(r,s,a,o,c){const h=c-3.5;let f,x,y,v;return o!==null?(f=o.getX(),x=o.getY(),y=h-3,v=y):(f=s.getX()-r.getX()+a.getX(),x=s.getY()-r.getY()+a.getY(),y=h,v=h),$t.quadrilateralToQuadrilateral(3.5,3.5,h,3.5,y,v,3.5,h,r.getX(),r.getY(),s.getX(),s.getY(),f,x,a.getX(),a.getY())}static sampleGrid(r,s,a){return Xr.getInstance().sampleGridWithTransform(r,a,a,s)}static computeDimension(r,s,a,o){const c=Ae.round(ye.distance(r,s)/o),h=Ae.round(ye.distance(r,a)/o);let f=Math.floor((c+h)/2)+7;switch(f&3){case 0:f++;break;case 2:f--;break;case 3:throw new q("Dimensions could be not found.")}return f}calculateModuleSize(r,s,a){return(this.calculateModuleSizeOneWay(r,s)+this.calculateModuleSizeOneWay(r,a))/2}calculateModuleSizeOneWay(r,s){const a=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(r.getX()),Math.floor(r.getY()),Math.floor(s.getX()),Math.floor(s.getY())),o=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(s.getX()),Math.floor(s.getY()),Math.floor(r.getX()),Math.floor(r.getY()));return isNaN(a)?o/7:isNaN(o)?a/7:(a+o)/14}sizeOfBlackWhiteBlackRunBothWays(r,s,a,o){let c=this.sizeOfBlackWhiteBlackRun(r,s,a,o),h=1,f=r-(a-r);f<0?(h=r/(r-f),f=0):f>=this.image.getWidth()&&(h=(this.image.getWidth()-1-r)/(f-r),f=this.image.getWidth()-1);let x=Math.floor(s-(o-s)*h);return h=1,x<0?(h=s/(s-x),x=0):x>=this.image.getHeight()&&(h=(this.image.getHeight()-1-s)/(x-s),x=this.image.getHeight()-1),f=Math.floor(r+(f-r)*h),c+=this.sizeOfBlackWhiteBlackRun(r,s,f,x),c-1}sizeOfBlackWhiteBlackRun(r,s,a,o){const c=Math.abs(o-s)>Math.abs(a-r);if(c){let j=r;r=s,s=j,j=a,a=o,o=j}const h=Math.abs(a-r),f=Math.abs(o-s);let x=-h/2;const y=r<a?1:-1,v=s<o?1:-1;let A=0;const S=a+y;for(let j=r,L=s;j!==S;j+=y){const U=c?L:j,X=c?j:L;if(A===1===this.image.get(U,X)){if(A===2)return Ae.distance(j,L,r,s);A++}if(x+=f,x>0){if(L===o)break;L+=v,x-=h}}return A===2?Ae.distance(a+y,o,r,s):NaN}findAlignmentInRegion(r,s,a,o){const c=Math.floor(o*r),h=Math.max(0,s-c),f=Math.min(this.image.getWidth()-1,s+c);if(f-h<r*3)throw new q("Alignment top exceeds estimated module size.");const x=Math.max(0,a-c),y=Math.min(this.image.getHeight()-1,a+c);if(y-x<r*3)throw new q("Alignment bottom exceeds estimated module size.");return new Wi(this.image,h,x,f-h,y-x,r,this.resultPointCallback).find()}}class In{constructor(){this.decoder=new _f}getDecoder(){return this.decoder}decode(r,s){let a,o;if(s!=null&&s.get(V.PURE_BARCODE)!==void 0){const x=In.extractPureBits(r.getBlackMatrix());a=this.decoder.decodeBitMatrix(x,s),o=In.NO_POINTS}else{const x=new ti(r.getBlackMatrix()).detect(s);a=this.decoder.decodeBitMatrix(x.getBits(),s),o=x.getPoints()}a.getOther()instanceof oc&&a.getOther().applyMirroredCorrection(o);const c=new ce(a.getText(),a.getRawBytes(),void 0,o,F.QR_CODE,void 0),h=a.getByteSegments();h!==null&&c.putMetadata(Pe.BYTE_SEGMENTS,h);const f=a.getECLevel();return f!==null&&c.putMetadata(Pe.ERROR_CORRECTION_LEVEL,f),a.hasStructuredAppend()&&(c.putMetadata(Pe.STRUCTURED_APPEND_SEQUENCE,a.getStructuredAppendSequenceNumber()),c.putMetadata(Pe.STRUCTURED_APPEND_PARITY,a.getStructuredAppendParity())),c}reset(){}static extractPureBits(r){const s=r.getTopLeftOnBit(),a=r.getBottomRightOnBit();if(s===null||a===null)throw new q;const o=this.moduleSize(s,r);let c=s[1],h=a[1],f=s[0],x=a[0];if(f>=x||c>=h)throw new q;if(h-c!==x-f&&(x=f+(h-c),x>=r.getWidth()))throw new q;const y=Math.round((x-f+1)/o),v=Math.round((h-c+1)/o);if(y<=0||v<=0)throw new q;if(v!==y)throw new q;const A=Math.floor(o/2);c+=A,f+=A;const S=f+Math.floor((y-1)*o)-x;if(S>0){if(S>A)throw new q;f-=S}const j=c+Math.floor((v-1)*o)-h;if(j>0){if(j>A)throw new q;c-=j}const L=new ge(y,v);for(let U=0;U<v;U++){const X=c+Math.floor(U*o);for(let ee=0;ee<y;ee++)r.get(f+Math.floor(ee*o),X)&&L.set(ee,U)}return L}static moduleSize(r,s){const a=s.getHeight(),o=s.getWidth();let c=r[0],h=r[1],f=!0,x=0;for(;c<o&&h<a;){if(f!==s.get(c,h)){if(++x===5)break;f=!f}c++,h++}if(c===o||h===a)throw new q;return(c-r[0])/7}}In.NO_POINTS=new Array;class Me{PDF417Common(){}static getBitCountSum(r){return Ae.sum(r)}static toIntArray(r){if(r==null||!r.length)return Me.EMPTY_INT_ARRAY;const s=new Int32Array(r.length);let a=0;for(const o of r)s[a++]=o;return s}static getCodeword(r){const s=H.binarySearch(Me.SYMBOL_TABLE,r&262143);return s<0?-1:(Me.CODEWORD_TABLE[s]-1)%Me.NUMBER_OF_CODEWORDS}}Me.NUMBER_OF_CODEWORDS=929,Me.MAX_CODEWORDS_IN_BARCODE=Me.NUMBER_OF_CODEWORDS-1,Me.MIN_ROWS_IN_BARCODE=3,Me.MAX_ROWS_IN_BARCODE=90,Me.MODULES_IN_CODEWORD=17,Me.MODULES_IN_STOP_PATTERN=18,Me.BARS_IN_MODULE=8,Me.EMPTY_INT_ARRAY=new Int32Array([]),Me.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Me.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Af{constructor(r,s){this.bits=r,this.points=s}getBits(){return this.bits}getPoints(){return this.points}}class Ye{static detectMultiple(r,s,a){let o=r.getBlackMatrix(),c=Ye.detect(a,o);return c.length||(o=o.clone(),o.rotate180(),c=Ye.detect(a,o)),new Af(o,c)}static detect(r,s){const a=new Array;let o=0,c=0,h=!1;for(;o<s.getHeight();){const f=Ye.findVertices(s,o,c);if(f[0]==null&&f[3]==null){if(!h)break;h=!1,c=0;for(const x of a)x[1]!=null&&(o=Math.trunc(Math.max(o,x[1].getY()))),x[3]!=null&&(o=Math.max(o,Math.trunc(x[3].getY())));o+=Ye.ROW_STEP;continue}if(h=!0,a.push(f),!r)break;f[2]!=null?(c=Math.trunc(f[2].getX()),o=Math.trunc(f[2].getY())):(c=Math.trunc(f[4].getX()),o=Math.trunc(f[4].getY()))}return a}static findVertices(r,s,a){const o=r.getHeight(),c=r.getWidth(),h=new Array(8);return Ye.copyToResult(h,Ye.findRowsWithPattern(r,o,c,s,a,Ye.START_PATTERN),Ye.INDEXES_START_PATTERN),h[4]!=null&&(a=Math.trunc(h[4].getX()),s=Math.trunc(h[4].getY())),Ye.copyToResult(h,Ye.findRowsWithPattern(r,o,c,s,a,Ye.STOP_PATTERN),Ye.INDEXES_STOP_PATTERN),h}static copyToResult(r,s,a){for(let o=0;o<a.length;o++)r[a[o]]=s[o]}static findRowsWithPattern(r,s,a,o,c,h){const f=new Array(4);let x=!1;const y=new Int32Array(h.length);for(;o<s;o+=Ye.ROW_STEP){let A=Ye.findGuardPattern(r,c,o,a,!1,h,y);if(A!=null){for(;o>0;){const S=Ye.findGuardPattern(r,c,--o,a,!1,h,y);if(S!=null)A=S;else{o++;break}}f[0]=new ye(A[0],o),f[1]=new ye(A[1],o),x=!0;break}}let v=o+1;if(x){let A=0,S=Int32Array.from([Math.trunc(f[0].getX()),Math.trunc(f[1].getX())]);for(;v<s;v++){const j=Ye.findGuardPattern(r,S[0],v,a,!1,h,y);if(j!=null&&Math.abs(S[0]-j[0])<Ye.MAX_PATTERN_DRIFT&&Math.abs(S[1]-j[1])<Ye.MAX_PATTERN_DRIFT)S=j,A=0;else{if(A>Ye.SKIPPED_ROW_COUNT_MAX)break;A++}}v-=A+1,f[2]=new ye(S[0],v),f[3]=new ye(S[1],v)}return v-o<Ye.BARCODE_MIN_HEIGHT&&H.fill(f,null),f}static findGuardPattern(r,s,a,o,c,h,f){H.fillWithin(f,0,f.length,0);let x=s,y=0;for(;r.get(x,a)&&x>0&&y++<Ye.MAX_PIXEL_DRIFT;)x--;let v=x,A=0,S=h.length;for(let j=c;v<o;v++)if(r.get(v,a)!==j)f[A]++;else{if(A===S-1){if(Ye.patternMatchVariance(f,h,Ye.MAX_INDIVIDUAL_VARIANCE)<Ye.MAX_AVG_VARIANCE)return new Int32Array([x,v]);x+=f[0]+f[1],T.arraycopy(f,2,f,0,A-1),f[A-1]=0,f[A]=0,A--}else A++;f[A]=1,j=!j}return A===S-1&&Ye.patternMatchVariance(f,h,Ye.MAX_INDIVIDUAL_VARIANCE)<Ye.MAX_AVG_VARIANCE?new Int32Array([x,v-1]):null}static patternMatchVariance(r,s,a){let o=r.length,c=0,h=0;for(let y=0;y<o;y++)c+=r[y],h+=s[y];if(c<h)return 1/0;let f=c/h;a*=f;let x=0;for(let y=0;y<o;y++){let v=r[y],A=s[y]*f,S=v>A?v-A:A-v;if(S>a)return 1/0;x+=S}return x/c}}Ye.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Ye.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Ye.MAX_AVG_VARIANCE=.42,Ye.MAX_INDIVIDUAL_VARIANCE=.8,Ye.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Ye.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Ye.MAX_PIXEL_DRIFT=3,Ye.MAX_PATTERN_DRIFT=5,Ye.SKIPPED_ROW_COUNT_MAX=25,Ye.ROW_STEP=5,Ye.BARCODE_MIN_HEIGHT=10;class lr{constructor(r,s){if(s.length===0)throw new C;this.field=r;let a=s.length;if(a>1&&s[0]===0){let o=1;for(;o<a&&s[o]===0;)o++;o===a?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(a-o),T.arraycopy(s,o,this.coefficients,0,this.coefficients.length))}else this.coefficients=s}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(r){return this.coefficients[this.coefficients.length-1-r]}evaluateAt(r){if(r===0)return this.getCoefficient(0);if(r===1){let o=0;for(let c of this.coefficients)o=this.field.add(o,c);return o}let s=this.coefficients[0],a=this.coefficients.length;for(let o=1;o<a;o++)s=this.field.add(this.field.multiply(r,s),this.coefficients[o]);return s}add(r){if(!this.field.equals(r.field))throw new C("ModulusPolys do not have same ModulusGF field");if(this.isZero())return r;if(r.isZero())return this;let s=this.coefficients,a=r.coefficients;if(s.length>a.length){let h=s;s=a,a=h}let o=new Int32Array(a.length),c=a.length-s.length;T.arraycopy(a,0,o,0,c);for(let h=c;h<a.length;h++)o[h]=this.field.add(s[h-c],a[h]);return new lr(this.field,o)}subtract(r){if(!this.field.equals(r.field))throw new C("ModulusPolys do not have same ModulusGF field");return r.isZero()?this:this.add(r.negative())}multiply(r){return r instanceof lr?this.multiplyOther(r):this.multiplyScalar(r)}multiplyOther(r){if(!this.field.equals(r.field))throw new C("ModulusPolys do not have same ModulusGF field");if(this.isZero()||r.isZero())return new lr(this.field,new Int32Array([0]));let s=this.coefficients,a=s.length,o=r.coefficients,c=o.length,h=new Int32Array(a+c-1);for(let f=0;f<a;f++){let x=s[f];for(let y=0;y<c;y++)h[f+y]=this.field.add(h[f+y],this.field.multiply(x,o[y]))}return new lr(this.field,h)}negative(){let r=this.coefficients.length,s=new Int32Array(r);for(let a=0;a<r;a++)s[a]=this.field.subtract(0,this.coefficients[a]);return new lr(this.field,s)}multiplyScalar(r){if(r===0)return new lr(this.field,new Int32Array([0]));if(r===1)return this;let s=this.coefficients.length,a=new Int32Array(s);for(let o=0;o<s;o++)a[o]=this.field.multiply(this.coefficients[o],r);return new lr(this.field,a)}multiplyByMonomial(r,s){if(r<0)throw new C;if(s===0)return new lr(this.field,new Int32Array([0]));let a=this.coefficients.length,o=new Int32Array(a+r);for(let c=0;c<a;c++)o[c]=this.field.multiply(this.coefficients[c],s);return new lr(this.field,o)}toString(){let r=new te;for(let s=this.getDegree();s>=0;s--){let a=this.getCoefficient(s);a!==0&&(a<0?(r.append(" - "),a=-a):r.length()>0&&r.append(" + "),(s===0||a!==1)&&r.append(a),s!==0&&(s===1?r.append("x"):(r.append("x^"),r.append(s))))}return r.toString()}}class Nf{add(r,s){return(r+s)%this.modulus}subtract(r,s){return(this.modulus+r-s)%this.modulus}exp(r){return this.expTable[r]}log(r){if(r===0)throw new C;return this.logTable[r]}inverse(r){if(r===0)throw new wr;return this.expTable[this.modulus-this.logTable[r]-1]}multiply(r,s){return r===0||s===0?0:this.expTable[(this.logTable[r]+this.logTable[s])%(this.modulus-1)]}getSize(){return this.modulus}equals(r){return r===this}}class Va extends Nf{constructor(r,s){super(),this.modulus=r,this.expTable=new Int32Array(r),this.logTable=new Int32Array(r);let a=1;for(let o=0;o<r;o++)this.expTable[o]=a,a=a*s%r;for(let o=0;o<r-1;o++)this.logTable[this.expTable[o]]=o;this.zero=new lr(this,new Int32Array([0])),this.one=new lr(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(r,s){if(r<0)throw new C;if(s===0)return this.zero;let a=new Int32Array(r+1);return a[0]=s,new lr(this,a)}}Va.PDF417_GF=new Va(Me.NUMBER_OF_CODEWORDS,3);class lc{constructor(){this.field=Va.PDF417_GF}decode(r,s,a){let o=new lr(this.field,r),c=new Int32Array(s),h=!1;for(let L=s;L>0;L--){let U=o.evaluateAt(this.field.exp(L));c[s-L]=U,U!==0&&(h=!0)}if(!h)return 0;let f=this.field.getOne();if(a!=null)for(const L of a){let U=this.field.exp(r.length-1-L),X=new lr(this.field,new Int32Array([this.field.subtract(0,U),1]));f=f.multiply(X)}let x=new lr(this.field,c),y=this.runEuclideanAlgorithm(this.field.buildMonomial(s,1),x,s),v=y[0],A=y[1],S=this.findErrorLocations(v),j=this.findErrorMagnitudes(A,v,S);for(let L=0;L<S.length;L++){let U=r.length-1-this.field.log(S[L]);if(U<0)throw N.getChecksumInstance();r[U]=this.field.subtract(r[U],j[L])}return S.length}runEuclideanAlgorithm(r,s,a){if(r.getDegree()<s.getDegree()){let S=r;r=s,s=S}let o=r,c=s,h=this.field.getZero(),f=this.field.getOne();for(;c.getDegree()>=Math.round(a/2);){let S=o,j=h;if(o=c,h=f,o.isZero())throw N.getChecksumInstance();c=S;let L=this.field.getZero(),U=o.getCoefficient(o.getDegree()),X=this.field.inverse(U);for(;c.getDegree()>=o.getDegree()&&!c.isZero();){let ee=c.getDegree()-o.getDegree(),le=this.field.multiply(c.getCoefficient(c.getDegree()),X);L=L.add(this.field.buildMonomial(ee,le)),c=c.subtract(o.multiplyByMonomial(ee,le))}f=L.multiply(h).subtract(j).negative()}let x=f.getCoefficient(0);if(x===0)throw N.getChecksumInstance();let y=this.field.inverse(x),v=f.multiply(y),A=c.multiply(y);return[v,A]}findErrorLocations(r){let s=r.getDegree(),a=new Int32Array(s),o=0;for(let c=1;c<this.field.getSize()&&o<s;c++)r.evaluateAt(c)===0&&(a[o]=this.field.inverse(c),o++);if(o!==s)throw N.getChecksumInstance();return a}findErrorMagnitudes(r,s,a){let o=s.getDegree(),c=new Int32Array(o);for(let y=1;y<=o;y++)c[o-y]=this.field.multiply(y,s.getCoefficient(y));let h=new lr(this.field,c),f=a.length,x=new Int32Array(f);for(let y=0;y<f;y++){let v=this.field.inverse(a[y]),A=this.field.subtract(0,r.evaluateAt(v)),S=this.field.inverse(h.evaluateAt(v));x[y]=this.field.multiply(A,S)}return x}}class zn{constructor(r,s,a,o,c){r instanceof zn?this.constructor_2(r):this.constructor_1(r,s,a,o,c)}constructor_1(r,s,a,o,c){const h=s==null||a==null,f=o==null||c==null;if(h&&f)throw new q;h?(s=new ye(0,o.getY()),a=new ye(0,c.getY())):f&&(o=new ye(r.getWidth()-1,s.getY()),c=new ye(r.getWidth()-1,a.getY())),this.image=r,this.topLeft=s,this.bottomLeft=a,this.topRight=o,this.bottomRight=c,this.minX=Math.trunc(Math.min(s.getX(),a.getX())),this.maxX=Math.trunc(Math.max(o.getX(),c.getX())),this.minY=Math.trunc(Math.min(s.getY(),o.getY())),this.maxY=Math.trunc(Math.max(a.getY(),c.getY()))}constructor_2(r){this.image=r.image,this.topLeft=r.getTopLeft(),this.bottomLeft=r.getBottomLeft(),this.topRight=r.getTopRight(),this.bottomRight=r.getBottomRight(),this.minX=r.getMinX(),this.maxX=r.getMaxX(),this.minY=r.getMinY(),this.maxY=r.getMaxY()}static merge(r,s){return r==null?s:s==null?r:new zn(r.image,r.topLeft,r.bottomLeft,s.topRight,s.bottomRight)}addMissingRows(r,s,a){let o=this.topLeft,c=this.bottomLeft,h=this.topRight,f=this.bottomRight;if(r>0){let x=a?this.topLeft:this.topRight,y=Math.trunc(x.getY()-r);y<0&&(y=0);let v=new ye(x.getX(),y);a?o=v:h=v}if(s>0){let x=a?this.bottomLeft:this.bottomRight,y=Math.trunc(x.getY()+s);y>=this.image.getHeight()&&(y=this.image.getHeight()-1);let v=new ye(x.getX(),y);a?c=v:f=v}return new zn(this.image,o,c,h,f)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Sf{constructor(r,s,a,o){this.columnCount=r,this.errorCorrectionLevel=o,this.rowCountUpperPart=s,this.rowCountLowerPart=a,this.rowCount=s+a}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class ri{constructor(){this.buffer=""}static form(r,s){let a=-1;function o(h,f,x,y,v,A){if(h==="%%")return"%";if(s[++a]===void 0)return;h=y?parseInt(y.substr(1)):void 0;let S=v?parseInt(v.substr(1)):void 0,j;switch(A){case"s":j=s[a];break;case"c":j=s[a][0];break;case"f":j=parseFloat(s[a]).toFixed(h);break;case"p":j=parseFloat(s[a]).toPrecision(h);break;case"e":j=parseFloat(s[a]).toExponential(h);break;case"x":j=parseInt(s[a]).toString(S||16);break;case"d":j=parseFloat(parseInt(s[a],S||10).toPrecision(h)).toFixed(0);break}j=typeof j=="object"?JSON.stringify(j):(+j).toString(S);let L=parseInt(x),U=x&&x[0]+""=="0"?"0":" ";for(;j.length<L;)j=f!==void 0?j+U:U+j;return j}let c=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return r.replace(c,o)}format(r,...s){this.buffer+=ri.form(r,s)}toString(){return this.buffer}}class ni{constructor(r){this.boundingBox=new zn(r),this.codewords=new Array(r.getMaxY()-r.getMinY()+1)}getCodewordNearby(r){let s=this.getCodeword(r);if(s!=null)return s;for(let a=1;a<ni.MAX_NEARBY_DISTANCE;a++){let o=this.imageRowToCodewordIndex(r)-a;if(o>=0&&(s=this.codewords[o],s!=null)||(o=this.imageRowToCodewordIndex(r)+a,o<this.codewords.length&&(s=this.codewords[o],s!=null)))return s}return null}imageRowToCodewordIndex(r){return r-this.boundingBox.getMinY()}setCodeword(r,s){this.codewords[this.imageRowToCodewordIndex(r)]=s}getCodeword(r){return this.codewords[this.imageRowToCodewordIndex(r)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const r=new ri;let s=0;for(const a of this.codewords){if(a==null){r.format("%3d:    |   %n",s++);continue}r.format("%3d: %3d|%3d%n",s++,a.getRowNumber(),a.getValue())}return r.toString()}}ni.MAX_NEARBY_DISTANCE=5;class si{constructor(){this.values=new Map}setValue(r){r=Math.trunc(r);let s=this.values.get(r);s==null&&(s=0),s++,this.values.set(r,s)}getValue(){let r=-1,s=new Array;for(const[a,o]of this.values.entries()){const c={getKey:()=>a,getValue:()=>o};c.getValue()>r?(r=c.getValue(),s=[],s.push(c.getKey())):c.getValue()===r&&s.push(c.getKey())}return Me.toIntArray(s)}getConfidence(r){return this.values.get(r)}}class cc extends ni{constructor(r,s){super(r),this._isLeft=s}setRowNumbers(){for(let r of this.getCodewords())r?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(r){let s=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(s,r);let a=this.getBoundingBox(),o=this._isLeft?a.getTopLeft():a.getTopRight(),c=this._isLeft?a.getBottomLeft():a.getBottomRight(),h=this.imageRowToCodewordIndex(Math.trunc(o.getY())),f=this.imageRowToCodewordIndex(Math.trunc(c.getY())),x=-1,y=1,v=0;for(let A=h;A<f;A++){if(s[A]==null)continue;let S=s[A],j=S.getRowNumber()-x;if(j===0)v++;else if(j===1)y=Math.max(y,v),v=1,x=S.getRowNumber();else if(j<0||S.getRowNumber()>=r.getRowCount()||j>A)s[A]=null;else{let L;y>2?L=(y-2)*j:L=j;let U=L>=A;for(let X=1;X<=L&&!U;X++)U=s[A-X]!=null;U?s[A]=null:(x=S.getRowNumber(),v=1)}}}getRowHeights(){let r=this.getBarcodeMetadata();if(r==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(r);let s=new Int32Array(r.getRowCount());for(let a of this.getCodewords())if(a!=null){let o=a.getRowNumber();if(o>=s.length)continue;s[o]++}return s}adjustIncompleteIndicatorColumnRowNumbers(r){let s=this.getBoundingBox(),a=this._isLeft?s.getTopLeft():s.getTopRight(),o=this._isLeft?s.getBottomLeft():s.getBottomRight(),c=this.imageRowToCodewordIndex(Math.trunc(a.getY())),h=this.imageRowToCodewordIndex(Math.trunc(o.getY())),f=this.getCodewords(),x=-1;for(let y=c;y<h;y++){if(f[y]==null)continue;let v=f[y];v.setRowNumberAsRowIndicatorColumn();let A=v.getRowNumber()-x;A===0||(A===1?x=v.getRowNumber():v.getRowNumber()>=r.getRowCount()?f[y]=null:x=v.getRowNumber())}}getBarcodeMetadata(){let r=this.getCodewords(),s=new si,a=new si,o=new si,c=new si;for(let f of r){if(f==null)continue;f.setRowNumberAsRowIndicatorColumn();let x=f.getValue()%30,y=f.getRowNumber();switch(this._isLeft||(y+=2),y%3){case 0:a.setValue(x*3+1);break;case 1:c.setValue(x/3),o.setValue(x%3);break;case 2:s.setValue(x+1);break}}if(s.getValue().length===0||a.getValue().length===0||o.getValue().length===0||c.getValue().length===0||s.getValue()[0]<1||a.getValue()[0]+o.getValue()[0]<Me.MIN_ROWS_IN_BARCODE||a.getValue()[0]+o.getValue()[0]>Me.MAX_ROWS_IN_BARCODE)return null;let h=new Sf(s.getValue()[0],a.getValue()[0],o.getValue()[0],c.getValue()[0]);return this.removeIncorrectCodewords(r,h),h}removeIncorrectCodewords(r,s){for(let a=0;a<r.length;a++){let o=r[a];if(r[a]==null)continue;let c=o.getValue()%30,h=o.getRowNumber();if(h>s.getRowCount()){r[a]=null;continue}switch(this._isLeft||(h+=2),h%3){case 0:c*3+1!==s.getRowCountUpperPart()&&(r[a]=null);break;case 1:(Math.trunc(c/3)!==s.getErrorCorrectionLevel()||c%3!==s.getRowCountLowerPart())&&(r[a]=null);break;case 2:c+1!==s.getColumnCount()&&(r[a]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class ii{constructor(r,s){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=r,this.barcodeColumnCount=r.getColumnCount(),this.boundingBox=s,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let r=Me.MAX_CODEWORDS_IN_BARCODE,s;do s=r,r=this.adjustRowNumbersAndGetCount();while(r>0&&r<s);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(r){r?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let r=this.adjustRowNumbersByRow();if(r===0)return 0;for(let s=1;s<this.barcodeColumnCount+1;s++){let a=this.detectionResultColumns[s].getCodewords();for(let o=0;o<a.length;o++)a[o]!=null&&(a[o].hasValidRowNumber()||this.adjustRowNumbers(s,o,a))}return r}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let r=this.detectionResultColumns[0].getCodewords(),s=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let a=0;a<r.length;a++)if(r[a]!=null&&s[a]!=null&&r[a].getRowNumber()===s[a].getRowNumber())for(let o=1;o<=this.barcodeColumnCount;o++){let c=this.detectionResultColumns[o].getCodewords()[a];c!=null&&(c.setRowNumber(r[a].getRowNumber()),c.hasValidRowNumber()||(this.detectionResultColumns[o].getCodewords()[a]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let r=0,s=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let a=0;a<s.length;a++){if(s[a]==null)continue;let o=s[a].getRowNumber(),c=0;for(let h=this.barcodeColumnCount+1;h>0&&c<this.ADJUST_ROW_NUMBER_SKIP;h--){let f=this.detectionResultColumns[h].getCodewords()[a];f!=null&&(c=ii.adjustRowNumberIfValid(o,c,f),f.hasValidRowNumber()||r++)}}return r}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let r=0,s=this.detectionResultColumns[0].getCodewords();for(let a=0;a<s.length;a++){if(s[a]==null)continue;let o=s[a].getRowNumber(),c=0;for(let h=1;h<this.barcodeColumnCount+1&&c<this.ADJUST_ROW_NUMBER_SKIP;h++){let f=this.detectionResultColumns[h].getCodewords()[a];f!=null&&(c=ii.adjustRowNumberIfValid(o,c,f),f.hasValidRowNumber()||r++)}}return r}static adjustRowNumberIfValid(r,s,a){return a==null||a.hasValidRowNumber()||(a.isValidRowNumber(r)?(a.setRowNumber(r),s=0):++s),s}adjustRowNumbers(r,s,a){if(!this.detectionResultColumns[r-1])return;let o=a[s],c=this.detectionResultColumns[r-1].getCodewords(),h=c;this.detectionResultColumns[r+1]!=null&&(h=this.detectionResultColumns[r+1].getCodewords());let f=new Array(14);f[2]=c[s],f[3]=h[s],s>0&&(f[0]=a[s-1],f[4]=c[s-1],f[5]=h[s-1]),s>1&&(f[8]=a[s-2],f[10]=c[s-2],f[11]=h[s-2]),s<a.length-1&&(f[1]=a[s+1],f[6]=c[s+1],f[7]=h[s+1]),s<a.length-2&&(f[9]=a[s+2],f[12]=c[s+2],f[13]=h[s+2]);for(let x of f)if(ii.adjustRowNumber(o,x))return}static adjustRowNumber(r,s){return s==null?!1:s.hasValidRowNumber()&&s.getBucket()===r.getBucket()?(r.setRowNumber(s.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(r){this.boundingBox=r}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(r,s){this.detectionResultColumns[r]=s}getDetectionResultColumn(r){return this.detectionResultColumns[r]}toString(){let r=this.detectionResultColumns[0];r==null&&(r=this.detectionResultColumns[this.barcodeColumnCount+1]);let s=new ri;for(let a=0;a<r.getCodewords().length;a++){s.format("CW %3d:",a);for(let o=0;o<this.barcodeColumnCount+2;o++){if(this.detectionResultColumns[o]==null){s.format("    |   ");continue}let c=this.detectionResultColumns[o].getCodewords()[a];if(c==null){s.format("    |   ");continue}s.format(" %3d|%3d",c.getRowNumber(),c.getValue())}s.format("%n")}return s.toString()}}class ai{constructor(r,s,a,o){this.rowNumber=ai.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(r),this.endX=Math.trunc(s),this.bucket=Math.trunc(a),this.value=Math.trunc(o)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(r){return r!==ai.BARCODE_ROW_UNKNOWN&&this.bucket===r%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(r){this.rowNumber=r}toString(){return this.rowNumber+"|"+this.value}}ai.BARCODE_ROW_UNKNOWN=-1;class Sr{static initialize(){for(let r=0;r<Me.SYMBOL_TABLE.length;r++){let s=Me.SYMBOL_TABLE[r],a=s&1;for(let o=0;o<Me.BARS_IN_MODULE;o++){let c=0;for(;(s&1)===a;)c+=1,s>>=1;a=s&1,Sr.RATIOS_TABLE[r]||(Sr.RATIOS_TABLE[r]=new Array(Me.BARS_IN_MODULE)),Sr.RATIOS_TABLE[r][Me.BARS_IN_MODULE-o-1]=Math.fround(c/Me.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(r){let s=Sr.getDecodedCodewordValue(Sr.sampleBitCounts(r));return s!==-1?s:Sr.getClosestDecodedValue(r)}static sampleBitCounts(r){let s=Ae.sum(r),a=new Int32Array(Me.BARS_IN_MODULE),o=0,c=0;for(let h=0;h<Me.MODULES_IN_CODEWORD;h++){let f=s/(2*Me.MODULES_IN_CODEWORD)+h*s/Me.MODULES_IN_CODEWORD;c+r[o]<=f&&(c+=r[o],o++),a[o]++}return a}static getDecodedCodewordValue(r){let s=Sr.getBitValue(r);return Me.getCodeword(s)===-1?-1:s}static getBitValue(r){let s=0;for(let a=0;a<r.length;a++)for(let o=0;o<r[a];o++)s=s<<1|(a%2===0?1:0);return Math.trunc(s)}static getClosestDecodedValue(r){let s=Ae.sum(r),a=new Array(Me.BARS_IN_MODULE);if(s>1)for(let h=0;h<a.length;h++)a[h]=Math.fround(r[h]/s);let o=sr.MAX_VALUE,c=-1;this.bSymbolTableReady||Sr.initialize();for(let h=0;h<Sr.RATIOS_TABLE.length;h++){let f=0,x=Sr.RATIOS_TABLE[h];for(let y=0;y<Me.BARS_IN_MODULE;y++){let v=Math.fround(x[y]-a[y]);if(f+=Math.fround(v*v),f>=o)break}f<o&&(o=f,c=Me.SYMBOL_TABLE[h])}return c}}Sr.bSymbolTableReady=!1,Sr.RATIOS_TABLE=new Array(Me.SYMBOL_TABLE.length).map(E=>new Array(Me.BARS_IN_MODULE));class uc{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(r){this.segmentIndex=r}getFileId(){return this.fileId}setFileId(r){this.fileId=r}getOptionalData(){return this.optionalData}setOptionalData(r){this.optionalData=r}isLastSegment(){return this.lastSegment}setLastSegment(r){this.lastSegment=r}getSegmentCount(){return this.segmentCount}setSegmentCount(r){this.segmentCount=r}getSender(){return this.sender||null}setSender(r){this.sender=r}getAddressee(){return this.addressee||null}setAddressee(r){this.addressee=r}getFileName(){return this.fileName}setFileName(r){this.fileName=r}getFileSize(){return this.fileSize}setFileSize(r){this.fileSize=r}getChecksum(){return this.checksum}setChecksum(r){this.checksum=r}getTimestamp(){return this.timestamp}setTimestamp(r){this.timestamp=r}}class dc{static parseLong(r,s=void 0){return parseInt(r,s)}}class hc extends m{}hc.kind="NullPointerException";class If{writeBytes(r){this.writeBytesOffset(r,0,r.length)}writeBytesOffset(r,s,a){if(r==null)throw new hc;if(s<0||s>r.length||a<0||s+a>r.length||s+a<0)throw new k;if(a===0)return;for(let o=0;o<a;o++)this.write(r[s+o])}flush(){}close(){}}class Tf extends m{}class Of extends If{constructor(r=32){if(super(),this.count=0,r<0)throw new C("Negative initial size: "+r);this.buf=new Uint8Array(r)}ensureCapacity(r){r-this.buf.length>0&&this.grow(r)}grow(r){let a=this.buf.length<<1;if(a-r<0&&(a=r),a<0){if(r<0)throw new Tf;a=B.MAX_VALUE}this.buf=H.copyOfUint8Array(this.buf,a)}write(r){this.ensureCapacity(this.count+1),this.buf[this.count]=r,this.count+=1}writeBytesOffset(r,s,a){if(s<0||s>r.length||a<0||s+a-r.length>0)throw new k;this.ensureCapacity(this.count+a),T.arraycopy(r,s,this.buf,this.count,a),this.count+=a}writeTo(r){r.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return H.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(r){return r?typeof r=="string"?this.toString_string(r):this.toString_number(r):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(r){return new String(this.buf).toString()}toString_number(r){return new String(this.buf).toString()}close(){}}var gt;(function(E){E[E.ALPHA=0]="ALPHA",E[E.LOWER=1]="LOWER",E[E.MIXED=2]="MIXED",E[E.PUNCT=3]="PUNCT",E[E.ALPHA_SHIFT=4]="ALPHA_SHIFT",E[E.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(gt||(gt={}));function fc(){if(typeof window<"u")return window.BigInt||null;if(typeof Xi<"u")return Xi.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Vi;function Tn(E){if(typeof Vi>"u"&&(Vi=fc()),Vi===null)throw new Error("BigInt is not supported!");return Vi(E)}function Rf(){let E=[];E[0]=Tn(1);let r=Tn(900);E[1]=r;for(let s=2;s<16;s++)E[s]=E[s-1]*r;return E}class J{static decode(r,s){let a=new te(""),o=O.ISO8859_1;a.enableDecoding(o);let c=1,h=r[c++],f=new uc;for(;c<r[0];){switch(h){case J.TEXT_COMPACTION_MODE_LATCH:c=J.textCompaction(r,c,a);break;case J.BYTE_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH_6:c=J.byteCompaction(h,r,o,c,a);break;case J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(r[c++]);break;case J.NUMERIC_COMPACTION_MODE_LATCH:c=J.numericCompaction(r,c,a);break;case J.ECI_CHARSET:O.getCharacterSetECIByValue(r[c++]);break;case J.ECI_GENERAL_PURPOSE:c+=2;break;case J.ECI_USER_DEFINED:c++;break;case J.BEGIN_MACRO_PDF417_CONTROL_BLOCK:c=J.decodeMacroBlock(r,c,f);break;case J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case J.MACRO_PDF417_TERMINATOR:throw new G;default:c--,c=J.textCompaction(r,c,a);break}if(c<r.length)h=r[c++];else throw G.getFormatInstance()}if(a.length()===0)throw G.getFormatInstance();let x=new Ze(null,a.toString(),null,s);return x.setOther(f),x}static decodeMacroBlock(r,s,a){if(s+J.NUMBER_OF_SEQUENCE_CODEWORDS>r[0])throw G.getFormatInstance();let o=new Int32Array(J.NUMBER_OF_SEQUENCE_CODEWORDS);for(let f=0;f<J.NUMBER_OF_SEQUENCE_CODEWORDS;f++,s++)o[f]=r[s];a.setSegmentIndex(B.parseInt(J.decodeBase900toBase10(o,J.NUMBER_OF_SEQUENCE_CODEWORDS)));let c=new te;s=J.textCompaction(r,s,c),a.setFileId(c.toString());let h=-1;for(r[s]===J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(h=s+1);s<r[0];)switch(r[s]){case J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(s++,r[s]){case J.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let f=new te;s=J.textCompaction(r,s+1,f),a.setFileName(f.toString());break;case J.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let x=new te;s=J.textCompaction(r,s+1,x),a.setSender(x.toString());break;case J.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let y=new te;s=J.textCompaction(r,s+1,y),a.setAddressee(y.toString());break;case J.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let v=new te;s=J.numericCompaction(r,s+1,v),a.setSegmentCount(B.parseInt(v.toString()));break;case J.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let A=new te;s=J.numericCompaction(r,s+1,A),a.setTimestamp(dc.parseLong(A.toString()));break;case J.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let S=new te;s=J.numericCompaction(r,s+1,S),a.setChecksum(B.parseInt(S.toString()));break;case J.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let j=new te;s=J.numericCompaction(r,s+1,j),a.setFileSize(dc.parseLong(j.toString()));break;default:throw G.getFormatInstance()}break;case J.MACRO_PDF417_TERMINATOR:s++,a.setLastSegment(!0);break;default:throw G.getFormatInstance()}if(h!==-1){let f=s-h;a.isLastSegment()&&f--,a.setOptionalData(H.copyOfRange(r,h,h+f))}return s}static textCompaction(r,s,a){let o=new Int32Array((r[0]-s)*2),c=new Int32Array((r[0]-s)*2),h=0,f=!1;for(;s<r[0]&&!f;){let x=r[s++];if(x<J.TEXT_COMPACTION_MODE_LATCH)o[h]=x/30,o[h+1]=x%30,h+=2;else switch(x){case J.TEXT_COMPACTION_MODE_LATCH:o[h++]=J.TEXT_COMPACTION_MODE_LATCH;break;case J.BYTE_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH_6:case J.NUMERIC_COMPACTION_MODE_LATCH:case J.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case J.MACRO_PDF417_TERMINATOR:s--,f=!0;break;case J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o[h]=J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,x=r[s++],c[h]=x,h++;break}}return J.decodeTextCompaction(o,c,h,a),s}static decodeTextCompaction(r,s,a,o){let c=gt.ALPHA,h=gt.ALPHA,f=0;for(;f<a;){let x=r[f],y="";switch(c){case gt.ALPHA:if(x<26)y=String.fromCharCode(65+x);else switch(x){case 26:y=" ";break;case J.LL:c=gt.LOWER;break;case J.ML:c=gt.MIXED;break;case J.PS:h=c,c=gt.PUNCT_SHIFT;break;case J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(s[f]);break;case J.TEXT_COMPACTION_MODE_LATCH:c=gt.ALPHA;break}break;case gt.LOWER:if(x<26)y=String.fromCharCode(97+x);else switch(x){case 26:y=" ";break;case J.AS:h=c,c=gt.ALPHA_SHIFT;break;case J.ML:c=gt.MIXED;break;case J.PS:h=c,c=gt.PUNCT_SHIFT;break;case J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(s[f]);break;case J.TEXT_COMPACTION_MODE_LATCH:c=gt.ALPHA;break}break;case gt.MIXED:if(x<J.PL)y=J.MIXED_CHARS[x];else switch(x){case J.PL:c=gt.PUNCT;break;case 26:y=" ";break;case J.LL:c=gt.LOWER;break;case J.AL:c=gt.ALPHA;break;case J.PS:h=c,c=gt.PUNCT_SHIFT;break;case J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(s[f]);break;case J.TEXT_COMPACTION_MODE_LATCH:c=gt.ALPHA;break}break;case gt.PUNCT:if(x<J.PAL)y=J.PUNCT_CHARS[x];else switch(x){case J.PAL:c=gt.ALPHA;break;case J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(s[f]);break;case J.TEXT_COMPACTION_MODE_LATCH:c=gt.ALPHA;break}break;case gt.ALPHA_SHIFT:if(c=h,x<26)y=String.fromCharCode(65+x);else switch(x){case 26:y=" ";break;case J.TEXT_COMPACTION_MODE_LATCH:c=gt.ALPHA;break}break;case gt.PUNCT_SHIFT:if(c=h,x<J.PAL)y=J.PUNCT_CHARS[x];else switch(x){case J.PAL:c=gt.ALPHA;break;case J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(s[f]);break;case J.TEXT_COMPACTION_MODE_LATCH:c=gt.ALPHA;break}break}y!==""&&o.append(y),f++}}static byteCompaction(r,s,a,o,c){let h=new Of,f=0,x=0,y=!1;switch(r){case J.BYTE_COMPACTION_MODE_LATCH:let v=new Int32Array(6),A=s[o++];for(;o<s[0]&&!y;)switch(v[f++]=A,x=900*x+A,A=s[o++],A){case J.TEXT_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH:case J.NUMERIC_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH_6:case J.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case J.MACRO_PDF417_TERMINATOR:o--,y=!0;break;default:if(f%5===0&&f>0){for(let S=0;S<6;++S)h.write(Number(Tn(x)>>Tn(8*(5-S))));x=0,f=0}break}o===s[0]&&A<J.TEXT_COMPACTION_MODE_LATCH&&(v[f++]=A);for(let S=0;S<f;S++)h.write(v[S]);break;case J.BYTE_COMPACTION_MODE_LATCH_6:for(;o<s[0]&&!y;){let S=s[o++];if(S<J.TEXT_COMPACTION_MODE_LATCH)f++,x=900*x+S;else switch(S){case J.TEXT_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH:case J.NUMERIC_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH_6:case J.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case J.MACRO_PDF417_TERMINATOR:o--,y=!0;break}if(f%5===0&&f>0){for(let j=0;j<6;++j)h.write(Number(Tn(x)>>Tn(8*(5-j))));x=0,f=0}}break}return c.append(oe.decode(h.toByteArray(),a)),o}static numericCompaction(r,s,a){let o=0,c=!1,h=new Int32Array(J.MAX_NUMERIC_CODEWORDS);for(;s<r[0]&&!c;){let f=r[s++];if(s===r[0]&&(c=!0),f<J.TEXT_COMPACTION_MODE_LATCH)h[o]=f,o++;else switch(f){case J.TEXT_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH:case J.BYTE_COMPACTION_MODE_LATCH_6:case J.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case J.MACRO_PDF417_TERMINATOR:s--,c=!0;break}(o%J.MAX_NUMERIC_CODEWORDS===0||f===J.NUMERIC_COMPACTION_MODE_LATCH||c)&&o>0&&(a.append(J.decodeBase900toBase10(h,o)),o=0)}return s}static decodeBase900toBase10(r,s){let a=Tn(0);for(let c=0;c<s;c++)a+=J.EXP900[s-c-1]*Tn(r[c]);let o=a.toString();if(o.charAt(0)!=="1")throw new G;return o.substring(1)}}J.TEXT_COMPACTION_MODE_LATCH=900,J.BYTE_COMPACTION_MODE_LATCH=901,J.NUMERIC_COMPACTION_MODE_LATCH=902,J.BYTE_COMPACTION_MODE_LATCH_6=924,J.ECI_USER_DEFINED=925,J.ECI_GENERAL_PURPOSE=926,J.ECI_CHARSET=927,J.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,J.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,J.MACRO_PDF417_TERMINATOR=922,J.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,J.MAX_NUMERIC_CODEWORDS=15,J.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,J.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,J.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,J.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,J.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,J.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,J.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,J.PL=25,J.LL=27,J.AS=27,J.ML=28,J.AL=28,J.PS=29,J.PAL=29,J.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,J.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",J.EXP900=fc()?Rf():[],J.NUMBER_OF_SEQUENCE_CODEWORDS=2;class $e{constructor(){}static decode(r,s,a,o,c,h,f){let x=new zn(r,s,a,o,c),y=null,v=null,A;for(let L=!0;;L=!1){if(s!=null&&(y=$e.getRowIndicatorColumn(r,x,s,!0,h,f)),o!=null&&(v=$e.getRowIndicatorColumn(r,x,o,!1,h,f)),A=$e.merge(y,v),A==null)throw q.getNotFoundInstance();let U=A.getBoundingBox();if(L&&U!=null&&(U.getMinY()<x.getMinY()||U.getMaxY()>x.getMaxY()))x=U;else break}A.setBoundingBox(x);let S=A.getBarcodeColumnCount()+1;A.setDetectionResultColumn(0,y),A.setDetectionResultColumn(S,v);let j=y!=null;for(let L=1;L<=S;L++){let U=j?L:S-L;if(A.getDetectionResultColumn(U)!==void 0)continue;let X;U===0||U===S?X=new cc(x,U===0):X=new ni(x),A.setDetectionResultColumn(U,X);let ee=-1,le=ee;for(let de=x.getMinY();de<=x.getMaxY();de++){if(ee=$e.getStartColumn(A,U,de,j),ee<0||ee>x.getMaxX()){if(le===-1)continue;ee=le}let ie=$e.detectCodeword(r,x.getMinX(),x.getMaxX(),j,ee,de,h,f);ie!=null&&(X.setCodeword(de,ie),le=ee,h=Math.min(h,ie.getWidth()),f=Math.max(f,ie.getWidth()))}}return $e.createDecoderResult(A)}static merge(r,s){if(r==null&&s==null)return null;let a=$e.getBarcodeMetadata(r,s);if(a==null)return null;let o=zn.merge($e.adjustBoundingBox(r),$e.adjustBoundingBox(s));return new ii(a,o)}static adjustBoundingBox(r){if(r==null)return null;let s=r.getRowHeights();if(s==null)return null;let a=$e.getMax(s),o=0;for(let f of s)if(o+=a-f,f>0)break;let c=r.getCodewords();for(let f=0;o>0&&c[f]==null;f++)o--;let h=0;for(let f=s.length-1;f>=0&&(h+=a-s[f],!(s[f]>0));f--);for(let f=c.length-1;h>0&&c[f]==null;f--)h--;return r.getBoundingBox().addMissingRows(o,h,r.isLeft())}static getMax(r){let s=-1;for(let a of r)s=Math.max(s,a);return s}static getBarcodeMetadata(r,s){let a;if(r==null||(a=r.getBarcodeMetadata())==null)return s==null?null:s.getBarcodeMetadata();let o;return s==null||(o=s.getBarcodeMetadata())==null?a:a.getColumnCount()!==o.getColumnCount()&&a.getErrorCorrectionLevel()!==o.getErrorCorrectionLevel()&&a.getRowCount()!==o.getRowCount()?null:a}static getRowIndicatorColumn(r,s,a,o,c,h){let f=new cc(s,o);for(let x=0;x<2;x++){let y=x===0?1:-1,v=Math.trunc(Math.trunc(a.getX()));for(let A=Math.trunc(Math.trunc(a.getY()));A<=s.getMaxY()&&A>=s.getMinY();A+=y){let S=$e.detectCodeword(r,0,r.getWidth(),o,v,A,c,h);S!=null&&(f.setCodeword(A,S),o?v=S.getStartX():v=S.getEndX())}}return f}static adjustCodewordCount(r,s){let a=s[0][1],o=a.getValue(),c=r.getBarcodeColumnCount()*r.getBarcodeRowCount()-$e.getNumberOfECCodeWords(r.getBarcodeECLevel());if(o.length===0){if(c<1||c>Me.MAX_CODEWORDS_IN_BARCODE)throw q.getNotFoundInstance();a.setValue(c)}else o[0]!==c&&a.setValue(c)}static createDecoderResult(r){let s=$e.createBarcodeMatrix(r);$e.adjustCodewordCount(r,s);let a=new Array,o=new Int32Array(r.getBarcodeRowCount()*r.getBarcodeColumnCount()),c=[],h=new Array;for(let x=0;x<r.getBarcodeRowCount();x++)for(let y=0;y<r.getBarcodeColumnCount();y++){let v=s[x][y+1].getValue(),A=x*r.getBarcodeColumnCount()+y;v.length===0?a.push(A):v.length===1?o[A]=v[0]:(h.push(A),c.push(v))}let f=new Array(c.length);for(let x=0;x<f.length;x++)f[x]=c[x];return $e.createDecoderResultFromAmbiguousValues(r.getBarcodeECLevel(),o,Me.toIntArray(a),Me.toIntArray(h),f)}static createDecoderResultFromAmbiguousValues(r,s,a,o,c){let h=new Int32Array(o.length),f=100;for(;f-- >0;){for(let x=0;x<h.length;x++)s[o[x]]=c[x][h[x]];try{return $e.decodeCodewords(s,r,a)}catch(x){if(!(x instanceof N))throw x}if(h.length===0)throw N.getChecksumInstance();for(let x=0;x<h.length;x++)if(h[x]<c[x].length-1){h[x]++;break}else if(h[x]=0,x===h.length-1)throw N.getChecksumInstance()}throw N.getChecksumInstance()}static createBarcodeMatrix(r){let s=Array.from({length:r.getBarcodeRowCount()},()=>new Array(r.getBarcodeColumnCount()+2));for(let o=0;o<s.length;o++)for(let c=0;c<s[o].length;c++)s[o][c]=new si;let a=0;for(let o of r.getDetectionResultColumns()){if(o!=null){for(let c of o.getCodewords())if(c!=null){let h=c.getRowNumber();if(h>=0){if(h>=s.length)continue;s[h][a].setValue(c.getValue())}}}a++}return s}static isValidBarcodeColumn(r,s){return s>=0&&s<=r.getBarcodeColumnCount()+1}static getStartColumn(r,s,a,o){let c=o?1:-1,h=null;if($e.isValidBarcodeColumn(r,s-c)&&(h=r.getDetectionResultColumn(s-c).getCodeword(a)),h!=null)return o?h.getEndX():h.getStartX();if(h=r.getDetectionResultColumn(s).getCodewordNearby(a),h!=null)return o?h.getStartX():h.getEndX();if($e.isValidBarcodeColumn(r,s-c)&&(h=r.getDetectionResultColumn(s-c).getCodewordNearby(a)),h!=null)return o?h.getEndX():h.getStartX();let f=0;for(;$e.isValidBarcodeColumn(r,s-c);){s-=c;for(let x of r.getDetectionResultColumn(s).getCodewords())if(x!=null)return(o?x.getEndX():x.getStartX())+c*f*(x.getEndX()-x.getStartX());f++}return o?r.getBoundingBox().getMinX():r.getBoundingBox().getMaxX()}static detectCodeword(r,s,a,o,c,h,f,x){c=$e.adjustCodewordStartColumn(r,s,a,o,c,h);let y=$e.getModuleBitCount(r,s,a,o,c,h);if(y==null)return null;let v,A=Ae.sum(y);if(o)v=c+A;else{for(let L=0;L<y.length/2;L++){let U=y[L];y[L]=y[y.length-1-L],y[y.length-1-L]=U}v=c,c=v-A}if(!$e.checkCodewordSkew(A,f,x))return null;let S=Sr.getDecodedValue(y),j=Me.getCodeword(S);return j===-1?null:new ai(c,v,$e.getCodewordBucketNumber(S),j)}static getModuleBitCount(r,s,a,o,c,h){let f=c,x=new Int32Array(8),y=0,v=o?1:-1,A=o;for(;(o?f<a:f>=s)&&y<x.length;)r.get(f,h)===A?(x[y]++,f+=v):(y++,A=!A);return y===x.length||f===(o?a:s)&&y===x.length-1?x:null}static getNumberOfECCodeWords(r){return 2<<r}static adjustCodewordStartColumn(r,s,a,o,c,h){let f=c,x=o?-1:1;for(let y=0;y<2;y++){for(;(o?f>=s:f<a)&&o===r.get(f,h);){if(Math.abs(c-f)>$e.CODEWORD_SKEW_SIZE)return c;f+=x}x=-x,o=!o}return f}static checkCodewordSkew(r,s,a){return s-$e.CODEWORD_SKEW_SIZE<=r&&r<=a+$e.CODEWORD_SKEW_SIZE}static decodeCodewords(r,s,a){if(r.length===0)throw G.getFormatInstance();let o=1<<s+1,c=$e.correctErrors(r,a,o);$e.verifyCodewordCount(r,o);let h=J.decode(r,""+s);return h.setErrorsCorrected(c),h.setErasures(a.length),h}static correctErrors(r,s,a){if(s!=null&&s.length>a/2+$e.MAX_ERRORS||a<0||a>$e.MAX_EC_CODEWORDS)throw N.getChecksumInstance();return $e.errorCorrection.decode(r,a,s)}static verifyCodewordCount(r,s){if(r.length<4)throw G.getFormatInstance();let a=r[0];if(a>r.length)throw G.getFormatInstance();if(a===0)if(s<r.length)r[0]=r.length-s;else throw G.getFormatInstance()}static getBitCountForCodeword(r){let s=new Int32Array(8),a=0,o=s.length-1;for(;!((r&1)!==a&&(a=r&1,o--,o<0));)s[o]++,r>>=1;return s}static getCodewordBucketNumber(r){return r instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(r):this.getCodewordBucketNumber_number(r)}static getCodewordBucketNumber_number(r){return $e.getCodewordBucketNumber($e.getBitCountForCodeword(r))}static getCodewordBucketNumber_Int32Array(r){return(r[0]-r[2]+r[4]-r[6]+9)%9}static toString(r){let s=new ri;for(let a=0;a<r.length;a++){s.format("Row %2d: ",a);for(let o=0;o<r[a].length;o++){let c=r[a][o];c.getValue().length===0?s.format("        ",null):s.format("%4d(%2d)",c.getValue()[0],c.getConfidence(c.getValue()[0]))}s.format("%n")}return s.toString()}}$e.CODEWORD_SKEW_SIZE=2,$e.MAX_ERRORS=3,$e.MAX_EC_CODEWORDS=512,$e.errorCorrection=new lc;class cr{decode(r,s=null){let a=cr.decode(r,s,!1);if(a==null||a.length===0||a[0]==null)throw q.getNotFoundInstance();return a[0]}decodeMultiple(r,s=null){try{return cr.decode(r,s,!0)}catch(a){throw a instanceof G||a instanceof N?q.getNotFoundInstance():a}}static decode(r,s,a){const o=new Array,c=Ye.detectMultiple(r,s,a);for(const h of c.getPoints()){const f=$e.decode(c.getBits(),h[4],h[5],h[6],h[7],cr.getMinCodewordWidth(h),cr.getMaxCodewordWidth(h)),x=new ce(f.getText(),f.getRawBytes(),void 0,h,F.PDF_417);x.putMetadata(Pe.ERROR_CORRECTION_LEVEL,f.getECLevel());const y=f.getOther();y!=null&&x.putMetadata(Pe.PDF417_EXTRA_METADATA,y),o.push(x)}return o.map(h=>h)}static getMaxWidth(r,s){return r==null||s==null?0:Math.trunc(Math.abs(r.getX()-s.getX()))}static getMinWidth(r,s){return r==null||s==null?B.MAX_VALUE:Math.trunc(Math.abs(r.getX()-s.getX()))}static getMaxCodewordWidth(r){return Math.floor(Math.max(Math.max(cr.getMaxWidth(r[0],r[4]),cr.getMaxWidth(r[6],r[2])*Me.MODULES_IN_CODEWORD/Me.MODULES_IN_STOP_PATTERN),Math.max(cr.getMaxWidth(r[1],r[5]),cr.getMaxWidth(r[7],r[3])*Me.MODULES_IN_CODEWORD/Me.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(r){return Math.floor(Math.min(Math.min(cr.getMinWidth(r[0],r[4]),cr.getMinWidth(r[6],r[2])*Me.MODULES_IN_CODEWORD/Me.MODULES_IN_STOP_PATTERN),Math.min(cr.getMinWidth(r[1],r[5]),cr.getMinWidth(r[7],r[3])*Me.MODULES_IN_CODEWORD/Me.MODULES_IN_STOP_PATTERN)))}reset(){}}class Hi extends m{}Hi.kind="ReaderException";class gc{constructor(r,s){this.verbose=r===!0,s&&this.setHints(s)}decode(r,s){return s&&this.setHints(s),this.decodeInternal(r)}decodeWithState(r){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(r)}setHints(r){this.hints=r;const s=!i(r)&&r.get(V.TRY_HARDER)===!0,a=i(r)?null:r.get(V.POSSIBLE_FORMATS),o=new Array;if(!i(a)){const c=a.some(h=>h===F.UPC_A||h===F.UPC_E||h===F.EAN_13||h===F.EAN_8||h===F.CODABAR||h===F.CODE_39||h===F.CODE_93||h===F.CODE_128||h===F.ITF||h===F.RSS_14||h===F.RSS_EXPANDED);c&&!s&&o.push(new ps(r,this.verbose)),a.includes(F.QR_CODE)&&o.push(new In),a.includes(F.DATA_MATRIX)&&o.push(new Sn),a.includes(F.AZTEC)&&o.push(new fs),a.includes(F.PDF_417)&&o.push(new cr),c&&s&&o.push(new ps(r,this.verbose))}o.length===0&&(s||o.push(new ps(r,this.verbose)),o.push(new In),o.push(new Sn),o.push(new fs),o.push(new cr),s&&o.push(new ps(r,this.verbose))),this.readers=o}reset(){if(this.readers!==null)for(const r of this.readers)r.reset()}decodeInternal(r){if(this.readers===null)throw new Hi("No readers where selected, nothing can be read.");for(const s of this.readers)try{return s.decode(r,this.hints)}catch(a){if(a instanceof Hi)continue}throw new q("No MultiFormat Readers were able to detect the code.")}}class jf extends W{constructor(r=null,s=500){const a=new gc;a.setHints(r),super(a,s)}decodeBitmap(r){return this.reader.decodeWithState(r)}}class kf extends W{constructor(r=500){super(new cr,r)}}class Df extends W{constructor(r=500){super(new In,r)}}var Ha;(function(E){E[E.ERROR_CORRECTION=0]="ERROR_CORRECTION",E[E.CHARACTER_SET=1]="CHARACTER_SET",E[E.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",E[E.MIN_SIZE=3]="MIN_SIZE",E[E.MAX_SIZE=4]="MAX_SIZE",E[E.MARGIN=5]="MARGIN",E[E.PDF417_COMPACT=6]="PDF417_COMPACT",E[E.PDF417_COMPACTION=7]="PDF417_COMPACTION",E[E.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",E[E.AZTEC_LAYERS=9]="AZTEC_LAYERS",E[E.QR_VERSION=10]="QR_VERSION"})(Ha||(Ha={}));var Jt=Ha;class Ga{constructor(r){this.field=r,this.cachedGenerators=[],this.cachedGenerators.push(new Nt(r,Int32Array.from([1])))}buildGenerator(r){const s=this.cachedGenerators;if(r>=s.length){let a=s[s.length-1];const o=this.field;for(let c=s.length;c<=r;c++){const h=a.multiply(new Nt(o,Int32Array.from([1,o.exp(c-1+o.getGeneratorBase())])));s.push(h),a=h}}return s[r]}encode(r,s){if(s===0)throw new C("No error correction bytes");const a=r.length-s;if(a<=0)throw new C("No data bytes provided");const o=this.buildGenerator(s),c=new Int32Array(a);T.arraycopy(r,0,c,0,a);let h=new Nt(this.field,c);h=h.multiplyByMonomial(s,1);const x=h.divide(o)[1].getCoefficients(),y=s-x.length;for(let v=0;v<y;v++)r[a+v]=0;T.arraycopy(x,0,r,a+y,x.length)}}class Pt{constructor(){}static applyMaskPenaltyRule1(r){return Pt.applyMaskPenaltyRule1Internal(r,!0)+Pt.applyMaskPenaltyRule1Internal(r,!1)}static applyMaskPenaltyRule2(r){let s=0;const a=r.getArray(),o=r.getWidth(),c=r.getHeight();for(let h=0;h<c-1;h++){const f=a[h];for(let x=0;x<o-1;x++){const y=f[x];y===f[x+1]&&y===a[h+1][x]&&y===a[h+1][x+1]&&s++}}return Pt.N2*s}static applyMaskPenaltyRule3(r){let s=0;const a=r.getArray(),o=r.getWidth(),c=r.getHeight();for(let h=0;h<c;h++)for(let f=0;f<o;f++){const x=a[h];f+6<o&&x[f]===1&&x[f+1]===0&&x[f+2]===1&&x[f+3]===1&&x[f+4]===1&&x[f+5]===0&&x[f+6]===1&&(Pt.isWhiteHorizontal(x,f-4,f)||Pt.isWhiteHorizontal(x,f+7,f+11))&&s++,h+6<c&&a[h][f]===1&&a[h+1][f]===0&&a[h+2][f]===1&&a[h+3][f]===1&&a[h+4][f]===1&&a[h+5][f]===0&&a[h+6][f]===1&&(Pt.isWhiteVertical(a,f,h-4,h)||Pt.isWhiteVertical(a,f,h+7,h+11))&&s++}return s*Pt.N3}static isWhiteHorizontal(r,s,a){s=Math.max(s,0),a=Math.min(a,r.length);for(let o=s;o<a;o++)if(r[o]===1)return!1;return!0}static isWhiteVertical(r,s,a,o){a=Math.max(a,0),o=Math.min(o,r.length);for(let c=a;c<o;c++)if(r[c][s]===1)return!1;return!0}static applyMaskPenaltyRule4(r){let s=0;const a=r.getArray(),o=r.getWidth(),c=r.getHeight();for(let x=0;x<c;x++){const y=a[x];for(let v=0;v<o;v++)y[v]===1&&s++}const h=r.getHeight()*r.getWidth();return Math.floor(Math.abs(s*2-h)*10/h)*Pt.N4}static getDataMaskBit(r,s,a){let o,c;switch(r){case 0:o=a+s&1;break;case 1:o=a&1;break;case 2:o=s%3;break;case 3:o=(a+s)%3;break;case 4:o=Math.floor(a/2)+Math.floor(s/3)&1;break;case 5:c=a*s,o=(c&1)+c%3;break;case 6:c=a*s,o=(c&1)+c%3&1;break;case 7:c=a*s,o=c%3+(a+s&1)&1;break;default:throw new C("Invalid mask pattern: "+r)}return o===0}static applyMaskPenaltyRule1Internal(r,s){let a=0;const o=s?r.getHeight():r.getWidth(),c=s?r.getWidth():r.getHeight(),h=r.getArray();for(let f=0;f<o;f++){let x=0,y=-1;for(let v=0;v<c;v++){const A=s?h[f][v]:h[v][f];A===y?x++:(x>=5&&(a+=Pt.N1+(x-5)),x=1,y=A)}x>=5&&(a+=Pt.N1+(x-5))}return a}}Pt.N1=3,Pt.N2=3,Pt.N3=40,Pt.N4=10;class Gi{constructor(r,s){this.width=r,this.height=s;const a=new Array(s);for(let o=0;o!==s;o++)a[o]=new Uint8Array(r);this.bytes=a}getHeight(){return this.height}getWidth(){return this.width}get(r,s){return this.bytes[s][r]}getArray(){return this.bytes}setNumber(r,s,a){this.bytes[s][r]=a}setBoolean(r,s,a){this.bytes[s][r]=a?1:0}clear(r){for(const s of this.bytes)H.fill(s,r)}equals(r){if(!(r instanceof Gi))return!1;const s=r;if(this.width!==s.width||this.height!==s.height)return!1;for(let a=0,o=this.height;a<o;++a){const c=this.bytes[a],h=s.bytes[a];for(let f=0,x=this.width;f<x;++f)if(c[f]!==h[f])return!1}return!0}toString(){const r=new te;for(let s=0,a=this.height;s<a;++s){const o=this.bytes[s];for(let c=0,h=this.width;c<h;++c)switch(o[c]){case 0:r.append(" 0");break;case 1:r.append(" 1");break;default:r.append("  ");break}r.append(`
`)}return r.toString()}}class Yn{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const r=new te;return r.append(`<<
`),r.append(" mode: "),r.append(this.mode?this.mode.toString():"null"),r.append(`
 ecLevel: `),r.append(this.ecLevel?this.ecLevel.toString():"null"),r.append(`
 version: `),r.append(this.version?this.version.toString():"null"),r.append(`
 maskPattern: `),r.append(this.maskPattern.toString()),this.matrix?(r.append(`
 matrix:
`),r.append(this.matrix.toString())):r.append(`
 matrix: null
`),r.append(`>>
`),r.toString()}setMode(r){this.mode=r}setECLevel(r){this.ecLevel=r}setVersion(r){this.version=r}setMaskPattern(r){this.maskPattern=r}setMatrix(r){this.matrix=r}static isValidMaskPattern(r){return r>=0&&r<Yn.NUM_MASK_PATTERNS}}Yn.NUM_MASK_PATTERNS=8;class xt extends m{}xt.kind="WriterException";class Re{constructor(){}static clearMatrix(r){r.clear(255)}static buildMatrix(r,s,a,o,c){Re.clearMatrix(c),Re.embedBasicPatterns(a,c),Re.embedTypeInfo(s,o,c),Re.maybeEmbedVersionInfo(a,c),Re.embedDataBits(r,o,c)}static embedBasicPatterns(r,s){Re.embedPositionDetectionPatternsAndSeparators(s),Re.embedDarkDotAtLeftBottomCorner(s),Re.maybeEmbedPositionAdjustmentPatterns(r,s),Re.embedTimingPatterns(s)}static embedTypeInfo(r,s,a){const o=new z;Re.makeTypeInfoBits(r,s,o);for(let c=0,h=o.getSize();c<h;++c){const f=o.get(o.getSize()-1-c),x=Re.TYPE_INFO_COORDINATES[c],y=x[0],v=x[1];if(a.setBoolean(y,v,f),c<8){const A=a.getWidth()-c-1;a.setBoolean(A,8,f)}else{const S=a.getHeight()-7+(c-8);a.setBoolean(8,S,f)}}}static maybeEmbedVersionInfo(r,s){if(r.getVersionNumber()<7)return;const a=new z;Re.makeVersionInfoBits(r,a);let o=17;for(let c=0;c<6;++c)for(let h=0;h<3;++h){const f=a.get(o);o--,s.setBoolean(c,s.getHeight()-11+h,f),s.setBoolean(s.getHeight()-11+h,c,f)}}static embedDataBits(r,s,a){let o=0,c=-1,h=a.getWidth()-1,f=a.getHeight()-1;for(;h>0;){for(h===6&&(h-=1);f>=0&&f<a.getHeight();){for(let x=0;x<2;++x){const y=h-x;if(!Re.isEmpty(a.get(y,f)))continue;let v;o<r.getSize()?(v=r.get(o),++o):v=!1,s!==255&&Pt.getDataMaskBit(s,y,f)&&(v=!v),a.setBoolean(y,f,v)}f+=c}c=-c,f+=c,h-=2}if(o!==r.getSize())throw new xt("Not all bits consumed: "+o+"/"+r.getSize())}static findMSBSet(r){return 32-B.numberOfLeadingZeros(r)}static calculateBCHCode(r,s){if(s===0)throw new C("0 polynomial");const a=Re.findMSBSet(s);for(r<<=a-1;Re.findMSBSet(r)>=a;)r^=s<<Re.findMSBSet(r)-a;return r}static makeTypeInfoBits(r,s,a){if(!Yn.isValidMaskPattern(s))throw new xt("Invalid mask pattern");const o=r.getBits()<<3|s;a.appendBits(o,5);const c=Re.calculateBCHCode(o,Re.TYPE_INFO_POLY);a.appendBits(c,10);const h=new z;if(h.appendBits(Re.TYPE_INFO_MASK_PATTERN,15),a.xor(h),a.getSize()!==15)throw new xt("should not happen but we got: "+a.getSize())}static makeVersionInfoBits(r,s){s.appendBits(r.getVersionNumber(),6);const a=Re.calculateBCHCode(r.getVersionNumber(),Re.VERSION_INFO_POLY);if(s.appendBits(a,12),s.getSize()!==18)throw new xt("should not happen but we got: "+s.getSize())}static isEmpty(r){return r===255}static embedTimingPatterns(r){for(let s=8;s<r.getWidth()-8;++s){const a=(s+1)%2;Re.isEmpty(r.get(s,6))&&r.setNumber(s,6,a),Re.isEmpty(r.get(6,s))&&r.setNumber(6,s,a)}}static embedDarkDotAtLeftBottomCorner(r){if(r.get(8,r.getHeight()-8)===0)throw new xt;r.setNumber(8,r.getHeight()-8,1)}static embedHorizontalSeparationPattern(r,s,a){for(let o=0;o<8;++o){if(!Re.isEmpty(a.get(r+o,s)))throw new xt;a.setNumber(r+o,s,0)}}static embedVerticalSeparationPattern(r,s,a){for(let o=0;o<7;++o){if(!Re.isEmpty(a.get(r,s+o)))throw new xt;a.setNumber(r,s+o,0)}}static embedPositionAdjustmentPattern(r,s,a){for(let o=0;o<5;++o){const c=Re.POSITION_ADJUSTMENT_PATTERN[o];for(let h=0;h<5;++h)a.setNumber(r+h,s+o,c[h])}}static embedPositionDetectionPattern(r,s,a){for(let o=0;o<7;++o){const c=Re.POSITION_DETECTION_PATTERN[o];for(let h=0;h<7;++h)a.setNumber(r+h,s+o,c[h])}}static embedPositionDetectionPatternsAndSeparators(r){const s=Re.POSITION_DETECTION_PATTERN[0].length;Re.embedPositionDetectionPattern(0,0,r),Re.embedPositionDetectionPattern(r.getWidth()-s,0,r),Re.embedPositionDetectionPattern(0,r.getWidth()-s,r);const a=8;Re.embedHorizontalSeparationPattern(0,a-1,r),Re.embedHorizontalSeparationPattern(r.getWidth()-a,a-1,r),Re.embedHorizontalSeparationPattern(0,r.getWidth()-a,r);const o=7;Re.embedVerticalSeparationPattern(o,0,r),Re.embedVerticalSeparationPattern(r.getHeight()-o-1,0,r),Re.embedVerticalSeparationPattern(o,r.getHeight()-o,r)}static maybeEmbedPositionAdjustmentPatterns(r,s){if(r.getVersionNumber()<2)return;const a=r.getVersionNumber()-1,o=Re.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[a];for(let c=0,h=o.length;c!==h;c++){const f=o[c];if(f>=0)for(let x=0;x!==h;x++){const y=o[x];y>=0&&Re.isEmpty(s.get(y,f))&&Re.embedPositionAdjustmentPattern(y-2,f-2,s)}}}}Re.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Re.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Re.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Re.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Re.VERSION_INFO_POLY=7973,Re.TYPE_INFO_POLY=1335,Re.TYPE_INFO_MASK_PATTERN=21522;class Pf{constructor(r,s){this.dataBytes=r,this.errorCorrectionBytes=s}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Et{constructor(){}static calculateMaskPenalty(r){return Pt.applyMaskPenaltyRule1(r)+Pt.applyMaskPenaltyRule2(r)+Pt.applyMaskPenaltyRule3(r)+Pt.applyMaskPenaltyRule4(r)}static encode(r,s,a=null){let o=Et.DEFAULT_BYTE_MODE_ENCODING;const c=a!==null&&a.get(Jt.CHARACTER_SET)!==void 0;c&&(o=a.get(Jt.CHARACTER_SET).toString());const h=this.chooseMode(r,o),f=new z;if(h===Ie.BYTE&&(c||Et.DEFAULT_BYTE_MODE_ENCODING!==o)){const de=O.getCharacterSetECIByName(o);de!==void 0&&this.appendECI(de,f)}this.appendModeInfo(h,f);const x=new z;this.appendBytes(r,h,x,o);let y;if(a!==null&&a.get(Jt.QR_VERSION)!==void 0){const de=Number.parseInt(a.get(Jt.QR_VERSION).toString(),10);y=Ne.getVersionForNumber(de);const ie=this.calculateBitsNeeded(h,f,x,y);if(!this.willFit(ie,y,s))throw new xt("Data too big for requested version")}else y=this.recommendVersion(s,h,f,x);const v=new z;v.appendBitArray(f);const A=h===Ie.BYTE?x.getSizeInBytes():r.length;this.appendLengthInfo(A,y,h,v),v.appendBitArray(x);const S=y.getECBlocksForLevel(s),j=y.getTotalCodewords()-S.getTotalECCodewords();this.terminateBits(j,v);const L=this.interleaveWithECBytes(v,y.getTotalCodewords(),j,S.getNumBlocks()),U=new Yn;U.setECLevel(s),U.setMode(h),U.setVersion(y);const X=y.getDimensionForVersion(),ee=new Gi(X,X),le=this.chooseMaskPattern(L,s,y,ee);return U.setMaskPattern(le),Re.buildMatrix(L,s,y,le,ee),U.setMatrix(ee),U}static recommendVersion(r,s,a,o){const c=this.calculateBitsNeeded(s,a,o,Ne.getVersionForNumber(1)),h=this.chooseVersion(c,r),f=this.calculateBitsNeeded(s,a,o,h);return this.chooseVersion(f,r)}static calculateBitsNeeded(r,s,a,o){return s.getSize()+r.getCharacterCountBits(o)+a.getSize()}static getAlphanumericCode(r){return r<Et.ALPHANUMERIC_TABLE.length?Et.ALPHANUMERIC_TABLE[r]:-1}static chooseMode(r,s=null){if(O.SJIS.getName()===s&&this.isOnlyDoubleByteKanji(r))return Ie.KANJI;let a=!1,o=!1;for(let c=0,h=r.length;c<h;++c){const f=r.charAt(c);if(Et.isDigit(f))a=!0;else if(this.getAlphanumericCode(f.charCodeAt(0))!==-1)o=!0;else return Ie.BYTE}return o?Ie.ALPHANUMERIC:a?Ie.NUMERIC:Ie.BYTE}static isOnlyDoubleByteKanji(r){let s;try{s=oe.encode(r,O.SJIS)}catch{return!1}const a=s.length;if(a%2!==0)return!1;for(let o=0;o<a;o+=2){const c=s[o]&255;if((c<129||c>159)&&(c<224||c>235))return!1}return!0}static chooseMaskPattern(r,s,a,o){let c=Number.MAX_SAFE_INTEGER,h=-1;for(let f=0;f<Yn.NUM_MASK_PATTERNS;f++){Re.buildMatrix(r,s,a,f,o);let x=this.calculateMaskPenalty(o);x<c&&(c=x,h=f)}return h}static chooseVersion(r,s){for(let a=1;a<=40;a++){const o=Ne.getVersionForNumber(a);if(Et.willFit(r,o,s))return o}throw new xt("Data too big")}static willFit(r,s,a){const o=s.getTotalCodewords(),h=s.getECBlocksForLevel(a).getTotalECCodewords(),f=o-h,x=(r+7)/8;return f>=x}static terminateBits(r,s){const a=r*8;if(s.getSize()>a)throw new xt("data bits cannot fit in the QR Code"+s.getSize()+" > "+a);for(let h=0;h<4&&s.getSize()<a;++h)s.appendBit(!1);const o=s.getSize()&7;if(o>0)for(let h=o;h<8;h++)s.appendBit(!1);const c=r-s.getSizeInBytes();for(let h=0;h<c;++h)s.appendBits((h&1)===0?236:17,8);if(s.getSize()!==a)throw new xt("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(r,s,a,o,c,h){if(o>=a)throw new xt("Block ID too large");const f=r%a,x=a-f,y=Math.floor(r/a),v=y+1,A=Math.floor(s/a),S=A+1,j=y-A,L=v-S;if(j!==L)throw new xt("EC bytes mismatch");if(a!==x+f)throw new xt("RS blocks mismatch");if(r!==(A+j)*x+(S+L)*f)throw new xt("Total bytes mismatch");o<x?(c[0]=A,h[0]=j):(c[0]=S,h[0]=L)}static interleaveWithECBytes(r,s,a,o){if(r.getSizeInBytes()!==a)throw new xt("Number of bits and data bytes does not match");let c=0,h=0,f=0;const x=new Array;for(let v=0;v<o;++v){const A=new Int32Array(1),S=new Int32Array(1);Et.getNumDataBytesAndNumECBytesForBlockID(s,a,o,v,A,S);const j=A[0],L=new Uint8Array(j);r.toBytes(8*c,L,0,j);const U=Et.generateECBytes(L,S[0]);x.push(new Pf(L,U)),h=Math.max(h,j),f=Math.max(f,U.length),c+=A[0]}if(a!==c)throw new xt("Data bytes does not match offset");const y=new z;for(let v=0;v<h;++v)for(const A of x){const S=A.getDataBytes();v<S.length&&y.appendBits(S[v],8)}for(let v=0;v<f;++v)for(const A of x){const S=A.getErrorCorrectionBytes();v<S.length&&y.appendBits(S[v],8)}if(s!==y.getSizeInBytes())throw new xt("Interleaving error: "+s+" and "+y.getSizeInBytes()+" differ.");return y}static generateECBytes(r,s){const a=r.length,o=new Int32Array(a+s);for(let h=0;h<a;h++)o[h]=r[h]&255;new Ga(tt.QR_CODE_FIELD_256).encode(o,s);const c=new Uint8Array(s);for(let h=0;h<s;h++)c[h]=o[a+h];return c}static appendModeInfo(r,s){s.appendBits(r.getBits(),4)}static appendLengthInfo(r,s,a,o){const c=a.getCharacterCountBits(s);if(r>=1<<c)throw new xt(r+" is bigger than "+((1<<c)-1));o.appendBits(r,c)}static appendBytes(r,s,a,o){switch(s){case Ie.NUMERIC:Et.appendNumericBytes(r,a);break;case Ie.ALPHANUMERIC:Et.appendAlphanumericBytes(r,a);break;case Ie.BYTE:Et.append8BitBytes(r,a,o);break;case Ie.KANJI:Et.appendKanjiBytes(r,a);break;default:throw new xt("Invalid mode: "+s)}}static getDigit(r){return r.charCodeAt(0)-48}static isDigit(r){const s=Et.getDigit(r);return s>=0&&s<=9}static appendNumericBytes(r,s){const a=r.length;let o=0;for(;o<a;){const c=Et.getDigit(r.charAt(o));if(o+2<a){const h=Et.getDigit(r.charAt(o+1)),f=Et.getDigit(r.charAt(o+2));s.appendBits(c*100+h*10+f,10),o+=3}else if(o+1<a){const h=Et.getDigit(r.charAt(o+1));s.appendBits(c*10+h,7),o+=2}else s.appendBits(c,4),o++}}static appendAlphanumericBytes(r,s){const a=r.length;let o=0;for(;o<a;){const c=Et.getAlphanumericCode(r.charCodeAt(o));if(c===-1)throw new xt;if(o+1<a){const h=Et.getAlphanumericCode(r.charCodeAt(o+1));if(h===-1)throw new xt;s.appendBits(c*45+h,11),o+=2}else s.appendBits(c,6),o++}}static append8BitBytes(r,s,a){let o;try{o=oe.encode(r,a)}catch(c){throw new xt(c)}for(let c=0,h=o.length;c!==h;c++){const f=o[c];s.appendBits(f,8)}}static appendKanjiBytes(r,s){let a;try{a=oe.encode(r,O.SJIS)}catch(c){throw new xt(c)}const o=a.length;for(let c=0;c<o;c+=2){const h=a[c]&255,f=a[c+1]&255,x=h<<8&4294967295|f;let y=-1;if(x>=33088&&x<=40956?y=x-33088:x>=57408&&x<=60351&&(y=x-49472),y===-1)throw new xt("Invalid byte sequence");const v=(y>>8)*192+(y&255);s.appendBits(v,13)}}static appendECI(r,s){s.appendBits(Ie.ECI.getBits(),4),s.appendBits(r.getValue(),8)}}Et.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Et.DEFAULT_BYTE_MODE_ENCODING=O.UTF8.getName();class Xn{write(r,s,a,o=null){if(r.length===0)throw new C("Found empty contents");if(s<0||a<0)throw new C("Requested dimensions are too small: "+s+"x"+a);let c=wt.L,h=Xn.QUIET_ZONE_SIZE;o!==null&&(o.get(Jt.ERROR_CORRECTION)!==void 0&&(c=wt.fromString(o.get(Jt.ERROR_CORRECTION).toString())),o.get(Jt.MARGIN)!==void 0&&(h=Number.parseInt(o.get(Jt.MARGIN).toString(),10)));const f=Et.encode(r,c,o);return this.renderResult(f,s,a,h)}writeToDom(r,s,a,o,c=null){typeof r=="string"&&(r=document.querySelector(r));const h=this.write(s,a,o,c);r&&r.appendChild(h)}renderResult(r,s,a,o){const c=r.getMatrix();if(c===null)throw new je;const h=c.getWidth(),f=c.getHeight(),x=h+o*2,y=f+o*2,v=Math.max(s,x),A=Math.max(a,y),S=Math.min(Math.floor(v/x),Math.floor(A/y)),j=Math.floor((v-h*S)/2),L=Math.floor((A-f*S)/2),U=this.createSVGElement(v,A);for(let X=0,ee=L;X<f;X++,ee+=S)for(let le=0,de=j;le<h;le++,de+=S)if(c.get(le,X)===1){const ie=this.createSvgRectElement(de,ee,S,S);U.appendChild(ie)}return U}createSVGElement(r,s){const a=document.createElementNS(Xn.SVG_NS,"svg");return a.setAttributeNS(null,"height",r.toString()),a.setAttributeNS(null,"width",s.toString()),a}createSvgRectElement(r,s,a,o){const c=document.createElementNS(Xn.SVG_NS,"rect");return c.setAttributeNS(null,"x",r.toString()),c.setAttributeNS(null,"y",s.toString()),c.setAttributeNS(null,"height",a.toString()),c.setAttributeNS(null,"width",o.toString()),c.setAttributeNS(null,"fill","#000000"),c}}Xn.QUIET_ZONE_SIZE=4,Xn.SVG_NS="http://www.w3.org/2000/svg";class ys{encode(r,s,a,o,c){if(r.length===0)throw new C("Found empty contents");if(s!==F.QR_CODE)throw new C("Can only encode QR_CODE, but got "+s);if(a<0||o<0)throw new C(`Requested dimensions are too small: ${a}x${o}`);let h=wt.L,f=ys.QUIET_ZONE_SIZE;c!==null&&(c.get(Jt.ERROR_CORRECTION)!==void 0&&(h=wt.fromString(c.get(Jt.ERROR_CORRECTION).toString())),c.get(Jt.MARGIN)!==void 0&&(f=Number.parseInt(c.get(Jt.MARGIN).toString(),10)));const x=Et.encode(r,h,c);return ys.renderResult(x,a,o,f)}static renderResult(r,s,a,o){const c=r.getMatrix();if(c===null)throw new je;const h=c.getWidth(),f=c.getHeight(),x=h+o*2,y=f+o*2,v=Math.max(s,x),A=Math.max(a,y),S=Math.min(Math.floor(v/x),Math.floor(A/y)),j=Math.floor((v-h*S)/2),L=Math.floor((A-f*S)/2),U=new ge(v,A);for(let X=0,ee=L;X<f;X++,ee+=S)for(let le=0,de=j;le<h;le++,de+=S)c.get(le,X)===1&&U.setRegion(de,ee,S,S);return U}}ys.QUIET_ZONE_SIZE=4;class Mf{encode(r,s,a,o,c){let h;switch(s){case F.QR_CODE:h=new ys;break;default:throw new C("No encoder available for format "+s)}return h.encode(r,s,a,o,c)}}class ln extends Q{constructor(r,s,a,o,c,h,f,x){if(super(h,f),this.yuvData=r,this.dataWidth=s,this.dataHeight=a,this.left=o,this.top=c,o+h>s||c+f>a)throw new C("Crop rectangle does not fit within image data.");x&&this.reverseHorizontal(h,f)}getRow(r,s){if(r<0||r>=this.getHeight())throw new C("Requested row is outside the image: "+r);const a=this.getWidth();(s==null||s.length<a)&&(s=new Uint8ClampedArray(a));const o=(r+this.top)*this.dataWidth+this.left;return T.arraycopy(this.yuvData,o,s,0,a),s}getMatrix(){const r=this.getWidth(),s=this.getHeight();if(r===this.dataWidth&&s===this.dataHeight)return this.yuvData;const a=r*s,o=new Uint8ClampedArray(a);let c=this.top*this.dataWidth+this.left;if(r===this.dataWidth)return T.arraycopy(this.yuvData,c,o,0,a),o;for(let h=0;h<s;h++){const f=h*r;T.arraycopy(this.yuvData,c,o,f,r),c+=this.dataWidth}return o}isCropSupported(){return!0}crop(r,s,a,o){return new ln(this.yuvData,this.dataWidth,this.dataHeight,this.left+r,this.top+s,a,o,!1)}renderThumbnail(){const r=this.getWidth()/ln.THUMBNAIL_SCALE_FACTOR,s=this.getHeight()/ln.THUMBNAIL_SCALE_FACTOR,a=new Int32Array(r*s),o=this.yuvData;let c=this.top*this.dataWidth+this.left;for(let h=0;h<s;h++){const f=h*r;for(let x=0;x<r;x++){const y=o[c+x*ln.THUMBNAIL_SCALE_FACTOR]&255;a[f+x]=4278190080|y*65793}c+=this.dataWidth*ln.THUMBNAIL_SCALE_FACTOR}return a}getThumbnailWidth(){return this.getWidth()/ln.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/ln.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(r,s){const a=this.yuvData;for(let o=0,c=this.top*this.dataWidth+this.left;o<s;o++,c+=this.dataWidth){const h=c+r/2;for(let f=c,x=c+r-1;f<h;f++,x--){const y=a[f];a[f]=a[x],a[x]=y}}}invert(){return new Fe(this)}}ln.THUMBNAIL_SCALE_FACTOR=2;class qa extends Q{constructor(r,s,a,o,c,h,f){if(super(s,a),this.dataWidth=o,this.dataHeight=c,this.left=h,this.top=f,r.BYTES_PER_ELEMENT===4){const x=s*a,y=new Uint8ClampedArray(x);for(let v=0;v<x;v++){const A=r[v],S=A>>16&255,j=A>>7&510,L=A&255;y[v]=(S+j+L)/4&255}this.luminances=y}else this.luminances=r;if(o===void 0&&(this.dataWidth=s),c===void 0&&(this.dataHeight=a),h===void 0&&(this.left=0),f===void 0&&(this.top=0),this.left+s>this.dataWidth||this.top+a>this.dataHeight)throw new C("Crop rectangle does not fit within image data.")}getRow(r,s){if(r<0||r>=this.getHeight())throw new C("Requested row is outside the image: "+r);const a=this.getWidth();(s==null||s.length<a)&&(s=new Uint8ClampedArray(a));const o=(r+this.top)*this.dataWidth+this.left;return T.arraycopy(this.luminances,o,s,0,a),s}getMatrix(){const r=this.getWidth(),s=this.getHeight();if(r===this.dataWidth&&s===this.dataHeight)return this.luminances;const a=r*s,o=new Uint8ClampedArray(a);let c=this.top*this.dataWidth+this.left;if(r===this.dataWidth)return T.arraycopy(this.luminances,c,o,0,a),o;for(let h=0;h<s;h++){const f=h*r;T.arraycopy(this.luminances,c,o,f,r),c+=this.dataWidth}return o}isCropSupported(){return!0}crop(r,s,a,o){return new qa(this.luminances,a,o,this.dataWidth,this.dataHeight,this.left+r,this.top+s)}invert(){return new Fe(this)}}class mc extends O{static forName(r){return this.getCharacterSetECIByName(r)}}class za{}za.ISO_8859_1=O.ISO8859_1;class xc{isCompact(){return this.compact}setCompact(r){this.compact=r}getSize(){return this.size}setSize(r){this.size=r}getLayers(){return this.layers}setLayers(r){this.layers=r}getCodeWords(){return this.codeWords}setCodeWords(r){this.codeWords=r}getMatrix(){return this.matrix}setMatrix(r){this.matrix=r}}class pc{static singletonList(r){return[r]}static min(r,s){return r.sort(s)[0]}}class Lf{constructor(r){this.previous=r}getPrevious(){return this.previous}}class bs extends Lf{constructor(r,s,a){super(r),this.value=s,this.bitCount=a}appendTo(r,s){r.appendBits(this.value,this.bitCount)}add(r,s){return new bs(this,r,s)}addBinaryShift(r,s){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new bs(this,r,s)}toString(){let r=this.value&(1<<this.bitCount)-1;return r|=1<<this.bitCount,"<"+B.toBinaryString(r|1<<this.bitCount).substring(1)+">"}}class Ya extends bs{constructor(r,s,a){super(r,0,0),this.binaryShiftStart=s,this.binaryShiftByteCount=a}appendTo(r,s){for(let a=0;a<this.binaryShiftByteCount;a++)(a===0||a===31&&this.binaryShiftByteCount<=62)&&(r.appendBits(31,5),this.binaryShiftByteCount>62?r.appendBits(this.binaryShiftByteCount-31,16):a===0?r.appendBits(Math.min(this.binaryShiftByteCount,31),5):r.appendBits(this.binaryShiftByteCount-31,5)),r.appendBits(s[this.binaryShiftStart+a],8)}addBinaryShift(r,s){return new Ya(this,r,s)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Bf(E,r,s){return new Ya(E,r,s)}function oi(E,r,s){return new bs(E,r,s)}const Ff=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],On=0,qi=1,zr=2,wc=3,cn=4,Uf=new bs(null,0,0),Xa=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function Wf(E){for(let r of E)H.fill(r,-1);return E[On][cn]=0,E[qi][cn]=0,E[qi][On]=28,E[wc][cn]=0,E[zr][cn]=0,E[zr][On]=15,E}const yc=Wf(H.createInt32Array(6,6));class un{constructor(r,s,a,o){this.token=r,this.mode=s,this.binaryShiftByteCount=a,this.bitCount=o}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(r,s){let a=this.bitCount,o=this.token;if(r!==this.mode){let h=Xa[this.mode][r];o=oi(o,h&65535,h>>16),a+=h>>16}let c=r===zr?4:5;return o=oi(o,s,c),new un(o,r,0,a+c)}shiftAndAppend(r,s){let a=this.token,o=this.mode===zr?4:5;return a=oi(a,yc[this.mode][r],o),a=oi(a,s,5),new un(a,this.mode,0,this.bitCount+o+5)}addBinaryShiftChar(r){let s=this.token,a=this.mode,o=this.bitCount;if(this.mode===cn||this.mode===zr){let f=Xa[a][On];s=oi(s,f&65535,f>>16),o+=f>>16,a=On}let c=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,h=new un(s,a,this.binaryShiftByteCount+1,o+c);return h.binaryShiftByteCount===2078&&(h=h.endBinaryShift(r+1)),h}endBinaryShift(r){if(this.binaryShiftByteCount===0)return this;let s=this.token;return s=Bf(s,r-this.binaryShiftByteCount,this.binaryShiftByteCount),new un(s,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(r){let s=this.bitCount+(Xa[this.mode][r.mode]>>16);return this.binaryShiftByteCount<r.binaryShiftByteCount?s+=un.calculateBinaryShiftCost(r)-un.calculateBinaryShiftCost(this):this.binaryShiftByteCount>r.binaryShiftByteCount&&r.binaryShiftByteCount>0&&(s+=10),s<=r.bitCount}toBitArray(r){let s=[];for(let o=this.endBinaryShift(r.length).token;o!==null;o=o.getPrevious())s.unshift(o);let a=new z;for(const o of s)o.appendTo(a,r);return a}toString(){return ue.format("%s bits=%d bytes=%d",Ff[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(r){return r.binaryShiftByteCount>62?21:r.binaryShiftByteCount>31?20:r.binaryShiftByteCount>0?10:0}}un.INITIAL_STATE=new un(Uf,On,0,0);function Vf(E){const r=ue.getCharCode(" "),s=ue.getCharCode("."),a=ue.getCharCode(",");E[On][r]=1;const o=ue.getCharCode("Z"),c=ue.getCharCode("A");for(let S=c;S<=o;S++)E[On][S]=S-c+2;E[qi][r]=1;const h=ue.getCharCode("z"),f=ue.getCharCode("a");for(let S=f;S<=h;S++)E[qi][S]=S-f+2;E[zr][r]=1;const x=ue.getCharCode("9"),y=ue.getCharCode("0");for(let S=y;S<=x;S++)E[zr][S]=S-y+2;E[zr][a]=12,E[zr][s]=13;const v=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let S=0;S<v.length;S++)E[wc][ue.getCharCode(v[S])]=S;const A=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let S=0;S<A.length;S++)ue.getCharCode(A[S])>0&&(E[cn][ue.getCharCode(A[S])]=S);return E}const $a=Vf(H.createInt32Array(5,256));class li{constructor(r){this.text=r}encode(){const r=ue.getCharCode(" "),s=ue.getCharCode(`
`);let a=pc.singletonList(un.INITIAL_STATE);for(let c=0;c<this.text.length;c++){let h,f=c+1<this.text.length?this.text[c+1]:0;switch(this.text[c]){case ue.getCharCode("\r"):h=f===s?2:0;break;case ue.getCharCode("."):h=f===r?3:0;break;case ue.getCharCode(","):h=f===r?4:0;break;case ue.getCharCode(":"):h=f===r?5:0;break;default:h=0}h>0?(a=li.updateStateListForPair(a,c,h),c++):a=this.updateStateListForChar(a,c)}return pc.min(a,(c,h)=>c.getBitCount()-h.getBitCount()).toBitArray(this.text)}updateStateListForChar(r,s){const a=[];for(let o of r)this.updateStateForChar(o,s,a);return li.simplifyStates(a)}updateStateForChar(r,s,a){let o=this.text[s]&255,c=$a[r.getMode()][o]>0,h=null;for(let f=0;f<=cn;f++){let x=$a[f][o];if(x>0){if(h==null&&(h=r.endBinaryShift(s)),!c||f===r.getMode()||f===zr){const y=h.latchAndAppend(f,x);a.push(y)}if(!c&&yc[r.getMode()][f]>=0){const y=h.shiftAndAppend(f,x);a.push(y)}}}if(r.getBinaryShiftByteCount()>0||$a[r.getMode()][o]===0){let f=r.addBinaryShiftChar(s);a.push(f)}}static updateStateListForPair(r,s,a){const o=[];for(let c of r)this.updateStateForPair(c,s,a,o);return this.simplifyStates(o)}static updateStateForPair(r,s,a,o){let c=r.endBinaryShift(s);if(o.push(c.latchAndAppend(cn,a)),r.getMode()!==cn&&o.push(c.shiftAndAppend(cn,a)),a===3||a===4){let h=c.latchAndAppend(zr,16-a).latchAndAppend(zr,1);o.push(h)}if(r.getBinaryShiftByteCount()>0){let h=r.addBinaryShiftChar(s).addBinaryShiftChar(s+1);o.push(h)}}static simplifyStates(r){let s=[];for(const a of r){let o=!0;for(const c of s){if(c.isBetterThanOrEqualTo(a)){o=!1;break}a.isBetterThanOrEqualTo(c)&&(s=s.filter(h=>h!==c))}o&&s.push(a)}return s}}class st{constructor(){}static encodeBytes(r){return st.encode(r,st.DEFAULT_EC_PERCENT,st.DEFAULT_AZTEC_LAYERS)}static encode(r,s,a){let o=new li(r).encode(),c=B.truncDivision(o.getSize()*s,100)+11,h=o.getSize()+c,f,x,y,v,A;if(a!==st.DEFAULT_AZTEC_LAYERS){if(f=a<0,x=Math.abs(a),x>(f?st.MAX_NB_BITS_COMPACT:st.MAX_NB_BITS))throw new C(ue.format("Illegal value %s for layers",a));y=st.totalBitsInLayer(x,f),v=st.WORD_SIZE[x];let ie=y-y%v;if(A=st.stuffBits(o,v),A.getSize()+c>ie)throw new C("Data to large for user specified layer");if(f&&A.getSize()>v*64)throw new C("Data to large for user specified layer")}else{v=0,A=null;for(let ie=0;;ie++){if(ie>st.MAX_NB_BITS)throw new C("Data too large for an Aztec code");if(f=ie<=3,x=f?ie+1:ie,y=st.totalBitsInLayer(x,f),h>y)continue;(A==null||v!==st.WORD_SIZE[x])&&(v=st.WORD_SIZE[x],A=st.stuffBits(o,v));let Je=y-y%v;if(!(f&&A.getSize()>v*64)&&A.getSize()+c<=Je)break}}let S=st.generateCheckWords(A,y,v),j=A.getSize()/v,L=st.generateModeMessage(f,x,j),U=(f?11:14)+x*4,X=new Int32Array(U),ee;if(f){ee=U;for(let ie=0;ie<X.length;ie++)X[ie]=ie}else{ee=U+1+2*B.truncDivision(B.truncDivision(U,2)-1,15);let ie=B.truncDivision(U,2),Je=B.truncDivision(ee,2);for(let He=0;He<ie;He++){let Ir=He+B.truncDivision(He,15);X[ie-He-1]=Je-Ir-1,X[ie+He]=Je+Ir+1}}let le=new ge(ee);for(let ie=0,Je=0;ie<x;ie++){let He=(x-ie)*4+(f?9:12);for(let Ir=0;Ir<He;Ir++){let Kr=Ir*2;for(let Tr=0;Tr<2;Tr++)S.get(Je+Kr+Tr)&&le.set(X[ie*2+Tr],X[ie*2+Ir]),S.get(Je+He*2+Kr+Tr)&&le.set(X[ie*2+Ir],X[U-1-ie*2-Tr]),S.get(Je+He*4+Kr+Tr)&&le.set(X[U-1-ie*2-Tr],X[U-1-ie*2-Ir]),S.get(Je+He*6+Kr+Tr)&&le.set(X[U-1-ie*2-Ir],X[ie*2+Tr])}Je+=He*8}if(st.drawModeMessage(le,f,ee,L),f)st.drawBullsEye(le,B.truncDivision(ee,2),5);else{st.drawBullsEye(le,B.truncDivision(ee,2),7);for(let ie=0,Je=0;ie<B.truncDivision(U,2)-1;ie+=15,Je+=16)for(let He=B.truncDivision(ee,2)&1;He<ee;He+=2)le.set(B.truncDivision(ee,2)-Je,He),le.set(B.truncDivision(ee,2)+Je,He),le.set(He,B.truncDivision(ee,2)-Je),le.set(He,B.truncDivision(ee,2)+Je)}let de=new xc;return de.setCompact(f),de.setSize(ee),de.setLayers(x),de.setCodeWords(j),de.setMatrix(le),de}static drawBullsEye(r,s,a){for(let o=0;o<a;o+=2)for(let c=s-o;c<=s+o;c++)r.set(c,s-o),r.set(c,s+o),r.set(s-o,c),r.set(s+o,c);r.set(s-a,s-a),r.set(s-a+1,s-a),r.set(s-a,s-a+1),r.set(s+a,s-a),r.set(s+a,s-a+1),r.set(s+a,s+a-1)}static generateModeMessage(r,s,a){let o=new z;return r?(o.appendBits(s-1,2),o.appendBits(a-1,6),o=st.generateCheckWords(o,28,4)):(o.appendBits(s-1,5),o.appendBits(a-1,11),o=st.generateCheckWords(o,40,4)),o}static drawModeMessage(r,s,a,o){let c=B.truncDivision(a,2);if(s)for(let h=0;h<7;h++){let f=c-3+h;o.get(h)&&r.set(f,c-5),o.get(h+7)&&r.set(c+5,f),o.get(20-h)&&r.set(f,c+5),o.get(27-h)&&r.set(c-5,f)}else for(let h=0;h<10;h++){let f=c-5+h+B.truncDivision(h,5);o.get(h)&&r.set(f,c-7),o.get(h+10)&&r.set(c+7,f),o.get(29-h)&&r.set(f,c+7),o.get(39-h)&&r.set(c-7,f)}}static generateCheckWords(r,s,a){let o=r.getSize()/a,c=new Ga(st.getGF(a)),h=B.truncDivision(s,a),f=st.bitsToWords(r,a,h);c.encode(f,h-o);let x=s%a,y=new z;y.appendBits(0,x);for(const v of Array.from(f))y.appendBits(v,a);return y}static bitsToWords(r,s,a){let o=new Int32Array(a),c,h;for(c=0,h=r.getSize()/s;c<h;c++){let f=0;for(let x=0;x<s;x++)f|=r.get(c*s+x)?1<<s-x-1:0;o[c]=f}return o}static getGF(r){switch(r){case 4:return tt.AZTEC_PARAM;case 6:return tt.AZTEC_DATA_6;case 8:return tt.AZTEC_DATA_8;case 10:return tt.AZTEC_DATA_10;case 12:return tt.AZTEC_DATA_12;default:throw new C("Unsupported word size "+r)}}static stuffBits(r,s){let a=new z,o=r.getSize(),c=(1<<s)-2;for(let h=0;h<o;h+=s){let f=0;for(let x=0;x<s;x++)(h+x>=o||r.get(h+x))&&(f|=1<<s-1-x);(f&c)===c?(a.appendBits(f&c,s),h--):(f&c)===0?(a.appendBits(f|1,s),h--):a.appendBits(f,s)}return a}static totalBitsInLayer(r,s){return((s?88:112)+16*r)*r}}st.DEFAULT_EC_PERCENT=33,st.DEFAULT_AZTEC_LAYERS=0,st.MAX_NB_BITS=32,st.MAX_NB_BITS_COMPACT=4,st.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class zi{encode(r,s,a,o){return this.encodeWithHints(r,s,a,o,null)}encodeWithHints(r,s,a,o,c){let h=za.ISO_8859_1,f=st.DEFAULT_EC_PERCENT,x=st.DEFAULT_AZTEC_LAYERS;return c!=null&&(c.has(Jt.CHARACTER_SET)&&(h=mc.forName(c.get(Jt.CHARACTER_SET).toString())),c.has(Jt.ERROR_CORRECTION)&&(f=B.parseInt(c.get(Jt.ERROR_CORRECTION).toString())),c.has(Jt.AZTEC_LAYERS)&&(x=B.parseInt(c.get(Jt.AZTEC_LAYERS).toString()))),zi.encodeLayers(r,s,a,o,h,f,x)}static encodeLayers(r,s,a,o,c,h,f){if(s!==F.AZTEC)throw new C("Can only encode AZTEC, but got "+s);let x=st.encode(ue.getBytes(r,c),h,f);return zi.renderResult(x,a,o)}static renderResult(r,s,a){let o=r.getMatrix();if(o==null)throw new je;let c=o.getWidth(),h=o.getHeight(),f=Math.max(s,c),x=Math.max(a,h),y=Math.min(f/c,x/h),v=(f-c*y)/2,A=(x-h*y)/2,S=new ge(f,x);for(let j=0,L=A;j<h;j++,L+=y)for(let U=0,X=v;U<c;U++,X+=y)o.get(U,j)&&S.setRegion(X,L,y,y);return S}}n.AbstractExpandedDecoder=Da,n.ArgumentException=b,n.ArithmeticException=wr,n.AztecCode=xc,n.AztecCodeReader=fs,n.AztecCodeWriter=zi,n.AztecDecoder=Xe,n.AztecDetector=Li,n.AztecDetectorResult=rn,n.AztecEncoder=st,n.AztecHighLevelEncoder=li,n.AztecPoint=ir,n.BarcodeFormat=F,n.Binarizer=I,n.BinaryBitmap=_,n.BitArray=z,n.BitMatrix=ge,n.BitSource=Ba,n.BrowserAztecCodeReader=Oa,n.BrowserBarcodeReader=yf,n.BrowserCodeReader=W,n.BrowserDatamatrixCodeReader=vf,n.BrowserMultiFormatReader=jf,n.BrowserPDF417Reader=kf,n.BrowserQRCodeReader=Df,n.BrowserQRCodeSvgWriter=Xn,n.CharacterSetECI=O,n.ChecksumException=N,n.Code128Reader=fe,n.Code39Reader=Wt,n.DataMatrixDecodedBitStreamParser=Nn,n.DataMatrixReader=Sn,n.DecodeHintType=V,n.DecoderResult=Ze,n.DefaultGridSampler=nn,n.DetectorResult=gr,n.EAN13Reader=Hn,n.EncodeHintType=Jt,n.Exception=m,n.FormatException=G,n.GenericGF=tt,n.GenericGFPoly=Nt,n.GlobalHistogramBinarizer=Z,n.GridSampler=Vr,n.GridSamplerInstance=Xr,n.HTMLCanvasElementLuminanceSource=qe,n.HybridBinarizer=Y,n.ITFReader=mt,n.IllegalArgumentException=C,n.IllegalStateException=je,n.InvertedLuminanceSource=Fe,n.LuminanceSource=Q,n.MathUtils=Ae,n.MultiFormatOneDReader=ps,n.MultiFormatReader=gc,n.MultiFormatWriter=Mf,n.NotFoundException=q,n.OneDReader=ft,n.PDF417DecodedBitStreamParser=J,n.PDF417DecoderErrorCorrection=lc,n.PDF417Reader=cr,n.PDF417ResultMetadata=uc,n.PerspectiveTransform=$t,n.PlanarYUVLuminanceSource=ln,n.QRCodeByteMatrix=Gi,n.QRCodeDataMask=Gr,n.QRCodeDecodedBitStreamParser=Ot,n.QRCodeDecoderErrorCorrectionLevel=wt,n.QRCodeDecoderFormatInformation=xr,n.QRCodeEncoder=Et,n.QRCodeEncoderQRCode=Yn,n.QRCodeMaskUtil=Pt,n.QRCodeMatrixUtil=Re,n.QRCodeMode=Ie,n.QRCodeReader=In,n.QRCodeVersion=Ne,n.QRCodeWriter=ys,n.RGBLuminanceSource=qa,n.RSS14Reader=Dt,n.RSSExpandedReader=se,n.ReaderException=Hi,n.ReedSolomonDecoder=Ut,n.ReedSolomonEncoder=Ga,n.ReedSolomonException=Te,n.Result=ce,n.ResultMetadataType=Pe,n.ResultPoint=ye,n.StringUtils=ue,n.UnsupportedOperationException=ne,n.VideoInputDevice=lt,n.WhiteRectangleDetector=Qt,n.WriterException=xt,n.ZXingArrays=H,n.ZXingCharset=mc,n.ZXingInteger=B,n.ZXingStandardCharsets=za,n.ZXingStringBuilder=te,n.ZXingStringEncoding=oe,n.ZXingSystem=T,n.createAbstractExpandedDecoder=ac,Object.defineProperty(n,"__esModule",{value:!0})}))})(mi,mi.exports)),mi.exports}var At=hv();const fv=y0(At),gv=F0({__proto__:null,default:fv},[At]);var ju=(function(){function t(e,n,i){if(this.formatMap=new Map([[we.QR_CODE,At.BarcodeFormat.QR_CODE],[we.AZTEC,At.BarcodeFormat.AZTEC],[we.CODABAR,At.BarcodeFormat.CODABAR],[we.CODE_39,At.BarcodeFormat.CODE_39],[we.CODE_93,At.BarcodeFormat.CODE_93],[we.CODE_128,At.BarcodeFormat.CODE_128],[we.DATA_MATRIX,At.BarcodeFormat.DATA_MATRIX],[we.MAXICODE,At.BarcodeFormat.MAXICODE],[we.ITF,At.BarcodeFormat.ITF],[we.EAN_13,At.BarcodeFormat.EAN_13],[we.EAN_8,At.BarcodeFormat.EAN_8],[we.PDF_417,At.BarcodeFormat.PDF_417],[we.RSS_14,At.BarcodeFormat.RSS_14],[we.RSS_EXPANDED,At.BarcodeFormat.RSS_EXPANDED],[we.UPC_A,At.BarcodeFormat.UPC_A],[we.UPC_E,At.BarcodeFormat.UPC_E],[we.UPC_EAN_EXTENSION,At.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!gv)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=n,this.logger=i;var u=this.createZXingFormats(e),d=new Map;d.set(At.DecodeHintType.POSSIBLE_FORMATS,u),d.set(At.DecodeHintType.TRY_HARDER,!1),this.hints=d}return t.prototype.decodeAsync=function(e){var n=this;return new Promise(function(i,u){try{i(n.decode(e))}catch(d){u(d)}})},t.prototype.decode=function(e){var n=new At.MultiFormatReader(this.verbose,this.hints),i=new At.HTMLCanvasElementLuminanceSource(e),u=new At.BinaryBitmap(new At.HybridBinarizer(i)),d=n.decode(u);return{text:d.text,format:Zh.create(this.toHtml5QrcodeSupportedFormats(d.format)),debugData:this.createDebugData()}},t.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(n,i,u){e.set(n,i)}),e},t.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},t.prototype.createZXingFormats=function(e){for(var n=[],i=0,u=e;i<u.length;i++){var d=u[i];this.formatMap.has(d)?n.push(this.formatMap.get(d)):this.logger.logError("".concat(d," is not supported by")+"ZXingHtml5QrcodeShim")}return n},t.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},t})(),mv=function(t,e,n,i){function u(d){return d instanceof n?d:new n(function(g){g(d)})}return new(n||(n=Promise))(function(d,g){function w(b){try{m(i.next(b))}catch(C){g(C)}}function p(b){try{m(i.throw(b))}catch(C){g(C)}}function m(b){b.done?d(b.value):u(b.value).then(w,p)}m((i=i.apply(t,e||[])).next())})},xv=function(t,e){var n={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},i,u,d,g;return g={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function w(m){return function(b){return p([m,b])}}function p(m){if(i)throw new TypeError("Generator is already executing.");for(;g&&(g=0,m[0]&&(n=0)),n;)try{if(i=1,u&&(d=m[0]&2?u.return:m[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,m[1])).done)return d;switch(u=0,d&&(m=[m[0]&2,d.value]),m[0]){case 0:case 1:d=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,u=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(d=n.trys,!(d=d.length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){n.label=m[1];break}if(m[0]===6&&n.label<d[1]){n.label=d[1],d=m;break}if(d&&n.label<d[2]){n.label=d[2],n.ops.push(m);break}d[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(b){m=[6,b],u=0}finally{i=d=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},ku=(function(){function t(e,n,i){if(this.formatMap=new Map([[we.QR_CODE,"qr_code"],[we.AZTEC,"aztec"],[we.CODABAR,"codabar"],[we.CODE_39,"code_39"],[we.CODE_93,"code_93"],[we.CODE_128,"code_128"],[we.DATA_MATRIX,"data_matrix"],[we.ITF,"itf"],[we.EAN_13,"ean_13"],[we.EAN_8,"ean_8"],[we.PDF_417,"pdf417"],[we.UPC_A,"upc_a"],[we.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!t.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=n,this.logger=i;var u=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(u),!this.detector)throw"BarcodeDetector detector not supported"}return t.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var e=new BarcodeDetector({formats:["qr_code"]});return typeof e<"u"},t.prototype.decodeAsync=function(e){return mv(this,void 0,void 0,function(){var n,i;return xv(this,function(u){switch(u.label){case 0:return[4,this.detector.detect(e)];case 1:if(n=u.sent(),!n||n.length===0)throw"No barcode or QR code detected.";return i=this.selectLargestBarcode(n),[2,{text:i.rawValue,format:Zh.create(this.toHtml5QrcodeSupportedFormats(i.format)),debugData:this.createDebugData()}]}})})},t.prototype.selectLargestBarcode=function(e){for(var n=null,i=0,u=0,d=e;u<d.length;u++){var g=d[u],w=g.boundingBox.width*g.boundingBox.height;w>i&&(i=w,n=g)}if(!n)throw"No largest barcode found";return n},t.prototype.createBarcodeDetectorFormats=function(e){for(var n=[],i=0,u=e;i<u.length;i++){var d=u[i];this.formatMap.has(d)?n.push(this.formatMap.get(d)):this.logger.warn("".concat(d," is not supported by")+"BarcodeDetectorDelegate")}return{formats:n}},t.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},t.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(n,i,u){e.set(n,i)}),e},t.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},t})(),Du=function(t,e,n,i){function u(d){return d instanceof n?d:new n(function(g){g(d)})}return new(n||(n=Promise))(function(d,g){function w(b){try{m(i.next(b))}catch(C){g(C)}}function p(b){try{m(i.throw(b))}catch(C){g(C)}}function m(b){b.done?d(b.value):u(b.value).then(w,p)}m((i=i.apply(t,e||[])).next())})},Pu=function(t,e){var n={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},i,u,d,g;return g={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function w(m){return function(b){return p([m,b])}}function p(m){if(i)throw new TypeError("Generator is already executing.");for(;g&&(g=0,m[0]&&(n=0)),n;)try{if(i=1,u&&(d=m[0]&2?u.return:m[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,m[1])).done)return d;switch(u=0,d&&(m=[m[0]&2,d.value]),m[0]){case 0:case 1:d=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,u=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(d=n.trys,!(d=d.length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){n.label=m[1];break}if(m[0]===6&&n.label<d[1]){n.label=d[1],d=m;break}if(d&&n.label<d[2]){n.label=d[2],n.ops.push(m);break}d[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(b){m=[6,b],u=0}finally{i=d=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},pv=(function(){function t(e,n,i,u){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=i,n&&ku.isSupported()?(this.primaryDecoder=new ku(e,i,u),this.secondaryDecoder=new ju(e,i,u)):this.primaryDecoder=new ju(e,i,u)}return t.prototype.decodeAsync=function(e){return Du(this,void 0,void 0,function(){var n;return Pu(this,function(i){switch(i.label){case 0:n=performance.now(),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,i.sent()];case 3:return this.possiblyLogPerformance(n),[7];case 4:return[2]}})})},t.prototype.decodeRobustlyAsync=function(e){return Du(this,void 0,void 0,function(){var n,i;return Pu(this,function(u){switch(u.label){case 0:n=performance.now(),u.label=1;case 1:return u.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,u.sent()];case 3:if(i=u.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw i;case 4:return this.possiblyLogPerformance(n),[7];case 5:return[2]}})})},t.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},t.prototype.possiblyLogPerformance=function(e){if(this.verbose){var n=performance.now()-e;this.executionResults.push(n),this.executions++,this.possiblyFlushPerformanceReport()}},t.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,n=0,i=this.executionResults;n<i.length;n++){var u=i[n];e+=u}var d=e/this.executionResults.length;console.log("".concat(d," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},t})(),Jl=(function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,u){i.__proto__=u}||function(i,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(i[d]=u[d])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function i(){this.constructor=e}e.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}})(),pa=function(t,e,n,i){function u(d){return d instanceof n?d:new n(function(g){g(d)})}return new(n||(n=Promise))(function(d,g){function w(b){try{m(i.next(b))}catch(C){g(C)}}function p(b){try{m(i.throw(b))}catch(C){g(C)}}function m(b){b.done?d(b.value):u(b.value).then(w,p)}m((i=i.apply(t,e||[])).next())})},wa=function(t,e){var n={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},i,u,d,g;return g={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function w(m){return function(b){return p([m,b])}}function p(m){if(i)throw new TypeError("Generator is already executing.");for(;g&&(g=0,m[0]&&(n=0)),n;)try{if(i=1,u&&(d=m[0]&2?u.return:m[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,m[1])).done)return d;switch(u=0,d&&(m=[m[0]&2,d.value]),m[0]){case 0:case 1:d=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,u=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(d=n.trys,!(d=d.length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){n.label=m[1];break}if(m[0]===6&&n.label<d[1]){n.label=d[1],d=m;break}if(d&&n.label<d[2]){n.label=d[2],n.ops.push(m);break}d[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(b){m=[6,b],u=0}finally{i=d=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},ef=(function(){function t(e,n){this.name=e,this.track=n}return t.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},t.prototype.apply=function(e){var n={};n[this.name]=e;var i={advanced:[n]};return this.track.applyConstraints(i)},t.prototype.value=function(){var e=this.track.getSettings();if(this.name in e){var n=e[this.name];return n}return null},t})(),wv=(function(t){Jl(e,t);function e(n,i){return t.call(this,n,i)||this}return e.prototype.min=function(){return this.getCapabilities().min},e.prototype.max=function(){return this.getCapabilities().max},e.prototype.step=function(){return this.getCapabilities().step},e.prototype.apply=function(n){var i={};i[this.name]=n;var u={advanced:[i]};return this.track.applyConstraints(u)},e.prototype.getCapabilities=function(){this.failIfNotSupported();var n=this.track.getCapabilities(),i=n[this.name];return{min:i.min,max:i.max,step:i.step}},e.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},e})(ef),yv=(function(t){Jl(e,t);function e(n){return t.call(this,"zoom",n)||this}return e})(wv),bv=(function(t){Jl(e,t);function e(n){return t.call(this,"torch",n)||this}return e})(ef),vv=(function(){function t(e){this.track=e}return t.prototype.zoomFeature=function(){return new yv(this.track)},t.prototype.torchFeature=function(){return new bv(this.track)},t})(),Cv=(function(){function t(e,n,i){this.isClosed=!1,this.parentElement=e,this.mediaStream=n,this.callbacks=i,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return t.prototype.createVideoElement=function(e){var n=document.createElement("video");return n.style.width="".concat(e,"px"),n.style.display="block",n.muted=!0,n.setAttribute("muted","true"),n.playsInline=!0,n},t.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var n=function(){var i=e.surface.clientWidth,u=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(i,u),e.surface.removeEventListener("playing",n)};this.surface.addEventListener("playing",n),this.surface.srcObject=this.mediaStream,this.surface.play()},t.create=function(e,n,i,u){return pa(this,void 0,void 0,function(){var d,g;return wa(this,function(w){switch(w.label){case 0:return d=new t(e,n,u),i.aspectRatio?(g={aspectRatio:i.aspectRatio},[4,d.getFirstTrackOrFail().applyConstraints(g)]):[3,2];case 1:w.sent(),w.label=2;case 2:return d.setupSurface(),[2,d]}})})},t.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},t.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},t.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},t.prototype.resume=function(e){this.failIfClosed();var n=this,i=function(){setTimeout(e,200),n.surface.removeEventListener("playing",i)};this.surface.addEventListener("playing",i),this.surface.play()},t.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},t.prototype.getSurface=function(){return this.failIfClosed(),this.surface},t.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},t.prototype.applyVideoConstraints=function(e){return pa(this,void 0,void 0,function(){return wa(this,function(n){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]})})},t.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise(function(n,i){var u=e.mediaStream.getVideoTracks(),d=u.length,g=0;e.mediaStream.getVideoTracks().forEach(function(w){e.mediaStream.removeTrack(w),w.stop(),++g,g>=d&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),n())})})},t.prototype.getCapabilities=function(){return new vv(this.getFirstTrackOrFail())},t})(),_v=(function(){function t(e){this.mediaStream=e}return t.prototype.render=function(e,n,i){return pa(this,void 0,void 0,function(){return wa(this,function(u){return[2,Cv.create(e,this.mediaStream,n,i)]})})},t.create=function(e){return pa(this,void 0,void 0,function(){var n,i;return wa(this,function(u){switch(u.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return n={audio:!1,video:e},[4,navigator.mediaDevices.getUserMedia(n)];case 1:return i=u.sent(),[2,new t(i)]}})})},t})(),Mu=function(t,e,n,i){function u(d){return d instanceof n?d:new n(function(g){g(d)})}return new(n||(n=Promise))(function(d,g){function w(b){try{m(i.next(b))}catch(C){g(C)}}function p(b){try{m(i.throw(b))}catch(C){g(C)}}function m(b){b.done?d(b.value):u(b.value).then(w,p)}m((i=i.apply(t,e||[])).next())})},Lu=function(t,e){var n={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},i,u,d,g;return g={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function w(m){return function(b){return p([m,b])}}function p(m){if(i)throw new TypeError("Generator is already executing.");for(;g&&(g=0,m[0]&&(n=0)),n;)try{if(i=1,u&&(d=m[0]&2?u.return:m[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,m[1])).done)return d;switch(u=0,d&&(m=[m[0]&2,d.value]),m[0]){case 0:case 1:d=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,u=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(d=n.trys,!(d=d.length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){n.label=m[1];break}if(m[0]===6&&n.label<d[1]){n.label=d[1],d=m;break}if(d&&n.label<d[2]){n.label=d[2],n.ops.push(m);break}d[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(b){m=[6,b],u=0}finally{i=d=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Ev=(function(){function t(){}return t.failIfNotSupported=function(){return Mu(this,void 0,void 0,function(){return Lu(this,function(e){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new t]})})},t.prototype.create=function(e){return Mu(this,void 0,void 0,function(){return Lu(this,function(n){return[2,_v.create(e)]})})},t})(),Av=function(t,e,n,i){function u(d){return d instanceof n?d:new n(function(g){g(d)})}return new(n||(n=Promise))(function(d,g){function w(b){try{m(i.next(b))}catch(C){g(C)}}function p(b){try{m(i.throw(b))}catch(C){g(C)}}function m(b){b.done?d(b.value):u(b.value).then(w,p)}m((i=i.apply(t,e||[])).next())})},Nv=function(t,e){var n={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},i,u,d,g;return g={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function w(m){return function(b){return p([m,b])}}function p(m){if(i)throw new TypeError("Generator is already executing.");for(;g&&(g=0,m[0]&&(n=0)),n;)try{if(i=1,u&&(d=m[0]&2?u.return:m[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,m[1])).done)return d;switch(u=0,d&&(m=[m[0]&2,d.value]),m[0]){case 0:case 1:d=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,u=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(d=n.trys,!(d=d.length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){n.label=m[1];break}if(m[0]===6&&n.label<d[1]){n.label=d[1],d=m;break}if(d&&n.label<d[2]){n.label=d[2],n.ops.push(m);break}d[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(b){m=[6,b],u=0}finally{i=d=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Sv=(function(){function t(){}return t.retrieve=function(){if(navigator.mediaDevices)return t.getCamerasFromMediaDevices();var e=MediaStreamTrack;return MediaStreamTrack&&e.getSources?t.getCamerasFromMediaStreamTrack():t.rejectWithError()},t.rejectWithError=function(){var e=Fs.unableToQuerySupportedDevices();return t.isHttpsOrLocalhost()||(e=Fs.insecureContextCameraQueryError()),Promise.reject(e)},t.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var e=location.host.split(":")[0];return e==="127.0.0.1"||e==="localhost"},t.getCamerasFromMediaDevices=function(){return Av(this,void 0,void 0,function(){var e,n,i,u,d,g,w;return Nv(this,function(p){switch(p.label){case 0:return e=function(m){for(var b=m.getVideoTracks(),C=0,_=b;C<_.length;C++){var N=_[C];N.enabled=!1,N.stop(),m.removeTrack(N)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return n=p.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(i=p.sent(),u=[],d=0,g=i;d<g.length;d++)w=g[d],w.kind==="videoinput"&&u.push({id:w.deviceId,label:w.label});return e(n),[2,u]}})})},t.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,n){var i=function(d){for(var g=[],w=0,p=d;w<p.length;w++){var m=p[w];m.kind==="video"&&g.push({id:m.id,label:m.label})}e(g)},u=MediaStreamTrack;u.getSources(i)})},t})(),Lt;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.NOT_STARTED=1]="NOT_STARTED",t[t.SCANNING=2]="SCANNING",t[t.PAUSED=3]="PAUSED"})(Lt||(Lt={}));var Iv=(function(){function t(){this.state=Lt.NOT_STARTED,this.onGoingTransactionNewState=Lt.UNKNOWN}return t.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},t.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},t.prototype.execute=function(){if(this.onGoingTransactionNewState===Lt.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Lt.UNKNOWN,this.directTransition(e)},t.prototype.cancel=function(){if(this.onGoingTransactionNewState===Lt.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Lt.UNKNOWN},t.prototype.getState=function(){return this.state},t.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Lt.UNKNOWN)throw"Cannot transition to a new state, already under transition"},t.prototype.validateTransition=function(e){switch(this.state){case Lt.UNKNOWN:throw"Transition from unknown is not allowed";case Lt.NOT_STARTED:this.failIfNewStateIs(e,[Lt.PAUSED]);break;case Lt.SCANNING:break;case Lt.PAUSED:break}},t.prototype.failIfNewStateIs=function(e,n){for(var i=0,u=n;i<u.length;i++){var d=u[i];if(e===d)throw"Cannot transition from ".concat(this.state," to ").concat(e)}},t})(),Tv=(function(){function t(e){this.stateManager=e}return t.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},t.prototype.directTransition=function(e){this.stateManager.directTransition(e)},t.prototype.getState=function(){return this.stateManager.getState()},t.prototype.canScanFile=function(){return this.stateManager.getState()===Lt.NOT_STARTED},t.prototype.isScanning=function(){return this.stateManager.getState()!==Lt.NOT_STARTED},t.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Lt.SCANNING},t.prototype.isPaused=function(){return this.stateManager.getState()===Lt.PAUSED},t})(),Ov=(function(){function t(){}return t.create=function(){return new Tv(new Iv)},t})(),Rv=(function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,u){i.__proto__=u}||function(i,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(i[d]=u[d])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function i(){this.constructor=e}e.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}})(),Mr=(function(t){Rv(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e})(lv),jv=(function(){function t(e,n){this.logger=n,this.fps=Mr.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=e.disableFlip===!0,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=Mr.DEFAULT_DISABLE_FLIP}return t.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Jh.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},t.prototype.isShadedBoxEnabled=function(){return!yn(this.qrbox)},t.create=function(e,n){return new t(e,n)},t})(),Bu=(function(){function t(e,n){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.elementId=e,this.verbose=!1;var i;typeof n=="boolean"?this.verbose=n===!0:n&&(i=n,this.verbose=i.verbose===!0,i.experimentalFeatures),this.logger=new uv(this.verbose),this.qrcode=new pv(this.getSupportedFormats(n),this.getUseBarCodeDetectorIfSupported(i),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=Ov.create()}return t.prototype.start=function(e,n,i,u){var d=this;if(!e)throw"cameraIdOrConfig is required";if(!i||typeof i!="function")throw"qrCodeSuccessCallback is required and should be a function.";var g;u?g=u:g=this.verbose?this.logger.log:function(){};var w=jv.create(n,this.logger);this.clearElement();var p=!1;w.videoConstraints&&(w.isMediaStreamConstraintsValid()?p=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var m=p,b=document.getElementById(this.elementId);b.clientWidth?b.clientWidth:Mr.DEFAULT_WIDTH,b.style.position="relative",this.shouldScan=!0,this.element=b;var C=this,_=this.stateManagerProxy.startTransition(Lt.SCANNING);return new Promise(function(N,I){var T=m?w.videoConstraints:C.createVideoConstraints(e);if(!T){_.cancel(),I("videoConstraints should be defined");return}var k={};(!m||w.aspectRatio)&&(k.aspectRatio=w.aspectRatio);var M={onRenderSurfaceReady:function(H,B){C.setupUi(H,B,w),C.isScanning=!0,C.foreverScan(w,i,g)}};Ev.failIfNotSupported().then(function(H){H.create(T).then(function(B){return B.render(d.element,k,M).then(function(z){C.renderedCamera=z,_.execute(),N(null)}).catch(function(z){_.cancel(),I(z)})}).catch(function(B){_.cancel(),I(Fs.errorGettingUserMedia(B))})}).catch(function(H){_.cancel(),I(Fs.cameraStreamingNotSupported())})})},t.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Lt.PAUSED),this.showPausedState(),(yn(e)||e!==!0)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},t.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,n=function(){e.stateManagerProxy.directTransition(Lt.SCANNING),e.hidePausedState()};if(!this.renderedCamera.isPaused()){n();return}this.renderedCamera.resume(function(){n()})},t.prototype.getState=function(){return this.stateManagerProxy.getState()},t.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var n=this.stateManagerProxy.startTransition(Lt.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var i=function(){if(e.element){var d=document.getElementById(Mr.SHADED_REGION_ELEMENT_ID);d&&e.element.removeChild(d)}},u=this;return this.renderedCamera.close().then(function(){return u.renderedCamera=null,u.element&&(u.element.removeChild(u.canvasElement),u.canvasElement=null),i(),u.qrRegion&&(u.qrRegion=null),u.context&&(u.context=null),n.execute(),u.hidePausedState(),u.isScanning=!1,Promise.resolve()})},t.prototype.scanFile=function(e,n){return this.scanFileV2(e,n).then(function(i){return i.decodedText})},t.prototype.scanFileV2=function(e,n){var i=this;if(!e||!(e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(yn(n)&&(n=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(u,d){i.possiblyCloseLastScanImageFile(),i.clearElement(),i.lastScanImageFile=URL.createObjectURL(e);var g=new Image;g.onload=function(){var w=g.width,p=g.height,m=document.getElementById(i.elementId),b=m.clientWidth?m.clientWidth:Mr.DEFAULT_WIDTH,C=Math.max(m.clientHeight?m.clientHeight:p,Mr.FILE_SCAN_MIN_HEIGHT),_=i.computeCanvasDrawConfig(w,p,b,C);if(n){var N=i.createCanvasElement(b,C,"qr-canvas-visible");N.style.display="inline-block",m.appendChild(N);var I=N.getContext("2d");if(!I)throw"Unable to get 2d context from canvas";I.canvas.width=b,I.canvas.height=C,I.drawImage(g,0,0,w,p,_.x,_.y,_.width,_.height)}var T=Mr.FILE_SCAN_HIDDEN_CANVAS_PADDING,k=Math.max(g.width,_.width),M=Math.max(g.height,_.height),H=k+2*T,B=M+2*T,z=i.createCanvasElement(H,B);m.appendChild(z);var ae=z.getContext("2d");if(!ae)throw"Unable to get 2d context from canvas";ae.canvas.width=H,ae.canvas.height=B,ae.drawImage(g,0,0,w,p,T,T,k,M);try{i.qrcode.decodeRobustlyAsync(z).then(function(V){u(Ou.createFromQrcodeResult(V))}).catch(d)}catch(V){d("QR code parse error, error = ".concat(V))}},g.onerror=d,g.onabort=d,g.onstalled=d,g.onsuspend=d,g.src=URL.createObjectURL(e)})},t.prototype.clear=function(){this.clearElement()},t.getCameras=function(){return Sv.retrieve()},t.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},t.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},t.prototype.applyVideoConstraints=function(e){if(e){if(!Jh.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},t.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},t.prototype.getSupportedFormats=function(e){var n=[we.QR_CODE,we.AZTEC,we.CODABAR,we.CODE_39,we.CODE_93,we.CODE_128,we.DATA_MATRIX,we.MAXICODE,we.ITF,we.EAN_13,we.EAN_8,we.PDF_417,we.RSS_14,we.RSS_EXPANDED,we.UPC_A,we.UPC_E,we.UPC_EAN_EXTENSION];if(!e||typeof e=="boolean"||!e.formatsToSupport)return n;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(e.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var i=[],u=0,d=e.formatsToSupport;u<d.length;u++){var g=d[u];ov(g)?i.push(g):this.logger.warn("Invalid format: ".concat(g," passed in config, ignoring."))}if(i.length===0)throw"None of formatsToSupport match supported values.";return i},t.prototype.getUseBarCodeDetectorIfSupported=function(e){if(yn(e))return!0;if(!yn(e.useBarCodeDetectorIfSupported))return e.useBarCodeDetectorIfSupported!==!1;if(yn(e.experimentalFeatures))return!0;var n=e.experimentalFeatures;return yn(n.useBarCodeDetectorIfSupported)?!0:n.useBarCodeDetectorIfSupported!==!1},t.prototype.validateQrboxSize=function(e,n,i){var u=this,d=i.qrbox;this.validateQrboxConfig(d);var g=this.toQrdimensions(e,n,d),w=function(m){if(m<Mr.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Mr.MIN_QR_BOX_SIZE,"px.")},p=function(m){return m>e&&(u.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),m=e),m};w(g.width),w(g.height),g.width=p(g.width)},t.prototype.validateQrboxConfig=function(e){if(typeof e!="number"&&typeof e!="function"&&(e.width===void 0||e.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},t.prototype.toQrdimensions=function(e,n,i){if(typeof i=="number")return{width:i,height:i};if(typeof i=="function")try{return i(e,n)}catch(u){throw new Error("qrbox config was passed as a function but it failed with unknown error"+u)}return i},t.prototype.setupUi=function(e,n,i){i.isShadedBoxEnabled()&&this.validateQrboxSize(e,n,i);var u=yn(i.qrbox)?{width:e,height:n}:i.qrbox;this.validateQrboxConfig(u);var d=this.toQrdimensions(e,n,u);d.height>n&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var g=i.isShadedBoxEnabled()&&d.height<=n,w={x:0,y:0,width:e,height:n},p=g?this.getShadedRegionBounds(e,n,d):w,m=this.createCanvasElement(p.width,p.height),b={willReadFrequently:!0},C=m.getContext("2d",b);C.canvas.width=p.width,C.canvas.height=p.height,this.element.append(m),g&&this.possiblyInsertShadingElement(this.element,e,n,d),this.createScannerPausedUiElement(this.element),this.qrRegion=p,this.context=C,this.canvasElement=m},t.prototype.createScannerPausedUiElement=function(e){var n=document.createElement("div");n.innerText=Fs.scannerPaused(),n.style.display="none",n.style.position="absolute",n.style.top="0px",n.style.zIndex="1",n.style.background="rgba(9, 9, 9, 0.46)",n.style.color="#FFECEC",n.style.textAlign="center",n.style.width="100%",e.appendChild(n),this.scannerPausedUiElement=n},t.prototype.scanContext=function(e,n){var i=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(u){return e(u.text,Ou.createFromQrcodeResult(u)),i.possiblyUpdateShaders(!0),!0}).catch(function(u){i.possiblyUpdateShaders(!1);var d=Fs.codeParseError(u);return n(d,cv.createFrom(d)),!1})},t.prototype.foreverScan=function(e,n,i){var u=this;if(this.shouldScan&&this.renderedCamera){var d=this.renderedCamera.getSurface(),g=d.videoWidth/d.clientWidth,w=d.videoHeight/d.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var p=this.qrRegion.width*g,m=this.qrRegion.height*w,b=this.qrRegion.x*g,C=this.qrRegion.y*w;this.context.drawImage(d,b,C,p,m,0,0,this.qrRegion.width,this.qrRegion.height);var _=function(){u.foreverScanTimeout=setTimeout(function(){u.foreverScan(e,n,i)},u.getTimeoutFps(e.fps))};this.scanContext(n,i).then(function(N){!N&&e.disableFlip!==!0?(u.context.translate(u.context.canvas.width,0),u.context.scale(-1,1),u.scanContext(n,i).finally(function(){_()})):_()}).catch(function(N){u.logger.logError("Error happend while scanning context",N),_()})}},t.prototype.createVideoConstraints=function(e){if(typeof e=="string")return{deviceId:{exact:e}};if(typeof e=="object"){var n="facingMode",i="deviceId",u={user:!0,environment:!0},d="exact",g=function(I){if(I in u)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(I,"'")},w=Object.keys(e);if(w.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(w.length," keys");var p=Object.keys(e)[0];if(p!==n&&p!==i)throw"Only '".concat(n,"' and '").concat(i,"' ")+" are supported for 'cameraIdOrConfig'";if(p===n){var m=e.facingMode;if(typeof m=="string"){if(g(m))return{facingMode:m}}else if(typeof m=="object")if(d in m){if(g(m["".concat(d)]))return{facingMode:{exact:m["".concat(d)]}}}else throw"'facingMode' should be string or object with"+" ".concat(d," as key.");else{var b=typeof m;throw"Invalid type of 'facingMode' = ".concat(b)}}else{var C=e.deviceId;if(typeof C=="string")return{deviceId:C};if(typeof C=="object"){if(d in C)return{deviceId:{exact:C["".concat(d)]}};throw"'deviceId' should be string or object with"+" ".concat(d," as key.")}else{var _=typeof C;throw"Invalid type of 'deviceId' = ".concat(_)}}}var N=typeof e;throw"Invalid type of 'cameraIdOrConfig' = ".concat(N)},t.prototype.computeCanvasDrawConfig=function(e,n,i,u){if(e<=i&&n<=u){var d=(i-e)/2,g=(u-n)/2;return{x:d,y:g,width:e,height:n}}else{var w=e,p=n;return e>i&&(n=i/e*n,e=i),n>u&&(e=u/n*e,n=u),this.logger.log("Image downsampled from "+"".concat(w,"X").concat(p)+" to ".concat(e,"X").concat(n,".")),this.computeCanvasDrawConfig(e,n,i,u)}},t.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},t.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(n){n.style.backgroundColor=e?Mr.BORDER_SHADER_MATCH_COLOR:Mr.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},t.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},t.prototype.createCanvasElement=function(e,n,i){var u=e,d=n,g=document.createElement("canvas");return g.style.width="".concat(u,"px"),g.style.height="".concat(d,"px"),g.style.display="none",g.id=yn(i)?"qr-canvas":i,g},t.prototype.getShadedRegionBounds=function(e,n,i){if(i.width>e||i.height>n)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-i.width)/2,y:(n-i.height)/2,width:i.width,height:i.height}},t.prototype.possiblyInsertShadingElement=function(e,n,i,u){if(!(n-u.width<1||i-u.height<1)){var d=document.createElement("div");d.style.position="absolute";var g=(n-u.width)/2,w=(i-u.height)/2;if(d.style.borderLeft="".concat(g,"px solid rgba(0, 0, 0, 0.48)"),d.style.borderRight="".concat(g,"px solid rgba(0, 0, 0, 0.48)"),d.style.borderTop="".concat(w,"px solid rgba(0, 0, 0, 0.48)"),d.style.borderBottom="".concat(w,"px solid rgba(0, 0, 0, 0.48)"),d.style.boxSizing="border-box",d.style.top="0px",d.style.bottom="0px",d.style.left="0px",d.style.right="0px",d.id="".concat(Mr.SHADED_REGION_ELEMENT_ID),n-u.width<11||i-u.height<11)this.hasBorderShaders=!1;else{var p=5,m=40;this.insertShaderBorders(d,m,p,-p,null,0,!0),this.insertShaderBorders(d,m,p,-p,null,0,!1),this.insertShaderBorders(d,m,p,null,-p,0,!0),this.insertShaderBorders(d,m,p,null,-p,0,!1),this.insertShaderBorders(d,p,m+p,-p,null,-p,!0),this.insertShaderBorders(d,p,m+p,null,-p,-p,!0),this.insertShaderBorders(d,p,m+p,-p,null,-p,!1),this.insertShaderBorders(d,p,m+p,null,-p,-p,!1),this.hasBorderShaders=!0}e.append(d)}},t.prototype.insertShaderBorders=function(e,n,i,u,d,g,w){var p=document.createElement("div");p.style.position="absolute",p.style.backgroundColor=Mr.BORDER_SHADER_DEFAULT_COLOR,p.style.width="".concat(n,"px"),p.style.height="".concat(i,"px"),u!==null&&(p.style.top="".concat(u,"px")),d!==null&&(p.style.bottom="".concat(d,"px")),w?p.style.left="".concat(g,"px"):p.style.right="".concat(g,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(p),e.appendChild(p)},t.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},t.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},t.prototype.getTimeoutFps=function(e){return 1e3/e},t})(),Fu;(function(t){t[t.STATUS_DEFAULT=0]="STATUS_DEFAULT",t[t.STATUS_SUCCESS=1]="STATUS_SUCCESS",t[t.STATUS_WARNING=2]="STATUS_WARNING",t[t.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Fu||(Fu={}));var Uu=1,kv=.9,Dv=.8,Pv=.17,Ao=.1,No=.999,Mv=.9999,Lv=.99,Bv=/[\\\/_+.#"@\[\(\{&]/,Fv=/[\\\/_+.#"@\[\(\{&]/g,Uv=/[\s-]/,tf=/[\s-]/g;function ol(t,e,n,i,u,d,g){if(d===e.length)return u===t.length?Uu:Lv;var w=`${u},${d}`;if(g[w]!==void 0)return g[w];for(var p=i.charAt(d),m=n.indexOf(p,u),b=0,C,_,N,I;m>=0;)C=ol(t,e,n,i,m+1,d+1,g),C>b&&(m===u?C*=Uu:Bv.test(t.charAt(m-1))?(C*=Dv,N=t.slice(u,m-1).match(Fv),N&&u>0&&(C*=Math.pow(No,N.length))):Uv.test(t.charAt(m-1))?(C*=kv,I=t.slice(u,m-1).match(tf),I&&u>0&&(C*=Math.pow(No,I.length))):(C*=Pv,u>0&&(C*=Math.pow(No,m-u))),t.charAt(m)!==e.charAt(d)&&(C*=Mv)),(C<Ao&&n.charAt(m-1)===i.charAt(d+1)||i.charAt(d+1)===i.charAt(d)&&n.charAt(m-1)!==i.charAt(d))&&(_=ol(t,e,n,i,m+1,d+2,g),_*Ao>C&&(C=_*Ao)),C>b&&(b=C),m=n.indexOf(p,m+1);return g[w]=b,b}function Wu(t){return t.toLowerCase().replace(tf," ")}function Wv(t,e,n){return t=n&&n.length>0?`${t+" "+n.join(" ")}`:t,ol(t,e,Wu(t),Wu(e),0,0,{})}var fi='[cmdk-group=""]',So='[cmdk-group-items=""]',Vv='[cmdk-group-heading=""]',rf='[cmdk-item=""]',Vu=`${rf}:not([aria-disabled="true"])`,ll="cmdk-item-select",Ds="data-value",Hv=(t,e,n)=>Wv(t,e,n),nf=D.createContext(void 0),Mi=()=>D.useContext(nf),sf=D.createContext(void 0),ec=()=>D.useContext(sf),af=D.createContext(void 0),of=D.forwardRef((t,e)=>{let n=Ps(()=>{var re,W;return{search:"",value:(W=(re=t.value)!=null?re:t.defaultValue)!=null?W:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),i=Ps(()=>new Set),u=Ps(()=>new Map),d=Ps(()=>new Map),g=Ps(()=>new Set),w=lf(t),{label:p,children:m,value:b,onValueChange:C,filter:_,shouldFilter:N,loop:I,disablePointerSelection:T=!1,vimBindings:k=!0,...M}=t,H=Us(),B=Us(),z=Us(),ae=D.useRef(null),V=eC();cs(()=>{if(b!==void 0){let re=b.trim();n.current.value=re,G.emit()}},[b]),cs(()=>{V(6,te)},[]);let G=D.useMemo(()=>({subscribe:re=>(g.current.add(re),()=>g.current.delete(re)),snapshot:()=>n.current,setState:(re,W,ce)=>{var $,F,he,Pe;if(!Object.is(n.current[re],W)){if(n.current[re]=W,re==="search")ue(),ne(),V(1,oe);else if(re==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let Ze=document.getElementById(z);Ze?Ze.focus():($=document.getElementById(H))==null||$.focus()}if(V(7,()=>{var Ze;n.current.selectedItemId=(Ze=ge())==null?void 0:Ze.id,G.emit()}),ce||V(5,te),((F=w.current)==null?void 0:F.value)!==void 0){let Ze=W??"";(Pe=(he=w.current).onValueChange)==null||Pe.call(he,Ze);return}}G.emit()}},emit:()=>{g.current.forEach(re=>re())}}),[]),P=D.useMemo(()=>({value:(re,W,ce)=>{var $;W!==(($=d.current.get(re))==null?void 0:$.value)&&(d.current.set(re,{value:W,keywords:ce}),n.current.filtered.items.set(re,O(W,ce)),V(2,()=>{ne(),G.emit()}))},item:(re,W)=>(i.current.add(re),W&&(u.current.has(W)?u.current.get(W).add(re):u.current.set(W,new Set([re]))),V(3,()=>{ue(),ne(),n.current.value||oe(),G.emit()}),()=>{d.current.delete(re),i.current.delete(re),n.current.filtered.items.delete(re);let ce=ge();V(4,()=>{ue(),ce?.getAttribute("id")===re&&oe(),G.emit()})}),group:re=>(u.current.has(re)||u.current.set(re,new Set),()=>{d.current.delete(re),u.current.delete(re)}),filter:()=>w.current.shouldFilter,label:p||t["aria-label"],getDisablePointerSelection:()=>w.current.disablePointerSelection,listId:H,inputId:z,labelId:B,listInnerRef:ae}),[]);function O(re,W){var ce,$;let F=($=(ce=w.current)==null?void 0:ce.filter)!=null?$:Hv;return re?F(re,n.current.search,W):0}function ne(){if(!n.current.search||w.current.shouldFilter===!1)return;let re=n.current.filtered.items,W=[];n.current.filtered.groups.forEach($=>{let F=u.current.get($),he=0;F.forEach(Pe=>{let Ze=re.get(Pe);he=Math.max(Ze,he)}),W.push([$,he])});let ce=ae.current;q().sort(($,F)=>{var he,Pe;let Ze=$.getAttribute("id"),_t=F.getAttribute("id");return((he=re.get(_t))!=null?he:0)-((Pe=re.get(Ze))!=null?Pe:0)}).forEach($=>{let F=$.closest(So);F?F.appendChild($.parentElement===F?$:$.closest(`${So} > *`)):ce.appendChild($.parentElement===ce?$:$.closest(`${So} > *`))}),W.sort(($,F)=>F[1]-$[1]).forEach($=>{var F;let he=(F=ae.current)==null?void 0:F.querySelector(`${fi}[${Ds}="${encodeURIComponent($[0])}"]`);he?.parentElement.appendChild(he)})}function oe(){let re=q().find(ce=>ce.getAttribute("aria-disabled")!=="true"),W=re?.getAttribute(Ds);G.setState("value",W||void 0)}function ue(){var re,W,ce,$;if(!n.current.search||w.current.shouldFilter===!1){n.current.filtered.count=i.current.size;return}n.current.filtered.groups=new Set;let F=0;for(let he of i.current){let Pe=(W=(re=d.current.get(he))==null?void 0:re.value)!=null?W:"",Ze=($=(ce=d.current.get(he))==null?void 0:ce.keywords)!=null?$:[],_t=O(Pe,Ze);n.current.filtered.items.set(he,_t),_t>0&&F++}for(let[he,Pe]of u.current)for(let Ze of Pe)if(n.current.filtered.items.get(Ze)>0){n.current.filtered.groups.add(he);break}n.current.filtered.count=F}function te(){var re,W,ce;let $=ge();$&&(((re=$.parentElement)==null?void 0:re.firstChild)===$&&((ce=(W=$.closest(fi))==null?void 0:W.querySelector(Vv))==null||ce.scrollIntoView({block:"nearest"})),$.scrollIntoView({block:"nearest"}))}function ge(){var re;return(re=ae.current)==null?void 0:re.querySelector(`${rf}[aria-selected="true"]`)}function q(){var re;return Array.from(((re=ae.current)==null?void 0:re.querySelectorAll(Vu))||[])}function Z(re){let W=q()[re];W&&G.setState("value",W.getAttribute(Ds))}function Y(re){var W;let ce=ge(),$=q(),F=$.findIndex(Pe=>Pe===ce),he=$[F+re];(W=w.current)!=null&&W.loop&&(he=F+re<0?$[$.length-1]:F+re===$.length?$[0]:$[F+re]),he&&G.setState("value",he.getAttribute(Ds))}function Q(re){let W=ge(),ce=W?.closest(fi),$;for(;ce&&!$;)ce=re>0?Zv(ce,fi):Jv(ce,fi),$=ce?.querySelector(Vu);$?G.setState("value",$.getAttribute(Ds)):Y(re)}let Fe=()=>Z(q().length-1),qe=re=>{re.preventDefault(),re.metaKey?Fe():re.altKey?Q(1):Y(1)},lt=re=>{re.preventDefault(),re.metaKey?Z(0):re.altKey?Q(-1):Y(-1)};return D.createElement(Wn.div,{ref:e,tabIndex:-1,...M,"cmdk-root":"",onKeyDown:re=>{var W;(W=M.onKeyDown)==null||W.call(M,re);let ce=re.nativeEvent.isComposing||re.keyCode===229;if(!(re.defaultPrevented||ce))switch(re.key){case"n":case"j":{k&&re.ctrlKey&&qe(re);break}case"ArrowDown":{qe(re);break}case"p":case"k":{k&&re.ctrlKey&&lt(re);break}case"ArrowUp":{lt(re);break}case"Home":{re.preventDefault(),Z(0);break}case"End":{re.preventDefault(),Fe();break}case"Enter":{re.preventDefault();let $=ge();if($){let F=new Event(ll);$.dispatchEvent(F)}}}}},D.createElement("label",{"cmdk-label":"",htmlFor:P.inputId,id:P.labelId,style:rC},p),Ta(t,re=>D.createElement(sf.Provider,{value:G},D.createElement(nf.Provider,{value:P},re))))}),Gv=D.forwardRef((t,e)=>{var n,i;let u=Us(),d=D.useRef(null),g=D.useContext(af),w=Mi(),p=lf(t),m=(i=(n=p.current)==null?void 0:n.forceMount)!=null?i:g?.forceMount;cs(()=>{if(!m)return w.item(u,g?.id)},[m]);let b=cf(u,d,[t.value,t.children,d],t.keywords),C=ec(),_=Un(V=>V.value&&V.value===b.current),N=Un(V=>m||w.filter()===!1?!0:V.search?V.filtered.items.get(u)>0:!0);D.useEffect(()=>{let V=d.current;if(!(!V||t.disabled))return V.addEventListener(ll,I),()=>V.removeEventListener(ll,I)},[N,t.onSelect,t.disabled]);function I(){var V,G;T(),(G=(V=p.current).onSelect)==null||G.call(V,b.current)}function T(){C.setState("value",b.current,!0)}if(!N)return null;let{disabled:k,value:M,onSelect:H,forceMount:B,keywords:z,...ae}=t;return D.createElement(Wn.div,{ref:wi(d,e),...ae,id:u,"cmdk-item":"",role:"option","aria-disabled":!!k,"aria-selected":!!_,"data-disabled":!!k,"data-selected":!!_,onPointerMove:k||w.getDisablePointerSelection()?void 0:T,onClick:k?void 0:I},t.children)}),qv=D.forwardRef((t,e)=>{let{heading:n,children:i,forceMount:u,...d}=t,g=Us(),w=D.useRef(null),p=D.useRef(null),m=Us(),b=Mi(),C=Un(N=>u||b.filter()===!1?!0:N.search?N.filtered.groups.has(g):!0);cs(()=>b.group(g),[]),cf(g,w,[t.value,t.heading,p]);let _=D.useMemo(()=>({id:g,forceMount:u}),[u]);return D.createElement(Wn.div,{ref:wi(w,e),...d,"cmdk-group":"",role:"presentation",hidden:C?void 0:!0},n&&D.createElement("div",{ref:p,"cmdk-group-heading":"","aria-hidden":!0,id:m},n),Ta(t,N=>D.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?m:void 0},D.createElement(af.Provider,{value:_},N))))}),zv=D.forwardRef((t,e)=>{let{alwaysRender:n,...i}=t,u=D.useRef(null),d=Un(g=>!g.search);return!n&&!d?null:D.createElement(Wn.div,{ref:wi(u,e),...i,"cmdk-separator":"",role:"separator"})}),Yv=D.forwardRef((t,e)=>{let{onValueChange:n,...i}=t,u=t.value!=null,d=ec(),g=Un(m=>m.search),w=Un(m=>m.selectedItemId),p=Mi();return D.useEffect(()=>{t.value!=null&&d.setState("search",t.value)},[t.value]),D.createElement(Wn.input,{ref:e,...i,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":p.listId,"aria-labelledby":p.labelId,"aria-activedescendant":w,id:p.inputId,type:"text",value:u?t.value:g,onChange:m=>{u||d.setState("search",m.target.value),n?.(m.target.value)}})}),Xv=D.forwardRef((t,e)=>{let{children:n,label:i="Suggestions",...u}=t,d=D.useRef(null),g=D.useRef(null),w=Un(m=>m.selectedItemId),p=Mi();return D.useEffect(()=>{if(g.current&&d.current){let m=g.current,b=d.current,C,_=new ResizeObserver(()=>{C=requestAnimationFrame(()=>{let N=m.offsetHeight;b.style.setProperty("--cmdk-list-height",N.toFixed(1)+"px")})});return _.observe(m),()=>{cancelAnimationFrame(C),_.unobserve(m)}}},[]),D.createElement(Wn.div,{ref:wi(d,e),...u,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":w,"aria-label":i,id:p.listId},Ta(t,m=>D.createElement("div",{ref:wi(g,p.listInnerRef),"cmdk-list-sizer":""},m)))}),$v=D.forwardRef((t,e)=>{let{open:n,onOpenChange:i,overlayClassName:u,contentClassName:d,container:g,...w}=t;return D.createElement(ul,{open:n,onOpenChange:i},D.createElement(fl,{container:g},D.createElement(cl,{"cmdk-overlay":"",className:u}),D.createElement(dl,{"aria-label":t.label,"cmdk-dialog":"",className:d},D.createElement(of,{ref:e,...w}))))}),Kv=D.forwardRef((t,e)=>Un(n=>n.filtered.count===0)?D.createElement(Wn.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),Qv=D.forwardRef((t,e)=>{let{progress:n,children:i,label:u="Loading...",...d}=t;return D.createElement(Wn.div,{ref:e,...d,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":u},Ta(t,g=>D.createElement("div",{"aria-hidden":!0},g)))}),Js=Object.assign(of,{List:Xv,Item:Gv,Input:Yv,Group:qv,Separator:zv,Dialog:$v,Empty:Kv,Loading:Qv});function Zv(t,e){let n=t.nextElementSibling;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}function Jv(t,e){let n=t.previousElementSibling;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function lf(t){let e=D.useRef(t);return cs(()=>{e.current=t}),e}var cs=typeof window>"u"?D.useEffect:D.useLayoutEffect;function Ps(t){let e=D.useRef();return e.current===void 0&&(e.current=t()),e}function Un(t){let e=ec(),n=()=>t(e.snapshot());return D.useSyncExternalStore(e.subscribe,n,n)}function cf(t,e,n,i=[]){let u=D.useRef(),d=Mi();return cs(()=>{var g;let w=(()=>{var m;for(let b of n){if(typeof b=="string")return b.trim();if(typeof b=="object"&&"current"in b)return b.current?(m=b.current.textContent)==null?void 0:m.trim():u.current}})(),p=i.map(m=>m.trim());d.value(t,w,p),(g=e.current)==null||g.setAttribute(Ds,w),u.current=w}),u}var eC=()=>{let[t,e]=D.useState(),n=Ps(()=>new Map);return cs(()=>{n.current.forEach(i=>i()),n.current=new Map},[t]),(i,u)=>{n.current.set(i,u),e({})}};function tC(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function Ta({asChild:t,children:e},n){return t&&D.isValidElement(e)?D.cloneElement(tC(e),{ref:e.ref},n(e.props.children)):n(e)}var rC={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function nC({className:t,...e}){return l.jsx(Js,{"data-slot":"command",className:Ce("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",t),...e})}function sC({className:t,...e}){return l.jsxs("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[l.jsx(us,{className:"size-4 shrink-0 opacity-50"}),l.jsx(Js.Input,{"data-slot":"command-input",className:Ce("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",t),...e})]})}function iC({className:t,...e}){return l.jsx(Js.List,{"data-slot":"command-list",className:Ce("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",t),...e})}function aC({...t}){return l.jsx(Js.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...t})}function oC({className:t,...e}){return l.jsx(Js.Group,{"data-slot":"command-group",className:Ce("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",t),...e})}function lC({className:t,...e}){return l.jsx(Js.Item,{"data-slot":"command-item",className:Ce("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...e})}function cC(){const[t,e]=D.useState(!1),[n,i]=D.useState([]),[u,d]=D.useState(""),[g,w]=D.useState([]),[p,m]=D.useState(null),[b,C]=D.useState(!1),[_,N]=D.useState(!1),[I,T]=D.useState(""),{markAttendance:k,attendance:M}=Ia(),{students:H}=ds(),{settings:B}=Na();D.useEffect(()=>{if(!document.getElementById("qr-reader"))return;const Z=new Bu("qr-reader");return m(Z),Bu.getCameras().then(Y=>{if(Y&&Y.length>0){w(Y);const Q=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if(C(Q),Q){const Fe=Y.find(qe=>qe.label.toLowerCase().includes("back")||qe.label.toLowerCase().includes("rear")||qe.label.toLowerCase().includes("environment"));d(Fe?Fe.id:Y[Y.length-1].id)}else d(Y[0].id)}}).catch(Y=>{console.error("Error getting cameras:",Y),xe.error("لا يمكن الوصول إلى الكاميرا")}),()=>{Z&&Z.isScanning&&Z.stop().catch(Y=>console.error(Y))}},[]);const z=async()=>{if(!p||!u){xe.error("الرجاء اختيار كاميرا أولاً");return}try{const Y=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?{facingMode:"environment"}:u;await p.start(Y,{fps:10,qrbox:{width:250,height:250},aspectRatio:1},Q=>{P(Q)},()=>{}),e(!0),xe.success("تم تشغيل الماسح الضوئي")}catch(Z){console.error("Error starting scanner:",Z),xe.error("فشل في تشغيل الماسح الضوئي")}},ae=async()=>{if(p&&t)try{await p.stop(),e(!1),xe.info("تم إيقاف الماسح الضوئي")}catch(Z){console.error("Error stopping scanner:",Z)}},[V,G]=D.useState(!1),P=async Z=>{if(!V){G(!0);try{let Y=Z;try{const ce=JSON.parse(Z);Y=ce.studentId||ce.id||Z}catch{}const Q=H.find(ce=>ce.id===Y);if(!Q){xe.error("⚠️ الطالب غير موجود في النظام",{description:`رقم الطالب: ${Y}`,duration:4e3}),O(Y,"طالب غير معروف","error"),setTimeout(()=>G(!1),2e3);return}if(Q.status&&Q.status!=="active"){const ce={suspended:"موقوف",expelled:"مفصول"};xe.error(`⚠️ لا يمكن تسجيل حضور طالب ${ce[Q.status]||Q.status}`,{description:`الطالب: ${Q.name}`,duration:5e3}),O(Y,Q.name,"error"),oe(),setTimeout(()=>G(!1),2e3);return}const Fe=new Date,qe=vu(B.work_start_time||"08:00","HH:mm",Fe),lt=vu(B.work_end_time||"14:00","HH:mm",Fe);if(!Sy(Fe,{start:qe,end:lt})){xe.error("⚠️ خارج أوقات العمل الرسمية",{description:`مواعيد العمل: من ${B.work_start_time} إلى ${B.work_end_time}`,duration:5e3}),O(Y,Q.name,"error"),oe(),setTimeout(()=>G(!1),2e3);return}const re=It(new Date,"yyyy-MM-dd");if(M.some(ce=>ce.student_id===Y&&ce.date===re)){xe.warning("⚠️ تم تسجيل الحضور من قبل",{description:`${Q.name} - مسجل مسبقاً اليوم`,duration:5e3}),O(Y,Q.name,"duplicate"),oe(),setTimeout(()=>G(!1),2e3);return}await k({student_id:Y,date:re,present:!0,notes:"QR Scan"}),xe.success("✅ تم تسجيل الحضور بنجاح",{description:`${Q.name}`,duration:4e3}),O(Y,Q.name,"success"),ne()}catch(Y){console.error("Error handling QR scan:",Y),xe.error("QR Code غير صالح أو حدث خطأ"),O("UNKNOWN","خطأ في المعالجة","error")}finally{setTimeout(()=>G(!1),2e3)}}},O=(Z,Y,Q)=>{const Fe={id:Date.now(),studentId:Z,studentName:Y,time:new Date().toLocaleTimeString("ar-SA"),status:Q};i(qe=>[Fe,...qe])},ne=()=>{try{const Z=new(window.AudioContext||window.webkitAudioContext),Y=Z.createOscillator(),Q=Z.createGain();Y.connect(Q),Q.connect(Z.destination),Y.frequency.value=800,Y.type="sine",Q.gain.setValueAtTime(.3,Z.currentTime),Q.gain.exponentialRampToValueAtTime(.01,Z.currentTime+.2),Y.start(Z.currentTime),Y.stop(Z.currentTime+.2)}catch{}},oe=()=>{try{const Z=new(window.AudioContext||window.webkitAudioContext),Y=Z.createOscillator(),Q=Z.createGain();Y.connect(Q),Q.connect(Z.destination),Y.frequency.value=400,Y.type="sawtooth",Q.gain.setValueAtTime(.3,Z.currentTime),Q.gain.exponentialRampToValueAtTime(.01,Z.currentTime+.3),Y.start(Z.currentTime),Y.stop(Z.currentTime+.3)}catch{}},ue=Z=>{switch(Z){case"success":return l.jsxs(vt,{className:"bg-green-500",children:[l.jsx(vi,{className:"h-3 w-3 ml-1"}),"نجح"]});case"duplicate":return l.jsxs(vt,{className:"bg-yellow-500",children:[l.jsx(ud,{className:"h-3 w-3 ml-1"}),"مكرر"]});case"error":return l.jsxs(vt,{className:"bg-red-500",children:[l.jsx(Oo,{className:"h-3 w-3 ml-1"}),"خطأ"]});default:return l.jsx(vt,{children:Z})}},te=n.filter(Z=>Z.status==="success"&&Z.studentId!=="UNKNOWN").length,ge=n.filter(Z=>Z.status==="duplicate").length,q=n.filter(Z=>Z.status==="error").length;return l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl text-black mb-1",children:"مسح رمز QR للحضور"}),l.jsx("p",{className:"text-gray-600",children:"استخدم الكاميرا لمسح رموز QR الخاصة بالطلاب لتسجيل الحضور"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"✅ حضور ناجح (جلسة حالية)"}),l.jsx(We,{className:"text-3xl text-green-600",children:te})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"⚠️ محاولات مكررة"}),l.jsx(We,{className:"text-3xl text-yellow-600",children:ge})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"❌ أخطاء"}),l.jsx(We,{className:"text-3xl text-red-600",children:q})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"📊 إجمالي المحاولات"}),l.jsx(We,{className:"text-3xl text-black",children:n.length})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"🔴 حالة الماسح"}),l.jsx(We,{className:"text-xl",children:t?l.jsxs("span",{className:"text-green-600 flex items-center gap-2",children:[l.jsxs("span",{className:"relative flex h-3 w-3",children:[l.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),l.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),"نشط"]}):l.jsx("span",{className:"text-gray-600",children:"متوقف"})})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs(Se,{children:[l.jsxs(Ue,{children:[l.jsxs(We,{className:"flex items-center gap-2",children:[l.jsx(wl,{className:"h-5 w-5 text-green-500"}),"تسجيل يدوي"]}),l.jsx(nt,{children:"البحث عن طالب وتسجيل حضوره يدوياً"})]}),l.jsxs(ht,{className:"space-y-4",children:[l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs(rl,{open:_,onOpenChange:N,children:[l.jsx(nl,{asChild:!0,children:l.jsxs(me,{variant:"outline",role:"combobox","aria-expanded":_,className:"w-full justify-between text-right h-12",children:[I?H.find(Z=>Z.id===I)?.name:"ابحث عن طالب...",l.jsx(O0,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),l.jsx(sl,{className:"w-[--radix-popover-trigger-width] p-0",children:l.jsxs(nC,{children:[l.jsx(sC,{placeholder:"ابحث باسم الطالب...",className:"h-9"}),l.jsxs(iC,{children:[l.jsx(aC,{children:"لم يتم العثور على طالب."}),l.jsx(oC,{children:H.map(Z=>l.jsxs(lC,{value:Z.name,onSelect:()=>{T(Z.id||""),N(!1)},children:[l.jsx(xl,{className:Ce("ml-2 h-4 w-4",I===Z.id?"opacity-100":"opacity-0")}),Z.name," - ",Z.classes?.name||"بدون صف"]},Z.id))})]})]})})]}),l.jsxs(me,{disabled:!I||V,onClick:()=>P(I),className:"w-full bg-green-600 hover:bg-green-700 text-white h-12",children:[l.jsx(vi,{className:"ml-2 h-4 w-4"}),"تسجيل حضور الطالب المختار"]})]}),l.jsx("div",{className:"pt-4 border-t border-gray-100",children:l.jsx("p",{className:"text-sm text-gray-500 mb-2 italic",children:"* استخدم ميزة التسجيل اليدوي في حالة تلف رمز QR الخاص بالطالب أو فقدانه."})})]})]}),l.jsxs(Se,{children:[l.jsx(Ue,{children:l.jsxs(We,{className:"flex items-center gap-2",children:[l.jsx(Cc,{className:"h-5 w-5 text-orange-500"}),"كاميرا المسح",b&&l.jsx(vt,{className:"bg-blue-500 text-white text-xs",children:"📱 كاميرا خلفية"})]})}),l.jsxs(ht,{className:"space-y-4",children:[g.length>1&&l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"اختر الكاميرا:"}),l.jsx("select",{value:u,onChange:Z=>d(Z.target.value),disabled:t,className:"w-full p-2 border rounded-lg text-right",children:g.map((Z,Y)=>l.jsx("option",{value:Z.id,children:Z.label||`كاميرا ${Y+1}`},Z.id))})]}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{id:"qr-reader",className:"w-full rounded-lg overflow-hidden"}),!t&&l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-lg",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx(Gs,{className:"h-16 w-16 mx-auto mb-2 opacity-50"}),l.jsx("p",{children:'اضغط "بدء المسح" للتشغيل'})]})})]}),l.jsx("div",{className:"flex gap-2",children:t?l.jsxs(me,{onClick:ae,className:"flex-1 bg-red-500 hover:bg-red-600 text-white",children:[l.jsx(Oo,{className:"ml-2 h-4 w-4"}),"إيقاف المسح"]}):l.jsxs(me,{onClick:z,className:"flex-1 bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(Cc,{className:"ml-2 h-4 w-4"}),"بدء المسح"]})})]})]}),l.jsxs(Se,{children:[l.jsxs(Ue,{children:[l.jsx(We,{children:"سجل المسح الأخير (الجلسة الحالية)"}),l.jsx(nt,{children:"آخر عمليات المسح والتسجيل في هذه الجلسة"})]}),l.jsx(ht,{children:l.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:n.length===0?l.jsxs("div",{className:"text-center py-8 text-gray-500",children:[l.jsx(Gs,{className:"h-12 w-12 mx-auto mb-2 opacity-30"}),l.jsx("p",{children:"لا توجد عمليات مسح بعد"})]}):n.map(Z=>l.jsx("div",{className:`p-3 rounded-lg border ${Z.status==="success"?"bg-green-50 border-green-200":Z.status==="duplicate"?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"text-black",children:Z.studentName}),l.jsx("p",{className:"text-sm text-gray-600",children:Z.studentId}),l.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Z.time})]}),ue(Z.status)]})},Z.id))})})]})]})]})}function uC(){const{id:t}=ed(),e=va(),{students:n,isLoading:i,addStudent:u,updateStudent:d,deleteStudent:g}=ds(),{classes:w,isLoading:p}=Zs(),{attendance:m,isLoading:b,markAttendance:C}=Ia(),[_,N]=D.useState(""),[I,T]=D.useState(1),k=10,[M,H]=D.useState(!1),[B,z]=D.useState(!1),[ae,V]=D.useState(!1),[G,P]=D.useState(null),[O,ne]=D.useState({name:"",phone:"",email:"",class_id:t||"",guardian_name:"",guardian_phone:"",payment_status:"regular"}),oe=D.useMemo(()=>w.find($=>$.id===t),[w,t]),ue=D.useMemo(()=>n.filter($=>$.class_id===t),[n,t]),te=new Date().toISOString().split("T")[0],ge=D.useMemo(()=>m.filter($=>$.date===te),[m,te]),q=D.useMemo(()=>{const $=ue.length,F=ue.filter(Ze=>ge.some(_t=>_t.student_id===Ze.id&&_t.present)).length,he=$-F,Pe=$>0?F/$*100:0;return{total:$,present:F,absent:he,percentage:Pe}},[ue,ge]),Z=ue.filter($=>$.name.toLowerCase().includes(_.toLowerCase())||($.email?.toLowerCase()||"").includes(_.toLowerCase())||$.phone.includes(_)||($.guardian_name||"").toLowerCase().includes(_.toLowerCase())),Y=Math.ceil(Z.length/k),Q=Z.slice((I-1)*k,I*k),Fe=async()=>{if(!O.name||!O.phone||!O.guardian_name||!O.guardian_phone){xe.error("الرجاء ملء جميع الحقول المطلوبة");return}try{await u({...O,email:O.email||void 0,class_id:t}),H(!1),W()}catch($){console.error($)}},qe=async()=>{if(!(!G||!G.id))try{await d({id:G.id,data:{...O,email:O.email||void 0,class_id:O.class_id||t}}),z(!1)}catch($){console.error($)}},lt=async $=>{if(window.confirm("هل أنت متأكد من حذف هذا الطالب؟"))try{await g($)}catch(F){console.error(F)}},re=async($,F)=>{try{await C({student_id:$,date:te,present:!F,notes:"تحديث يدوي من صفحة الفصل"}),xe.success(F?"تم تسجيل الغياب":"تم تسجيل الحضور")}catch(he){console.error(he),xe.error("حدث خطأ أثناء تحديث الحضور")}},W=()=>{ne({name:"",phone:"",email:"",class_id:t||"",guardian_name:"",guardian_phone:"",payment_status:"regular"})},ce=$=>{P($),ne({name:$.name,phone:$.phone,email:$.email||"",class_id:$.class_id||t||"",guardian_name:$.guardian_name,guardian_phone:$.guardian_phone,payment_status:$.payment_status}),z(!0)};return i||p||b?l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"جاري تحميل البيانات..."})]})}):oe?l.jsxs("div",{className:"space-y-6",dir:"rtl",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>e("/dashboard/classes"),children:l.jsx(dd,{className:"h-5 w-5"})}),l.jsxs("div",{children:[l.jsxs("h2",{className:"text-2xl font-bold text-black mb-1",children:[oe.name," - ",oe.grade_level]}),l.jsx("p",{className:"text-gray-600",children:"طلاب الفصل وإحصائيات الحضور"})]})]}),l.jsxs(me,{onClick:()=>{W(),H(!0)},className:"bg-orange-500 hover:bg-orange-600 text-black",children:[l.jsx(Xs,{className:"ml-2 h-4 w-4"}),"إضافة طالب للفصل"]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"إجمالي الطلاب"}),l.jsx(We,{className:"text-3xl font-bold",children:q.total})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2 text-green-600",children:[l.jsx(nt,{className:"text-green-600",children:"حاضر اليوم"}),l.jsx(We,{className:"text-3xl font-bold",children:q.present})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2 text-red-600",children:[l.jsx(nt,{className:"text-red-600",children:"غائب اليوم"}),l.jsx(We,{className:"text-3xl font-bold",children:q.absent})]})}),l.jsx(Se,{children:l.jsxs(Ue,{className:"pb-2",children:[l.jsx(nt,{children:"نسبة الحضور"}),l.jsxs(We,{className:"text-3xl font-bold",children:[q.percentage.toFixed(1),"%"]})]})})]}),l.jsxs(Se,{children:[l.jsx(Ue,{className:"pb-0 pt-6 px-6",children:l.jsxs("div",{className:"relative",children:[l.jsx(us,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),l.jsx(Be,{placeholder:"ابحث عن طالب...",value:_,onChange:$=>N($.target.value),className:"pr-10"})]})}),l.jsxs(ht,{className:"p-0 mt-4",children:[l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(Ln,{children:[l.jsx(Bn,{children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right",children:"اسم الطالب"}),l.jsx(Ve,{className:"text-right",children:"ولي الأمر"}),l.jsx(Ve,{className:"text-right",children:"رقم الهاتف"}),l.jsx(Ve,{className:"text-right",children:"حالة الرسوم"}),l.jsx(Ve,{className:"text-right",children:"حضور اليوم"}),l.jsx(Ve,{className:"text-center",children:"الإجراءات"})]})}),l.jsx(Fn,{children:Q.length>0?Q.map($=>{const F=ge.some(he=>he.student_id===$.id&&he.present);return l.jsxs(Tt,{children:[l.jsx(Oe,{className:"font-medium",children:$.name}),l.jsx(Oe,{children:$.guardian_name}),l.jsx(Oe,{dir:"ltr",className:"text-right",children:$.phone}),l.jsx(Oe,{children:l.jsx(vt,{variant:$.payment_status==="regular"?"default":"secondary",children:$.payment_status==="regular"?"منتظم":"معفى"})}),l.jsx(Oe,{children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs(me,{size:"sm",variant:F?"default":"outline",className:Ce("h-8 flex-1 gap-1",F?"bg-green-600 hover:bg-green-700 text-white":"text-gray-500 hover:text-green-600 border-gray-200"),onClick:()=>re($.id,F),children:[l.jsx(wl,{className:"h-3.5 w-3.5"}),F?"حاضر":"تسجيل حضور"]}),F&&l.jsx(me,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-500 hover:text-red-600 border-red-100 hover:bg-red-50",onClick:()=>re($.id,!0),title:"تسجيل غياب",children:l.jsx(R0,{className:"h-4 w-4"})})]})}),l.jsx(Oe,{children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>ce($),children:l.jsx(Ca,{className:"h-4 w-4 text-blue-500"})}),l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>{P($),V(!0)},children:l.jsx(Gs,{className:"h-4 w-4 text-purple-500"})}),l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>lt($.id||""),children:l.jsx(Oi,{className:"h-4 w-4 text-red-500"})})]})})]},$.id)}):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:6,className:"text-center text-gray-500 py-8",children:"لا توجد نتائج"})})})]})}),Y>1&&l.jsx("div",{className:"p-4 border-t",children:l.jsx(Ol,{children:l.jsxs(Rl,{children:[l.jsx(vn,{children:l.jsx(jl,{onClick:()=>T($=>Math.max(1,$-1)),className:I===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Y},($,F)=>F+1).map($=>l.jsx(vn,{children:l.jsx(ji,{isActive:I===$,onClick:()=>T($),className:"cursor-pointer",children:$})},$)),l.jsx(vn,{children:l.jsx(kl,{onClick:()=>T($=>Math.min(Y,$+1)),className:I===Y?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),l.jsx(vr,{open:M,onOpenChange:H,children:l.jsxs(Cr,{className:"sm:max-w-[500px]",onInteractOutside:$=>$.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"إضافة طالب جديد للفصل"}),l.jsx(Ur,{children:"أدخل بيانات الطالب الجديد أدناه. سيتم تعيينه لهذا الفصل تلقائياً."})]}),l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"name",children:"اسم الطالب *"}),l.jsx(Be,{id:"name",value:O.name,onChange:$=>ne({...O,name:$.target.value}),placeholder:"الاسم الثلاثي"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"phone",children:"رقم الهاتف *"}),l.jsx(Be,{id:"phone",value:O.phone,onChange:$=>ne({...O,phone:$.target.value}),placeholder:"05xxxxxxxx",dir:"ltr"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"email",children:"البريد الإلكتروني"}),l.jsx(Be,{id:"email",type:"email",value:O.email,onChange:$=>ne({...O,email:$.target.value}),placeholder:"example@email.com",dir:"ltr"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"guardianName",children:"اسم ولي الأمر *"}),l.jsx(Be,{id:"guardianName",value:O.guardian_name,onChange:$=>ne({...O,guardian_name:$.target.value}),placeholder:"اسم ولي الأمر"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"guardianPhone",children:"هاتف ولي الأمر *"}),l.jsx(Be,{id:"guardianPhone",value:O.guardian_phone,onChange:$=>ne({...O,guardian_phone:$.target.value}),placeholder:"05xxxxxxxx",dir:"ltr"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"paymentStatus",children:"حالة الرسوم"}),l.jsxs(Ht,{value:O.payment_status,onValueChange:$=>ne({...O,payment_status:$}),children:[l.jsx(qt,{id:"paymentStatus",children:l.jsx(Gt,{})}),l.jsxs(zt,{children:[l.jsx(et,{value:"regular",children:"منتظم"}),l.jsx(et,{value:"exempt",children:"معفى"})]})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>H(!1),children:"إلغاء"}),l.jsx(me,{onClick:Fe,className:"bg-orange-500 hover:bg-orange-600 text-black",children:"حفظ الطالب"})]})]})}),l.jsx(vr,{open:B,onOpenChange:z,children:l.jsxs(Cr,{className:"sm:max-w-[500px]",onInteractOutside:$=>$.preventDefault(),children:[l.jsx(_r,{children:l.jsx(Er,{children:"تعديل بيانات الطالب"})}),l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-name",children:"اسم الطالب *"}),l.jsx(Be,{id:"edit-name",value:O.name,onChange:$=>ne({...O,name:$.target.value})})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-phone",children:"رقم الهاتف *"}),l.jsx(Be,{id:"edit-phone",value:O.phone,onChange:$=>ne({...O,phone:$.target.value}),dir:"ltr"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-email",children:"البريد الإلكتروني"}),l.jsx(Be,{id:"edit-email",type:"email",value:O.email,onChange:$=>ne({...O,email:$.target.value}),dir:"ltr"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-guardianName",children:"اسم ولي الأمر *"}),l.jsx(Be,{id:"edit-guardianName",value:O.guardian_name,onChange:$=>ne({...O,guardian_name:$.target.value})})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-guardianPhone",children:"هاتف ولي الأمر *"}),l.jsx(Be,{id:"edit-guardianPhone",value:O.guardian_phone,onChange:$=>ne({...O,guardian_phone:$.target.value}),dir:"ltr"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-paymentStatus",children:"حالة الرسوم"}),l.jsxs(Ht,{value:O.payment_status,onValueChange:$=>ne({...O,payment_status:$}),children:[l.jsx(qt,{id:"edit-paymentStatus",children:l.jsx(Gt,{})}),l.jsxs(zt,{children:[l.jsx(et,{value:"regular",children:"منتظم"}),l.jsx(et,{value:"exempt",children:"معفى"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"edit-class",children:"الفصل"}),l.jsxs(Ht,{value:O.class_id,onValueChange:$=>ne({...O,class_id:$}),children:[l.jsx(qt,{id:"edit-class",children:l.jsx(Gt,{placeholder:"اختر الفصل"})}),l.jsx(zt,{children:w.map($=>l.jsxs(et,{value:$.id||"",children:[$.name," (",$.grade_level,")"]},$.id))})]})]})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>z(!1),children:"إلغاء"}),l.jsx(me,{onClick:qe,className:"bg-orange-500 hover:bg-orange-600 text-black",children:"حفظ التغييرات"})]})]})}),G&&l.jsx(xh,{open:ae,onOpenChange:V,student:{id:G.id||"",name:G.name,classes:G.classes,phone:G.phone}})]}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx("h2",{className:"text-xl font-bold mb-4",children:"الفصل غير موجود"}),l.jsx(me,{onClick:()=>e("/dashboard/classes"),children:"العودة للفصول"})]})}function dC({className:t,...e}){return l.jsx(h0,{"data-slot":"tabs",className:Ce("flex flex-col gap-2",t),...e})}function hC({className:t,...e}){return l.jsx(f0,{"data-slot":"tabs-list",className:Ce("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",t),...e})}function Hu({className:t,...e}){return l.jsx(g0,{"data-slot":"tabs-trigger",className:Ce("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...e})}function Gu({className:t,...e}){return l.jsx(m0,{"data-slot":"tabs-content",className:Ce("flex-1 outline-none",t),...e})}function fC(t,e=[]){let n=[];function i(d,g){const w=D.createContext(g);w.displayName=d+"Context";const p=n.length;n=[...n,g];const m=C=>{const{scope:_,children:N,...I}=C,T=_?.[t]?.[p]||w,k=D.useMemo(()=>I,Object.values(I));return l.jsx(T.Provider,{value:k,children:N})};m.displayName=d+"Provider";function b(C,_){const N=_?.[t]?.[p]||w,I=D.useContext(N);if(I)return I;if(g!==void 0)return g;throw new Error(`\`${C}\` must be used within \`${d}\``)}return[m,b]}const u=()=>{const d=n.map(g=>D.createContext(g));return function(w){const p=w?.[t]||d;return D.useMemo(()=>({[`__scope${t}`]:{...w,[t]:p}}),[w,p])}};return u.scopeName=t,[i,gC(u,...e)]}function gC(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(d){const g=i.reduce((w,{useScope:p,scopeName:m})=>{const C=p(d)[`__scope${m}`];return{...w,...C}},{});return D.useMemo(()=>({[`__scope${e.scopeName}`]:g}),[g])}};return n.scopeName=e.scopeName,n}var mC=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],uf=mC.reduce((t,e)=>{const n=x0(`Primitive.${e}`),i=D.forwardRef((u,d)=>{const{asChild:g,...w}=u,p=g?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),l.jsx(p,{...w,ref:d})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{}),tc="Progress",rc=100,[xC]=fC(tc),[pC,wC]=xC(tc),df=D.forwardRef((t,e)=>{const{__scopeProgress:n,value:i=null,max:u,getValueLabel:d=yC,...g}=t;(u||u===0)&&!qu(u)&&console.error(bC(`${u}`,"Progress"));const w=qu(u)?u:rc;i!==null&&!zu(i,w)&&console.error(vC(`${i}`,"Progress"));const p=zu(i,w)?i:null,m=ya(p)?d(p,w):void 0;return l.jsx(pC,{scope:n,value:p,max:w,children:l.jsx(uf.div,{"aria-valuemax":w,"aria-valuemin":0,"aria-valuenow":ya(p)?p:void 0,"aria-valuetext":m,role:"progressbar","data-state":gf(p,w),"data-value":p??void 0,"data-max":w,...g,ref:e})})});df.displayName=tc;var hf="ProgressIndicator",ff=D.forwardRef((t,e)=>{const{__scopeProgress:n,...i}=t,u=wC(hf,n);return l.jsx(uf.div,{"data-state":gf(u.value,u.max),"data-value":u.value??void 0,"data-max":u.max,...i,ref:e})});ff.displayName=hf;function yC(t,e){return`${Math.round(t/e*100)}%`}function gf(t,e){return t==null?"indeterminate":t===e?"complete":"loading"}function ya(t){return typeof t=="number"}function qu(t){return ya(t)&&!isNaN(t)&&t>0}function zu(t,e){return ya(t)&&!isNaN(t)&&t<=e&&t>=0}function bC(t,e){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${e}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${rc}\`.`}function vC(t,e){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${e}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${rc} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var CC=df,_C=ff;function Yu({className:t,value:e,...n}){return l.jsx(CC,{"data-slot":"progress",className:Ce("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...n,children:l.jsx(_C,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})})}function EC(){const{id:t}=ed(),e=va(),{students:n,isLoading:i,updateStudent:u}=ds(),d=n,{attendance:g,isLoading:w}=Ia(),p=g,{classes:m,isLoading:b}=Zs(),[C,_]=D.useState([]),[N,I]=D.useState(!1),[T,k]=D.useState({duration_days:1,reason:"",status:"suspended"}),M=D.useMemo(()=>d.find(O=>O.id===t),[d,t]),H=D.useMemo(()=>p.filter(O=>O.student_id===t),[p,t]),B=D.useMemo(()=>{if(!M?.class_id)return[];const O=d.filter(ne=>ne.class_id===M.class_id).map(ne=>ne.id);return p.filter(ne=>O.includes(ne.student_id))},[p,M,d]),z=D.useMemo(()=>{const O=H.length,ne=H.filter(q=>q.present).length,oe=O>0?ne/O*100:0,ue=B.length,te=B.filter(q=>q.present).length,ge=ue>0?te/ue*100:0;return{total:O,present:ne,rate:oe,classRate:ge}},[H,B]);D.useEffect(()=>{t&&ae()},[t]);const ae=async()=>{try{const{data:O,error:ne}=await ze.from("suspensions").select("*").eq("student_id",t).order("created_at",{ascending:!1});!ne&&O&&_(O)}catch(O){console.error("Error fetching suspensions:",O)}},V=async()=>{if(!(!t||!M))try{await u({id:t,data:{status:T.status}});const{error:O}=await ze.from("suspensions").insert([{student_id:t,duration_days:T.status==="expelled"?0:T.duration_days,reason:T.reason,start_date:new Date().toISOString().split("T")[0]}]);if(O)throw O;xe.success(T.status==="expelled"?"تم فصل الطالب نهائياً":"تم وقف الطالب مؤقتاً"),I(!1),k({duration_days:1,reason:"",status:"suspended"}),ae()}catch(O){console.error(O),xe.error("فشل تنفيذ الإجراء. تأكد من وجود صلاحيات كافية.")}},G=async()=>{if(t&&window.confirm("هل أنت متأكد من إعادة تفعيل هذا الطالب؟"))try{await u({id:t,data:{status:"active"}}),xe.success("تم إعادة تفعيل الطالب بنجاح"),ae()}catch(O){console.error(O),xe.error("فشل في إعادة التفعيل")}};if(i||w||b)return l.jsx("div",{className:"p-8 text-center text-gray-500",children:"جاري التحميل..."});if(!M)return l.jsxs("div",{className:"p-8 text-center",children:[l.jsx("p",{className:"text-gray-500 mb-4",children:"الطالب غير موجود"}),l.jsx(me,{onClick:()=>e("/dashboard/students"),children:"العودة لقائمة الطلاب"})]});const P=m.find(O=>O.id===M.class_id);return l.jsxs("div",{className:"space-y-6",dir:"rtl",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx(me,{variant:"ghost",size:"icon",onClick:()=>e("/dashboard/students"),children:l.jsx(dd,{className:"h-5 w-5"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:M.name}),l.jsxs("p",{className:"text-gray-500",children:[P?.name||"غير محدد"," - ",P?.grade_level||""]})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:M.status&&M.status!=="active"?l.jsxs(me,{variant:"default",onClick:G,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[l.jsx(Ro,{className:"h-4 w-4"}),"إعادة تفعيل الطالب"]}):l.jsxs(me,{variant:"destructive",onClick:()=>I(!0),className:"flex items-center gap-2",children:[l.jsx(To,{className:"h-4 w-4"}),"إجراء فصل/وقف"]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[l.jsxs(Se,{className:"lg:col-span-1",children:[l.jsx(Ue,{children:l.jsxs(We,{className:"text-lg flex items-center gap-2",children:[l.jsx(yi,{className:"h-5 w-5 text-orange-500"}),"البيانات الأساسية"]})}),l.jsxs(ht,{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:l.jsx(_c,{className:"h-4 w-4 text-blue-500"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-gray-500",children:"رقم الهاتف"}),l.jsx("p",{className:"text-sm font-medium",children:M.phone})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:l.jsx(yi,{className:"h-4 w-4 text-green-500"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-gray-500",children:"ولي الأمر"}),l.jsx("p",{className:"text-sm font-medium",children:M.guardian_name})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:l.jsx(_c,{className:"h-4 w-4 text-orange-500"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-gray-500",children:"هاتف ولي الأمر"}),l.jsx("p",{className:"text-sm font-medium",children:M.guardian_phone})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:l.jsx(Io,{className:"h-4 w-4 text-purple-500"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-gray-500",children:"حالة الرسوم"}),l.jsx(vt,{variant:M.payment_status==="regular"?"default":"secondary",children:M.payment_status==="regular"?"منتظم":"معفى"})]})]}),l.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-gray-50",children:[l.jsx("div",{className:`p-2 rounded-lg ${M.status==="suspended"?"bg-yellow-50":M.status==="expelled"?"bg-red-50":"bg-green-50"}`,children:l.jsx(To,{className:`h-4 w-4 ${M.status==="suspended"?"text-yellow-600":M.status==="expelled"?"text-red-600":"text-green-600"}`})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-gray-500",children:"حالة الطالب"}),l.jsx(vt,{className:M.status==="suspended"?"bg-yellow-500 hover:bg-yellow-600":M.status==="expelled"?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600",children:M.status==="suspended"?"موقوف مؤقتاً":M.status==="expelled"?"مفصول نهائياً":"مقيد بنشاط"})]})]})]})]}),l.jsxs(Se,{className:"lg:col-span-2",children:[l.jsx(Ue,{children:l.jsxs(We,{className:"text-lg flex items-center gap-2",children:[l.jsx(Ro,{className:"h-5 w-5 text-green-500"}),"تحليلات الحضور"]})}),l.jsxs(ht,{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"p-4 bg-orange-50 rounded-xl border border-orange-100",children:[l.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"نسبة حضور الطالب"}),l.jsx("div",{className:"flex items-end gap-2",children:l.jsxs("span",{className:"text-3xl font-bold text-orange-600",children:[z.rate.toFixed(1),"%"]})}),l.jsx(Yu,{value:z.rate,className:"h-2 mt-2"})]}),l.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-100",children:[l.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"متوسط حضور الفصل"}),l.jsx("div",{className:"flex items-end gap-2",children:l.jsxs("span",{className:"text-3xl font-bold text-gray-700",children:[z.classRate.toFixed(1),"%"]})}),l.jsx(Yu,{value:z.classRate,className:"h-2 mt-2"})]})]}),l.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 text-blue-700 rounded-lg text-sm",children:[l.jsx(j0,{className:"h-4 w-4"}),z.rate>=z.classRate?"أداء الطالب في الحضور أعلى من متوسط الفصل، أحسنت!":"حضور الطالب أقل من متوسط الفصل، يرجى المتابعة."]})]})]})]}),l.jsxs(dC,{defaultValue:"attendance",className:"w-full",children:[l.jsxs(hC,{className:"grid w-full grid-cols-2 lg:w-[400px]",children:[l.jsxs(Hu,{value:"attendance",className:"flex items-center gap-2",children:[l.jsx(pl,{className:"h-4 w-4"}),"سجل الحضور"]}),l.jsxs(Hu,{value:"suspensions",className:"flex items-center gap-2",children:[l.jsx(k0,{className:"h-4 w-4"}),"سجل القرارات (",C.length,")"]})]}),l.jsx(Gu,{value:"attendance",className:"mt-4",children:l.jsxs(Se,{children:[l.jsx(Ue,{children:l.jsx(We,{className:"text-md",children:"آخر سجلات الحضور"})}),l.jsx(ht,{children:l.jsxs(Ln,{children:[l.jsx(Bn,{children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right",children:"التاريخ"}),l.jsx(Ve,{className:"text-right",children:"الحالة"}),l.jsx(Ve,{className:"text-right",children:"وقت التسجيل"})]})}),l.jsx(Fn,{children:H.length>0?H.slice(0,10).map(O=>l.jsxs(Tt,{children:[l.jsx(Oe,{children:O.date}),l.jsx(Oe,{children:l.jsx(vt,{variant:O.present?"default":"destructive",children:O.present?"حاضر":"غائب"})}),l.jsx(Oe,{dir:"ltr",children:O.created_at?It(new Date(O.created_at),"hh:mm a"):"-"})]},O.id)):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:3,className:"text-center text-gray-500 py-4",children:"لا توجد سجلات حضور حالياً"})})})]})})]})}),l.jsx(Gu,{value:"suspensions",className:"mt-4",children:l.jsxs(Se,{children:[l.jsxs(Ue,{children:[l.jsx(We,{className:"text-md",children:"سجل الفصل من المدرسة"}),l.jsx(nt,{children:"عرض جميع قرارات الفصل السابقة والمدة والسبب"})]}),l.jsx(ht,{children:l.jsxs(Ln,{children:[l.jsx(Bn,{children:l.jsxs(Tt,{children:[l.jsx(Ve,{className:"text-right",children:"تاريخ البدء"}),l.jsx(Ve,{className:"text-right",children:"المدة (أيام)"}),l.jsx(Ve,{className:"text-right",children:"السبب"}),l.jsx(Ve,{className:"text-right",children:"تاريخ القرار"})]})}),l.jsx(Fn,{children:C.length>0?C.map(O=>l.jsxs(Tt,{children:[l.jsx(Oe,{children:O.start_date}),l.jsx(Oe,{children:O.duration_days}),l.jsx(Oe,{className:"max-w-[300px] truncate",children:O.reason||"-"}),l.jsx(Oe,{dir:"ltr",children:It(new Date(O.created_at),"yyyy-MM-dd")})]},O.id)):l.jsx(Tt,{children:l.jsx(Oe,{colSpan:4,className:"text-center text-gray-500 py-4",children:"لا يوجد سجل للفصل حالياً"})})})]})})]})})]}),l.jsx(vr,{open:N,onOpenChange:I,children:l.jsxs(Cr,{className:"sm:max-w-[425px]",onInteractOutside:O=>O.preventDefault(),children:[l.jsxs(_r,{children:[l.jsx(Er,{children:"تسجيل قرار فصل طالب"}),l.jsxs(Ur,{children:["يرجى تحديد مدة الفصل وسبب هذا الإجراء الإداري للطالب ",M.name,"."]})]}),l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"status",children:"نوع الإجراء *"}),l.jsxs("select",{id:"status",className:"w-full p-2 border rounded-md",value:T.status,onChange:O=>k({...T,status:O.target.value}),children:[l.jsx("option",{value:"suspended",children:"وقف مؤقت (Suspension)"}),l.jsx("option",{value:"expelled",children:"فصل نهائي (Expulsion)"})]})]}),T.status==="suspended"&&l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"duration",children:"مدة الوقف (بالأيام) *"}),l.jsx(Be,{id:"duration",type:"number",min:"1",value:T.duration_days,onChange:O=>k({...T,duration_days:parseInt(O.target.value)})})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"reason",children:"السبب *"}),l.jsx("textarea",{id:"reason",className:"w-full p-2 border rounded-md h-24",value:T.reason,onChange:O=>k({...T,reason:O.target.value}),placeholder:"مثال: مخالفة القواعد المدرسية أو عدم سداد الرسوم"})]})]}),l.jsxs(Fr,{children:[l.jsx(me,{variant:"outline",onClick:()=>I(!1),children:"إلغاء"}),l.jsx(me,{onClick:V,disabled:!T.reason,className:`${T.status==="expelled"?"bg-red-600 hover:bg-red-700":"bg-orange-600 hover:bg-orange-700"} text-white`,children:"تأكيد وحفظ الإجراء"})]})]})})]})}function AC(){const{settings:t,updateSettings:e,isUpdating:n}=Na(),{grades:i}=Dl(),{classes:u}=Zs(),[d,g]=D.useState(t.school_name),[w,p]=D.useState(t.available_stages),[m,b]=D.useState(""),[C,_]=D.useState(t.work_start_time||"08:00"),[N,I]=D.useState(t.work_end_time||"14:00");D.useEffect(()=>{g(t.school_name),p(t.available_stages),_(t.work_start_time||"08:00"),I(t.work_end_time||"14:00")},[t]);const T=()=>{e({school_name:d,work_start_time:C,work_end_time:N})},k=()=>{window.confirm("هل أنت متأكد من رغبتك في طلب إيقاف الاشتراك؟ سيتم إرسال طلبك للإدارة.")&&(e({cancel_requested:!0}),xe.info("تم إرسال طلب إيقاف الاشتراك للإدارة"))},M=()=>{if(!m.trim())return;if(w.includes(m.trim())){xe.error("هذه المرحلة موجودة بالفعل");return}const z=[...w,m.trim()];p(z),e({available_stages:z}),b("")},H=z=>{if(w.length<=1){xe.error("يجب وجود مرحلة واحدة على الأقل");return}const ae=i.filter(P=>P.stage===z);if(ae.length>0){const P=ae.reduce((ne,oe)=>ne+(oe.classCount||0),0),O=ae.reduce((ne,oe)=>ne+(oe.studentCount||0),0);xe.error(`⚠️ لا يمكن حذف هذه المرحلة لأنها مرتبطة بـ ${ae.length} مرحلة فرعية${P>0?` و ${P} فصل`:""}${O>0?` و ${O} طالب`:""}`);return}const V=u.filter(P=>P.stage===z);if(V.length>0){const P=V.reduce((O,ne)=>O+(ne.currentStudents||0),0);xe.error(`⚠️ لا يمكن حذف هذه المرحلة لأنها مرتبطة بـ ${V.length} فصل دراسي${P>0?` و ${P} طالب`:""}`);return}const G=w.filter(P=>P!==z);p(G),e({available_stages:G})},B=z=>{try{return It(new Date(z),"PPP",{locale:es})}catch{return z}};return l.jsxs("div",{className:"space-y-6",dir:"rtl",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"bg-orange-500 p-2 rounded-lg",children:l.jsx(id,{className:"h-6 w-6 text-black"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl text-black",children:"إعدادات المدرسة"}),l.jsx("p",{className:"text-gray-600",children:"إدارة هوية المدرسة والمراحل الدراسية والاشتراك"})]})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs(Se,{className:"border-none shadow-sm bg-white overflow-hidden",children:[l.jsxs(Ue,{className:"border-b border-gray-50 pb-4",children:[l.jsxs(We,{className:"flex items-center gap-2 text-lg",children:[l.jsx(gl,{className:"h-5 w-5 text-orange-500"}),"هوية المدرسة"]}),l.jsx(nt,{children:"هذه البيانات تظهر في واجهة البرنامج والتقارير"})]}),l.jsxs(ht,{className:"pt-6 space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"school-name",children:"اسم المدرسة / المنشأة"}),l.jsx(Be,{id:"school-name",value:d,onChange:z=>g(z.target.value),placeholder:"أدخل اسم المدرسة",className:"bg-gray-50 border-gray-100 focus:bg-white transition-all"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"start-time",children:"بداية الدوام"}),l.jsx(Be,{id:"start-time",type:"time",value:C,onChange:z=>_(z.target.value),className:"bg-gray-50 border-gray-100 focus:bg-white transition-all"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(_e,{htmlFor:"end-time",children:"نهاية الدوام"}),l.jsx(Be,{id:"end-time",type:"time",value:N,onChange:z=>I(z.target.value),className:"bg-gray-50 border-gray-100 focus:bg-white transition-all"})]})]}),l.jsxs(me,{onClick:T,disabled:n||d===t.school_name&&C===t.work_start_time&&N===t.work_end_time,className:"bg-orange-500 hover:bg-orange-600 text-black w-full font-bold shadow-md shadow-orange-500/20",children:[l.jsx(D0,{className:"ml-2 h-4 w-4"}),"حفظ التغييرات"]})]})]}),l.jsxs(Se,{className:"border-none shadow-sm bg-white overflow-hidden",children:[l.jsxs(Ue,{className:"border-b border-gray-50 pb-4",children:[l.jsxs(We,{className:"flex items-center gap-2 text-lg",children:[l.jsx(P0,{className:"h-5 w-5 text-orange-500"}),"الاشتراك والخدمات"]}),l.jsx(nt,{children:"تحكم في اشتراكك وخدماتك البريميوم"})]}),l.jsxs(ht,{className:"pt-6 space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between p-4 bg-orange-50/50 rounded-2xl border border-orange-100",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-orange-600 font-medium mb-1",children:"نوع الباقة"}),l.jsx("p",{className:"text-xl font-black text-orange-950",children:t.subscription_type})]}),l.jsxs("div",{className:"flex flex-col items-end gap-2",children:[l.jsx(vt,{className:"bg-green-500 text-white hover:bg-green-600 border-none px-4 py-1",children:"نشط"}),l.jsxs("span",{className:"text-[10px] text-gray-500 flex items-center gap-1",children:[l.jsx(pl,{className:"h-3 w-3"}),"ينتهي في: ",B(t.expiry_date)]})]})]}),l.jsx("div",{className:"space-y-4",children:l.jsx("div",{className:"pt-4 border-t border-gray-50",children:t.cancel_requested?l.jsxs("div",{className:"bg-yellow-50 p-3 rounded-xl border border-yellow-100 flex items-center gap-3 text-yellow-700 text-sm",children:[l.jsx(Ms,{className:"h-5 w-5 flex-shrink-0"}),l.jsx("span",{children:"تم إرسال طلب إيقاف الاشتراك، جارِ معالجته من قبل الإدارة."})]}):l.jsxs(me,{onClick:k,variant:"outline",className:"w-full text-red-500 border-red-100 hover:bg-red-50 hover:text-red-700 hover:border-red-200 transition-all text-xs",children:[l.jsx(M0,{className:"ml-2 h-4 w-4"}),"طلب إيقاف الاشتراك"]})})})]})]}),l.jsxs(Se,{className:"lg:col-span-2 border-none shadow-sm bg-white overflow-hidden",children:[l.jsxs(Ue,{className:"border-b border-gray-50 pb-4",children:[l.jsxs(We,{className:"flex items-center gap-2 text-lg",children:[l.jsx(L0,{className:"h-5 w-5 text-orange-500"}),"المراحل الدراسية العامة"]}),l.jsx(nt,{children:"قم بتعريف المراحل الأساسية (مثل: ابتدائي، حضانة، إلخ). ستظهر هذه الخيارات عند إضافة مراحل دراسية جديدة."})]}),l.jsxs(ht,{className:"pt-6 space-y-6",children:[l.jsx("div",{className:"flex flex-wrap gap-2 min-h-[40px]",children:w.map(z=>l.jsxs(vt,{variant:"secondary",className:"px-4 py-2 text-sm flex items-center gap-2 bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100 transition-all font-medium rounded-full",children:[z,l.jsx("button",{onClick:()=>H(z),className:"text-gray-400 hover:text-red-500 transition-colors",children:l.jsx(ml,{className:"h-4 w-4"})})]},z))}),l.jsxs("div",{className:"flex items-end gap-2 max-w-md pt-4 bg-gray-50/50 p-4 rounded-2xl border border-gray-100",children:[l.jsxs("div",{className:"flex-1 space-y-2",children:[l.jsx(_e,{className:"text-xs font-bold text-gray-600 mr-1",children:"إضافة مرحلة عامة جديدة"}),l.jsx(Be,{value:m,onChange:z=>b(z.target.value),placeholder:"مثال: التمهيدي",className:"bg-white border-gray-200",onKeyPress:z=>z.key==="Enter"&&M()})]}),l.jsxs(me,{onClick:M,className:"bg-black hover:bg-gray-800 text-white shadow-lg",children:[l.jsx(Xs,{className:"ml-2 h-4 w-4"}),"إضافة"]})]})]})]})]})]})}var NC=(t,e,n,i,u,d,g,w)=>{let p=document.documentElement,m=["light","dark"];function b(N){(Array.isArray(t)?t:[t]).forEach(I=>{let T=I==="class",k=T&&d?u.map(M=>d[M]||M):u;T?(p.classList.remove(...k),p.classList.add(d&&d[N]?d[N]:N)):p.setAttribute(I,N)}),C(N)}function C(N){w&&m.includes(N)&&(p.style.colorScheme=N)}function _(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(i)b(i);else try{let N=localStorage.getItem(e)||n,I=g&&N==="system"?_():N;b(I)}catch{}},SC=D.createContext(void 0),IC={setTheme:t=>{},themes:[]},TC=()=>{var t;return(t=D.useContext(SC))!=null?t:IC};D.memo(({forcedTheme:t,storageKey:e,attribute:n,enableSystem:i,enableColorScheme:u,defaultTheme:d,value:g,themes:w,nonce:p,scriptProps:m})=>{let b=JSON.stringify([n,e,d,t,w,g,i,u]).slice(1,-1);return D.createElement("script",{...m,suppressHydrationWarning:!0,nonce:typeof window>"u"?p:"",dangerouslySetInnerHTML:{__html:`(${NC.toString()})(${b})`}})});const OC=({...t})=>{const{theme:e="system"}=TC();return l.jsx(B0,{theme:e,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...t})},RC=D.lazy(()=>_a(()=>import("./Login-By29LvfG.js"),__vite__mapDeps([0,1,2,3]))),jC=D.lazy(()=>_a(()=>import("./Register-D-_rYn1e.js"),__vite__mapDeps([4,1,2,3]))),kC=D.lazy(()=>_a(()=>import("./ForgetPassword-ChyRMPM7.js"),__vite__mapDeps([5,1,2,3]))),DC=D.lazy(()=>_a(()=>import("./VerifyEmail-B1ehFFIg.js"),__vite__mapDeps([6,1,2,3])));function PC(){const[t,e]=D.useState(!1),[n,i]=D.useState(!1),[u,d]=D.useState("");D.useEffect(()=>{ze.auth.getSession().then(({data:{session:b}})=>{e(!!b),b?.user?.email&&(d(b.user.email),i(!!b.user.email_confirmed_at))});const{data:{subscription:m}}=ze.auth.onAuthStateChange((b,C)=>{e(!!C),C?.user?.email?(d(C.user.email),i(!!C.user.email_confirmed_at)):(d(""),i(!1))});return()=>m.unsubscribe()},[]);const g=async()=>{try{await ze.auth.signOut(),localStorage.clear()}catch(m){console.error("Error signing out:",m)}},w=()=>{i(!0)},p=m=>{console.log("Login callback triggered for:",m)};return l.jsxs("div",{dir:"rtl",className:"min-h-screen bg-white",children:[l.jsx(b0,{children:l.jsx(D.Suspense,{fallback:l.jsx(N1,{}),children:l.jsxs(v0,{children:[l.jsx(pr,{path:"/",element:l.jsx(Or,{to:t?"/dashboard":"/login",replace:!0})}),l.jsx(pr,{path:"/login",element:t?l.jsx(Or,{to:"/dashboard"}):l.jsx(RC,{onLogin:p})}),l.jsx(pr,{path:"/register",element:t?l.jsx(Or,{to:"/dashboard"}):l.jsx(jC,{onRegister:p})}),l.jsx(pr,{path:"/forget-password",element:l.jsx(kC,{})}),l.jsx(pr,{path:"/verify-email",element:l.jsx(DC,{email:u,onVerify:w})}),l.jsx(pr,{path:"/dashboard",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(xu,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/students",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(xu,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/classes",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(_p,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/grades",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(Ep,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/payments",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(sv,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/reports",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(av,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/qr-scanner",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(cC,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/students/:id",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(EC,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/classes/:id",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(uC,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"/dashboard/settings",element:t?l.jsx(dn,{onLogout:g,isVerified:n,userEmail:u,onVerify:w,children:l.jsx(AC,{})}):l.jsx(Or,{to:"/login"})}),l.jsx(pr,{path:"*",element:l.jsx(Or,{to:"/",replace:!0})})]})})}),l.jsx(OC,{position:"top-center",dir:"rtl"})]})}const MC=new d1;W0.createRoot(document.getElementById("root")).render(l.jsx(h1,{client:MC,children:l.jsx(PC,{})}));export{me as B,Se as C,Be as I,_e as L,Ue as a,We as b,nt as c,ht as d,WC as e,op as f,gu as g,jn as h,lp as i,ze as s};
